/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.lens_bundle_jsonpfunction=window.lens_bundle_jsonpfunction||[]).push([[1,4],Array(75).concat([function(e,t,n){"use strict";n.r(t),n.d(t,"visualizationTypes",(function(){return d}));var a=n(0),i=n(14),r=n.n(i),s=(n(6),n(4));var l=n(88);var o=n(89);const u=a.i18n.translate("xpack.lens.xyVisualization.barGroupLabel",{defaultMessage:"Bar"}),c=a.i18n.translate("xpack.lens.xyVisualization.lineGroupLabel",{defaultMessage:"Line and area"}),d=[{id:"bar",icon:({title:e,titleId:t,...n})=>Object(s.jsx)("svg",r()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(s.jsx)("title",{id:t},e):null,Object(s.jsx)("path",{d:"M5 7a1 1 0 011 1v13a1 1 0 01-1 1H1a1 1 0 01-1-1V8a1 1 0 011-1h4zm16-7a1 1 0 011 1v20a1 1 0 01-1 1h-4a1 1 0 01-1-1V1a1 1 0 011-1h4z",className:"lensChartIcon__subdued"}),Object(s.jsx)("path",{d:"M13 11a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1v-9a1 1 0 011-1h4zm16-7a1 1 0 011 1v16a1 1 0 01-1 1h-4a1 1 0 01-1-1V5a1 1 0 011-1h4z",className:"lensChartIcon__accent"})),label:a.i18n.translate("xpack.lens.xyVisualization.barLabel",{defaultMessage:"Bar vertical"}),groupLabel:u},{id:"bar_horizontal",icon:o.a,label:a.i18n.translate("xpack.lens.xyVisualization.barHorizontalLabel",{defaultMessage:"H. Bar"}),fullLabel:a.i18n.translate("xpack.lens.xyVisualization.barHorizontalFullLabel",{defaultMessage:"Bar horizontal"}),groupLabel:u},{id:"bar_stacked",icon:l.a,label:a.i18n.translate("xpack.lens.xyVisualization.stackedBarLabel",{defaultMessage:"Bar vertical stacked"}),groupLabel:u},{id:"bar_percentage_stacked",icon:({title:e,titleId:t,...n})=>Object(s.jsx)("svg",r()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(s.jsx)("title",{id:t},e):null,Object(s.jsx)("path",{d:"M6 13v8a1 1 0 01-1 1H1a1 1 0 01-1-1v-8h6zm8-4v12a1 1 0 01-1 1H9a1 1 0 01-1-1V9h6zm8 4v8a1 1 0 01-1 1h-4a1 1 0 01-1-1v-8h6zm8 1v7a1 1 0 01-1 1h-4a1 1 0 01-1-1v-7h6z",className:"lensChartIcon__subdued"}),Object(s.jsx)("path",{d:"M29 0a1 1 0 011 1v11h-6V1a1 1 0 011-1h4zM5 0a1 1 0 011 1v10H0V1a1 1 0 011-1h4zm16 0a1 1 0 011 1v10h-6V1a1 1 0 011-1h4zm-8 0a1 1 0 011 1v6H8V1a1 1 0 011-1h4z",className:"lensChartIcon__accent"})),label:a.i18n.translate("xpack.lens.xyVisualization.stackedPercentageBarLabel",{defaultMessage:"Bar vertical percentage"}),groupLabel:u},{id:"bar_horizontal_stacked",icon:({title:e,titleId:t,...n})=>Object(s.jsx)("svg",r()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(s.jsx)("title",{id:t},e):null,Object(s.jsx)("path",{d:"M18 16v6H1a1 1 0 01-1-1v-4a1 1 0 011-1h17zm-3-8v6H1.222C.547 14 0 13.552 0 13V9c0-.552.547-1 1.222-1H15zm1-8v6H1.042C.466 6 0 5.552 0 5V1c0-.552.466-1 1.042-1H16z",className:"lensChartIcon__subdued"}),Object(s.jsx)("path",{d:"M29 16a1 1 0 011 1v4a1 1 0 01-1 1h-9v-6h9zm-9.222-8C20.453 8 21 8.448 21 9v4c0 .552-.547 1-1.222 1H17V8h2.778zm3.18-8C23.534 0 24 .448 24 1v4c0 .552-.466 1-1.042 1H18V0h4.958z",className:"lensChartIcon__accent"})),label:a.i18n.translate("xpack.lens.xyVisualization.stackedBarHorizontalLabel",{defaultMessage:"H. Stacked bar"}),fullLabel:a.i18n.translate("xpack.lens.xyVisualization.stackedBarHorizontalFullLabel",{defaultMessage:"Bar horizontal stacked"}),groupLabel:u},{id:"bar_horizontal_percentage_stacked",icon:({title:e,titleId:t,...n})=>Object(s.jsx)("svg",r()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(s.jsx)("title",{id:t},e):null,Object(s.jsx)("path",{d:"M20 16v6H1a1 1 0 01-1-1v-4a1 1 0 011-1h19zm-3-8v6H1.222C.547 14 0 13.552 0 13V9c0-.552.547-1 1.222-1H17zm1-8v6H1.042C.466 6 0 5.552 0 5V1c0-.552.466-1 1.042-1H18z",className:"lensChartIcon__subdued"}),Object(s.jsx)("path",{d:"M29 16a1 1 0 011 1v4a1 1 0 01-1 1h-7v-6h7zm-.222-8C29.453 8 30 8.448 30 9v4c0 .552-.547 1-1.222 1H19V8h9.778zm.18-8C29.534 0 30 .448 30 1v4c0 .552-.466 1-1.042 1H20V0h8.958z",className:"lensChartIcon__accent"})),label:a.i18n.translate("xpack.lens.xyVisualization.stackedPercentageBarHorizontalLabel",{defaultMessage:"H. Percentage bar"}),fullLabel:a.i18n.translate("xpack.lens.xyVisualization.stackedPercentageBarHorizontalFullLabel",{defaultMessage:"Bar horizontal percentage"}),groupLabel:u},{id:"area",icon:({title:e,titleId:t,...n})=>Object(s.jsx)("svg",r()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(s.jsx)("title",{id:t},e):null,Object(s.jsx)("path",{d:"M30 6v15a1 1 0 01-1 1H1a1 1 0 01-1-1v-2c1 0 3.5-4 6-4s5 3 6 3 3.23-6.994 5.865-6.997C20.5 11 23 11 24 11s3-5 6-5z",className:"lensChartIcon__accent"}),Object(s.jsx)("path",{d:"M6 1c3 0 5 6 6 6s3.5-3 6-3c1.667 0 2.944 2.333 3.833 6.999l.309.001c-1.013 0-2.27 0-3.593.002h-.684C15.231 11.007 13 18 12 18s-3.5-3-6-3-5 4-6 4V7c1-1.5 3-6 6-6z",className:"lensChartIcon__subdued"})),label:a.i18n.translate("xpack.lens.xyVisualization.areaLabel",{defaultMessage:"Area"}),groupLabel:c},{id:"area_stacked",icon:({title:e,titleId:t,...n})=>Object(s.jsx)("svg",r()({viewBox:"0 0 30 22",width:31,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(s.jsx)("title",{id:t},e):null,Object(s.jsx)("path",{d:"M0 15.213l.484.091.813.146.762.129C3.779 15.859 5.09 16 6 16c.986 0 1.712-.25 3.166-.966l.281-.14C10.802 14.217 11.381 14 12 14c.507 0 .988.146 1.89.571l1.209.592c1.28.617 1.977.837 2.901.837 1.028 0 1.75-.349 3.119-1.344l.89-.659C23.034 13.252 23.535 13 24 13c.581 0 1.232.185 2.598.718l1.1.436.568.217c.72.27 1.256.438 1.736.532L30 21a1 1 0 01-1 1H1a1 1 0 01-1-1v-5.787z",className:"lensChartIcon__accent"}),Object(s.jsx)("path",{d:"M24 1c1.334 0 3.334 1 6 3v8.842l-.324-.098c-.346-.11-.759-.262-1.273-.462l-1.101-.436-.568-.217-.536-.193C25.277 11.118 24.676 11 24 11c-1.028 0-1.75.349-3.119 1.344l-.89.659c-1.024.745-1.524.997-1.99.997-.508 0-.989-.146-1.89-.571l-1.21-.592c-1.28-.617-1.977-.837-2.9-.837-.987 0-1.713.25-3.167.966l-.281.14C7.198 13.783 6.619 14 6 14l-.334-.007c-1.182-.045-3.08-.317-5.665-.815V9c2 0 4.666 1 6 1 2 0 4-4 6-4s4 1 6 1 4-6 6-6z",className:"lensChartIcon__subdued"})),label:a.i18n.translate("xpack.lens.xyVisualization.stackedAreaLabel",{defaultMessage:"Area stacked"}),groupLabel:c},{id:"area_percentage_stacked",icon:({title:e,titleId:t,...n})=>Object(s.jsx)("svg",r()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(s.jsx)("title",{id:t},e):null,Object(s.jsx)("path",{d:"M0 13v8a1 1 0 001 1h28a1 1 0 001-1V9.25c-1.251-.929-2.45-1.734-3.493-2.313a11.028 11.028 0 00-1.478-.703C24.592 6.072 24.25 6 24 6c-.262 0-.63.212-1.126.77-.472.53-.952 1.249-1.458 2.007l-.013.02c-.49.736-1.006 1.51-1.53 2.098C19.37 11.462 18.739 12 18 12c-1.062 0-2.112-.263-3.092-.508l-.03-.007C13.869 11.232 12.929 11 12 11c-.337 0-.729.171-1.2.525-.466.35-.94.822-1.446 1.329l-.015.015c-.49.489-1.01 1.01-1.539 1.406-.529.396-1.137.725-1.8.725-.657 0-1.57-.212-2.48-.424l-.058-.014C2.275 14.287 1.032 14 0 14v-1z",className:"lensChartIcon__accent"}),Object(s.jsx)("path",{d:"M29 0a1 1 0 011 1v6.012c-1.06-.764-2.085-1.437-3.007-1.95a11.93 11.93 0 00-1.616-.765C24.887 4.115 24.418 4 24 4c-.738 0-1.369.538-1.874 1.105-.523.589-1.039 1.362-1.529 2.098l-.013.02c-.506.758-.985 1.476-1.458 2.007-.495.558-.864.77-1.126.77-.928 0-1.867-.232-2.879-.485l-.029-.007C14.112 9.263 13.062 9 12 9c-.663 0-1.271.328-1.8.725-.528.396-1.05.917-1.538 1.406l-.015.015c-.507.507-.98.98-1.447 1.329-.471.354-.863.525-1.2.525-.528 0-1.328-.183-2.311-.412l-.034-.007C2.507 12.314 1.159 12 .001 12V1a1 1 0 011-1h28z",className:"lensChartIcon__subdued"})),label:a.i18n.translate("xpack.lens.xyVisualization.stackedPercentageAreaLabel",{defaultMessage:"Area percentage"}),groupLabel:c},{id:"line",icon:({title:e,titleId:t,...n})=>Object(s.jsx)("svg",r()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(s.jsx)("title",{id:t},e):null,Object(s.jsx)("path",{d:"M23.434 16.456c.211.553.406.982.58 1.277l.073.119c.038.058.072.105.101.141.52-.04 1.07-.248 2.13-.77l.235-.117C28.198 16.283 28.953 16 30 16v2c-.507 0-.988.146-1.89.571l-1.209.592C25.621 19.78 24.924 20 24 20l-.174-.005c-1.251-.076-1.805-1.036-2.994-4.993L22.93 15c.18.563.335 1.012.505 1.455zM6 1c1.269 0 1.966.69 3.492 2.939l.774 1.146.272.387.26.358C11.419 6.658 11.788 7 12 7c.466 0 .967-.252 1.99-.997l.891-.659.458-.325C16.424 4.272 17.093 4 18 4c1.377 0 1.925.863 3.168 4.999L19.07 9a26.766 26.766 0 00-.505-1.457c-.24-.631-.46-1.1-.652-1.395l-.051-.074-.045-.06c-.452.064-.988.375-2.007 1.13l-.691.512-.458.325C13.576 8.728 12.907 9 12 9c-1.269 0-1.966-.69-3.492-2.939l-.774-1.146-.272-.387-.26-.358C6.581 3.342 6.213 3 6 3c-.294 0-.885.651-2.017 2.33l-.491.731-.326.475C1.859 8.409 1.175 9 0 9V7c.294 0 .885-.651 2.017-2.33l.491-.731.326-.475C4.141 1.591 4.825 1 6 1z",className:"lensChartIcon__subdued"}),Object(s.jsx)("path",{d:"M0 21c1.123 0 1.852-.477 3.295-1.885l.758-.75.345-.33C5.208 17.275 5.648 17 6 17c.466 0 .967.252 1.99.997l.891.659.458.325C10.424 19.728 11.093 20 12 20c1.325 0 1.996-.772 3.546-3.444l.593-1.028.385-.646C17.328 13.562 17.796 13 18 13h6c1.333 0 1.978-.795 3.452-3.676l.692-1.37.358-.69C29.333 5.7 29.831 5 30 5V3c-1.333 0-1.978.795-3.452 3.676l-.692 1.37-.358.69C24.667 10.3 24.169 11 24 11h-6c-1.325 0-1.996.772-3.546 3.444l-.593 1.028-.385.646C12.672 17.438 12.204 18 12 18c-.466 0-.967-.252-1.99-.997l-.891-.659-.458-.325C7.576 15.272 6.907 15 6 15c-1.123 0-1.852.477-3.295 1.885l-.758.75-.345.33C.792 18.725.352 19 0 19v2z",className:"lensChartIcon__accent"})),label:a.i18n.translate("xpack.lens.xyVisualization.lineLabel",{defaultMessage:"Line"}),groupLabel:c}]},,,function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return l}));const a="---",i="›";function r(e,t){return`${e}${a}${t}`}function s(e){if(e.includes(a)){const t=e.split(a);return t[t.length-1]}return e}function l(e,t,n){e.columns.filter((e=>e.isTransposed)).reverse().forEach((({columnId:a})=>{const s=t.columns.findIndex((e=>e.id===a)),l=t.columns[s],o=n[l.id],{uniqueValues:u,uniqueRawValues:c}=function(e,t,n){const a=new Map;e.rows.forEach((e=>{const i=e[n];a.set(t.convert(e[n]),i)}));const i=[...a.keys()],r=[...a.values()];return{uniqueValues:i,uniqueRawValues:r}}(t,o,a),d=e.columns.filter((e=>e.transposable)),p=e.columns.filter((e=>!e.transposable&&e.columnId!==a));t.columns.splice(s,1),function(e,t,n,a,s,l,o){const u=n.map((e=>{const t=a.columns.find((t=>t.id===e.columnId)),n=s.map((n=>({...t,id:r(n,e.columnId),name:`${n} ${i} ${t.name}`})));return a.columns.splice(a.columns.findIndex((t=>t.id===e.columnId)),1,...n),s.map(((n,a)=>({...e,columnId:r(n,e.columnId),originalColumnId:e.originalColumnId||e.columnId,originalName:e.originalName||t.name,bucketValues:[...e.bucketValues||[],{originalBucketColumn:o,value:l[a]}]})))}));!function(e,t,n){var a;e.columns=[...t],null===(a=n[0])||void 0===a||a.forEach(((t,a)=>{n.forEach((t=>{e.columns.push(t[a])}))}))}(e,t,u)}(e,p,d,t,u,c,l),function(e,t,n,a,i,s){const l=function(e,t,n){const a={};return e.rows.forEach((e=>{const i=t.map((t=>n[t.columnId].convert(e[t.columnId]))).join(",");a[i]||(a[i]=[]),a[i].push(e)})),a}(e,t,n);e.rows=function(e,t,n,a,i){return Object.values(e).map((e=>{const s={};return t.forEach((t=>{s[t.columnId]=e[0][t.columnId]})),e.forEach((e=>{const t=n.convert(e[a]);i.forEach((n=>{s[r(t,n.columnId)]=e[n.columnId]}))})),s}))}(l,t,a,i,s)}(t,p,n,o,a,d)}))}},,,,function(e,t,n){e.exports=n(15)(2404)},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(78);function i(e){return"number"==typeof e||null==e}function r(e,t){var n;return"number"===(null==e||null===(n=e.columns.find((e=>e.id===t||Object(a.a)(e.id)===t)))||void 0===n?void 0:n.meta.type)&&(null==e?void 0:e.rows.every((e=>{const n=e[t];return i(n)||Array.isArray(n)&&n.every(i)})))}},,,,function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return l})),n.d(t,"d",(function(){return o})),n.d(t,"a",(function(){return u}));var a=n(0),i=n(78),r=n(83);function s(e,t,n){var a;const i=Object(r.a)(n,e)&&(null==t?void 0:t.summaryRow)||"none";return{summaryRow:i,summaryLabel:null!==(a=null==t?void 0:t.summaryLabel)&&void 0!==a?a:l(i)}}function l(e){return o().find((({value:t})=>e===t)).label}function o(){return[{value:"none",label:a.i18n.translate("xpack.lens.table.summaryRow.none",{defaultMessage:"None"}),"data-test-subj":"lns-datatable-summary-none"},{value:"count",label:a.i18n.translate("xpack.lens.table.summaryRow.count",{defaultMessage:"Value count"}),"data-test-subj":"lns-datatable-summary-count"},{value:"sum",label:a.i18n.translate("xpack.lens.table.summaryRow.sum",{defaultMessage:"Sum"}),"data-test-subj":"lns-datatable-summary-sum"},{value:"avg",label:a.i18n.translate("xpack.lens.table.summaryRow.average",{defaultMessage:"Average"}),"data-test-subj":"lns-datatable-summary-avg"},{value:"min",label:a.i18n.translate("xpack.lens.table.summaryRow.minimum",{defaultMessage:"Minimum"}),"data-test-subj":"lns-datatable-summary-min"},{value:"max",label:a.i18n.translate("xpack.lens.table.summaryRow.maximum",{defaultMessage:"Maximum"}),"data-test-subj":"lns-datatable-summary-max"}]}function u(e,t,n,a){const r=function(e,t,n){const a=n.filter((e=>null!=e[t])).flatMap((e=>e[t])),i=a.length,r=a.reduce(((e,t)=>e+t),0);switch(e){case"sum":return r;case"count":return i;case"avg":return r/i;case"min":return Math.min(...a);case"max":return Math.max(...a);default:throw Error("No summary function found")}}(e.summaryRow,e.columnId,t.rows);return"count"===e.summaryRow?a.convert(r):n[Object(i.a)(e.columnId)].convert(r)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(14),i=n.n(a),r=(n(6),n(4));const s=({title:e,titleId:t,...n})=>Object(r.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(r.jsx)("title",{id:t},e):null,Object(r.jsx)("path",{className:"lensChartIcon__subdued",d:"M6 13v8a1 1 0 01-1 1H1a1 1 0 01-1-1v-8h6zm8-4v12a1 1 0 01-1 1H9a1 1 0 01-1-1V9h6zm8 4v8a1 1 0 01-1 1h-4a1 1 0 01-1-1v-8h6zm8 1v7a1 1 0 01-1 1h-4a1 1 0 01-1-1v-7h6z"}),Object(r.jsx)("path",{d:"M29 1a1 1 0 011 1v10h-6V2a1 1 0 011-1h4zM5 7a1 1 0 011 1v3H0V8a1 1 0 011-1h4zm16-4a1 1 0 011 1v7h-6V4a1 1 0 011-1h4zm-8-3a1 1 0 011 1v6H8V1a1 1 0 011-1h4z",className:"lensChartIcon__accent"}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(14),i=n.n(a),r=(n(6),n(4));const s=({title:e,titleId:t,...n})=>Object(r.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(r.jsx)("title",{id:t},e):null,Object(r.jsx)("path",{d:"M29 16a1 1 0 011 1v4a1 1 0 01-1 1H1a1 1 0 01-1-1v-4a1 1 0 011-1h28zM22 0a1 1 0 011 1v4a1 1 0 01-1 1H1a1 1 0 01-1-1V1a1 1 0 011-1h21z",className:"lensChartIcon__subdued"}),Object(r.jsx)("path",{d:"M0 9a1 1 0 011-1h15a1 1 0 011 1v4a1 1 0 01-1 1H1a1 1 0 01-1-1V9z",className:"lensChartIcon__accent"}))},function(e,t,n){switch(window.__kbnThemeTag__){case"v7dark":return n(238);case"v7light":return n(240);case"v8dark":return n(242);case"v8light":return n(244)}},,function(e,t,n){e.exports=n(15)(2401)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KBN_FIELD_TYPES=t.ES_FIELD_TYPES=void 0;t.ES_FIELD_TYPES=function(e){return e._ID="_id",e._INDEX="_index",e._SOURCE="_source",e._TYPE="_type",e.STRING="string",e.TEXT="text",e.KEYWORD="keyword",e.VERSION="version",e.BOOLEAN="boolean",e.OBJECT="object",e.DATE="date",e.DATE_NANOS="date_nanos",e.DATE_RANGE="date_range",e.GEO_POINT="geo_point",e.GEO_SHAPE="geo_shape",e.FLOAT="float",e.HALF_FLOAT="half_float",e.SCALED_FLOAT="scaled_float",e.DOUBLE="double",e.INTEGER="integer",e.LONG="long",e.SHORT="short",e.UNSIGNED_LONG="unsigned_long",e.FLOAT_RANGE="float_range",e.DOUBLE_RANGE="double_range",e.INTEGER_RANGE="integer_range",e.LONG_RANGE="long_range",e.NESTED="nested",e.BYTE="byte",e.IP="ip",e.IP_RANGE="ip_range",e.ATTACHMENT="attachment",e.TOKEN_COUNT="token_count",e.MURMUR3="murmur3",e.HISTOGRAM="histogram",e}({}),t.KBN_FIELD_TYPES=function(e){return e._SOURCE="_source",e.ATTACHMENT="attachment",e.BOOLEAN="boolean",e.DATE="date",e.DATE_RANGE="date_range",e.GEO_POINT="geo_point",e.GEO_SHAPE="geo_shape",e.IP="ip",e.IP_RANGE="ip_range",e.MURMUR3="murmur3",e.NUMBER="number",e.NUMBER_RANGE="number_range",e.STRING="string",e.UNKNOWN="unknown",e.CONFLICT="conflict",e.OBJECT="object",e.NESTED="nested",e.HISTOGRAM="histogram",e.MISSING="missing",e}({})},,,,,,function(e,t){e.exports={pow:function(e,t){if(null==t)throw new Error("Missing exponent");if(Array.isArray(e))return e.map((e=>Math.pow(e,t)));return Math.pow(e,t)}}},function(e,t,n){e.exports=n(15)(2403)},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));const a={number:{decimalsToPattern:(e=2)=>0===e?"0,0":`0,0.${"0".repeat(e)}`},percent:{decimalsToPattern:(e=2)=>0===e?"0,0%":`0,0.${"0".repeat(e)}%`},bytes:{decimalsToPattern:(e=2)=>0===e?"0,0b":`0,0.${"0".repeat(e)}b`}}},function(e,t,n){switch(window.__kbnThemeTag__){case"v7dark":return n(356);case"v7light":return n(358);case"v8dark":return n(360);case"v8light":return n(362)}},,,,,,,,,,,,,function(e,t,n){const{get:a}=n(39),i=n(91),{parse:r}=n(267),{functions:s}=n(268);const l=i((function(e,t){if(null==e)throw new Error("Missing expression");if("string"!=typeof e)throw new Error("Expression must be a string");try{return r(e,t)}catch(e){throw new Error(`Failed to parse expression. ${e.message}`)}}));function o(e,t,n){const i=Object.assign({},s,n);return r(e);function r(e){if("number"==typeof e)return e;if("function"===e.type)return function(e){const{name:t,args:n}=e,a=i[t];if(!a)throw new Error(`No such function: ${t}`);const s=n.map(r);return a.skipNumberValidation||u(s)?a(...s):NaN}(e);if("variable"===e.type){const n=function(e,t){const n=a(e,t);return void 0!==n?n:e[t]}(t,e.value);if(void 0===n)throw new Error(`Unknown variable: ${e.value}`);return n}if("namedArgument"===e.type)throw new Error(`Named arguments are not supported in tinymath itself, at ${e.name}`)}}function u(e){return e.every((e=>Array.isArray(e)?u(e):"number"==typeof e&&!isNaN(e)))}e.exports={parse:l,evaluate:function(e,t={},n={}){return t=t||{},o(l(e),t,n)},interpret:o}},function(e,t){e.exports={add:function(...e){if(1===e.length)return Array.isArray(e[0])?e[0].reduce(((e,t)=>e+t)):e[0];return e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,n)=>e+t[n]))}return Array.isArray(e)?e.map((e=>e+t)):Array.isArray(t)?t.map((t=>t+e)):e+t}))}}},function(e,t){function n(e){if(Array.isArray(e))return e.length;throw new Error("Must pass an array")}e.exports={size:n},n.skipNumberValidation=!0},function(e,t){const n=(e,t)=>Math.log(e)/Math.log(t);e.exports={log:function(e,t=Math.E){if(t<=0)throw new Error("Base out of range");if(Array.isArray(e))return e.map((e=>{if(e<0)throw new Error("Must be greater than 0");return n(e,t)}));if(e<0)throw new Error("Must be greater than 0");return n(e,t)}}},function(e,t){e.exports={max:function(...e){if(1===e.length)return Array.isArray(e[0])?e[0].reduce(((e,t)=>Math.max(e,t))):e[0];return e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,n)=>Math.max(e,t[n])))}return Array.isArray(e)?e.map((e=>Math.max(e,t))):Array.isArray(t)?t.map((t=>Math.max(t,e))):Math.max(e,t)}))}}},function(e,t){e.exports={transpose:function(e,t){const n=e[t].length;return e[t].map(((t,a)=>e.map((e=>{if(Array.isArray(e)){if(e.length!==n)throw new Error("Array length mismatch");return e[a]}return e}))))}}},function(e,t){e.exports={min:function(...e){if(1===e.length)return Array.isArray(e[0])?e[0].reduce(((e,t)=>Math.min(e,t))):e[0];return e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,n)=>Math.min(e,t[n])))}return Array.isArray(e)?e.map((e=>Math.min(e,t))):Array.isArray(t)?t.map((t=>Math.min(t,e))):Math.min(e,t)}))}}},function(e,t){e.exports={subtract:function(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,n)=>e-t[n]))}return Array.isArray(e)?e.map((e=>e-t)):Array.isArray(t)?t.map((t=>e-t)):e-t}}},function(e,t,n){e.exports=n(15)(495)},function(e,t,n){"use strict";function a(e,t,n,i){var r=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(r,a.prototype),r.expected=t,r.found=n,r.location=i,r.name="SyntaxError",r}function i(e,t,n){return n=n||" ",e.length>t?e:(t-=e.length,e+(n+=n.repeat(t)).slice(0,t))}!function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}(a,Error),a.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var n,a=null;for(n=0;n<e.length;n++)if(e[n].source===this.location.source){a=e[n].text.split(/\r\n|\n|\r/g);break}var r=this.location.start,s=this.location.source+":"+r.line+":"+r.column;if(a){var l=this.location.end,o=i("",r.line.toString().length),u=a[r.line-1],c=r.line===l.line?l.column:u.length+1;t+="\n --\x3e "+s+"\n"+o+" |\n"+r.line+" | "+u+"\n"+o+" | "+i("",r.column-1)+i("",c-r.column,"^")}else t+="\n at "+s}return t},a.buildMessage=function(e,t){var n={literal:function(e){return'"'+i(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?r(e[0])+"-"+r(e[1]):r(e)}));return"["+(e.inverted?"^":"")+t+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function a(e){return e.charCodeAt(0).toString(16).toUpperCase()}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+a(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+a(e)}))}function r(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+a(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+a(e)}))}function s(e){return n[e.type](e)}return"Expected "+function(e){var t,n,a=e.map(s);if(a.sort(),a.length>0){for(t=1,n=1;t<a.length;t++)a[t-1]!==a[t]&&(a[n]=a[t],n++);a.length=n}switch(a.length){case 1:return a[0];case 2:return a[0]+" or "+a[1];default:return a.slice(0,-1).join(", ")+", or "+a[a.length-1]}}(e)+" but "+function(e){return e?'"'+i(e)+'"':"end of input"}(t)+" found."},e.exports={SyntaxError:a,parse:function(e,t){var n,i={},r=(t=void 0!==t?t:{}).grammarSource,s={start:rt,Literal:ht},l=rt,o="(",u=")",c=":",d="{",p="}",m="or",g="and",f="not",b='"',x="\\",h="*",v="\\t",y="\\r",j="\\n",_="u",O="<=",k=">=",I="<",F=">",w="@kuery-cursor@",T=/^[\\"]/,E=/^[^"]/,C=/^[\\():<>"*{}]/,M=/^[0-9a-f]/i,P=/^[ \t\r\n\xA0]/,S=Ze("(",!1),A=Ze(")",!1),L=Ze(":",!1),D=Ze("{",!1),N=Ze("}",!1),z=et("fieldName"),B=et("value"),R=et("OR"),V=Ze("or",!0),H=et("AND"),G=Ze("and",!0),q=et("NOT"),W=Ze("not",!0),$=et("literal"),Y=Ze('"',!1),K=Ze("\\",!1),U=Je(["\\",'"'],!1,!1),X=Je(['"'],!0,!1),Q={type:"any"},Z=Ze("*",!1),J=Ze("\\t",!1),ee=Ze("\\r",!1),te=Ze("\\n",!1),ne=Je(["\\","(",")",":","<",">",'"',"*","{","}"],!1,!1),ae=Ze("u",!1),ie=Je([["0","9"],["a","f"]],!1,!0),re=Ze("<=",!1),se=Ze(">=",!1),le=Ze("<",!1),oe=Ze(">",!1),ue=et("whitespace"),ce=Je([" ","\t","\r","\n"," "],!1,!1),de=Ze("@kuery-cursor@",!1),pe=function(e,t){return"cursor"===t.type?{...t,suggestionTypes:["conjunction"]}:null!==e?e:St.function.buildNode("is","*","*")},me=function(e,t){return t},ge=function(e,t){const n=[e,...t],a=Ct&&n.find((e=>"cursor"===e.type));return a||At("or",n)},fe=function(e,t){const n=[e,...t],a=Ct&&n.find((e=>"cursor"===e.type));return a||At("and",n)},be=function(e){return"cursor"===e.type?e:At("not",[e])},xe=function(e,t){return"cursor"===t.type?{...t,suggestionTypes:["conjunction"]}:e},he=function(e,t,n){return"cursor"===t.type?{...t,nestedPath:t.nestedPath?`${e.value}.${t.nestedPath}`:e.value}:"cursor"===n.type?{...n,suggestionTypes:["conjunction"]}:At("nested",[e,t])},ve=function(e,t,n){if("cursor"===n.type)return{...n,suggestionTypes:["conjunction"]};const a=Nt(t,n);return At("range",[e,a])},ye=function(e,t){return"cursor"===t.type?{...t,fieldName:e.value,suggestionTypes:["value","conjunction"]}:t(e)},je=function(e){if("cursor"===e.type){const t=`${e.prefix}${e.suffix}`.trim();return{...e,fieldName:t,suggestionTypes:["field","operator","conjunction"]}}return e(Lt(null))},_e=function(e,t){return"cursor"===t.type?{...t,suggestionTypes:["conjunction"]}:e},Oe=function(e,t){return t},ke=function(e,t){const n=[e,...t],a=Ct&&n.find((e=>"cursor"===e.type));return a?{...a,suggestionTypes:["value"]}:e=>At("or",n.map((t=>t(e))))},Ie=function(e,t){const n=[e,...t],a=Ct&&n.find((e=>"cursor"===e.type));return a?{...a,suggestionTypes:["value"]}:e=>At("and",n.map((t=>t(e))))},Fe=function(e){return"cursor"===e.type?{...list,suggestionTypes:["value"]}:t=>At("not",[e(t)])},we=function(e){if("cursor"===e.type)return e;const t=Lt(!0);return n=>At("is",[n,e,t])},Te=function(e){if("cursor"===e.type)return e;!Pt&&"wildcard"===e.type&&St.wildcard.hasLeadingWildcard(e)&&function(e,t){throw t=void 0!==t?t:nt(Ye,$e),function(e,t){return new a(e,null,null,t)}(e,t)}("Leading wildcards are disabled. See query:allowLeadingWildcards in Advanced Settings.");const t=Lt(!1);return n=>At("is",[n,e,t])},Ee=function(){return Ct},Ce=function(t,n,a){const{start:i,end:r}=nt(Ye,$e);return{type:"cursor",start:i.offset,end:r.offset-n.length,prefix:t.join(""),suffix:a.join(""),text:e.substring(Ye,$e).replace(n,"")}},Me=function(e){return Lt(e.join(""))},Pe=function(e){return e},Se=function(e){const t=e.join("").trim();return"null"===t?Lt(null):"true"===t?Lt(!0):"false"===t?Lt(!1):e.includes(zt)?Dt(t):Lt(t)},Ae=function(){return zt},Le=function(){return"\t"},De=function(){return"\r"},Ne=function(){return"\n"},ze=function(e){return e},Be=function(e){return e},Re=function(e){return String.fromCharCode(parseInt(e,16))},Ve=function(){return"lte"},He=function(){return"gte"},Ge=function(){return"lt"},qe=function(){return"gt"},We=function(){return Mt},$e=0,Ye=0,Ke=[{line:1,column:1}],Ue=0,Xe=[],Qe=0;if("startRule"in t){if(!(t.startRule in s))throw new Error("Can't start parsing from rule \""+t.startRule+'".');l=s[t.startRule]}function Ze(e,t){return{type:"literal",text:e,ignoreCase:t}}function Je(e,t,n){return{type:"class",parts:e,inverted:t,ignoreCase:n}}function et(e){return{type:"other",description:e}}function tt(t){var n,a=Ke[t];if(a)return a;for(n=t-1;!Ke[n];)n--;for(a={line:(a=Ke[n]).line,column:a.column};n<t;)10===e.charCodeAt(n)?(a.line++,a.column=1):a.column++,n++;return Ke[t]=a,a}function nt(e,t){var n=tt(e),a=tt(t);return{source:r,start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:a.line,column:a.column}}}function at(e){$e<Ue||($e>Ue&&(Ue=$e,Xe=[]),Xe.push(e))}function it(e,t,n){return new a(a.buildMessage(e,t),e,t,n)}function rt(){var e,t,n,a;for(e=$e,t=[],n=Tt();n!==i;)t.push(n),n=Tt();return(n=st())===i&&(n=null),(a=Ot())!==i?(Ye=e,e=pe(n,a)):($e=e,e=i),e}function st(){var e,t,n,a,r;if(e=$e,(t=lt())!==i){if(n=[],a=$e,ft()!==i&&(r=lt())!==i?(Ye=a,a=me(t,r)):($e=a,a=i),a!==i)for(;a!==i;)n.push(a),a=$e,ft()!==i&&(r=lt())!==i?(Ye=a,a=me(t,r)):($e=a,a=i);else n=i;n!==i?(Ye=e,e=ge(t,n)):($e=e,e=i)}else $e=e,e=i;return e===i&&(e=lt()),e}function lt(){var e,t,n,a,r;if(e=$e,(t=ot())!==i){if(n=[],a=$e,bt()!==i&&(r=ot())!==i?(Ye=a,a=me(t,r)):($e=a,a=i),a!==i)for(;a!==i;)n.push(a),a=$e,bt()!==i&&(r=ot())!==i?(Ye=a,a=me(t,r)):($e=a,a=i);else n=i;n!==i?(Ye=e,e=fe(t,n)):($e=e,e=i)}else $e=e,e=i;return e===i&&(e=ot()),e}function ot(){var e,t;return e=$e,xt()!==i&&(t=ut())!==i?(Ye=e,e=be(t)):($e=e,e=i),e===i&&(e=ut()),e}function ut(){var t,n,a,r,s,l;if(t=$e,40===e.charCodeAt($e)?(n=o,$e++):(n=i,0===Qe&&at(S)),n!==i){for(a=[],r=Tt();r!==i;)a.push(r),r=Tt();(r=st())!==i&&(s=Ot())!==i?(41===e.charCodeAt($e)?(l=u,$e++):(l=i,0===Qe&&at(A)),l!==i?(Ye=t,t=xe(r,s)):($e=t,t=i)):($e=t,t=i)}else $e=t,t=i;return t===i&&(t=function(){var t,n,a,r,s,l,o,u,m,g;if(t=$e,n=ct(),n!==i){for(a=[],r=Tt();r!==i;)a.push(r),r=Tt();if(58===e.charCodeAt($e)?(r=c,$e++):(r=i,0===Qe&&at(L)),r!==i){for(s=[],l=Tt();l!==i;)s.push(l),l=Tt();if(123===e.charCodeAt($e)?(l=d,$e++):(l=i,0===Qe&&at(D)),l!==i){for(o=[],u=Tt();u!==i;)o.push(u),u=Tt();(u=st())!==i&&(m=Ot())!==i?(125===e.charCodeAt($e)?(g=p,$e++):(g=i,0===Qe&&at(N)),g!==i?(Ye=t,t=he(n,u,m)):($e=t,t=i)):($e=t,t=i)}else $e=t,t=i}else $e=t,t=i}else $e=t,t=i;t===i&&(t=function(){var t;t=function(){var t,n,a,r,s,l;if(t=$e,n=ct(),n!==i){for(a=[],r=Tt();r!==i;)a.push(r),r=Tt();if(r=function(){var t,n;t=$e,e.substr($e,2)===O?(n=O,$e+=2):(n=i,0===Qe&&at(re));n!==i&&(Ye=t,n=Ve());t=n,t===i&&(t=$e,e.substr($e,2)===k?(n=k,$e+=2):(n=i,0===Qe&&at(se)),n!==i&&(Ye=t,n=He()),(t=n)===i&&(t=$e,60===e.charCodeAt($e)?(n=I,$e++):(n=i,0===Qe&&at(le)),n!==i&&(Ye=t,n=Ge()),(t=n)===i&&(t=$e,62===e.charCodeAt($e)?(n=F,$e++):(n=i,0===Qe&&at(oe)),n!==i&&(Ye=t,n=qe()),t=n)));return t}(),r!==i){for(s=[],l=Tt();l!==i;)s.push(l),l=Tt();(l=ht())!==i?(Ye=t,t=ve(n,r,l)):($e=t,t=i)}else $e=t,t=i}else $e=t,t=i;return t}(),t===i&&(t=function(){var t,n,a,r,s,l;if(t=$e,n=ct(),n!==i){for(a=[],r=Tt();r!==i;)a.push(r),r=Tt();if(58===e.charCodeAt($e)?(r=c,$e++):(r=i,0===Qe&&at(L)),r!==i){for(s=[],l=Tt();l!==i;)s.push(l),l=Tt();(l=dt())!==i?(Ye=t,t=ye(n,l)):($e=t,t=i)}else $e=t,t=i}else $e=t,t=i;return t}(),t===i&&(t=function(){var e,t;e=$e,t=gt(),t!==i&&(Ye=e,t=je(t));return e=t,e}()));return t}());return t}()),t}function ct(){var e;return Qe++,e=ht(),Qe--,e===i&&(i,0===Qe&&at(z)),e}function dt(){var t,n,a,r,s,l;if(t=$e,40===e.charCodeAt($e)?(n=o,$e++):(n=i,0===Qe&&at(S)),n!==i){for(a=[],r=Tt();r!==i;)a.push(r),r=Tt();r=function(){var e,t,n,a,r;if(e=$e,t=pt(),t!==i){if(n=[],a=$e,ft()!==i&&(r=pt())!==i?(Ye=a,a=Oe(t,r)):($e=a,a=i),a!==i)for(;a!==i;)n.push(a),a=$e,ft()!==i&&(r=pt())!==i?(Ye=a,a=Oe(t,r)):($e=a,a=i);else n=i;n!==i?(Ye=e,e=ke(t,n)):($e=e,e=i)}else $e=e,e=i;e===i&&(e=pt());return e}(),r!==i&&(s=Ot())!==i?(41===e.charCodeAt($e)?(l=u,$e++):(l=i,0===Qe&&at(A)),l!==i?(Ye=t,t=_e(r,s)):($e=t,t=i)):($e=t,t=i)}else $e=t,t=i;return t===i&&(t=gt()),t}function pt(){var e,t,n,a,r;if(e=$e,(t=mt())!==i){if(n=[],a=$e,bt()!==i&&(r=mt())!==i?(Ye=a,a=Oe(t,r)):($e=a,a=i),a!==i)for(;a!==i;)n.push(a),a=$e,bt()!==i&&(r=mt())!==i?(Ye=a,a=Oe(t,r)):($e=a,a=i);else n=i;n!==i?(Ye=e,e=Ie(t,n)):($e=e,e=i)}else $e=e,e=i;return e===i&&(e=mt()),e}function mt(){var e,t;return e=$e,xt()!==i&&(t=dt())!==i?(Ye=e,e=Fe(t)):($e=e,e=i),e===i&&(e=dt()),e}function gt(){var e,t;return Qe++,e=$e,(t=vt())!==i&&(Ye=e,t=we(t)),(e=t)===i&&(e=$e,(t=jt())!==i&&(Ye=e,t=Te(t)),e=t),Qe--,e===i&&(t=i,0===Qe&&at(B)),e}function ft(){var t,n,a,r,s;if(Qe++,t=$e,n=[],(a=Tt())!==i)for(;a!==i;)n.push(a),a=Tt();else n=i;if(n!==i)if(e.substr($e,2).toLowerCase()===m?(a=e.substr($e,2),$e+=2):(a=i,0===Qe&&at(V)),a!==i){if(r=[],(s=Tt())!==i)for(;s!==i;)r.push(s),s=Tt();else r=i;r!==i?t=n=[n,a,r]:($e=t,t=i)}else $e=t,t=i;else $e=t,t=i;return Qe--,t===i&&(n=i,0===Qe&&at(R)),t}function bt(){var t,n,a,r,s;if(Qe++,t=$e,n=[],(a=Tt())!==i)for(;a!==i;)n.push(a),a=Tt();else n=i;if(n!==i)if(e.substr($e,3).toLowerCase()===g?(a=e.substr($e,3),$e+=3):(a=i,0===Qe&&at(G)),a!==i){if(r=[],(s=Tt())!==i)for(;s!==i;)r.push(s),s=Tt();else r=i;r!==i?t=n=[n,a,r]:($e=t,t=i)}else $e=t,t=i;else $e=t,t=i;return Qe--,t===i&&(n=i,0===Qe&&at(H)),t}function xt(){var t,n,a,r;if(Qe++,t=$e,e.substr($e,3).toLowerCase()===f?(n=e.substr($e,3),$e+=3):(n=i,0===Qe&&at(W)),n!==i){if(a=[],(r=Tt())!==i)for(;r!==i;)a.push(r),r=Tt();else a=i;a!==i?t=n=[n,a]:($e=t,t=i)}else $e=t,t=i;return Qe--,t===i&&(n=i,0===Qe&&at(q)),t}function ht(){var e;return Qe++,(e=vt())===i&&(e=jt()),Qe--,e===i&&(i,0===Qe&&at($)),e}function vt(){var t,n,a,r,s,l,o;if(t=$e,Ye=$e,(n=(n=Ee())?void 0:i)!==i)if(34===e.charCodeAt($e)?(a=b,$e++):(a=i,0===Qe&&at(Y)),a!==i){for(r=[],s=yt();s!==i;)r.push(s),s=yt();if((s=Et())!==i){for(l=[],o=yt();o!==i;)l.push(o),o=yt();34===e.charCodeAt($e)?(o=b,$e++):(o=i,0===Qe&&at(Y)),o!==i?(Ye=t,t=Ce(r,s,l)):($e=t,t=i)}else $e=t,t=i}else $e=t,t=i;else $e=t,t=i;if(t===i)if(t=$e,34===e.charCodeAt($e)?(n=b,$e++):(n=i,0===Qe&&at(Y)),n!==i){for(a=[],r=yt();r!==i;)a.push(r),r=yt();34===e.charCodeAt($e)?(r=b,$e++):(r=i,0===Qe&&at(Y)),r!==i?(Ye=t,t=Me(a)):($e=t,t=i)}else $e=t,t=i;return t}function yt(){var t,n,a;return(t=kt())===i&&(t=Ft())===i&&(t=$e,92===e.charCodeAt($e)?(n=x,$e++):(n=i,0===Qe&&at(K)),n!==i?(T.test(e.charAt($e))?(a=e.charAt($e),$e++):(a=i,0===Qe&&at(U)),a!==i?(Ye=t,t=Pe(a)):($e=t,t=i)):($e=t,t=i),t===i&&(t=$e,n=$e,Qe++,a=Et(),Qe--,a===i?n=void 0:($e=n,n=i),n!==i?(E.test(e.charAt($e))?(a=e.charAt($e),$e++):(a=i,0===Qe&&at(X)),a!==i?(Ye=t,t=Pe(a)):($e=t,t=i)):($e=t,t=i))),t}function jt(){var e,t,n,a,r,s;if(e=$e,Ye=$e,(t=(t=Ee())?void 0:i)!==i){for(n=[],a=_t();a!==i;)n.push(a),a=_t();if((a=Et())!==i){for(r=[],s=_t();s!==i;)r.push(s),s=_t();Ye=e,e=Ce(n,a,r)}else $e=e,e=i}else $e=e,e=i;if(e===i){if(e=$e,t=[],(n=_t())!==i)for(;n!==i;)t.push(n),n=_t();else t=i;t!==i&&(Ye=e,t=Se(t)),e=t}return e}function _t(){var t,n,a,r,s;return(t=kt())===i&&(t=function(){var t,n,a;t=$e,92===e.charCodeAt($e)?(n=x,$e++):(n=i,0===Qe&&at(K));n!==i&&(a=It())!==i?(Ye=t,t=Pe(a)):($e=t,t=i);return t}(),t===i&&(t=Ft())===i&&(t=function(){var t,n,a;t=$e,92===e.charCodeAt($e)?(n=x,$e++):(n=i,0===Qe&&at(K));n!==i?(e.substr($e,2).toLowerCase()===m?(a=e.substr($e,2),$e+=2):(a=i,0===Qe&&at(V)),a===i&&(e.substr($e,3).toLowerCase()===g?(a=e.substr($e,3),$e+=3):(a=i,0===Qe&&at(G)),a===i&&(e.substr($e,3).toLowerCase()===f?(a=e.substr($e,3),$e+=3):(a=i,0===Qe&&at(W)))),a!==i?(Ye=t,t=ze(a)):($e=t,t=i)):($e=t,t=i);return t}(),t===i&&(t=function(){var t,n;t=$e,42===e.charCodeAt($e)?(n=h,$e++):(n=i,0===Qe&&at(Z));n!==i&&(Ye=t,n=Ae());return t=n,t}(),t===i&&(t=$e,n=$e,Qe++,a=It(),Qe--,a===i?n=void 0:($e=n,n=i),n!==i?(a=$e,Qe++,r=function(){var e;e=ft(),e===i&&(e=bt())===i&&(e=xt());return e}(),Qe--,r===i?a=void 0:($e=a,a=i),a!==i?(r=$e,Qe++,s=Et(),Qe--,s===i?r=void 0:($e=r,r=i),r!==i?(e.length>$e?(s=e.charAt($e),$e++):(s=i,0===Qe&&at(Q)),s!==i?(Ye=t,t=Pe(s)):($e=t,t=i)):($e=t,t=i)):($e=t,t=i)):($e=t,t=i))))),t}function Ot(){var e,t,n,a,r,s;if(e=$e,Ye=$e,(t=(t=Ee())?void 0:i)!==i){for(n=[],a=Tt();a!==i;)n.push(a),a=Tt();if((a=Et())!==i){for(r=[],s=Tt();s!==i;)r.push(s),s=Tt();Ye=e,e=Ce(n,a,r)}else $e=e,e=i}else $e=e,e=i;if(e===i)for(e=[],t=Tt();t!==i;)e.push(t),t=Tt();return e}function kt(){var t,n;return t=$e,e.substr($e,2)===v?(n=v,$e+=2):(n=i,0===Qe&&at(J)),n!==i&&(Ye=t,n=Le()),(t=n)===i&&(t=$e,e.substr($e,2)===y?(n=y,$e+=2):(n=i,0===Qe&&at(ee)),n!==i&&(Ye=t,n=De()),(t=n)===i&&(t=$e,e.substr($e,2)===j?(n=j,$e+=2):(n=i,0===Qe&&at(te)),n!==i&&(Ye=t,n=Ne()),t=n)),t}function It(){var t;return C.test(e.charAt($e))?(t=e.charAt($e),$e++):(t=i,0===Qe&&at(ne)),t}function Ft(){var t,n,a;return t=$e,92===e.charCodeAt($e)?(n=x,$e++):(n=i,0===Qe&&at(K)),n!==i?(a=function(){var t,n,a,r,s,l,o,u;t=$e,117===e.charCodeAt($e)?(n=_,$e++):(n=i,0===Qe&&at(ae));n!==i?(a=$e,r=$e,(s=wt())!==i&&(l=wt())!==i&&(o=wt())!==i&&(u=wt())!==i?r=s=[s,l,o,u]:($e=r,r=i),(a=r!==i?e.substring(a,$e):r)!==i?(Ye=t,t=Re(a)):($e=t,t=i)):($e=t,t=i);return t}(),a!==i?(Ye=t,t=Be(a)):($e=t,t=i)):($e=t,t=i),t}function wt(){var t;return M.test(e.charAt($e))?(t=e.charAt($e),$e++):(t=i,0===Qe&&at(ie)),t}function Tt(){var t;return Qe++,P.test(e.charAt($e))?(t=e.charAt($e),$e++):(t=i,0===Qe&&at(ce)),Qe--,t===i&&(i,0===Qe&&at(ue)),t}function Et(){var t,n;return t=$e,Ye=$e,(Ee()?void 0:i)!==i?(e.substr($e,14)===w?(n=w,$e+=14):(n=i,0===Qe&&at(de)),n!==i?(Ye=t,t=We()):($e=t,t=i)):($e=t,t=i),t}const{parseCursor:Ct,cursorSymbol:Mt,allowLeadingWildcards:Pt=!0,helpers:{nodeTypes:St}}=t,At=St.function.buildNodeWithArgumentNodes,Lt=St.literal.buildNode,Dt=St.wildcard.buildNode,Nt=St.namedArg.buildNode,{wildcardSymbol:zt}=St.wildcard;if((n=l())!==i&&$e===e.length)return n;throw n!==i&&$e<e.length&&at({type:"end"}),it(Xe,Ue<e.length?e.charAt(Ue):null,Ue<e.length?nt(Ue,Ue+1):nt(Ue,Ue))}}},function(e,t,n){"use strict";var a=n(73);Object.defineProperty(t,"__esModule",{value:!0}),t.KbnFieldType=void 0;var i=a(n(2)),r=n(93);t.KbnFieldType=class KbnFieldType{constructor(e={}){(0,i.default)(this,"name",void 0),(0,i.default)(this,"sortable",void 0),(0,i.default)(this,"filterable",void 0),(0,i.default)(this,"esTypes",void 0),this.name=e.name||r.KBN_FIELD_TYPES.UNKNOWN,this.sortable=e.sortable||!1,this.filterable=e.filterable||!1,this.esTypes=Object.freeze((e.esTypes||[]).slice())}}},function(e,t,n){switch(window.__kbnThemeTag__){case"v7dark":return n(373);case"v7light":return n(375);case"v8dark":return n(377);case"v8light":return n(379)}},,,,,,,,,,,,,,,,function(e,t,n){switch(window.__kbnThemeTag__){case"v7dark":return n(143);case"v7light":return n(145);case"v8dark":return n(147);case"v8light":return n(149)}},function(e,t,n){var a=n(66),i=n(144);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsDataTableContainer{height:100%}.lnsTableCell{max-width:100%;overflow:hidden !important;text-overflow:ellipsis !important;white-space:nowrap !important;word-wrap:normal !important}.lnsTableCell--left{text-align:left}.lnsTableCell--right{text-align:right}.lnsTableCell--center{text-align:center}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(146);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsDataTableContainer{height:100%}.lnsTableCell{max-width:100%;overflow:hidden !important;text-overflow:ellipsis !important;white-space:nowrap !important;word-wrap:normal !important}.lnsTableCell--left{text-align:left}.lnsTableCell--right{text-align:right}.lnsTableCell--center{text-align:center}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(148);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsDataTableContainer{height:100%}.lnsTableCell{max-width:100%;overflow:hidden !important;text-overflow:ellipsis !important;white-space:nowrap !important;word-wrap:normal !important}.lnsTableCell--left{text-align:left}.lnsTableCell--right{text-align:right}.lnsTableCell--center{text-align:center}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(150);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsDataTableContainer{height:100%}.lnsTableCell{max-width:100%;overflow:hidden !important;text-overflow:ellipsis !important;white-space:nowrap !important;word-wrap:normal !important}.lnsTableCell--left{text-align:left}.lnsTableCell--right{text-align:right}.lnsTableCell--center{text-align:center}",""]),e.exports=t},function(e,t,n){switch(window.__kbnThemeTag__){case"v7dark":return n(152);case"v7light":return n(154);case"v8dark":return n(156);case"v8light":return n(158)}},function(e,t,n){var a=n(66),i=n(153);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsVisualizationContainer{scrollbar-color:rgba(152,162,179,.5) rgba(0,0,0,0);scrollbar-width:thin;overflow:auto hidden;-webkit-user-select:text;user-select:text}.lnsVisualizationContainer::-webkit-scrollbar{width:16px;height:16px}.lnsVisualizationContainer::-webkit-scrollbar-thumb{background-color:rgba(152,162,179,.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsVisualizationContainer::-webkit-scrollbar-corner,.lnsVisualizationContainer::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsExpressionRenderer{scrollbar-color:rgba(152,162,179,.5) rgba(0,0,0,0);scrollbar-width:thin;position:relative;width:100%;height:100%;display:flex;overflow:auto}.lnsExpressionRenderer::-webkit-scrollbar{width:16px;height:16px}.lnsExpressionRenderer::-webkit-scrollbar-thumb{background-color:rgba(152,162,179,.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsExpressionRenderer::-webkit-scrollbar-corner,.lnsExpressionRenderer::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsExpressionRenderer .lnsExpressionRenderer__component{position:static}.lnsEmbeddedError{flex-grow:1;display:flex;align-items:center;justify-content:center;overflow:auto}.lnsSelectableErrorMessage{-webkit-user-select:text;user-select:text}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(155);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsVisualizationContainer{scrollbar-color:rgba(105,112,125,.5) rgba(0,0,0,0);scrollbar-width:thin;overflow:auto hidden;-webkit-user-select:text;user-select:text}.lnsVisualizationContainer::-webkit-scrollbar{width:16px;height:16px}.lnsVisualizationContainer::-webkit-scrollbar-thumb{background-color:rgba(105,112,125,.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsVisualizationContainer::-webkit-scrollbar-corner,.lnsVisualizationContainer::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsExpressionRenderer{scrollbar-color:rgba(105,112,125,.5) rgba(0,0,0,0);scrollbar-width:thin;position:relative;width:100%;height:100%;display:flex;overflow:auto}.lnsExpressionRenderer::-webkit-scrollbar{width:16px;height:16px}.lnsExpressionRenderer::-webkit-scrollbar-thumb{background-color:rgba(105,112,125,.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsExpressionRenderer::-webkit-scrollbar-corner,.lnsExpressionRenderer::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsExpressionRenderer .lnsExpressionRenderer__component{position:static}.lnsEmbeddedError{flex-grow:1;display:flex;align-items:center;justify-content:center;overflow:auto}.lnsSelectableErrorMessage{-webkit-user-select:text;user-select:text}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(157);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsVisualizationContainer{scrollbar-color:rgba(152,162,179,.5) rgba(0,0,0,0);scrollbar-width:thin;overflow:auto hidden;-webkit-user-select:text;user-select:text}.lnsVisualizationContainer::-webkit-scrollbar{width:16px;height:16px}.lnsVisualizationContainer::-webkit-scrollbar-thumb{background-color:rgba(152,162,179,.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsVisualizationContainer::-webkit-scrollbar-corner,.lnsVisualizationContainer::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsExpressionRenderer{scrollbar-color:rgba(152,162,179,.5) rgba(0,0,0,0);scrollbar-width:thin;position:relative;width:100%;height:100%;display:flex;overflow:auto}.lnsExpressionRenderer::-webkit-scrollbar{width:16px;height:16px}.lnsExpressionRenderer::-webkit-scrollbar-thumb{background-color:rgba(152,162,179,.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsExpressionRenderer::-webkit-scrollbar-corner,.lnsExpressionRenderer::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsExpressionRenderer .lnsExpressionRenderer__component{position:static}.lnsEmbeddedError{flex-grow:1;display:flex;align-items:center;justify-content:center;overflow:auto}.lnsSelectableErrorMessage{-webkit-user-select:text;user-select:text}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(159);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsVisualizationContainer{scrollbar-color:rgba(105,112,125,.5) rgba(0,0,0,0);scrollbar-width:thin;overflow:auto hidden;-webkit-user-select:text;user-select:text}.lnsVisualizationContainer::-webkit-scrollbar{width:16px;height:16px}.lnsVisualizationContainer::-webkit-scrollbar-thumb{background-color:rgba(105,112,125,.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsVisualizationContainer::-webkit-scrollbar-corner,.lnsVisualizationContainer::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsExpressionRenderer{scrollbar-color:rgba(105,112,125,.5) rgba(0,0,0,0);scrollbar-width:thin;position:relative;width:100%;height:100%;display:flex;overflow:auto}.lnsExpressionRenderer::-webkit-scrollbar{width:16px;height:16px}.lnsExpressionRenderer::-webkit-scrollbar-thumb{background-color:rgba(105,112,125,.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsExpressionRenderer::-webkit-scrollbar-corner,.lnsExpressionRenderer::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsExpressionRenderer .lnsExpressionRenderer__component{position:static}.lnsEmbeddedError{flex-grow:1;display:flex;align-items:center;justify-content:center;overflow:auto}.lnsSelectableErrorMessage{-webkit-user-select:text;user-select:text}",""]),e.exports=t},,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(46),i=n(113),r=a.__importDefault(n(114));t.default=function(e,t){r.default(e,t,i.isDeepEqual)}},,function(e,t,n){switch(window.__kbnThemeTag__){case"v7dark":return n(185);case"v7light":return n(187);case"v8dark":return n(189);case"v8light":return n(191)}},function(e,t,n){var a=n(66),i=n(186);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}.lnsDynamicColoringClickable{cursor:pointer}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(188);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}.lnsDynamicColoringClickable{cursor:pointer}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(190);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}.lnsDynamicColoringClickable{cursor:pointer}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(192);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}.lnsDynamicColoringClickable{cursor:pointer}",""]),e.exports=t},function(e,t,n){switch(window.__kbnThemeTag__){case"v7dark":return n(194);case"v7light":return n(196);case"v8dark":return n(198);case"v8light":return n(200)}},function(e,t,n){var a=n(66),i=n(195);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsMetricExpression__container{display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;height:100%;text-align:center}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(197);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsMetricExpression__container{display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;height:100%;text-align:center}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(199);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsMetricExpression__container{display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;height:100%;text-align:center}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(201);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsMetricExpression__container{display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;height:100%;text-align:center}",""]),e.exports=t},function(e,t,n){switch(window.__kbnThemeTag__){case"v7dark":return n(203);case"v7light":return n(205);case"v8dark":return n(207);case"v8light":return n(209)}},function(e,t,n){var a=n(66),i=n(204);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsPieExpression__container{height:100%;width:100%;overflow-x:hidden}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(206);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsPieExpression__container{height:100%;width:100%;overflow-x:hidden}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(208);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsPieExpression__container{height:100%;width:100%;overflow-x:hidden}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(210);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsPieExpression__container{height:100%;width:100%;overflow-x:hidden}",""]),e.exports=t},function(e,t,n){switch(window.__kbnThemeTag__){case"v7dark":return n(212);case"v7light":return n(214);case"v8dark":return n(216);case"v8light":return n(218)}},function(e,t,n){var a=n(66),i=n(213);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsPieToolbar__popover{width:400px}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(215);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsPieToolbar__popover{width:400px}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(217);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsPieToolbar__popover{width:400px}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(219);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsPieToolbar__popover{width:400px}",""]),e.exports=t},function(e,t,n){switch(window.__kbnThemeTag__){case"v7dark":return n(221);case"v7light":return n(223);case"v8dark":return n(225);case"v8light":return n(227)}},function(e,t,n){var a=n(66),i=n(222);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsXyExpression__container{height:100%;width:100%;overflow-x:hidden}.lnsChart__empty{height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(224);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsXyExpression__container{height:100%;width:100%;overflow-x:hidden}.lnsChart__empty{height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(226);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsXyExpression__container{height:100%;width:100%;overflow-x:hidden}.lnsChart__empty{height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(228);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsXyExpression__container{height:100%;width:100%;overflow-x:hidden}.lnsChart__empty{height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center}",""]),e.exports=t},function(e,t,n){switch(window.__kbnThemeTag__){case"v7dark":return n(230);case"v7light":return n(232);case"v8dark":return n(234);case"v8light":return n(236)}},function(e,t,n){var a=n(66),i=n(231);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,'.lnsXyDecorationRotatedWrapper{display:inline-block;overflow:hidden;line-height:1.5}.lnsXyDecorationRotatedWrapper .lnsXyDecorationRotatedWrapper__label{display:inline-block;white-space:nowrap;transform:translate(0, 100%) rotate(-90deg);transform-origin:0 0}.lnsXyDecorationRotatedWrapper .lnsXyDecorationRotatedWrapper__label::after{content:"";float:left;margin-top:100%}',""]),e.exports=t},function(e,t,n){var a=n(66),i=n(233);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,'.lnsXyDecorationRotatedWrapper{display:inline-block;overflow:hidden;line-height:1.5}.lnsXyDecorationRotatedWrapper .lnsXyDecorationRotatedWrapper__label{display:inline-block;white-space:nowrap;transform:translate(0, 100%) rotate(-90deg);transform-origin:0 0}.lnsXyDecorationRotatedWrapper .lnsXyDecorationRotatedWrapper__label::after{content:"";float:left;margin-top:100%}',""]),e.exports=t},function(e,t,n){var a=n(66),i=n(235);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,'.lnsXyDecorationRotatedWrapper{display:inline-block;overflow:hidden;line-height:1.5}.lnsXyDecorationRotatedWrapper .lnsXyDecorationRotatedWrapper__label{display:inline-block;white-space:nowrap;transform:translate(0, 100%) rotate(-90deg);transform-origin:0 0}.lnsXyDecorationRotatedWrapper .lnsXyDecorationRotatedWrapper__label::after{content:"";float:left;margin-top:100%}',""]),e.exports=t},function(e,t,n){var a=n(66),i=n(237);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,'.lnsXyDecorationRotatedWrapper{display:inline-block;overflow:hidden;line-height:1.5}.lnsXyDecorationRotatedWrapper .lnsXyDecorationRotatedWrapper__label{display:inline-block;white-space:nowrap;transform:translate(0, 100%) rotate(-90deg);transform-origin:0 0}.lnsXyDecorationRotatedWrapper .lnsXyDecorationRotatedWrapper__label::after{content:"";float:left;margin-top:100%}',""]),e.exports=t},function(e,t,n){var a=n(66),i=n(239);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsXyToolbar__popover{width:365px}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(241);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsXyToolbar__popover{width:365px}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(243);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsXyToolbar__popover{width:365px}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(245);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsXyToolbar__popover{width:365px}",""]),e.exports=t},,,,function(e,t,n){switch(window.__kbnThemeTag__){case"v7dark":return n(250);case"v7light":return n(252);case"v8dark":return n(254);case"v8light":return n(256)}},function(e,t,n){var a=n(66),i=n(251);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsHeatmapExpression__container{height:100%;width:100%;overflow-x:hidden}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(253);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsHeatmapExpression__container{height:100%;width:100%;overflow-x:hidden}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(255);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsHeatmapExpression__container{height:100%;width:100%;overflow-x:hidden}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(257);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsHeatmapExpression__container{height:100%;width:100%;overflow-x:hidden}",""]),e.exports=t},function(e,t,n){switch(window.__kbnThemeTag__){case"v7dark":return n(259);case"v7light":return n(261);case"v8dark":return n(263);case"v8light":return n(265)}},function(e,t,n){var a=n(66),i=n(260);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(262);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(264);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(266);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}",""]),e.exports=t},function(e,t,n){"use strict";function a(e,t,n,i){var r=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(r,a.prototype),r.expected=t,r.found=n,r.location=i,r.name="SyntaxError",r}function i(e,t,n){return n=n||" ",e.length>t?e:(t-=e.length,e+(n+=n.repeat(t)).slice(0,t))}!function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}(a,Error),a.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var n,a=null;for(n=0;n<e.length;n++)if(e[n].source===this.location.source){a=e[n].text.split(/\r\n|\n|\r/g);break}var r=this.location.start,s=this.location.source+":"+r.line+":"+r.column;if(a){var l=this.location.end,o=i("",r.line.toString().length),u=a[r.line-1],c=r.line===l.line?l.column:u.length+1;t+="\n --\x3e "+s+"\n"+o+" |\n"+r.line+" | "+u+"\n"+o+" | "+i("",r.column-1)+i("",c-r.column,"^")}else t+="\n at "+s}return t},a.buildMessage=function(e,t){var n={literal:function(e){return'"'+i(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?r(e[0])+"-"+r(e[1]):r(e)}));return"["+(e.inverted?"^":"")+t+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function a(e){return e.charCodeAt(0).toString(16).toUpperCase()}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+a(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+a(e)}))}function r(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+a(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+a(e)}))}function s(e){return n[e.type](e)}return"Expected "+function(e){var t,n,a=e.map(s);if(a.sort(),a.length>0){for(t=1,n=1;t<a.length;t++)a[t-1]!==a[t]&&(a[n]=a[t],n++);a.length=n}switch(a.length){case 1:return a[0];case 2:return a[0]+" or "+a[1];default:return a.slice(0,-1).join(", ")+", or "+a[a.length-1]}}(e)+" but "+function(e){return e?'"'+i(e)+'"':"end of input"}(t)+" found."},e.exports={SyntaxError:a,parse:function(e,t){var n,i={},r=(t=void 0!==t?t:{}).grammarSource,s={start:De},l=De,o='"',u='\\"',c="'",d="\\'",p="+",m="-",g="*",f="/",b="(",x=")",h=",",v="=",y=".",j="0",_=/^[ \t\n\r]/,O=/^[0-9A-Za-z._@[\]\-]/,k=/^[^"]/,I=/^[^']/,F=/^[a-zA-Z_]/,w=/^[a-zA-Z_\-]/,T=/^[eE]/,E=/^[1-9]/,C=/^[0-9]/,M=Me("whitespace"),P=Ce([" ","\t","\n","\r"],!1,!1),S=(Ce([" "],!1,!1),Ce(['"',"'"],!1,!1),Ce([["A","Z"],["a","z"],"_","@",".","[","]","-"],!1,!1),Ce([["0","9"],["A","Z"],["a","z"],".","_","@","[","]","-"],!1,!1)),A=Me("literal"),L=Ee('"',!1),D=Ee('\\"',!1),N=Ce(['"'],!0,!1),z=Ee("'",!1),B=Ee("\\'",!1),R=Ce(["'"],!0,!1),V=Ee("+",!1),H=Ee("-",!1),G=Ee("*",!1),q=Ee("/",!1),W=Ee("(",!1),$=Ee(")",!1),Y=Me("arguments"),K=Ee(",",!1),U=Ce([["a","z"],["A","Z"],"_"],!1,!1),X=Ee("=",!1),Q=Me("function"),Z=Ce([["a","z"],["A","Z"],"_","-"],!1,!1),J=Me("number"),ee=Ce(["e","E"],!1,!1),te=Me("exponent"),ne=Ee(".",!1),ae=Ee("0",!1),ie=Ce([["1","9"]],!1,!1),re=Ce([["0","9"]],!1,!1),se=function(e){return e},le=function(){return'"'},oe=function(e){return{type:"variable",value:e.join(""),location:$e(Te()),text:we()}},ue=function(){return"'"},ce=function(e){return{type:"variable",value:e.join(""),location:$e(Te()),text:we()}},de=function(e){return{type:"variable",value:e.join(""),location:$e(Te()),text:we()}},pe=function(e,t){const n=t.reduce(((e,t)=>({type:"function",name:"+"===t[0]?"add":"subtract",args:[e,t[1]]})),e);return"object"==typeof n&&(n.location=$e(Te()),n.text=we()),n},me=function(e,t){const n=t.reduce(((e,t)=>({type:"function",name:"*"===t[0]?"multiply":"divide",args:[e,t[1]]})),e);return"object"==typeof n&&(n.location=$e(Te()),n.text=we()),n},ge=function(e){return e},fe=function(e,t){return t},be=function(e,t){return[e].concat(t)},xe=function(e){return e.join("")},he=function(e,t){return{type:"namedArgument",name:e.join(""),value:t,location:$e(Te()),text:we()}},ve=function(e,t){return{type:"function",name:e.join(""),args:t||[],location:$e(Te()),text:we()}},ye=function(){return parseFloat(we())},je=0,_e=0,Oe=[{line:1,column:1}],ke=0,Ie=[],Fe=0;if("startRule"in t){if(!(t.startRule in s))throw new Error("Can't start parsing from rule \""+t.startRule+'".');l=s[t.startRule]}function we(){return e.substring(_e,je)}function Te(){return Se(_e,je)}function Ee(e,t){return{type:"literal",text:e,ignoreCase:t}}function Ce(e,t,n){return{type:"class",parts:e,inverted:t,ignoreCase:n}}function Me(e){return{type:"other",description:e}}function Pe(t){var n,a=Oe[t];if(a)return a;for(n=t-1;!Oe[n];)n--;for(a={line:(a=Oe[n]).line,column:a.column};n<t;)10===e.charCodeAt(n)?(a.line++,a.column=1):a.column++,n++;return Oe[t]=a,a}function Se(e,t){var n=Pe(e),a=Pe(t);return{source:r,start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:a.line,column:a.column}}}function Ae(e){je<ke||(je>ke&&(ke=je,Ie=[]),Ie.push(e))}function Le(e,t,n){return new a(a.buildMessage(e,t),e,t,n)}function De(){return Re()}function Ne(){var t,n;for(Fe++,t=[],_.test(e.charAt(je))?(n=e.charAt(je),je++):(n=i,0===Fe&&Ae(P));n!==i;)t.push(n),_.test(e.charAt(je))?(n=e.charAt(je),je++):(n=i,0===Fe&&Ae(P));return Fe--,n=i,0===Fe&&Ae(M),t}function ze(){var t;return O.test(e.charAt(je))?(t=e.charAt(je),je++):(t=i,0===Fe&&Ae(S)),t}function Be(){var t,n;return Fe++,t=je,Ne(),(n=qe())===i&&(n=function(){var t,n,a,r,s;t=je,Ne(),34===e.charCodeAt(je)?(n=o,je++):(n=i,0===Fe&&Ae(L));if(n!==i){for(a=[],r=je,e.substr(je,2)===u?(s=u,je+=2):(s=i,0===Fe&&Ae(D)),s!==i&&(_e=r,s=le()),(r=s)===i&&(k.test(e.charAt(je))?(r=e.charAt(je),je++):(r=i,0===Fe&&Ae(N)));r!==i;)a.push(r),r=je,e.substr(je,2)===u?(s=u,je+=2):(s=i,0===Fe&&Ae(D)),s!==i&&(_e=r,s=le()),(r=s)===i&&(k.test(e.charAt(je))?(r=e.charAt(je),je++):(r=i,0===Fe&&Ae(N)));34===e.charCodeAt(je)?(r=o,je++):(r=i,0===Fe&&Ae(L)),r!==i?(s=Ne(),_e=t,t=oe(a)):(je=t,t=i)}else je=t,t=i;if(t===i){if(t=je,Ne(),39===e.charCodeAt(je)?(n=c,je++):(n=i,0===Fe&&Ae(z)),n!==i){for(a=[],r=je,e.substr(je,2)===d?(s=d,je+=2):(s=i,0===Fe&&Ae(B)),s!==i&&(_e=r,s=ue()),(r=s)===i&&(I.test(e.charAt(je))?(r=e.charAt(je),je++):(r=i,0===Fe&&Ae(R)));r!==i;)a.push(r),r=je,e.substr(je,2)===d?(s=d,je+=2):(s=i,0===Fe&&Ae(B)),s!==i&&(_e=r,s=ue()),(r=s)===i&&(I.test(e.charAt(je))?(r=e.charAt(je),je++):(r=i,0===Fe&&Ae(R)));39===e.charCodeAt(je)?(r=c,je++):(r=i,0===Fe&&Ae(z)),r!==i?(s=Ne(),_e=t,t=ce(a)):(je=t,t=i)}else je=t,t=i;if(t===i){if(t=je,Ne(),n=[],(a=ze())!==i)for(;a!==i;)n.push(a),a=ze();else n=i;n!==i?(a=Ne(),_e=t,t=de(n)):(je=t,t=i)}}return t}()),n!==i?(Ne(),_e=t,t=se(n)):(je=t,t=i),Fe--,t===i&&(i,0===Fe&&Ae(A)),t}function Re(){var t,n,a,r,s,l;if(t=je,Ne(),(n=Ve())!==i){if(a=[],r=je,43===e.charCodeAt(je)?(s=p,je++):(s=i,0===Fe&&Ae(V)),s===i&&(45===e.charCodeAt(je)?(s=m,je++):(s=i,0===Fe&&Ae(H))),s!==i&&(l=Ve())!==i?r=s=[s,l]:(je=r,r=i),r!==i)for(;r!==i;)a.push(r),r=je,43===e.charCodeAt(je)?(s=p,je++):(s=i,0===Fe&&Ae(V)),s===i&&(45===e.charCodeAt(je)?(s=m,je++):(s=i,0===Fe&&Ae(H))),s!==i&&(l=Ve())!==i?r=s=[s,l]:(je=r,r=i);else a=i;a!==i?(r=Ne(),_e=t,t=pe(n,a)):(je=t,t=i)}else je=t,t=i;return t===i&&(t=Ve()),t}function Ve(){var t,n,a,r,s,l;if(t=je,Ne(),(n=He())!==i){for(a=[],r=je,42===e.charCodeAt(je)?(s=g,je++):(s=i,0===Fe&&Ae(G)),s===i&&(47===e.charCodeAt(je)?(s=f,je++):(s=i,0===Fe&&Ae(q))),s!==i&&(l=He())!==i?r=s=[s,l]:(je=r,r=i);r!==i;)a.push(r),r=je,42===e.charCodeAt(je)?(s=g,je++):(s=i,0===Fe&&Ae(G)),s===i&&(47===e.charCodeAt(je)?(s=f,je++):(s=i,0===Fe&&Ae(q))),s!==i&&(l=He())!==i?r=s=[s,l]:(je=r,r=i);r=Ne(),_e=t,t=me(n,a)}else je=t,t=i;return t===i&&(t=He()),t}function He(){var t;return(t=function(){var t,n,a,r;t=je,Ne(),40===e.charCodeAt(je)?(n=b,je++):(n=i,0===Fe&&Ae(W));n!==i?(Ne(),(a=Re())!==i?(Ne(),41===e.charCodeAt(je)?(r=x,je++):(r=i,0===Fe&&Ae($)),r!==i?(Ne(),_e=t,t=ge(a)):(je=t,t=i)):(je=t,t=i)):(je=t,t=i);return t}())===i&&(t=function(){var t,n,a,r,s;Fe++,t=je,Ne(),n=[],w.test(e.charAt(je))?(a=e.charAt(je),je++):(a=i,0===Fe&&Ae(Z));if(a!==i)for(;a!==i;)n.push(a),w.test(e.charAt(je))?(a=e.charAt(je),je++):(a=i,0===Fe&&Ae(Z));else n=i;n!==i?(40===e.charCodeAt(je)?(a=b,je++):(a=i,0===Fe&&Ae(W)),a!==i?(Ne(),r=function(){var t,n,a,r,s,l,o;if(Fe++,t=je,n=Ge(),n!==i){for(a=[],r=je,s=Ne(),44===e.charCodeAt(je)?(l=h,je++):(l=i,0===Fe&&Ae(K)),l!==i?(Ne(),(o=Ge())!==i?(_e=r,r=fe(n,o)):(je=r,r=i)):(je=r,r=i);r!==i;)a.push(r),r=je,s=Ne(),44===e.charCodeAt(je)?(l=h,je++):(l=i,0===Fe&&Ae(K)),l!==i?(Ne(),(o=Ge())!==i?(_e=r,r=fe(n,o)):(je=r,r=i)):(je=r,r=i);r=Ne(),44===e.charCodeAt(je)?(s=h,je++):(s=i,0===Fe&&Ae(K)),s===i&&(s=null),_e=t,t=be(n,a)}else je=t,t=i;Fe--,t===i&&(n=i,0===Fe&&Ae(Y));return t}(),r===i&&(r=null),Ne(),41===e.charCodeAt(je)?(s=x,je++):(s=i,0===Fe&&Ae($)),s!==i?(Ne(),_e=t,t=ve(n,r)):(je=t,t=i)):(je=t,t=i)):(je=t,t=i);Fe--,t===i&&(i,0===Fe&&Ae(Q));return t}())===i&&(t=Be()),t}function Ge(){var t,n,a,r,s;if(t=je,n=[],F.test(e.charAt(je))?(a=e.charAt(je),je++):(a=i,0===Fe&&Ae(U)),a!==i)for(;a!==i;)n.push(a),F.test(e.charAt(je))?(a=e.charAt(je),je++):(a=i,0===Fe&&Ae(U));else n=i;return n!==i?(a=Ne(),61===e.charCodeAt(je)?(r=v,je++):(r=i,0===Fe&&Ae(X)),r!==i?(Ne(),(s=qe())===i&&(s=function(){var t,n,a,r,s;if(t=je,34===e.charCodeAt(je)?(n=o,je++):(n=i,0===Fe&&Ae(L)),n!==i){for(a=[],r=je,e.substr(je,2)===u?(s=u,je+=2):(s=i,0===Fe&&Ae(D)),s!==i&&(_e=r,s=le()),(r=s)===i&&(k.test(e.charAt(je))?(r=e.charAt(je),je++):(r=i,0===Fe&&Ae(N)));r!==i;)a.push(r),r=je,e.substr(je,2)===u?(s=u,je+=2):(s=i,0===Fe&&Ae(D)),s!==i&&(_e=r,s=le()),(r=s)===i&&(k.test(e.charAt(je))?(r=e.charAt(je),je++):(r=i,0===Fe&&Ae(N)));34===e.charCodeAt(je)?(r=o,je++):(r=i,0===Fe&&Ae(L)),r!==i?(_e=t,t=xe(a)):(je=t,t=i)}else je=t,t=i;if(t===i){if(t=je,39===e.charCodeAt(je)?(n=c,je++):(n=i,0===Fe&&Ae(z)),n!==i){for(a=[],r=je,e.substr(je,2)===d?(s=d,je+=2):(s=i,0===Fe&&Ae(B)),s!==i&&(_e=r,s=ue()),(r=s)===i&&(I.test(e.charAt(je))?(r=e.charAt(je),je++):(r=i,0===Fe&&Ae(R)));r!==i;)a.push(r),r=je,e.substr(je,2)===d?(s=d,je+=2):(s=i,0===Fe&&Ae(B)),s!==i&&(_e=r,s=ue()),(r=s)===i&&(I.test(e.charAt(je))?(r=e.charAt(je),je++):(r=i,0===Fe&&Ae(R)));39===e.charCodeAt(je)?(r=c,je++):(r=i,0===Fe&&Ae(z)),r!==i?(_e=t,t=xe(a)):(je=t,t=i)}else je=t,t=i;if(t===i){if(t=je,n=[],(a=ze())!==i)for(;a!==i;)n.push(a),a=ze();else n=i;n!==i&&(_e=t,n=xe(n)),t=n}}return t}()),s!==i?(Ne(),_e=t,t=he(n,s)):(je=t,t=i)):(je=t,t=i)):(je=t,t=i),t===i&&(t=Re()),t}function qe(){var t,n,a,r,s;return Fe++,t=je,45===e.charCodeAt(je)?(n=m,je++):(n=i,0===Fe&&Ae(H)),n===i&&(n=null),a=function(){var t,n,a,r;48===e.charCodeAt(je)?(t=j,je++):(t=i,0===Fe&&Ae(ae));if(t===i)if(t=je,E.test(e.charAt(je))?(n=e.charAt(je),je++):(n=i,0===Fe&&Ae(ie)),n!==i){for(a=[],r=We();r!==i;)a.push(r),r=We();t=n=[n,a]}else je=t,t=i;return t}(),a!==i?(r=function(){var t,n,a,r;t=je,46===e.charCodeAt(je)?(n=y,je++):(n=i,0===Fe&&Ae(ne));if(n!==i){if(a=[],(r=We())!==i)for(;r!==i;)a.push(r),r=We();else a=i;a!==i?t=n=[n,a]:(je=t,t=i)}else je=t,t=i;return t}(),r===i&&(r=null),s=function(){var t,n,a,r,s;if(Fe++,t=je,n=function(){var t;T.test(e.charAt(je))?(t=e.charAt(je),je++):(t=i,0===Fe&&Ae(ee));return t}(),n!==i){if(45===e.charCodeAt(je)?(a=m,je++):(a=i,0===Fe&&Ae(H)),a===i&&(a=null),r=[],(s=We())!==i)for(;s!==i;)r.push(s),s=We();else r=i;r!==i?t=n=[n,a,r]:(je=t,t=i)}else je=t,t=i;Fe--,t===i&&(n=i,0===Fe&&Ae(te));return t}(),s===i&&(s=null),_e=t,t=ye()):(je=t,t=i),Fe--,t===i&&(n=i,0===Fe&&Ae(J)),t}function We(){var t;return C.test(e.charAt(je))?(t=e.charAt(je),je++):(t=i,0===Fe&&Ae(re)),t}function $e(e){return{min:e.start.offset,max:e.end.offset}}if((n=l())!==i&&je===e.length)return n;throw n!==i&&je<e.length&&Ae({type:"end"}),Le(Ie,ke<e.length?e.charAt(ke):null,ke<e.length?Se(ke,ke+1):Se(ke,ke))}}},function(e,t,n){const{abs:a}=n(269),{add:i}=n(116),{cbrt:r}=n(270),{ceil:s}=n(271),{clamp:l}=n(272),{cos:o}=n(273),{count:u}=n(274),{cube:c}=n(275),{degtorad:d}=n(276),{divide:p}=n(277),{exp:m}=n(278),{first:g}=n(279),{fix:f}=n(280),{floor:b}=n(281),{last:x}=n(282),{log:h}=n(118),{log10:v}=n(283),{max:y}=n(119),{mean:j}=n(284),{median:_}=n(285),{min:O}=n(121),{mod:k}=n(286),{mode:I}=n(287),{multiply:F}=n(288),{pi:w}=n(289),{pow:T}=n(99),{radtodeg:E}=n(290),{random:C}=n(291),{range:M}=n(292),{round:P}=n(293),{sin:S}=n(294),{size:A}=n(117),{sqrt:L}=n(295),{square:D}=n(296),{subtract:N}=n(122),{sum:z}=n(297),{tan:B}=n(298),{unique:R}=n(299);e.exports={functions:{abs:a,add:i,cbrt:r,ceil:s,clamp:l,cos:o,count:u,cube:c,degtorad:d,divide:p,exp:m,first:g,fix:f,floor:b,last:x,log:h,log10:v,max:y,mean:j,median:_,min:O,mod:k,mode:I,multiply:F,pi:w,pow:T,radtodeg:E,random:C,range:M,round:P,sin:S,size:A,sqrt:L,square:D,subtract:N,sum:z,tan:B,unique:R}}},function(e,t){e.exports={abs:function(e){if(Array.isArray(e))return e.map((e=>Math.abs(e)));return Math.abs(e)}}},function(e,t){e.exports={cbrt:function(e){if(Array.isArray(e))return e.map((e=>Math.cbrt(e)));return Math.cbrt(e)}}},function(e,t){e.exports={ceil:function(e){if(Array.isArray(e))return e.map((e=>Math.ceil(e)));return Math.ceil(e)}}},function(e,t){const n=(e,t,n)=>{if(t>n)throw new Error("Min must be less than max");return Math.min(Math.max(e,t),n)};e.exports={clamp:function(e,t,a){if(null===a)throw new Error("Missing maximum value. You may want to use the 'min' function instead");if(null===t)throw new Error("Missing minimum value. You may want to use the 'max' function instead");if(Array.isArray(a)){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==a.length||e.length!==t.length)throw new Error("Array length mismatch");return a.map(((a,i)=>n(e[i],t[i],a)))}if(Array.isArray(e)){if(e.length!==a.length)throw new Error("Array length mismatch");return a.map(((a,i)=>n(e[i],t,a)))}if(Array.isArray(t)){if(t.length!==a.length)throw new Error("Array length mismatch");return a.map(((a,i)=>n(e,t[i],a)))}return a.map((a=>n(e,t,a)))}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,a)=>n(e,t[a])))}if(Array.isArray(e))return e.map((e=>n(e,t,a)));if(Array.isArray(t))return t.map((t=>n(e,t,a)));return n(e,t,a)}}},function(e,t){e.exports={cos:function(e){if(Array.isArray(e))return e.map((e=>Math.cos(e)));return Math.cos(e)}}},function(e,t,n){const{size:a}=n(117);function i(e){return a(e)}e.exports={count:i},i.skipNumberValidation=!0},function(e,t,n){const{pow:a}=n(99);e.exports={cube:function(e){return a(e,3)}}},function(e,t){e.exports={degtorad:function(e){if(Array.isArray(e))return e.map((e=>e*Math.PI/180));return e*Math.PI/180}}},function(e,t){e.exports={divide:function(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,n)=>{if(0===t[n])throw new Error("Cannot divide by 0");return e/t[n]}))}if(Array.isArray(t))return t.map((t=>e/t));if(0===t)throw new Error("Cannot divide by 0");return Array.isArray(e)?e.map((e=>e/t)):e/t}}},function(e,t){e.exports={exp:function(e){if(Array.isArray(e))return e.map((e=>Math.exp(e)));return Math.exp(e)}}},function(e,t){function n(e){return Array.isArray(e)?e[0]:e}e.exports={first:n},n.skipNumberValidation=!0},function(e,t){const n=e=>e>0?Math.floor(e):Math.ceil(e);e.exports={fix:function(e){if(Array.isArray(e))return e.map((e=>n(e)));return n(e)}}},function(e,t){e.exports={floor:function(e){if(Array.isArray(e))return e.map((e=>Math.floor(e)));return Math.floor(e)}}},function(e,t){function n(e){return Array.isArray(e)?e[e.length-1]:e}e.exports={last:n},n.skipNumberValidation=!0},function(e,t,n){const{log:a}=n(118);e.exports={log10:function(e){return a(e,10)}}},function(e,t,n){const{add:a}=n(116);e.exports={mean:function(...e){if(1===e.length)return Array.isArray(e[0])?a(e[0])/e[0].length:e[0];const t=a(...e);if(Array.isArray(t))return t.map((t=>t/e.length));return t/e.length}}},function(e,t,n){const{transpose:a}=n(120),i=e=>{const t=e.length,n=Math.floor(t/2);return e.sort(((e,t)=>t-e)),t%2==0?(e[n]+e[n-1])/2:e[n]};e.exports={median:function(...e){if(1===e.length)return Array.isArray(e[0])?i(e[0]):e[0];const t=e.findIndex((e=>Array.isArray(e)));if(-1!==t){return a(e,t).map((e=>i(e)))}return i(e)}}},function(e,t){e.exports={mod:function(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,n)=>{if(0===t[n])throw new Error("Cannot divide by 0");return e%t[n]}))}if(Array.isArray(t))return t.map((t=>e%t));if(0===t)throw new Error("Cannot divide by 0");return Array.isArray(e)?e.map((e=>e%t)):e%t}}},function(e,t,n){const{transpose:a}=n(120),i=e=>{let t=0;const n={};return e.map((e=>{void 0===n[e]&&(n[e]=0),n[e]+=1,n[e]>t&&(t=n[e])})),Object.keys(n).filter((e=>n[e]===t)).map((e=>parseFloat(e))).sort(((e,t)=>e-t))};e.exports={mode:function(...e){if(1===e.length)return Array.isArray(e[0])?i(e[0]):e[0];const t=e.findIndex((e=>Array.isArray(e)));if(-1!==t){return a(e,t).map((e=>i(e)))}return i(e)}}},function(e,t){e.exports={multiply:function(...e){return e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,n)=>e*t[n]))}return Array.isArray(e)?e.map((e=>e*t)):Array.isArray(t)?t.map((t=>t*e)):e*t}))}}},function(e,t){e.exports={pi:function(){return Math.PI}}},function(e,t){e.exports={radtodeg:function(e){if(Array.isArray(e))return e.map((e=>180*e/Math.PI));return 180*e/Math.PI}}},function(e,t){e.exports={random:function(e,t){if(null==e)return Math.random();if(null==t){if(e<0)throw new Error("Min is greater than max");return Math.random()*e}if(e>t)throw new Error("Min is greater than max");return Math.random()*(t-e)+e}}},function(e,t,n){const{max:a}=n(119),{min:i}=n(121),{subtract:r}=n(122);e.exports={range:function(...e){return r(a(...e),i(...e))}}},function(e,t){const n=(e,t)=>Math.round(e*Math.pow(10,t))/Math.pow(10,t);e.exports={round:function(e,t=0){if(Array.isArray(e))return e.map((e=>n(e,t)));return n(e,t)}}},function(e,t){e.exports={sin:function(e){if(Array.isArray(e))return e.map((e=>Math.sin(e)));return Math.sin(e)}}},function(e,t){e.exports={sqrt:function(e){if(Array.isArray(e))return e.map((e=>{if(e<0)throw new Error("Unable find the square root of a negative number");return Math.sqrt(e)}));if(e<0)throw new Error("Unable find the square root of a negative number");return Math.sqrt(e)}}},function(e,t,n){const{pow:a}=n(99);e.exports={square:function(e){return a(e,2)}}},function(e,t){const n=(e,t)=>e+t;e.exports={sum:function(...e){return e.reduce(((e,t)=>Array.isArray(t)?e+t.reduce(n,0):e+t),0)}}},function(e,t){e.exports={tan:function(e){if(Array.isArray(e))return e.map((e=>Math.tan(e)));return Math.tan(e)}}},function(e,t){function n(e){return Array.isArray(e)?e.filter(((t,n)=>e.indexOf(t)===n)).length:1}e.exports={unique:n},n.skipNumberValidation=!0},function(e,t,n){switch(window.__kbnThemeTag__){case"v7dark":return n(301);case"v7light":return n(303);case"v8dark":return n(305);case"v8light":return n(307)}},function(e,t,n){var a=n(66),i=n(302);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,'.lnsFormula{display:flex;flex-direction:column}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula{height:100%}.lnsFormula>*{flex:1;min-height:0}.lnsFormula>*+*{border-top:1px solid #343741}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editor{border-bottom:none;display:flex;flex-direction:column}.lnsFormula__editor>*+*{border-top:1px solid #343741}.lnsFormula__editorHeader,.lnsFormula__editorFooter{padding:8px 16px}.lnsFormula__editorFooter{z-index:1;background-color:#25262e}.lnsFormula__editorHeaderGroup,.lnsFormula__editorFooterGroup{display:block}.lnsFormula__editorContent{min-height:0;position:relative}.lnsIndexPatternDimensionEditor:not(.lnsIndexPatternDimensionEditor-isFullscreen) .lnsFormula__editorContent{height:200px}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editorContent{flex:1}.lnsFormula__editorPlaceholder{position:absolute;top:0;left:16px;right:0;color:#7a7f89;font-family:Menlo,Monaco,"Courier New",monospace;pointer-events:none}.lnsFormula__warningText+.lnsFormula__warningText{margin-top:8px;border-top:1px solid #343741;padding-top:8px}.lnsFormula__editorHelp--inline{align-items:center;display:flex;padding:4px}.lnsFormula__editorHelp--inline>*+*{margin-left:4px}.lnsFormula__editorError{white-space:nowrap}.lnsFormula__docs{background:#1d1e24}.lnsFormula__docs--inline{display:flex;flex-direction:column;z-index:1}.lnsFormula__docs--overlay .lnsFormula__docsContent{height:40vh;width:min(75vh, 90vw)}.lnsFormula__docs--inline .lnsFormula__docsContent{flex:1;min-height:0}.lnsFormula__docsContent>*+*{border-left:1px solid #343741}.lnsFormula__docsSidebar{background:#25262e}.lnsFormula__docsSidebarInner{min-height:0}.lnsFormula__docsSidebarInner>*+*{border-top:1px solid #343741}.lnsFormula__docsSearch{padding:16px}.lnsFormula__docsNav{scrollbar-color:rgba(152,162,179,.5) rgba(0,0,0,0);scrollbar-width:thin;height:100%;overflow-y:auto;overflow-x:hidden}.lnsFormula__docsNav::-webkit-scrollbar{width:16px;height:16px}.lnsFormula__docsNav::-webkit-scrollbar-thumb{background-color:rgba(152,162,179,.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsFormula__docsNav::-webkit-scrollbar-corner,.lnsFormula__docsNav::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsFormula__docsNav:focus{outline:none}.lnsFormula__docsNav[tabindex="0"]:focus:focus-visible{outline-style:auto}.lnsFormula__docsNavGroup{padding:16px}.lnsFormula__docsNavGroup+.lnsFormula__docsNavGroup{border-top:1px solid #343741}.lnsFormula__docsNavGroupLink{font-weight:inherit}.lnsFormula__docsText{scrollbar-color:rgba(152,162,179,.5) rgba(0,0,0,0);scrollbar-width:thin;height:100%;overflow-y:auto;overflow-x:hidden;padding:16px}.lnsFormula__docsText::-webkit-scrollbar{width:16px;height:16px}.lnsFormula__docsText::-webkit-scrollbar-thumb{background-color:rgba(152,162,179,.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsFormula__docsText::-webkit-scrollbar-corner,.lnsFormula__docsText::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsFormula__docsText:focus{outline:none}.lnsFormula__docsText[tabindex="0"]:focus:focus-visible{outline-style:auto}.lnsFormula__docsTextGroup,.lnsFormula__docsTextItem{margin-top:40px}.lnsFormula__docsTextGroup{border-top:1px solid #343741;padding-top:40px}.lnsFormulaOverflow{z-index:9001}',""]),e.exports=t},function(e,t,n){var a=n(66),i=n(304);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,'.lnsFormula{display:flex;flex-direction:column}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula{height:100%}.lnsFormula>*{flex:1;min-height:0}.lnsFormula>*+*{border-top:1px solid #d3dae6}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editor{border-bottom:none;display:flex;flex-direction:column}.lnsFormula__editor>*+*{border-top:1px solid #d3dae6}.lnsFormula__editorHeader,.lnsFormula__editorFooter{padding:8px 16px}.lnsFormula__editorFooter{z-index:1;background-color:#f5f7fa}.lnsFormula__editorHeaderGroup,.lnsFormula__editorFooterGroup{display:block}.lnsFormula__editorContent{min-height:0;position:relative}.lnsIndexPatternDimensionEditor:not(.lnsIndexPatternDimensionEditor-isFullscreen) .lnsFormula__editorContent{height:200px}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editorContent{flex:1}.lnsFormula__editorPlaceholder{position:absolute;top:0;left:16px;right:0;color:#6a717d;font-family:Menlo,Monaco,"Courier New",monospace;pointer-events:none}.lnsFormula__warningText+.lnsFormula__warningText{margin-top:8px;border-top:1px solid #d3dae6;padding-top:8px}.lnsFormula__editorHelp--inline{align-items:center;display:flex;padding:4px}.lnsFormula__editorHelp--inline>*+*{margin-left:4px}.lnsFormula__editorError{white-space:nowrap}.lnsFormula__docs{background:#fff}.lnsFormula__docs--inline{display:flex;flex-direction:column;z-index:1}.lnsFormula__docs--overlay .lnsFormula__docsContent{height:40vh;width:min(75vh, 90vw)}.lnsFormula__docs--inline .lnsFormula__docsContent{flex:1;min-height:0}.lnsFormula__docsContent>*+*{border-left:1px solid #d3dae6}.lnsFormula__docsSidebar{background:#f5f7fa}.lnsFormula__docsSidebarInner{min-height:0}.lnsFormula__docsSidebarInner>*+*{border-top:1px solid #d3dae6}.lnsFormula__docsSearch{padding:16px}.lnsFormula__docsNav{scrollbar-color:rgba(105,112,125,.5) rgba(0,0,0,0);scrollbar-width:thin;height:100%;overflow-y:auto;overflow-x:hidden}.lnsFormula__docsNav::-webkit-scrollbar{width:16px;height:16px}.lnsFormula__docsNav::-webkit-scrollbar-thumb{background-color:rgba(105,112,125,.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsFormula__docsNav::-webkit-scrollbar-corner,.lnsFormula__docsNav::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsFormula__docsNav:focus{outline:none}.lnsFormula__docsNav[tabindex="0"]:focus:focus-visible{outline-style:auto}.lnsFormula__docsNavGroup{padding:16px}.lnsFormula__docsNavGroup+.lnsFormula__docsNavGroup{border-top:1px solid #d3dae6}.lnsFormula__docsNavGroupLink{font-weight:inherit}.lnsFormula__docsText{scrollbar-color:rgba(105,112,125,.5) rgba(0,0,0,0);scrollbar-width:thin;height:100%;overflow-y:auto;overflow-x:hidden;padding:16px}.lnsFormula__docsText::-webkit-scrollbar{width:16px;height:16px}.lnsFormula__docsText::-webkit-scrollbar-thumb{background-color:rgba(105,112,125,.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsFormula__docsText::-webkit-scrollbar-corner,.lnsFormula__docsText::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsFormula__docsText:focus{outline:none}.lnsFormula__docsText[tabindex="0"]:focus:focus-visible{outline-style:auto}.lnsFormula__docsTextGroup,.lnsFormula__docsTextItem{margin-top:40px}.lnsFormula__docsTextGroup{border-top:1px solid #d3dae6;padding-top:40px}.lnsFormulaOverflow{z-index:9001}',""]),e.exports=t},function(e,t,n){var a=n(66),i=n(306);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,'.lnsFormula{display:flex;flex-direction:column}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula{height:100%}.lnsFormula>*{flex:1;min-height:0}.lnsFormula>*+*{border-top:1px solid #343741}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editor{border-bottom:none;display:flex;flex-direction:column}.lnsFormula__editor>*+*{border-top:1px solid #343741}.lnsFormula__editorHeader,.lnsFormula__editorFooter{padding:8px 16px}.lnsFormula__editorFooter{z-index:1;background-color:#25262e}.lnsFormula__editorHeaderGroup,.lnsFormula__editorFooterGroup{display:block}.lnsFormula__editorContent{min-height:0;position:relative}.lnsIndexPatternDimensionEditor:not(.lnsIndexPatternDimensionEditor-isFullscreen) .lnsFormula__editorContent{height:200px}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editorContent{flex:1}.lnsFormula__editorPlaceholder{position:absolute;top:0;left:16px;right:0;color:#7a7f89;font-family:Menlo,Monaco,"Courier New",monospace;pointer-events:none}.lnsFormula__warningText+.lnsFormula__warningText{margin-top:8px;border-top:1px solid #343741;padding-top:8px}.lnsFormula__editorHelp--inline{align-items:center;display:flex;padding:4px}.lnsFormula__editorHelp--inline>*+*{margin-left:4px}.lnsFormula__editorError{white-space:nowrap}.lnsFormula__docs{background:#1d1e24}.lnsFormula__docs--inline{display:flex;flex-direction:column;z-index:1}.lnsFormula__docs--overlay .lnsFormula__docsContent{height:40vh;width:min(75vh, 90vw)}.lnsFormula__docs--inline .lnsFormula__docsContent{flex:1;min-height:0}.lnsFormula__docsContent>*+*{border-left:1px solid #343741}.lnsFormula__docsSidebar{background:#25262e}.lnsFormula__docsSidebarInner{min-height:0}.lnsFormula__docsSidebarInner>*+*{border-top:1px solid #343741}.lnsFormula__docsSearch{padding:16px}.lnsFormula__docsNav{scrollbar-color:rgba(152,162,179,.5) rgba(0,0,0,0);scrollbar-width:thin;height:100%;overflow-y:auto;overflow-x:hidden}.lnsFormula__docsNav::-webkit-scrollbar{width:16px;height:16px}.lnsFormula__docsNav::-webkit-scrollbar-thumb{background-color:rgba(152,162,179,.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsFormula__docsNav::-webkit-scrollbar-corner,.lnsFormula__docsNav::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsFormula__docsNav:focus{outline:none}.lnsFormula__docsNav[tabindex="0"]:focus:focus-visible{outline-style:auto}.lnsFormula__docsNavGroup{padding:16px}.lnsFormula__docsNavGroup+.lnsFormula__docsNavGroup{border-top:1px solid #343741}.lnsFormula__docsNavGroupLink{font-weight:inherit}.lnsFormula__docsText{scrollbar-color:rgba(152,162,179,.5) rgba(0,0,0,0);scrollbar-width:thin;height:100%;overflow-y:auto;overflow-x:hidden;padding:16px}.lnsFormula__docsText::-webkit-scrollbar{width:16px;height:16px}.lnsFormula__docsText::-webkit-scrollbar-thumb{background-color:rgba(152,162,179,.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsFormula__docsText::-webkit-scrollbar-corner,.lnsFormula__docsText::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsFormula__docsText:focus{outline:none}.lnsFormula__docsText[tabindex="0"]:focus:focus-visible{outline-style:auto}.lnsFormula__docsTextGroup,.lnsFormula__docsTextItem{margin-top:40px}.lnsFormula__docsTextGroup{border-top:1px solid #343741;padding-top:40px}.lnsFormulaOverflow{z-index:9001}',""]),e.exports=t},function(e,t,n){var a=n(66),i=n(308);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,'.lnsFormula{display:flex;flex-direction:column}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula{height:100%}.lnsFormula>*{flex:1;min-height:0}.lnsFormula>*+*{border-top:1px solid #d3dae6}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editor{border-bottom:none;display:flex;flex-direction:column}.lnsFormula__editor>*+*{border-top:1px solid #d3dae6}.lnsFormula__editorHeader,.lnsFormula__editorFooter{padding:8px 16px}.lnsFormula__editorFooter{z-index:1;background-color:#f5f7fa}.lnsFormula__editorHeaderGroup,.lnsFormula__editorFooterGroup{display:block}.lnsFormula__editorContent{min-height:0;position:relative}.lnsIndexPatternDimensionEditor:not(.lnsIndexPatternDimensionEditor-isFullscreen) .lnsFormula__editorContent{height:200px}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editorContent{flex:1}.lnsFormula__editorPlaceholder{position:absolute;top:0;left:16px;right:0;color:#69707d;font-family:Menlo,Monaco,"Courier New",monospace;pointer-events:none}.lnsFormula__warningText+.lnsFormula__warningText{margin-top:8px;border-top:1px solid #d3dae6;padding-top:8px}.lnsFormula__editorHelp--inline{align-items:center;display:flex;padding:4px}.lnsFormula__editorHelp--inline>*+*{margin-left:4px}.lnsFormula__editorError{white-space:nowrap}.lnsFormula__docs{background:#fff}.lnsFormula__docs--inline{display:flex;flex-direction:column;z-index:1}.lnsFormula__docs--overlay .lnsFormula__docsContent{height:40vh;width:min(75vh, 90vw)}.lnsFormula__docs--inline .lnsFormula__docsContent{flex:1;min-height:0}.lnsFormula__docsContent>*+*{border-left:1px solid #d3dae6}.lnsFormula__docsSidebar{background:#f5f7fa}.lnsFormula__docsSidebarInner{min-height:0}.lnsFormula__docsSidebarInner>*+*{border-top:1px solid #d3dae6}.lnsFormula__docsSearch{padding:16px}.lnsFormula__docsNav{scrollbar-color:rgba(105,112,125,.5) rgba(0,0,0,0);scrollbar-width:thin;height:100%;overflow-y:auto;overflow-x:hidden}.lnsFormula__docsNav::-webkit-scrollbar{width:16px;height:16px}.lnsFormula__docsNav::-webkit-scrollbar-thumb{background-color:rgba(105,112,125,.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsFormula__docsNav::-webkit-scrollbar-corner,.lnsFormula__docsNav::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsFormula__docsNav:focus{outline:none}.lnsFormula__docsNav[tabindex="0"]:focus:focus-visible{outline-style:auto}.lnsFormula__docsNavGroup{padding:16px}.lnsFormula__docsNavGroup+.lnsFormula__docsNavGroup{border-top:1px solid #d3dae6}.lnsFormula__docsNavGroupLink{font-weight:inherit}.lnsFormula__docsText{scrollbar-color:rgba(105,112,125,.5) rgba(0,0,0,0);scrollbar-width:thin;height:100%;overflow-y:auto;overflow-x:hidden;padding:16px}.lnsFormula__docsText::-webkit-scrollbar{width:16px;height:16px}.lnsFormula__docsText::-webkit-scrollbar-thumb{background-color:rgba(105,112,125,.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsFormula__docsText::-webkit-scrollbar-corner,.lnsFormula__docsText::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsFormula__docsText:focus{outline:none}.lnsFormula__docsText[tabindex="0"]:focus:focus-visible{outline-style:auto}.lnsFormula__docsTextGroup,.lnsFormula__docsTextItem{margin-top:40px}.lnsFormula__docsTextGroup{border-top:1px solid #d3dae6;padding-top:40px}.lnsFormulaOverflow{z-index:9001}',""]),e.exports=t},function(e,t,n){switch(window.__kbnThemeTag__){case"v7dark":return n(310);case"v7light":return n(312);case"v8dark":return n(314);case"v8light":return n(316)}},function(e,t,n){var a=n(66),i=n(311);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsFiltersOperation__popoverButton{overflow-wrap:break-word !important;word-wrap:break-word !important;word-break:break-word;font-size:14px;font-size:0.875rem;line-height:1.5;min-height:32px;width:100%}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(313);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsFiltersOperation__popoverButton{overflow-wrap:break-word !important;word-wrap:break-word !important;word-break:break-word;font-size:14px;font-size:0.875rem;line-height:1.5;min-height:32px;width:100%}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(315);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsFiltersOperation__popoverButton{overflow-wrap:break-word !important;word-wrap:break-word !important;word-break:break-word;font-size:14px;font-size:1rem;line-height:1.7142857143rem;min-height:32px;width:100%}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(317);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsFiltersOperation__popoverButton{overflow-wrap:break-word !important;word-wrap:break-word !important;word-break:break-word;font-size:14px;font-size:1rem;line-height:1.7142857143rem;min-height:32px;width:100%}",""]),e.exports=t},function(e,t,n){var a=n(319);function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}e.exports=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){e.exports=n(15)(2395)},function(e,t,n){e.exports=n(15)(2387)},function(e,t,n){e.exports=n(15)(2394)},function(e,t,n){e.exports=n(15)(1074)},function(e,t,n){e.exports=n(15)(1073)},function(e,t,n){e.exports=n(15)(2397)},function(e,t,n){e.exports=n(15)(2407)},function(e,t,n){switch(window.__kbnThemeTag__){case"v7dark":return n(327);case"v7light":return n(329);case"v8dark":return n(331);case"v8light":return n(333)}},function(e,t,n){var a=n(66),i=n(328);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsIndexPatternDimensionEditor__filtersEditor{width:960px}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(330);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsIndexPatternDimensionEditor__filtersEditor{width:960px}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(332);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsIndexPatternDimensionEditor__filtersEditor{width:960px}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(334);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsIndexPatternDimensionEditor__filtersEditor{width:960px}",""]),e.exports=t},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ES_FIELD_TYPES",{enumerable:!0,get:function(){return r.ES_FIELD_TYPES}}),Object.defineProperty(t,"KBN_FIELD_TYPES",{enumerable:!0,get:function(){return r.KBN_FIELD_TYPES}}),Object.defineProperty(t,"KbnFieldType",{enumerable:!0,get:function(){return a.KbnFieldType}}),Object.defineProperty(t,"castEsToKbnFieldTypeName",{enumerable:!0,get:function(){return i.castEsToKbnFieldTypeName}}),Object.defineProperty(t,"getFilterableKbnTypeNames",{enumerable:!0,get:function(){return i.getFilterableKbnTypeNames}}),Object.defineProperty(t,"getKbnFieldType",{enumerable:!0,get:function(){return i.getKbnFieldType}}),Object.defineProperty(t,"getKbnTypeNames",{enumerable:!0,get:function(){return i.getKbnTypeNames}});var a=n(125),i=n(336),r=n(93)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getKbnTypeNames=t.getKbnFieldType=t.getFilterableKbnTypeNames=t.castEsToKbnFieldTypeName=void 0;var a=n(337),i=n(93);const r=(0,a.createKbnFieldTypes)();t.getKbnFieldType=e=>r.find((t=>t.name===e))||a.kbnFieldTypeUnknown;t.getKbnTypeNames=()=>r.filter((e=>e.name)).map((e=>e.name));t.castEsToKbnFieldTypeName=e=>{const t=r.find((t=>t.esTypes.includes(e)));return t&&t.name?t.name:i.KBN_FIELD_TYPES.UNKNOWN};t.getFilterableKbnTypeNames=()=>r.filter((e=>e.filterable)).map((e=>e.name))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.kbnFieldTypeUnknown=t.createKbnFieldTypes=void 0;var a=n(125),i=n(93);const r=t.kbnFieldTypeUnknown=new a.KbnFieldType({name:i.KBN_FIELD_TYPES.UNKNOWN});t.createKbnFieldTypes=()=>[new a.KbnFieldType({name:i.KBN_FIELD_TYPES.STRING,sortable:!0,filterable:!0,esTypes:[i.ES_FIELD_TYPES.STRING,i.ES_FIELD_TYPES.TEXT,i.ES_FIELD_TYPES.KEYWORD,i.ES_FIELD_TYPES.VERSION,i.ES_FIELD_TYPES._TYPE,i.ES_FIELD_TYPES._ID]}),new a.KbnFieldType({name:i.KBN_FIELD_TYPES.NUMBER,sortable:!0,filterable:!0,esTypes:[i.ES_FIELD_TYPES.FLOAT,i.ES_FIELD_TYPES.HALF_FLOAT,i.ES_FIELD_TYPES.SCALED_FLOAT,i.ES_FIELD_TYPES.DOUBLE,i.ES_FIELD_TYPES.INTEGER,i.ES_FIELD_TYPES.LONG,i.ES_FIELD_TYPES.UNSIGNED_LONG,i.ES_FIELD_TYPES.SHORT,i.ES_FIELD_TYPES.BYTE,i.ES_FIELD_TYPES.TOKEN_COUNT]}),new a.KbnFieldType({name:i.KBN_FIELD_TYPES.NUMBER_RANGE,sortable:!0,filterable:!0,esTypes:[i.ES_FIELD_TYPES.FLOAT_RANGE,i.ES_FIELD_TYPES.DOUBLE_RANGE,i.ES_FIELD_TYPES.INTEGER_RANGE,i.ES_FIELD_TYPES.LONG_RANGE]}),new a.KbnFieldType({name:i.KBN_FIELD_TYPES.DATE,sortable:!0,filterable:!0,esTypes:[i.ES_FIELD_TYPES.DATE,i.ES_FIELD_TYPES.DATE_NANOS]}),new a.KbnFieldType({name:i.KBN_FIELD_TYPES.DATE_RANGE,sortable:!0,filterable:!0,esTypes:[i.ES_FIELD_TYPES.DATE_RANGE]}),new a.KbnFieldType({name:i.KBN_FIELD_TYPES.IP,sortable:!0,filterable:!0,esTypes:[i.ES_FIELD_TYPES.IP]}),new a.KbnFieldType({name:i.KBN_FIELD_TYPES.IP_RANGE,sortable:!0,filterable:!0,esTypes:[i.ES_FIELD_TYPES.IP_RANGE]}),new a.KbnFieldType({name:i.KBN_FIELD_TYPES.BOOLEAN,sortable:!0,filterable:!0,esTypes:[i.ES_FIELD_TYPES.BOOLEAN]}),new a.KbnFieldType({name:i.KBN_FIELD_TYPES.OBJECT,esTypes:[i.ES_FIELD_TYPES.OBJECT]}),new a.KbnFieldType({name:i.KBN_FIELD_TYPES.NESTED,esTypes:[i.ES_FIELD_TYPES.NESTED]}),new a.KbnFieldType({name:i.KBN_FIELD_TYPES.GEO_POINT,esTypes:[i.ES_FIELD_TYPES.GEO_POINT]}),new a.KbnFieldType({name:i.KBN_FIELD_TYPES.GEO_SHAPE,esTypes:[i.ES_FIELD_TYPES.GEO_SHAPE]}),new a.KbnFieldType({name:i.KBN_FIELD_TYPES.ATTACHMENT,esTypes:[i.ES_FIELD_TYPES.ATTACHMENT]}),new a.KbnFieldType({name:i.KBN_FIELD_TYPES.MURMUR3,esTypes:[i.ES_FIELD_TYPES.MURMUR3]}),new a.KbnFieldType({name:i.KBN_FIELD_TYPES._SOURCE,esTypes:[i.ES_FIELD_TYPES._SOURCE]}),new a.KbnFieldType({name:i.KBN_FIELD_TYPES.HISTOGRAM,filterable:!0,esTypes:[i.ES_FIELD_TYPES.HISTOGRAM]}),new a.KbnFieldType({name:i.KBN_FIELD_TYPES.CONFLICT}),r]},function(e,t,n){switch(window.__kbnThemeTag__){case"v7dark":return n(339);case"v7light":return n(341);case"v8dark":return n(343);case"v8light":return n(345)}},function(e,t,n){var a=n(66),i=n(340);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,'.lnsHelpPopover__panel{max-width:480px}.lnsHelpPopover__content{scrollbar-color:rgba(152,162,179,.5) rgba(0,0,0,0);scrollbar-width:thin;height:100%;overflow-y:auto;overflow-x:hidden;-webkit-mask-image:linear-gradient(to bottom, rgba(255, 0, 0, 0.1) 0%, red 7.5px, red calc(100% - 7.5px), rgba(255, 0, 0, 0.1) 100%);mask-image:linear-gradient(to bottom, rgba(255, 0, 0, 0.1) 0%, red 7.5px, red calc(100% - 7.5px), rgba(255, 0, 0, 0.1) 100%);max-height:40vh;padding:12px}.lnsHelpPopover__content::-webkit-scrollbar{width:16px;height:16px}.lnsHelpPopover__content::-webkit-scrollbar-thumb{background-color:rgba(152,162,179,.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsHelpPopover__content::-webkit-scrollbar-corner,.lnsHelpPopover__content::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsHelpPopover__content:focus{outline:none}.lnsHelpPopover__content[tabindex="0"]:focus:focus-visible{outline-style:auto}.lnsHelpPopover__buttonIcon{margin-right:4px}',""]),e.exports=t},function(e,t,n){var a=n(66),i=n(342);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,'.lnsHelpPopover__panel{max-width:480px}.lnsHelpPopover__content{scrollbar-color:rgba(105,112,125,.5) rgba(0,0,0,0);scrollbar-width:thin;height:100%;overflow-y:auto;overflow-x:hidden;-webkit-mask-image:linear-gradient(to bottom, rgba(255, 0, 0, 0.1) 0%, red 7.5px, red calc(100% - 7.5px), rgba(255, 0, 0, 0.1) 100%);mask-image:linear-gradient(to bottom, rgba(255, 0, 0, 0.1) 0%, red 7.5px, red calc(100% - 7.5px), rgba(255, 0, 0, 0.1) 100%);max-height:40vh;padding:12px}.lnsHelpPopover__content::-webkit-scrollbar{width:16px;height:16px}.lnsHelpPopover__content::-webkit-scrollbar-thumb{background-color:rgba(105,112,125,.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsHelpPopover__content::-webkit-scrollbar-corner,.lnsHelpPopover__content::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsHelpPopover__content:focus{outline:none}.lnsHelpPopover__content[tabindex="0"]:focus:focus-visible{outline-style:auto}.lnsHelpPopover__buttonIcon{margin-right:4px}',""]),e.exports=t},function(e,t,n){var a=n(66),i=n(344);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,'.lnsHelpPopover__panel{max-width:480px}.lnsHelpPopover__content{scrollbar-color:rgba(152,162,179,.5) rgba(0,0,0,0);scrollbar-width:thin;height:100%;overflow-y:auto;overflow-x:hidden;-webkit-mask-image:linear-gradient(to bottom, rgba(255, 0, 0, 0.1) 0%, red 7.5px, red calc(100% - 7.5px), rgba(255, 0, 0, 0.1) 100%);mask-image:linear-gradient(to bottom, rgba(255, 0, 0, 0.1) 0%, red 7.5px, red calc(100% - 7.5px), rgba(255, 0, 0, 0.1) 100%);max-height:40vh;padding:12px}.lnsHelpPopover__content::-webkit-scrollbar{width:16px;height:16px}.lnsHelpPopover__content::-webkit-scrollbar-thumb{background-color:rgba(152,162,179,.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsHelpPopover__content::-webkit-scrollbar-corner,.lnsHelpPopover__content::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsHelpPopover__content:focus{outline:none}.lnsHelpPopover__content[tabindex="0"]:focus:focus-visible{outline-style:auto}.lnsHelpPopover__buttonIcon{margin-right:4px}',""]),e.exports=t},function(e,t,n){var a=n(66),i=n(346);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,'.lnsHelpPopover__panel{max-width:480px}.lnsHelpPopover__content{scrollbar-color:rgba(105,112,125,.5) rgba(0,0,0,0);scrollbar-width:thin;height:100%;overflow-y:auto;overflow-x:hidden;-webkit-mask-image:linear-gradient(to bottom, rgba(255, 0, 0, 0.1) 0%, red 7.5px, red calc(100% - 7.5px), rgba(255, 0, 0, 0.1) 100%);mask-image:linear-gradient(to bottom, rgba(255, 0, 0, 0.1) 0%, red 7.5px, red calc(100% - 7.5px), rgba(255, 0, 0, 0.1) 100%);max-height:40vh;padding:12px}.lnsHelpPopover__content::-webkit-scrollbar{width:16px;height:16px}.lnsHelpPopover__content::-webkit-scrollbar-thumb{background-color:rgba(105,112,125,.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsHelpPopover__content::-webkit-scrollbar-corner,.lnsHelpPopover__content::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsHelpPopover__content:focus{outline:none}.lnsHelpPopover__content[tabindex="0"]:focus:focus-visible{outline-style:auto}.lnsHelpPopover__buttonIcon{margin-right:4px}',""]),e.exports=t},function(e,t,n){switch(window.__kbnThemeTag__){case"v7dark":return n(348);case"v7light":return n(350);case"v8dark":return n(352);case"v8light":return n(354)}},function(e,t,n){var a=n(66),i=n(349);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsRangesOperation__popoverButton{overflow-wrap:break-word !important;word-wrap:break-word !important;word-break:break-word;font-size:14px;font-size:0.875rem;line-height:1.5;min-height:32px;width:100%}.lnsRangesOperation__popoverNumberField{width:14ch}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(351);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsRangesOperation__popoverButton{overflow-wrap:break-word !important;word-wrap:break-word !important;word-break:break-word;font-size:14px;font-size:0.875rem;line-height:1.5;min-height:32px;width:100%}.lnsRangesOperation__popoverNumberField{width:14ch}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(353);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsRangesOperation__popoverButton{overflow-wrap:break-word !important;word-wrap:break-word !important;word-break:break-word;font-size:14px;font-size:1rem;line-height:1.7142857143rem;min-height:32px;width:100%}.lnsRangesOperation__popoverNumberField{width:14ch}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(355);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsRangesOperation__popoverButton{overflow-wrap:break-word !important;word-wrap:break-word !important;word-break:break-word;font-size:14px;font-size:1rem;line-height:1.7142857143rem;min-height:32px;width:100%}.lnsRangesOperation__popoverNumberField{width:14ch}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(357);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsIndexPatternDimensionEditor{height:100%}.lnsIndexPatternDimensionEditor__header{position:sticky;top:0;background:#1d1e24;z-index:1000;padding:0 16px}.lnsIndexPatternDimensionEditor-isFullscreen{position:absolute;left:0;right:0;top:0;bottom:0}.lnsIndexPatternDimensionEditor-isFullscreen .lnsIndexPatternDimensionEditor__section{height:100%}.lnsIndexPatternDimensionEditor__section--padded{padding:16px}.lnsIndexPatternDimensionEditor__section--collapseNext{margin-bottom:-24px}.lnsIndexPatternDimensionEditor__section--shaded{background-color:#25262e;border-bottom:1px solid #343741}.lnsIndexPatternDimensionEditor__columns{column-count:2;column-gap:32px}.lnsIndexPatternDimensionEditor__operation{display:block}.lnsIndexPatternDimensionEditor__operation .euiListGroupItem__label{width:100%}.lnsIndexPatternDimensionEditor__operation>button{padding-top:0;padding-bottom:0}.lnsIndexPatternDimensionEditor__warning{border:none}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(359);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsIndexPatternDimensionEditor{height:100%}.lnsIndexPatternDimensionEditor__header{position:sticky;top:0;background:#fff;z-index:1000;padding:0 16px}.lnsIndexPatternDimensionEditor-isFullscreen{position:absolute;left:0;right:0;top:0;bottom:0}.lnsIndexPatternDimensionEditor-isFullscreen .lnsIndexPatternDimensionEditor__section{height:100%}.lnsIndexPatternDimensionEditor__section--padded{padding:16px}.lnsIndexPatternDimensionEditor__section--collapseNext{margin-bottom:-24px}.lnsIndexPatternDimensionEditor__section--shaded{background-color:#f5f7fa;border-bottom:1px solid #d3dae6}.lnsIndexPatternDimensionEditor__columns{column-count:2;column-gap:32px}.lnsIndexPatternDimensionEditor__operation{display:block}.lnsIndexPatternDimensionEditor__operation .euiListGroupItem__label{width:100%}.lnsIndexPatternDimensionEditor__operation>button{padding-top:0;padding-bottom:0}.lnsIndexPatternDimensionEditor__warning{border:none}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(361);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsIndexPatternDimensionEditor{height:100%}.lnsIndexPatternDimensionEditor__header{position:sticky;top:0;background:#1d1e24;z-index:1000;padding:0 16px}.lnsIndexPatternDimensionEditor-isFullscreen{position:absolute;left:0;right:0;top:0;bottom:0}.lnsIndexPatternDimensionEditor-isFullscreen .lnsIndexPatternDimensionEditor__section{height:100%}.lnsIndexPatternDimensionEditor__section--padded{padding:16px}.lnsIndexPatternDimensionEditor__section--collapseNext{margin-bottom:-24px}.lnsIndexPatternDimensionEditor__section--shaded{background-color:#25262e;border-bottom:1px solid #343741}.lnsIndexPatternDimensionEditor__columns{column-count:2;column-gap:32px}.lnsIndexPatternDimensionEditor__operation{display:block}.lnsIndexPatternDimensionEditor__operation .euiListGroupItem__label{width:100%}.lnsIndexPatternDimensionEditor__operation>button{padding-top:0;padding-bottom:0}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(363);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsIndexPatternDimensionEditor{height:100%}.lnsIndexPatternDimensionEditor__header{position:sticky;top:0;background:#fff;z-index:1000;padding:0 16px}.lnsIndexPatternDimensionEditor-isFullscreen{position:absolute;left:0;right:0;top:0;bottom:0}.lnsIndexPatternDimensionEditor-isFullscreen .lnsIndexPatternDimensionEditor__section{height:100%}.lnsIndexPatternDimensionEditor__section--padded{padding:16px}.lnsIndexPatternDimensionEditor__section--collapseNext{margin-bottom:-24px}.lnsIndexPatternDimensionEditor__section--shaded{background-color:#f5f7fa;border-bottom:1px solid #d3dae6}.lnsIndexPatternDimensionEditor__columns{column-count:2;column-gap:32px}.lnsIndexPatternDimensionEditor__operation{display:block}.lnsIndexPatternDimensionEditor__operation .euiListGroupItem__label{width:100%}.lnsIndexPatternDimensionEditor__operation>button{padding-top:0;padding-bottom:0}",""]),e.exports=t},function(e,t,n){switch(window.__kbnThemeTag__){case"v7dark":return n(365);case"v7light":return n(367);case"v8dark":return n(369);case"v8light":return n(371)}},function(e,t,n){var a=n(66),i=n(366);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnFieldSelect__option--incompatible{color:#343741}.lnFieldSelect__option--nonExistant{background-color:#25262e}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(368);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnFieldSelect__option--incompatible{color:#d3dae6}.lnFieldSelect__option--nonExistant{background-color:#f5f7fa}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(370);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnFieldSelect__option--incompatible{color:#343741}.lnFieldSelect__option--nonExistant{background-color:#25262e}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(372);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnFieldSelect__option--incompatible{color:#d3dae6}.lnFieldSelect__option--nonExistant{background-color:#f5f7fa}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(374);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsInnerIndexPatternDataPanel{width:100%;height:100%;padding:16px 16px 0}.lnsInnerIndexPatternDataPanel__switcher{min-width:0}.lnsInnerIndexPatternDataPanel__header{display:flex;align-items:center;margin-bottom:8px}.lnsInnerIndexPatternDataPanel__titleTooltip{margin-right:4px}.lnsInnerIndexPatternDataPanel__fieldItems{padding:4px}.lnsInnerIndexPatternDataPanel__textField{padding-right:40px;padding-left:40px}.lnsInnerIndexPatternDataPanel__filterType{font-size:14px;padding:8px;border-bottom:1px solid #25262e}.lnsInnerIndexPatternDataPanel__filterTypeInner{display:flex;align-items:center}.lnsInnerIndexPatternDataPanel__filterTypeInner .lnsFieldListPanel__fieldIcon{margin-right:8px}.lnsChangeIndexPatternPopover{width:320px}.lnsChangeIndexPatternPopover__trigger{padding:0 16px}.lnsLayerPanelChartSwitch_title{font-weight:600;display:inline;padding-left:8px}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(376);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsInnerIndexPatternDataPanel{width:100%;height:100%;padding:16px 16px 0}.lnsInnerIndexPatternDataPanel__switcher{min-width:0}.lnsInnerIndexPatternDataPanel__header{display:flex;align-items:center;margin-bottom:8px}.lnsInnerIndexPatternDataPanel__titleTooltip{margin-right:4px}.lnsInnerIndexPatternDataPanel__fieldItems{padding:4px}.lnsInnerIndexPatternDataPanel__textField{padding-right:40px;padding-left:40px}.lnsInnerIndexPatternDataPanel__filterType{font-size:14px;padding:8px;border-bottom:1px solid #f5f7fa}.lnsInnerIndexPatternDataPanel__filterTypeInner{display:flex;align-items:center}.lnsInnerIndexPatternDataPanel__filterTypeInner .lnsFieldListPanel__fieldIcon{margin-right:8px}.lnsChangeIndexPatternPopover{width:320px}.lnsChangeIndexPatternPopover__trigger{padding:0 16px}.lnsLayerPanelChartSwitch_title{font-weight:600;display:inline;padding-left:8px}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(378);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsInnerIndexPatternDataPanel{width:100%;height:100%;padding:16px 16px 0}.lnsInnerIndexPatternDataPanel__switcher{min-width:0}.lnsInnerIndexPatternDataPanel__header{display:flex;align-items:center;margin-bottom:8px}.lnsInnerIndexPatternDataPanel__titleTooltip{margin-right:4px}.lnsInnerIndexPatternDataPanel__fieldItems{padding:4px}.lnsInnerIndexPatternDataPanel__textField{padding-right:40px;padding-left:40px}.lnsInnerIndexPatternDataPanel__filterType{font-size:14px;padding:8px;border-bottom:1px solid #25262e}.lnsInnerIndexPatternDataPanel__filterTypeInner{display:flex;align-items:center}.lnsInnerIndexPatternDataPanel__filterTypeInner .lnsFieldListPanel__fieldIcon{margin-right:8px}.lnsChangeIndexPatternPopover{width:320px}.lnsChangeIndexPatternPopover__trigger{padding:0 16px}.lnsLayerPanelChartSwitch_title{font-weight:600;display:inline;padding-left:8px}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(380);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsInnerIndexPatternDataPanel{width:100%;height:100%;padding:16px 16px 0}.lnsInnerIndexPatternDataPanel__switcher{min-width:0}.lnsInnerIndexPatternDataPanel__header{display:flex;align-items:center;margin-bottom:8px}.lnsInnerIndexPatternDataPanel__titleTooltip{margin-right:4px}.lnsInnerIndexPatternDataPanel__fieldItems{padding:4px}.lnsInnerIndexPatternDataPanel__textField{padding-right:40px;padding-left:40px}.lnsInnerIndexPatternDataPanel__filterType{font-size:14px;padding:8px;border-bottom:1px solid #f5f7fa}.lnsInnerIndexPatternDataPanel__filterTypeInner{display:flex;align-items:center}.lnsInnerIndexPatternDataPanel__filterTypeInner .lnsFieldListPanel__fieldIcon{margin-right:8px}.lnsChangeIndexPatternPopover{width:320px}.lnsChangeIndexPatternPopover__trigger{padding:0 16px}.lnsLayerPanelChartSwitch_title{font-weight:600;display:inline;padding-left:8px}",""]),e.exports=t},,,,,,,,,,,,function(e,t,n){switch(window.__kbnThemeTag__){case"v7dark":return n(393);case"v7light":return n(395);case"v8dark":return n(397);case"v8light":return n(399)}},function(e,t,n){var a=n(66),i=n(394);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsIndexPatternFieldList{-webkit-mask-image:linear-gradient(to bottom, rgba(255, 0, 0, 0.1) 0%, red 7.5px, red calc(100% - 7.5px), rgba(255, 0, 0, 0.1) 100%);mask-image:linear-gradient(to bottom, rgba(255, 0, 0, 0.1) 0%, red 7.5px, red calc(100% - 7.5px), rgba(255, 0, 0, 0.1) 100%);scrollbar-color:rgba(152,162,179,.5) rgba(0,0,0,0);scrollbar-width:thin;margin-left:-16px;position:relative;flex-grow:1;overflow:auto}.lnsIndexPatternFieldList::-webkit-scrollbar{width:16px;height:16px}.lnsIndexPatternFieldList::-webkit-scrollbar-thumb{background-color:rgba(152,162,179,.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsIndexPatternFieldList::-webkit-scrollbar-corner,.lnsIndexPatternFieldList::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsIndexPatternFieldList__accordionContainer{padding-top:8px;position:absolute;top:0;left:16px;right:4px}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(396);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsIndexPatternFieldList{-webkit-mask-image:linear-gradient(to bottom, rgba(255, 0, 0, 0.1) 0%, red 7.5px, red calc(100% - 7.5px), rgba(255, 0, 0, 0.1) 100%);mask-image:linear-gradient(to bottom, rgba(255, 0, 0, 0.1) 0%, red 7.5px, red calc(100% - 7.5px), rgba(255, 0, 0, 0.1) 100%);scrollbar-color:rgba(105,112,125,.5) rgba(0,0,0,0);scrollbar-width:thin;margin-left:-16px;position:relative;flex-grow:1;overflow:auto}.lnsIndexPatternFieldList::-webkit-scrollbar{width:16px;height:16px}.lnsIndexPatternFieldList::-webkit-scrollbar-thumb{background-color:rgba(105,112,125,.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsIndexPatternFieldList::-webkit-scrollbar-corner,.lnsIndexPatternFieldList::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsIndexPatternFieldList__accordionContainer{padding-top:8px;position:absolute;top:0;left:16px;right:4px}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(398);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsIndexPatternFieldList{-webkit-mask-image:linear-gradient(to bottom, rgba(255, 0, 0, 0.1) 0%, red 7.5px, red calc(100% - 7.5px), rgba(255, 0, 0, 0.1) 100%);mask-image:linear-gradient(to bottom, rgba(255, 0, 0, 0.1) 0%, red 7.5px, red calc(100% - 7.5px), rgba(255, 0, 0, 0.1) 100%);scrollbar-color:rgba(152,162,179,.5) rgba(0,0,0,0);scrollbar-width:thin;margin-left:-16px;position:relative;flex-grow:1;overflow:auto}.lnsIndexPatternFieldList::-webkit-scrollbar{width:16px;height:16px}.lnsIndexPatternFieldList::-webkit-scrollbar-thumb{background-color:rgba(152,162,179,.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsIndexPatternFieldList::-webkit-scrollbar-corner,.lnsIndexPatternFieldList::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsIndexPatternFieldList__accordionContainer{padding-top:8px;position:absolute;top:0;left:16px;right:4px}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(400);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsIndexPatternFieldList{-webkit-mask-image:linear-gradient(to bottom, rgba(255, 0, 0, 0.1) 0%, red 7.5px, red calc(100% - 7.5px), rgba(255, 0, 0, 0.1) 100%);mask-image:linear-gradient(to bottom, rgba(255, 0, 0, 0.1) 0%, red 7.5px, red calc(100% - 7.5px), rgba(255, 0, 0, 0.1) 100%);scrollbar-color:rgba(105,112,125,.5) rgba(0,0,0,0);scrollbar-width:thin;margin-left:-16px;position:relative;flex-grow:1;overflow:auto}.lnsIndexPatternFieldList::-webkit-scrollbar{width:16px;height:16px}.lnsIndexPatternFieldList::-webkit-scrollbar-thumb{background-color:rgba(105,112,125,.5);background-clip:content-box;border-radius:16px;border:6px solid rgba(0,0,0,0)}.lnsIndexPatternFieldList::-webkit-scrollbar-corner,.lnsIndexPatternFieldList::-webkit-scrollbar-track{background-color:rgba(0,0,0,0)}.lnsIndexPatternFieldList__accordionContainer{padding-top:8px;position:absolute;top:0;left:16px;right:4px}",""]),e.exports=t},function(e,t,n){switch(window.__kbnThemeTag__){case"v7dark":return n(402);case"v7light":return n(404);case"v8dark":return n(406);case"v8light":return n(408)}},function(e,t,n){var a=n(66),i=n(403);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsFieldItem{width:100%}.lnsFieldItem.kbnFieldButton:focus-within,.lnsFieldItem.kbnFieldButton-isActive{animation:none !important}.lnsFieldItem .kbnFieldButton__button:focus{animation:none !important}.lnsFieldItem .kbnFieldButton__button:focus .kbnFieldButton__name>span{background-color:#052231;animation:350ms cubic-bezier(0.694, 0.0482, 0.335, 1) 1 normal forwards focusRingAnimate !important}.lnsFieldItem .kbnFieldButton__button:focus .kbnFieldButton__name>span{text-decoration:underline}.lnsFieldItem .lnsFieldItem__infoIcon{visibility:hidden;opacity:0}.lnsFieldItem:hover:not([class*=isActive]){cursor:grab}.lnsFieldItem:hover:not([class*=isActive]) .lnsFieldItem__infoIcon{visibility:visible;opacity:1;transition:opacity 150ms ease-in-out 1s}.kbnFieldButton.lnsDragDrop_ghost .lnsFieldItem__infoIcon{visibility:hidden;opacity:0}.kbnFieldButton__name{transition:background-color 150ms ease-in-out}.lnsFieldItem--missing{background:#1d1e24;color:#98a2b3}.lnsFieldItem__topValue{margin-bottom:8px}.lnsFieldItem__topValue:last-of-type{margin-bottom:0}.lnsFieldItem__topValueProgress{background-color:#25262e}.lnsFieldItem__topValueProgress::-webkit-progress-bar{background-color:#25262e}.lnsFieldItem__fieldPanel{min-width:260px;max-width:300px}.lnsFieldItem__fieldPanelTitle{text-transform:none}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(405);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsFieldItem{width:100%}.lnsFieldItem.kbnFieldButton:focus-within,.lnsFieldItem.kbnFieldButton-isActive{animation:none !important}.lnsFieldItem .kbnFieldButton__button:focus{animation:none !important}.lnsFieldItem .kbnFieldButton__button:focus .kbnFieldButton__name>span{background-color:#e6f0f8;animation:350ms cubic-bezier(0.694, 0.0482, 0.335, 1) 1 normal forwards focusRingAnimate !important}.lnsFieldItem .kbnFieldButton__button:focus .kbnFieldButton__name>span{text-decoration:underline}.lnsFieldItem .lnsFieldItem__infoIcon{visibility:hidden;opacity:0}.lnsFieldItem:hover:not([class*=isActive]){cursor:grab}.lnsFieldItem:hover:not([class*=isActive]) .lnsFieldItem__infoIcon{visibility:visible;opacity:1;transition:opacity 150ms ease-in-out 1s}.kbnFieldButton.lnsDragDrop_ghost .lnsFieldItem__infoIcon{visibility:hidden;opacity:0}.kbnFieldButton__name{transition:background-color 150ms ease-in-out}.lnsFieldItem--missing{background:rgba(152,162,179,.1);color:#69707d}.lnsFieldItem__topValue{margin-bottom:8px}.lnsFieldItem__topValue:last-of-type{margin-bottom:0}.lnsFieldItem__topValueProgress{background-color:#f5f7fa}.lnsFieldItem__topValueProgress::-webkit-progress-bar{background-color:#f5f7fa}.lnsFieldItem__fieldPanel{min-width:260px;max-width:300px}.lnsFieldItem__fieldPanelTitle{text-transform:none}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(407);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsFieldItem{width:100%}.lnsFieldItem.kbnFieldButton:focus-within,.lnsFieldItem.kbnFieldButton-isActive{outline:none}.lnsFieldItem.kbnFieldButton:focus-within:focus-visible,.lnsFieldItem.kbnFieldButton-isActive:focus-visible{outline-style:none}.lnsFieldItem .kbnFieldButton__button:focus{outline:none}.lnsFieldItem .kbnFieldButton__button:focus:focus-visible{outline-style:none}.lnsFieldItem .kbnFieldButton__button:focus .kbnFieldButton__name>span{background-color:rgba(54,162,239,.2);outline:2px solid currentColor}.lnsFieldItem .kbnFieldButton__button:focus:focus-visible .kbnFieldButton__name>span{outline-style:auto}.lnsFieldItem .kbnFieldButton__button:focus:not(:focus-visible) .kbnFieldButton__name>span{outline:none}.lnsFieldItem .kbnFieldButton__button:focus .kbnFieldButton__name>span{text-decoration:underline}.lnsFieldItem .lnsFieldItem__infoIcon{visibility:hidden;opacity:0}.lnsFieldItem:hover:not([class*=isActive]){cursor:grab}.lnsFieldItem:hover:not([class*=isActive]) .lnsFieldItem__infoIcon{visibility:visible;opacity:1;transition:opacity 150ms ease-in-out 1s}.kbnFieldButton.lnsDragDrop_ghost .lnsFieldItem__infoIcon{visibility:hidden;opacity:0}.kbnFieldButton__name{transition:background-color 150ms ease-in-out}.lnsFieldItem--missing{background:#1d1e24;color:#98a2b3}.lnsFieldItem__topValue{margin-bottom:8px}.lnsFieldItem__topValue:last-of-type{margin-bottom:0}.lnsFieldItem__topValueProgress{background-color:#25262e}.lnsFieldItem__topValueProgress::-webkit-progress-bar{background-color:#25262e}.lnsFieldItem__fieldPanel{min-width:260px;max-width:300px}.lnsFieldItem__fieldPanelTitle{text-transform:none}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(409);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsFieldItem{width:100%}.lnsFieldItem.kbnFieldButton:focus-within,.lnsFieldItem.kbnFieldButton-isActive{outline:none}.lnsFieldItem.kbnFieldButton:focus-within:focus-visible,.lnsFieldItem.kbnFieldButton-isActive:focus-visible{outline-style:none}.lnsFieldItem .kbnFieldButton__button:focus{outline:none}.lnsFieldItem .kbnFieldButton__button:focus:focus-visible{outline-style:none}.lnsFieldItem .kbnFieldButton__button:focus .kbnFieldButton__name>span{background-color:rgba(0,119,204,.1);outline:2px solid currentColor}.lnsFieldItem .kbnFieldButton__button:focus:focus-visible .kbnFieldButton__name>span{outline-style:auto}.lnsFieldItem .kbnFieldButton__button:focus:not(:focus-visible) .kbnFieldButton__name>span{outline:none}.lnsFieldItem .kbnFieldButton__button:focus .kbnFieldButton__name>span{text-decoration:underline}.lnsFieldItem .lnsFieldItem__infoIcon{visibility:hidden;opacity:0}.lnsFieldItem:hover:not([class*=isActive]){cursor:grab}.lnsFieldItem:hover:not([class*=isActive]) .lnsFieldItem__infoIcon{visibility:visible;opacity:1;transition:opacity 150ms ease-in-out 1s}.kbnFieldButton.lnsDragDrop_ghost .lnsFieldItem__infoIcon{visibility:hidden;opacity:0}.kbnFieldButton__name{transition:background-color 150ms ease-in-out}.lnsFieldItem--missing{background:rgba(152,162,179,.1);color:#69707d}.lnsFieldItem__topValue{margin-bottom:8px}.lnsFieldItem__topValue:last-of-type{margin-bottom:0}.lnsFieldItem__topValueProgress{background-color:#f5f7fa}.lnsFieldItem__topValueProgress::-webkit-progress-bar{background-color:#f5f7fa}.lnsFieldItem__fieldPanel{min-width:260px;max-width:300px}.lnsFieldItem__fieldPanelTitle{text-transform:none}",""]),e.exports=t},function(e,t,n){e.exports=n(15)(114)},function(e,t,n){switch(window.__kbnThemeTag__){case"v7dark":return n(412);case"v7light":return n(414);case"v8dark":return n(416);case"v8light":return n(418)}},function(e,t,n){var a=n(66),i=n(413);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsVisualizeGeoFieldWorkspacePanel__dragDrop{padding:40px 64px;border:1px solid #343741;border-radius:4px}.lnsVisualizeGeoFieldWorkspacePanel__dragDrop.lnsDragDrop-isDropTarget{border:1px dashed #343741;background-color:rgba(84,179,153,.1)}.lnsVisualizeGeoFieldWorkspacePanel__dragDrop.lnsDragDrop-isActiveDropTarget{background-color:rgba(84,179,153,.25);border:1px dashed #54b399}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(415);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsVisualizeGeoFieldWorkspacePanel__dragDrop{padding:40px 64px;border:1px solid #d3dae6;border-radius:4px}.lnsVisualizeGeoFieldWorkspacePanel__dragDrop.lnsDragDrop-isDropTarget{border:1px dashed #d3dae6;background-color:rgba(84,179,153,.1)}.lnsVisualizeGeoFieldWorkspacePanel__dragDrop.lnsDragDrop-isActiveDropTarget{background-color:rgba(84,179,153,.25);border:1px dashed #54b399}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(417);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsVisualizeGeoFieldWorkspacePanel__dragDrop{padding:40px 64px;border:1px solid #343741;border-radius:6px}.lnsVisualizeGeoFieldWorkspacePanel__dragDrop.lnsDragDrop-isDropTarget{border:1px dashed #343741;background-color:rgba(84,179,153,.1)}.lnsVisualizeGeoFieldWorkspacePanel__dragDrop.lnsDragDrop-isActiveDropTarget{background-color:rgba(84,179,153,.25);border:1px dashed #54b399}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(419);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsVisualizeGeoFieldWorkspacePanel__dragDrop{padding:40px 64px;border:1px solid #d3dae6;border-radius:6px}.lnsVisualizeGeoFieldWorkspacePanel__dragDrop.lnsDragDrop-isDropTarget{border:1px dashed #d3dae6;background-color:rgba(84,179,153,.1)}.lnsVisualizeGeoFieldWorkspacePanel__dragDrop.lnsDragDrop-isActiveDropTarget{background-color:rgba(84,179,153,.25);border:1px dashed #54b399}",""]),e.exports=t},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var a,i,r;if(Array.isArray(t)){if((a=t.length)!=n.length)return!1;for(i=a;0!=i--;)if(!e(t[i],n[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((a=(r=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(i=a;0!=i--;)if(!Object.prototype.hasOwnProperty.call(n,r[i]))return!1;for(i=a;0!=i--;){var s=r[i];if(!e(t[s],n[s]))return!1}return!0}return t!=t&&n!=n}},function(e,t,n){switch(window.__kbnThemeTag__){case"v7dark":return n(520);case"v7light":return n(522);case"v8dark":return n(524);case"v8light":return n(526)}},function(e,t,n){var a=n(66),i=n(521);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsAppWrapper{display:flex;flex-direction:column;flex-grow:1}.lnsApp{flex:1 1 auto;display:flex;flex-direction:column;height:100%;overflow:hidden}.lnsApp>.kbnTopNavMenu__wrapper{border-bottom:1px solid #343741}.lnsApp__frame{position:relative;display:flex;flex-direction:column;flex-grow:1}.lensChartIcon__subdued{fill:#7a7f89}.lnsLayerChartSwitch__item-isSelected .lensChartIcon__subdued{fill:currentColor}.lensChartIcon__accent{fill:#54b399}.lnsLayerChartSwitch__item-isSelected .lensChartIcon__accent{fill:#2a574a}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(523);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsAppWrapper{display:flex;flex-direction:column;flex-grow:1}.lnsApp{flex:1 1 auto;display:flex;flex-direction:column;height:100%;overflow:hidden}.lnsApp>.kbnTopNavMenu__wrapper{border-bottom:1px solid #d3dae6}.lnsApp__frame{position:relative;display:flex;flex-direction:column;flex-grow:1}.lensChartIcon__subdued{fill:#6a717d}.lnsLayerChartSwitch__item-isSelected .lensChartIcon__subdued{fill:currentColor}.lensChartIcon__accent{fill:#54b399}.lnsLayerChartSwitch__item-isSelected .lensChartIcon__accent{fill:#9ed4c5}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(525);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsAppWrapper{display:flex;flex-direction:column;flex-grow:1}.lnsApp{flex:1 1 auto;display:flex;flex-direction:column;height:100%;overflow:hidden}.lnsApp>.kbnTopNavMenu__wrapper{border-bottom:1px solid #343741}.lnsApp__frame{position:relative;display:flex;flex-direction:column;flex-grow:1}.lensChartIcon__subdued{fill:#7a7f89}.lnsLayerChartSwitch__item-isSelected .lensChartIcon__subdued{fill:currentColor}.lensChartIcon__accent{fill:#54b399}.lnsLayerChartSwitch__item-isSelected .lensChartIcon__accent{fill:#2a574a}",""]),e.exports=t},function(e,t,n){var a=n(66),i=n(527);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};a(i,r);e.exports=i.locals||{}},function(e,t,n){(t=n(67)(!1)).push([e.i,".lnsAppWrapper{display:flex;flex-direction:column;flex-grow:1}.lnsApp{flex:1 1 auto;display:flex;flex-direction:column;height:100%;overflow:hidden}.lnsApp>.kbnTopNavMenu__wrapper{border-bottom:1px solid #d3dae6}.lnsApp__frame{position:relative;display:flex;flex-direction:column;flex-grow:1}.lensChartIcon__subdued{fill:#69707d}.lnsLayerChartSwitch__item-isSelected .lensChartIcon__subdued{fill:currentColor}.lensChartIcon__accent{fill:#54b399}.lnsLayerChartSwitch__item-isSelected .lensChartIcon__accent{fill:#9ed4c5}",""]),e.exports=t},,function(e,t,n){"use strict";n.r(t),n.d(t,"getDatatableRenderer",(function(){return H})),n.d(t,"getDatatableVisualization",(function(){return K})),n.d(t,"DatatableVisualization",(function(){return DatatableVisualization})),n.d(t,"getMetricChartRenderer",(function(){return ae})),n.d(t,"MetricChart",(function(){return ie})),n.d(t,"metricVisualization",(function(){return le})),n.d(t,"MetricVisualization",(function(){return MetricVisualization})),n.d(t,"getPieRenderer",(function(){return fe})),n.d(t,"getPieVisualization",(function(){return Ee})),n.d(t,"PieVisualization",(function(){return PieVisualization})),n.d(t,"calculateMinInterval",(function(){return Yt})),n.d(t,"getXyChartRenderer",(function(){return Ut})),n.d(t,"XYChartReportable",(function(){return Qt})),n.d(t,"XYChart",(function(){return Zt})),n.d(t,"visualizationTypes",(function(){return Ce.visualizationTypes})),n.d(t,"getXyVisualization",(function(){return On})),n.d(t,"XyVisualization",(function(){return xy_visualization_XyVisualization})),n.d(t,"getHeatmapRenderer",(function(){return Wn})),n.d(t,"isBucketed",(function(){return Jn})),n.d(t,"filterOperationsAxis",(function(){return ea})),n.d(t,"isCellValueSupported",(function(){return ta})),n.d(t,"getHeatmapVisualization",(function(){return aa})),n.d(t,"HeatmapVisualization",(function(){return heatmap_visualization_HeatmapVisualization})),n.d(t,"deleteColumn",(function(){return Vi})),n.d(t,"columnToOperation",(function(){return Nc})),n.d(t,"getSuffixFormatter",(function(){return Js})),n.d(t,"unitSuffixesLong",(function(){return Qs})),n.d(t,"suffixFormatterId",(function(){return Zs})),n.d(t,"getIndexPatternDatasource",(function(){return zc})),n.d(t,"IndexPatternDatasource",(function(){return indexpattern_datasource_IndexPatternDatasource})),n.d(t,"EditorFrame",(function(){return Vc.a})),n.d(t,"initializeDatasources",(function(){return Vc.d})),n.d(t,"getDatasourceLayers",(function(){return Vc.b})),n.d(t,"persistedStateToExpression",(function(){return Vc.e})),n.d(t,"getMissingIndexPattern",(function(){return Vc.c})),n.d(t,"validateDatasourceAndVisualization",(function(){return Vc.f})),n.d(t,"EditorFrameService",(function(){return service_EditorFrameService})),n.d(t,"Embeddable",(function(){return embeddable_Embeddable})),n.d(t,"getLensServices",(function(){return cd})),n.d(t,"mountApp",(function(){return dd})),n.d(t,"getLensAttributeService",(function(){return gd})),n.d(t,"setReportManager",(function(){return at.b})),n.d(t,"stopReportManager",(function(){return at.c})),n.d(t,"trackUiEvent",(function(){return at.e})),n.d(t,"trackSuggestionEvent",(function(){return at.d})),n.d(t,"LensReportManager",(function(){return at.a})),n.d(t,"SaveModalContainer",(function(){return sd.SaveModalContainer})),n.d(t,"runSaveLensVisualization",(function(){return sd.runSaveLensVisualization})),n.d(t,"getLastKnownDocWithoutPinnedFilters",(function(){return sd.getLastKnownDocWithoutPinnedFilters}));var a={};n.r(a),n.d(a,"buildNode",(function(){return gr})),n.d(a,"toElasticsearchQuery",(function(){return fr}));var i={};n.r(i),n.d(i,"wildcardSymbol",(function(){return br})),n.d(i,"buildNode",(function(){return vr})),n.d(i,"test",(function(){return yr})),n.d(i,"toElasticsearchQuery",(function(){return jr})),n.d(i,"toQueryStringQuery",(function(){return _r})),n.d(i,"hasLeadingWildcard",(function(){return Or}));var r={};n.r(r),n.d(r,"buildNodeParams",(function(){return Cr})),n.d(r,"toElasticsearchQuery",(function(){return Mr}));var s={};n.r(s),n.d(s,"buildNodeParams",(function(){return Pr})),n.d(s,"toElasticsearchQuery",(function(){return Sr}));var l={};n.r(l),n.d(l,"buildNodeParams",(function(){return Ar})),n.d(l,"toElasticsearchQuery",(function(){return Lr}));var o={};n.r(o),n.d(o,"buildNodeParams",(function(){return Dr})),n.d(o,"toElasticsearchQuery",(function(){return Nr}));var u={};n.r(u),n.d(u,"buildNodeParams",(function(){return Rr})),n.d(u,"toElasticsearchQuery",(function(){return Vr}));var c={};n.r(c),n.d(c,"buildNodeParams",(function(){return Hr})),n.d(c,"toElasticsearchQuery",(function(){return Gr}));var d={};n.r(d),n.d(d,"buildNodeParams",(function(){return qr})),n.d(d,"toElasticsearchQuery",(function(){return Wr}));var p={};n.r(p),n.d(p,"buildNodeParams",(function(){return $r})),n.d(p,"toElasticsearchQuery",(function(){return Yr}));var m={};n.r(m),n.d(m,"buildNodeParams",(function(){return Kr})),n.d(m,"toElasticsearchQuery",(function(){return Ur}));var g={};n.r(g),n.d(g,"buildNode",(function(){return Qr})),n.d(g,"buildNodeWithArgumentNodes",(function(){return Zr})),n.d(g,"toElasticsearchQuery",(function(){return Jr}));var f={};n.r(f),n.d(f,"buildNode",(function(){return es})),n.d(f,"toElasticsearchQuery",(function(){return ts}));var b=n(14),x=n.n(b),h=n(6),v=n.n(h),y=n(42),j=n.n(y),_=n(0),O=n(40),k=(n(142),n(182)),I=n.n(k),F=n(7),w=(n(151),n(44)),T=n.n(w),E=n(4);function C({isReady:e=!0,reportTitle:t,reportDescription:n,children:a,className:i,...r}){const s=Object(h.useRef)(0);s.current++;const l={};return t&&(l["data-title"]=t),n&&(l["data-description"]=n),Object(E.jsx)("div",x()({"data-shared-item":!0,"data-render-complete":e,"data-rendering-count":s.current,"data-test-subj":"lnsVisualizationContainer",className:T()(i,"lnsVisualizationContainer")},l,r),a)}var M=n(68);const P=({title:e,titleId:t,...n})=>Object(E.jsx)("svg",x()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(E.jsx)("title",{id:t},e):null,Object(E.jsx)("path",{d:"M11 18a1 1 0 011 1v2a1 1 0 01-1 1H1a1 1 0 01-1-1v-2a1 1 0 011-1h10zm0-6a1 1 0 011 1v2a1 1 0 01-1 1H1a1 1 0 01-1-1v-2a1 1 0 011-1h10zm0-6a1 1 0 011 1v2a1 1 0 01-1 1H1a1 1 0 01-1-1V7a1 1 0 011-1h10zm18-6a1 1 0 011 1v2a1 1 0 01-1 1H1a1 1 0 01-1-1V1a1 1 0 011-1h28z",className:"lensChartIcon__subdued"}),Object(E.jsx)("path",{d:"M20 18a1 1 0 011 1v2a1 1 0 01-.883.993L20 22h-5a1 1 0 01-1-1v-2a1 1 0 011-1h5zm9 0a1 1 0 011 1v2a1 1 0 01-1 1h-5a1 1 0 01-1-1v-2a1 1 0 011-1h5zm-9-6a1 1 0 011 1v2a1 1 0 01-.883.993L20 16h-5a1 1 0 01-1-1v-2a1 1 0 011-1h5zm9 0a1 1 0 011 1v2a1 1 0 01-1 1h-5a1 1 0 01-1-1v-2a1 1 0 011-1h5zm-9-6a1 1 0 011 1v2a1 1 0 01-.883.993L20 10h-5a1 1 0 01-1-1V7a1 1 0 011-1h5zm9 0a1 1 0 011 1v2a1 1 0 01-1 1h-5a1 1 0 01-1-1V7a1 1 0 011-1h5z",className:"lensChartIcon__accent"}));n(32),n(31),n(29),n(28),n(33),n(26),n(25);var S=n(87),A=n(78),L=n(83),D=(n(11),n(12),n(27),n(34),n(30),n(8),n(24)),N=(n(18),n(20),n(21),n(22),n(23),n(19),n(80));var z=n(77);const B=v.a.createContext({}),R={border:"horizontal",header:"underline"},V=e=>{var t;const[n]=Object.values(e.data.tables),[a,i]=Object(h.useState)({columns:e.args.columns,sortingColumnId:e.args.sortingColumnId,sortingDirection:e.args.sortingDirection}),[r,s]=Object(h.useState)(n);I()((()=>{i({columns:e.args.columns,sortingColumnId:e.args.sortingColumnId,sortingDirection:e.args.sortingDirection})}),[e.args.columns,e.args.sortingColumnId,e.args.sortingDirection]),I()((()=>{s(n)}),[n]);const l=Object(h.useRef)(r);l.current=r;const o=Object(h.useRef)(e.untransposedData);o.current=e.untransposedData;const u=null===(t=e.rowHasRowClickTriggerActions)||void 0===t?void 0:t.some((e=>e)),{getType:c,dispatchEvent:d,renderMode:p,formatFactory:m}=e,g=Object(h.useMemo)((()=>r.columns.reduce(((e,t)=>{var n;return{...e,[t.id]:m(null===(n=t.meta)||void 0===n?void 0:n.params)}}),{})),[r,m]),f=Object(h.useCallback)((e=>{d({name:"filter",data:e})}),[d]),b=Object(h.useCallback)((e=>{"edit"===p&&d({name:"edit",data:e})}),[d,p]),x=Object(h.useCallback)((e=>{d({name:"tableRowContextMenuClick",data:e})}),[d]),v=Object(h.useMemo)((()=>((e,t)=>(n,a,i,r,s=!1)=>{var l,o;const u=e.current.columns[i],c="date"===(null===(l=u.meta)||void 0===l?void 0:l.type),d=s&&c||null==u||null===(o=u.meta)||void 0===o?void 0:o.field,p={negate:s,data:[{row:r,column:i,value:a,table:e.current}],timeFieldName:d};t(p)})(l,f)),[l,f]),y=Object(h.useMemo)((()=>((e,t)=>(n,a=!1)=>{var i,r;if(!t.current)return;const s=Object.values(t.current.tables)[0],l=null===(i=n.find((({originalBucketColumn:e})=>"date"===e.meta.type)))||void 0===i?void 0:i.originalBucketColumn,o=Boolean(l),u=a&&o||null==l||null===(r=l.meta)||void 0===r?void 0:r.field,c={negate:a,data:n.map((({originalBucketColumn:e,value:t})=>{const n=s.columns.findIndex((t=>t.id===e.id));return{row:s.rows.findIndex((n=>n[e.id]===t)),column:n,value:t,table:s}})),timeFieldName:u};e(c)})(f,o)),[f,o]),j=Object(h.useMemo)((()=>a.columns.filter(((e,t)=>{var n,a,i;const r=l.current.columns[t];return(null==r||null===(n=r.meta)||void 0===n||null===(a=n.sourceParams)||void 0===a?void 0:a.type)&&"buckets"===(null===(i=c(r.meta.sourceParams.type))||void 0===i?void 0:i.type)})).map((e=>e.columnId))),[l,a,c]),O=0===r.rows.length||j.length&&n.rows.every((e=>j.every((t=>null==e[t])))),k=Object(h.useMemo)((()=>a.columns.filter((e=>!!e.columnId&&!e.hidden)).map((e=>e.columnId))),[a]),{sortingColumnId:w,sortingDirection:T}=e.args,L="edit"!==p,D=Object(h.useMemo)((()=>((e,t,n)=>a=>{const i=Object(A.a)(a.columnId);return t({...e,columns:e.columns.map((e=>e.columnId===a.columnId||e.originalColumnId===i?{...e,width:a.width}:e))}),n({action:"resize",columnId:i,width:a.width})})(a,i,b)),[b,i,a]),V=Object(h.useMemo)((()=>((e,t,n)=>a=>{const i=Object(A.a)(a.columnId);return t({...e,columns:e.columns.map((e=>e.columnId===a.columnId||e.originalColumnId===i?{...e,hidden:!0}:e))}),n({action:"toggle",columnId:i})})(a,i,b)),[b,i,a]),H=Object(h.useMemo)((()=>{const e={};for(const t of r.columns)e[t.id]="number"===t.meta.type;return e}),[r]),G=Object(h.useMemo)((()=>{const e={};return a.columns.forEach((t=>{t.alignment?e[t.columnId]=t.alignment:e[t.columnId]=H[t.columnId]?"right":"left"})),e}),[a,H]),q=Object(h.useMemo)((()=>Object(M.n)(a.columns.filter((({columnId:e})=>H[e])).map((({columnId:e})=>e)),n,A.a)),[n,H,a]),W=Object(h.useMemo)((()=>((e,t,n,a,i,r,s,l,o,u,c)=>{const d=t.columns.reduce(((e,{id:t,name:n,meta:a},i)=>(e[t]={name:n,index:i,meta:a},e)),{}),p=new Set(e),m=({rowIndex:e,columnId:n})=>{var a;const i=t.rows[e][n],r=null==d?void 0:d[n];return{rowValue:i,contentsIsDefined:null!=i,cellContent:l(null==r||null===(a=r.meta)||void 0===a?void 0:a.params).convert(i)}};return s.map((e=>{const t=p.has(e),{name:l,index:g}=d[e],f=t?[({rowIndex:t,columnId:a,Component:i,closePopover:r})=>{const{rowValue:s,contentsIsDefined:l,cellContent:o}=m({rowIndex:t,columnId:a}),u=_.i18n.translate("xpack.lens.table.tableCellFilter.filterForValueText",{defaultMessage:"Filter for value"}),c=_.i18n.translate("xpack.lens.table.tableCellFilter.filterForValueAriaLabel",{defaultMessage:"Filter for value: {cellContent}",values:{cellContent:o}});return l&&Object(E.jsx)(i,{"aria-label":c,"data-test-subj":"lensDatatableFilterFor",onClick:()=>{n(e,s,g,t),r()},iconType:"plusInCircle"},u)},({rowIndex:t,columnId:a,Component:i,closePopover:r})=>{const{rowValue:s,contentsIsDefined:l,cellContent:o}=m({rowIndex:t,columnId:a}),u=_.i18n.translate("xpack.lens.table.tableCellFilter.filterOutValueText",{defaultMessage:"Filter out value"}),c=_.i18n.translate("xpack.lens.table.tableCellFilter.filterOutValueAriaLabel",{defaultMessage:"Filter out value: {cellContent}",values:{cellContent:o}});return l&&Object(E.jsx)(i,{"data-test-subj":"lensDatatableFilterOut","aria-label":c,onClick:()=>{n(e,s,g,t,!0),r()},iconType:"minusInCircle"},u)}]:void 0,b=r.columns.find((({columnId:t})=>t===e)),x=Boolean(null==b?void 0:b.originalColumnId),h=null==b?void 0:b.width,v=null==b?void 0:b.hidden,y=null==b?void 0:b.originalColumnId,j=[];if(j.push({color:"text",size:"xs",onClick:()=>o({columnId:y||e,width:void 0}),iconType:"empty",label:_.i18n.translate("xpack.lens.table.resize.reset",{defaultMessage:"Reset width"}),"data-test-subj":"lensDatatableResetWidth",isDisabled:null==h}),x||j.push({color:"text",size:"xs",onClick:()=>u({columnId:y||e}),iconType:"eyeClosed",label:_.i18n.translate("xpack.lens.table.hide.hideLabel",{defaultMessage:"Hide"}),"data-test-subj":"lensDatatableHide",isDisabled:!v&&s.length<=1}),!i&&x&&null!=b&&b.bucketValues){const e=null==b?void 0:b.bucketValues;j.push({color:"text",size:"xs",onClick:()=>a(e,!1),iconType:"plusInCircle",label:_.i18n.translate("xpack.lens.table.columnFilter.filterForValueText",{defaultMessage:"Filter for column"}),"data-test-subj":"lensDatatableHide"}),j.push({color:"text",size:"xs",onClick:()=>a(e,!0),iconType:"minusInCircle",label:_.i18n.translate("xpack.lens.table.columnFilter.filterOutValueText",{defaultMessage:"Filter out column"}),"data-test-subj":"lensDatatableHide"})}const O=`lnsTableCell--${c&&c[e]}`,k={id:e,cellActions:f,display:Object(E.jsx)("div",{className:O},l),displayAsText:l,actions:{showHide:!1,showMoveLeft:!1,showMoveRight:!1,showSortAsc:!i&&{label:_.i18n.translate("xpack.lens.table.sort.ascLabel",{defaultMessage:"Sort ascending"})},showSortDesc:!i&&{label:_.i18n.translate("xpack.lens.table.sort.descLabel",{defaultMessage:"Sort descending"})},additional:j}};return h&&(k.initialWidth=h),k}))})(j,r,v,y,L,a,k,m,D,V,G)),[j,r,v,y,L,a,k,m,D,V,G]),$=Object(h.useMemo)((()=>u&&x?[{headerCellRender:()=>null,width:40,id:"trailingControlColumn",rowCellRender:function({rowIndex:e}){const{rowHasRowClickTriggerActions:t}=Object(h.useContext)(B);return Object(E.jsx)(F.EuiButtonIcon,{"aria-label":_.i18n.translate("xpack.lens.table.actionsLabel",{defaultMessage:"Show actions"}),iconType:t&&!t[e]?"empty":"boxesVertical",color:"text",onClick:()=>{x({rowIndex:e,table:l.current,columns:a.columns.map((e=>e.columnId))})}})}}]:[]),[l,x,a,u]),Y=Object(h.useMemo)((()=>((e,t,n,a)=>{const i=a.get("theme:darkMode");return({rowIndex:a,columnId:r,setCellProps:s})=>{var l;const{table:o,alignments:u,minMaxByColumnId:c,getColorForValue:d}=Object(h.useContext)(n),p=null==o?void 0:o.rows[a][r],m=null===(l=e[r])||void 0===l?void 0:l.convert(p,"html"),g=`lnsTableCell--${u&&u[r]}`,{colorMode:f,palette:b}=t.columns.find((({columnId:e})=>e===r))||{};return Object(h.useEffect)((()=>{const e=Object(A.a)(r);if(null!=c&&c[e]&&"none"!==f&&null!=b&&b.params&&d){const t=d(Object(N.f)(p),b.params,c[e]);if(t){const e={["cell"===f?"backgroundColor":"color"]:t};"cell"===f&&t&&(e.color=Object(N.d)(t,i)),s({style:e})}}return()=>{null!=c&&c[e]&&s({style:{backgroundColor:void 0,color:void 0}})}}),[p,r,s,f,b,c,d]),Object(E.jsx)("div",{dangerouslySetInnerHTML:{__html:m},"data-test-subj":"lnsTableCellContent",className:`lnsTableCell ${g}`})}})(g,a,B,e.uiSettings)),[g,a,e.uiSettings]),K=Object(h.useMemo)((()=>({visibleColumns:k,setVisibleColumns:()=>{}})),[k]),U=Object(h.useMemo)((()=>((e,t,n)=>({columns:e&&"none"!==t?[{id:e,direction:t}]:[],onSort:t=>{const a=t.length<=1?t[0]:t[1],i=e!==((null==a?void 0:a.id)||""),r=a?a.direction:"none";return n({action:"sort",columnId:"none"!==r||i?null==a?void 0:a.id:void 0,direction:r})}}))(w,T,b)),[b,w,T]),X=Object(h.useMemo)((()=>{const e=a.columns.filter((e=>!!e.columnId&&!e.hidden)).map((e=>({columnId:e.columnId,summaryRowValue:e.summaryRowValue,...Object(S.c)(e.columnId,e,n)}))).filter((({summaryRow:e})=>"none"!==e));if(e.length){const t=Object.fromEntries(e.map((({summaryRowValue:e,summaryLabel:t,columnId:n})=>[n,""===t?`${e}`:`${t}: ${e}`])));return({columnId:e})=>{var n,a;const i=`lnsTableCell--${G&&G[e]}`,r=(null===(n=W.find((({id:t})=>t===e)))||void 0===n||null===(a=n.displayAsText)||void 0===a?void 0:a.replace(/ /g,"-"))||e;return null!=t[e]?Object(E.jsx)("div",{className:`lnsTableCell ${i}`,"data-test-subj":`lnsDataTable-footer-${r}`},t[e]):null}}}),[a.columns,G,n,W]);if(O)return Object(E.jsx)(C,{className:"lnsDataTableContainer",reportTitle:e.args.title,reportDescription:e.args.description},Object(E.jsx)(M.c,{icon:P}));const Q=e.args.title||_.i18n.translate("xpack.lens.table.defaultAriaLabel",{defaultMessage:"Data table visualization"});return Object(E.jsx)(C,{className:"lnsDataTableContainer",reportTitle:e.args.title,reportDescription:e.args.description},Object(E.jsx)(B.Provider,{value:{table:r,rowHasRowClickTriggerActions:e.rowHasRowClickTriggerActions,alignments:G,minMaxByColumnId:q,getColorForValue:e.paletteService.get(z.a).getColorForValue}},Object(E.jsx)(F.EuiDataGrid,{"aria-label":Q,"data-test-subj":"lnsDataTable",columns:W,columnVisibility:K,trailingControlColumns:$,rowCount:r.rows.length,renderCellValue:Y,gridStyle:R,sorting:U,onColumnResize:D,toolbarVisibility:!1,renderFooterCellValue:X})))},H=e=>({name:"lens_datatable_renderer",displayName:_.i18n.translate("xpack.lens.datatable.visualizationName",{defaultMessage:"Datatable"}),help:"",validate:()=>{},reuseDomNode:!0,render:async(t,n,a)=>{const i=await e.getType,{hasCompatibleActions:r}=a;let s=[];if(r){const e=Object.values(n.data.tables)[0];e&&(s=await Promise.all(e.rows.map((async(t,a)=>{try{return await r({name:"tableRowContextMenuClick",data:{rowIndex:a,table:e,columns:n.args.columns.map((e=>e.columnId))}})}catch{return!1}}))))}j.a.render(Object(E.jsx)(O.I18nProvider,null,Object(E.jsx)(V,x()({},n,{formatFactory:e.formatFactory,dispatchEvent:a.event,renderMode:a.getRenderMode(),paletteService:e.paletteService,getType:i,rowHasRowClickTriggerActions:s,uiSettings:e.uiSettings}))),t,(()=>{a.done()})),a.onDestroy((()=>j.a.unmountComponentAtNode(t)))}});n(184);const G=Object(F.htmlIdGenerator)()();function q(e,t,n){return e.columns.map((e=>e.columnId===t?{...e,...n}:e))}function W(e){var t,n,a;const{state:i,setState:r,frame:s,accessor:l}=e,o=i.columns.find((({columnId:e})=>l===e)),[u,c]=Object(h.useState)(!1),d=Object(h.useCallback)((e=>{r({...i,columns:q(i,l,{summaryLabel:e})})}),[l,r,i]),{inputValue:p,handleInputChange:m}=Object(M.q)({onChange:d,value:null==o?void 0:o.summaryLabel},{allowFalsyValue:!0});if(!o)return null;if(o.isTransposed)return null;const g=null===(t=s.activeData)||void 0===t?void 0:t[i.layerId],f=Object(L.a)(g,l),b=(null==o?void 0:o.alignment)||(f?"right":"left"),x=(null==o?void 0:o.colorMode)||"none",y="none"!==x,{summaryRow:j,summaryLabel:O}=Object(S.c)(l,o,g),k=s.datasourceLayers[i.layerId],I=Boolean(f&&!(null!=k&&null!==(n=k.getOperationForColumnId(l))&&void 0!==n&&n.isBucketed)),w=i.columns.filter((e=>!e.hidden)).length,T=i.columns.some((({isTransposed:e})=>e))?(null==g?void 0:g.columns.filter((({id:e})=>Object(A.a)(e)===l)).map((({id:e})=>e)))||[]:[l],C=Object(M.n)(T,g,A.a)[l],P=(null==o?void 0:o.palette)||{type:"palette",name:M.m.name},D=Object(M.l)(e.paletteService,P,C);return Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:_.i18n.translate("xpack.lens.table.alignment.label",{defaultMessage:"Text alignment"})},Object(E.jsx)(F.EuiButtonGroup,{isFullWidth:!0,legend:_.i18n.translate("xpack.lens.table.alignment.label",{defaultMessage:"Text alignment"}),"data-test-subj":"lnsDatatable_alignment_groups",name:"alignment",buttonSize:"compressed",options:[{id:`${G}left`,label:_.i18n.translate("xpack.lens.table.alignment.left",{defaultMessage:"Left"}),"data-test-subj":"lnsDatatable_alignment_groups_left"},{id:`${G}center`,label:_.i18n.translate("xpack.lens.table.alignment.center",{defaultMessage:"Center"}),"data-test-subj":"lnsDatatable_alignment_groups_center"},{id:`${G}right`,label:_.i18n.translate("xpack.lens.table.alignment.right",{defaultMessage:"Right"}),"data-test-subj":"lnsDatatable_alignment_groups_right"}],idSelected:`${G}${b}`,onChange:e=>{const t=e.replace(G,"");r({...i,columns:q(i,l,{alignment:t})})}})),!o.isTransposed&&Object(E.jsx)(F.EuiFormRow,{label:_.i18n.translate("xpack.lens.table.columnVisibilityLabel",{defaultMessage:"Hide column"}),display:"columnCompressedSwitch"},Object(E.jsx)(F.EuiSwitch,{compressed:!0,label:_.i18n.translate("xpack.lens.table.columnVisibilityLabel",{defaultMessage:"Hide column"}),showLabel:!1,"data-test-subj":"lns-table-column-hidden",checked:Boolean(null==o?void 0:o.hidden),disabled:!o.hidden&&w<=1,onChange:()=>{const e={...i,columns:i.columns.map((e=>e.columnId===l?{...e,hidden:!o.hidden}:e))};r(e)}})),f&&Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiFormRow,{fullWidth:!0,label:_.i18n.translate("xpack.lens.table.summaryRow.label",{defaultMessage:"Summary Row"}),display:"columnCompressed"},Object(E.jsx)(F.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":"lnsDatatable_summaryrow_function",placeholder:_.i18n.translate("xpack.lens.indexPattern.fieldPlaceholder",{defaultMessage:"Field"}),options:Object(S.d)(),selectedOptions:[{label:Object(S.b)(j),value:j}],singleSelection:{asPlainText:!0},onChange:e=>{const t=e[0].value;r({...i,columns:q(i,l,{summaryRow:t})})}})),"none"!==j&&Object(E.jsx)(F.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:_.i18n.translate("xpack.lens.table.summaryRow.customlabel",{defaultMessage:"Summary label"})},Object(E.jsx)(F.EuiFieldText,{compressed:!0,"data-test-subj":"lnsDatatable_summaryrow_label",value:null!=p?p:O,onChange:e=>{m(e.target.value)}}))),I&&Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:_.i18n.translate("xpack.lens.table.dynamicColoring.label",{defaultMessage:"Color by value"})},Object(E.jsx)(F.EuiButtonGroup,{isFullWidth:!0,legend:_.i18n.translate("xpack.lens.table.dynamicColoring.label",{defaultMessage:"Color by value"}),"data-test-subj":"lnsDatatable_dynamicColoring_groups",name:"dynamicColoring",buttonSize:"compressed",options:[{id:`${G}none`,label:_.i18n.translate("xpack.lens.table.dynamicColoring.none",{defaultMessage:"None"}),"data-test-subj":"lnsDatatable_dynamicColoring_groups_none"},{id:`${G}cell`,label:_.i18n.translate("xpack.lens.table.dynamicColoring.cell",{defaultMessage:"Cell"}),"data-test-subj":"lnsDatatable_dynamicColoring_groups_cell"},{id:`${G}text`,label:_.i18n.translate("xpack.lens.table.dynamicColoring.text",{defaultMessage:"Text"}),"data-test-subj":"lnsDatatable_dynamicColoring_groups_text"}],idSelected:`${G}${x}`,onChange:e=>{const t=e.replace(G,""),n={colorMode:t};null!=o&&o.palette||"none"===t||(n.palette={...P,params:{...P.params,stops:D}}),null!=o&&o.palette&&"none"===t&&(n.palette=void 0),r({...i,columns:q(i,l,n)})}})),y&&Object(E.jsx)(F.EuiFormRow,{className:"lnsDynamicColoringRow",display:"columnCompressed",fullWidth:!0,label:_.i18n.translate("xpack.lens.paletteTableGradient.label",{defaultMessage:"Color"})},Object(E.jsx)(F.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1,className:"lnsDynamicColoringClickable"},Object(E.jsx)(F.EuiFlexItem,null,Object(E.jsx)(F.EuiColorPaletteDisplay,{"data-test-subj":"lnsDatatable_dynamicColoring_palette",palette:Object(M.o)(D,null===(a=P.params)||void 0===a?void 0:a.colorStops),type:M.d,onClick:()=>{c(!u)}})),Object(E.jsx)(F.EuiFlexItem,{grow:!1},Object(E.jsx)(F.EuiButtonEmpty,{"data-test-subj":"lnsDatatable_dynamicColoring_trigger",iconType:"controlsHorizontal",onClick:()=>{c(!u)},size:"xs",flush:"both"},_.i18n.translate("xpack.lens.paletteTableGradient.customize",{defaultMessage:"Edit"})),Object(E.jsx)(M.g,{siblingRef:e.panelRef,isOpen:u,handleClose:()=>c(!u)},Object(E.jsx)(M.b,{palettes:e.paletteService,activePalette:P,dataBounds:C,setPalette:e=>{r({...i,columns:q(i,l,{palette:e})})}})))))))}var $=n(69);const Y=_.i18n.translate("xpack.lens.datatable.label",{defaultMessage:"Table"}),K=({paletteService:e})=>({id:"lnsDatatable",visualizationTypes:[{id:"lnsDatatable",icon:P,label:Y,groupLabel:_.i18n.translate("xpack.lens.datatable.groupLabel",{defaultMessage:"Tabular and single value"}),sortPriority:1}],getVisualizationTypeId:()=>"lnsDatatable",getLayerIds:e=>[e.layerId],clearLayer:e=>({...e,columns:[]}),getDescription:()=>({icon:P,label:Y}),switchVisualizationType:(e,t)=>t,initialize:(e,t)=>t||{columns:[],layerId:e(),layerType:$.i.DATA},getSuggestions({table:e,state:t,keptLayerIds:n}){if(n.length>1||n.length&&e.layerId!==n[0]||t&&"unchanged"===e.changeType)return[];const a={};t&&t.columns.forEach((e=>{a[e.columnId]=e}));const i=e.columns.findIndex((e=>{var t;return!!a[e.columnId]&&!(null!==(t=a[e.columnId])&&void 0!==t&&t.isTransposed)})),r=null==t?void 0:t.columns.some((e=>e.isTransposed));return[{title:"unchanged"===e.changeType?_.i18n.translate("xpack.lens.datatable.suggestionLabel",{defaultMessage:"As table"}):_.i18n.translate("xpack.lens.datatable.visualizationOf",{defaultMessage:"Table {operations}",values:{operations:e.label||e.columns.map((e=>e.operation.label)).join(_.i18n.translate("xpack.lens.datatable.conjunctionSign",{defaultMessage:" & ",description:"A character that can be used for conjunction of multiple enumarated items. Make sure to include spaces around it if needed."}))}}),score:Math.min(e.columns.length,10)/10*.4,state:{...t||{},layerId:e.layerId,layerType:$.i.DATA,columns:e.columns.map(((e,t)=>({...a[e.columnId]||{},isTransposed:r&&t<i,columnId:e.columnId})))},previewIcon:P,hide:!0}]},getConfiguration({state:e,frame:t,layerId:n}){const{sortedColumns:a,datasource:i}=U(e,t.datasourceLayers,n)||{},r={};return e.columns.forEach((e=>{r[e.columnId]=e})),a?{groups:[{groupId:"rows",groupLabel:_.i18n.translate("xpack.lens.datatable.breakdownRows",{defaultMessage:"Rows"}),groupTooltip:_.i18n.translate("xpack.lens.datatable.breakdownRows.description",{defaultMessage:"Split table rows by field. This is recommended for high cardinality breakdowns."}),layerId:e.layerId,accessors:a.filter((t=>{var n,a;return(null===(n=i.getOperationForColumnId(t))||void 0===n?void 0:n.isBucketed)&&!(null!==(a=e.columns.find((e=>e.columnId===t)))&&void 0!==a&&a.isTransposed)})).map((e=>({columnId:e,triggerIcon:r[e].hidden?"invisible":void 0}))),supportsMoreColumns:!0,filterOperations:e=>e.isBucketed,dataTestSubj:"lnsDatatable_rows",enableDimensionEditor:!0,hideGrouping:!0,nestingOrder:1},{groupId:"columns",groupLabel:_.i18n.translate("xpack.lens.datatable.breakdownColumns",{defaultMessage:"Columns"}),groupTooltip:_.i18n.translate("xpack.lens.datatable.breakdownColumns.description",{defaultMessage:"Split metric columns by field. It's recommended to keep the number of columns low to avoid horizontal scrolling."}),layerId:e.layerId,accessors:a.filter((t=>{var n,a;return(null===(n=i.getOperationForColumnId(t))||void 0===n?void 0:n.isBucketed)&&(null===(a=e.columns.find((e=>e.columnId===t)))||void 0===a?void 0:a.isTransposed)})).map((e=>({columnId:e}))),supportsMoreColumns:!0,filterOperations:e=>e.isBucketed,dataTestSubj:"lnsDatatable_columns",enableDimensionEditor:!0,hideGrouping:!0,nestingOrder:0},{groupId:"metrics",groupLabel:_.i18n.translate("xpack.lens.datatable.metrics",{defaultMessage:"Metrics"}),layerId:e.layerId,accessors:a.filter((e=>{var t;return!(null!==(t=i.getOperationForColumnId(e))&&void 0!==t&&t.isBucketed)})).map((e=>{var t,n,a,i,s,l;const o=r[e],u=Boolean("none"!==o.colorMode&&(null===(t=o.palette)||void 0===t||null===(n=t.params)||void 0===n?void 0:n.stops));return{columnId:e,triggerIcon:o.hidden?"invisible":u?"colorBy":void 0,palette:u?Object(M.o)((null===(a=o.palette)||void 0===a||null===(i=a.params)||void 0===i?void 0:i.stops)||[],null===(s=o.palette)||void 0===s||null===(l=s.params)||void 0===l?void 0:l.colorStops):void 0}})),supportsMoreColumns:!0,filterOperations:e=>!e.isBucketed,required:!0,dataTestSubj:"lnsDatatable_metrics",enableDimensionEditor:!0}]}:{groups:[]}},setDimension:({prevState:e,columnId:t,groupId:n,previousColumn:a})=>e.columns.some((e=>e.columnId===t||a&&e.columnId===a))?{...e,columns:e.columns.map((e=>e.columnId===t||e.columnId===a?{...e,columnId:t,isTransposed:"columns"===n}:e))}:{...e,columns:[...e.columns,{columnId:t,isTransposed:"columns"===n}]},removeDimension({prevState:e,columnId:t}){var n;return{...e,columns:e.columns.filter((e=>e.columnId!==t)),sorting:(null===(n=e.sorting)||void 0===n?void 0:n.columnId)===t?void 0:e.sorting}},renderDimensionEditor(t,n){Object(y.render)(Object(E.jsx)(O.I18nProvider,null,Object(E.jsx)(W,x()({},n,{paletteService:e}))),t)},getSupportedLayers:()=>[{type:$.i.DATA,label:_.i18n.translate("xpack.lens.datatable.addLayer",{defaultMessage:"Add visualization layer"})}],getLayerType(e,t){if((null==t?void 0:t.layerId)===e)return t.layerType},toExpression(t,n,{title:a,description:i}={}){var r,s;const{sortedColumns:l,datasource:o}=U(t,n,t.layerId)||{};if(null!=l&&l.length&&0===l.filter((e=>{var t;return!(null!==(t=o.getOperationForColumnId(e))&&void 0!==t&&t.isBucketed)})).length)return null;const u={};t.columns.forEach((e=>{u[e.columnId]=e}));return{type:"expression",chain:[{type:"function",function:"lens_datatable",arguments:{title:[a||""],description:[i||""],columns:l.filter((e=>o.getOperationForColumnId(e))).map((e=>u[e])).map((t=>{var n,a,i,r,s,l,u,c,d,p;const m={...null===(n=t.palette)||void 0===n?void 0:n.params,colors:((null===(a=t.palette)||void 0===a||null===(i=a.params)||void 0===i?void 0:i.stops)||[]).map((({color:e})=>e)),stops:"custom"===(null===(r=t.palette)||void 0===r||null===(s=r.params)||void 0===s?void 0:s.name)?((null===(l=t.palette)||void 0===l||null===(u=l.params)||void 0===u?void 0:u.stops)||[]).map((({stop:e})=>e)):[],reverse:!1},g=null==t.summaryRow||"none"===t.summaryRow;return{type:"expression",chain:[{type:"function",function:"lens_datatable_column",arguments:{columnId:[t.columnId],hidden:void 0===t.hidden?[]:[t.hidden],width:void 0===t.width?[]:[t.width],isTransposed:void 0===t.isTransposed?[]:[t.isTransposed],transposable:[!(null!==(c=o.getOperationForColumnId(t.columnId))&&void 0!==c&&c.isBucketed)],alignment:void 0===t.alignment?[]:[t.alignment],colorMode:[null!==(d=t.colorMode)&&void 0!==d?d:"none"],palette:[e.get(z.a).toExpression(m)],summaryRow:g?[]:[t.summaryRow],summaryLabel:g?[]:[null!==(p=t.summaryLabel)&&void 0!==p?p:Object(S.b)(t.summaryRow)]}}]}})),sortingColumnId:[(null===(r=t.sorting)||void 0===r?void 0:r.columnId)||""],sortingDirection:[(null===(s=t.sorting)||void 0===s?void 0:s.direction)||"none"]}}]}},getErrorMessages(e){},onEditAction(e,t){switch(t.data.action){case"sort":return{...e,sorting:{columnId:t.data.columnId,direction:t.data.direction}};case"toggle":return{...e,columns:e.columns.map((e=>e.columnId===t.data.columnId?{...e,hidden:!e.hidden}:e))};case"resize":const n=t.data.width;return{...e,columns:e.columns.map((e=>e.columnId===t.data.columnId?{...e,width:n}:e))};default:return e}}});function U(e,t,n){const a=t[e.layerId],i=a.getTableSpec().map((({columnId:e})=>e));return{datasource:a,sortedColumns:Array.from(new Set(i.concat(e.columns.map((({columnId:e})=>e)))))}}class DatatableVisualization{setup(e,{expressions:t,formatFactory:a,editorFrame:i,charts:r}){i.registerVisualization((async()=>{const{getDatatableRenderer:i,getDatatableVisualization:s}=await Promise.resolve().then(n.bind(null,529)),l=await r.palettes.getPalettes();return t.registerRenderer((()=>i({formatFactory:a,getType:e.getStartServices().then((([e,{data:t}])=>t.search.aggs.types.get)),paletteService:l,uiSettings:e.uiSettings}))),s({paletteService:l})}))}}n(193);var X=n(2),Q=n.n(X),Z=n(39),J=n.n(Z);class auto_scale_AutoScale extends v.a.Component{constructor(e){super(e),Q()(this,"child",null),Q()(this,"parent",null),Q()(this,"scale",void 0),Q()(this,"setParent",(e=>{e&&this.parent!==e&&(this.parent=e,setTimeout((()=>this.scale())))})),Q()(this,"setChild",(e=>{e&&this.child!==e&&(this.child=e,setTimeout((()=>this.scale())))})),this.scale=Object(Z.throttle)((()=>{const e=function(e,t,n=te){if(!e||!t)return 1;const a=e.clientWidth/t.clientWidth,i=e.clientHeight/t.clientHeight;return Math.max(Math.min(ee,Math.min(a,i)),n)}(this.parent,this.child,this.props.minScale);this.state.scale!==e&&this.setState({scale:e})})),this.state={scale:0}}render(){const{children:e,minScale:t,...n}=this.props,{scale:a}=this.state,i=this.props.style||{};return Object(E.jsx)(F.EuiResizeObserver,{onResize:this.scale},(t=>Object(E.jsx)("div",x()({},n,{ref:e=>{this.setParent(e),t(e)},style:{...i,display:"flex",justifyContent:"center",alignItems:"center",maxWidth:"100%",maxHeight:"100%",overflow:"hidden",lineHeight:1.5}}),Object(E.jsx)("div",{ref:this.setChild,style:{transform:`scale(${a})`}},e))))}}const ee=1,te=.3;const ne=({title:e,titleId:t,...n})=>Object(E.jsx)("svg",x()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(E.jsx)("title",{id:t},e):null,Object(E.jsx)("path",{d:"M25 0a1 1 0 011 1v14a1 1 0 01-1 1H5a1 1 0 01-1-1V1a1 1 0 011-1h20zm-9.878 3c-1.887 0-3.265 1.107-3.26 2.61-.005 1.054.67 1.938 1.672 2.157v.067l-.155.03a2.453 2.453 0 00-1.879 2.394C11.495 11.84 12.997 13 15.122 13c2.105 0 3.612-1.16 3.617-2.742-.005-1.217-.903-2.234-2.035-2.424v-.067l.162-.042c.896-.275 1.507-1.12 1.511-2.116C18.373 4.112 16.994 3 15.122 3zm0 5.542c1.036 0 1.796.665 1.806 1.592-.01.898-.718 1.507-1.806 1.507-1.103 0-1.816-.609-1.806-1.507-.01-.932.755-1.592 1.806-1.592zm0-4.164c.908 0 1.53.561 1.54 1.398-.01.85-.651 1.43-1.54 1.43-.903 0-1.55-.584-1.54-1.43-.01-.837.618-1.398 1.54-1.398z",className:"lensChartIcon__accent"}),Object(E.jsx)("path",{d:"M1 18h28a1 1 0 011 1v2a1 1 0 01-1 1H1a1 1 0 01-1-1v-2a1 1 0 011-1z",className:"lensChartIcon__subdued"})),ae=e=>({name:"lens_metric_chart_renderer",displayName:"Metric chart",help:"Metric chart renderer",validate:()=>{},reuseDomNode:!0,render:(t,n,a)=>{j.a.render(Object(E.jsx)(O.I18nProvider,null,Object(E.jsx)(ie,x()({},n,{formatFactory:e}))),t,(()=>{a.done()})),a.onDestroy((()=>j.a.unmountComponentAtNode(t)))}});function ie({data:e,args:t,formatFactory:n}){var a,i;const{metricTitle:r,title:s,description:l,accessor:o,mode:u}=t,c=Object.values(e.tables)[0],d=()=>Object(E.jsx)(C,{reportTitle:s,reportDescription:l,className:"lnsMetricExpression__container"},Object(E.jsx)(M.c,{icon:ne}));if(!o||!c)return d();const p=c.columns.find((({id:e})=>e===o)),m=c.rows[0];if(!p||!m)return d();if(!(null!=m[o]))return d();const g=p&&null!==(a=p.meta)&&void 0!==a&&a.params?n(null===(i=p.meta)||void 0===i?void 0:i.params).convert(m[o]):Number(Number(m[o]).toFixed(3)).toString();return Object(E.jsx)(C,{reportTitle:s,reportDescription:l,className:"lnsMetricExpression__container"},Object(E.jsx)(auto_scale_AutoScale,{key:g},Object(E.jsx)("div",{"data-test-subj":"lns_metric_value",style:{fontSize:"60pt",fontWeight:600}},g),"full"===u&&Object(E.jsx)("div",{"data-test-subj":"lns_metric_title",style:{fontSize:"24pt"}},r)))}function re(e){const t=e.columns[0];return{title:e.label||t.operation.label,score:.1,previewIcon:ne,state:{layerId:e.layerId,accessor:t.columnId,layerType:$.i.DATA}}}const se=(e,t,n)=>{if(!e.accessor)return null;const[a]=Object.values(t),i=a&&a.getOperationForColumnId(e.accessor);return{type:"expression",chain:[{type:"function",function:"lens_metric_chart",arguments:{title:[(null==n?void 0:n.title)||""],description:[(null==n?void 0:n.description)||""],metricTitle:[i&&i.label||""],accessor:[e.accessor],mode:[(null==n?void 0:n.mode)||"full"]}}]}},le={id:"lnsMetric",visualizationTypes:[{id:"lnsMetric",icon:ne,label:_.i18n.translate("xpack.lens.metric.label",{defaultMessage:"Metric"}),groupLabel:_.i18n.translate("xpack.lens.metric.groupLabel",{defaultMessage:"Tabular and single value"}),sortPriority:1}],getVisualizationTypeId:()=>"lnsMetric",clearLayer:e=>({...e,accessor:void 0}),getLayerIds:e=>[e.layerId],getDescription:()=>({icon:ne,label:_.i18n.translate("xpack.lens.metric.label",{defaultMessage:"Metric"})}),getSuggestions:function({table:e,state:t,keptLayerIds:n}){return e.isMultiRow||n.length>1||n.length&&e.layerId!==n[0]||1!==e.columns.length||"number"!==e.columns[0].operation.dataType||t&&"unchanged"===e.changeType?[]:[re(e)]},initialize:(e,t)=>t||{layerId:e(),accessor:void 0,layerType:$.i.DATA},getConfiguration:e=>({groups:[{groupId:"metric",groupLabel:_.i18n.translate("xpack.lens.metric.label",{defaultMessage:"Metric"}),layerId:e.state.layerId,accessors:e.state.accessor?[{columnId:e.state.accessor}]:[],supportsMoreColumns:!e.state.accessor,filterOperations:e=>!e.isBucketed&&"number"===e.dataType}]}),getSupportedLayers:()=>[{type:$.i.DATA,label:_.i18n.translate("xpack.lens.metric.addLayer",{defaultMessage:"Add visualization layer"})}],getLayerType(e,t){if((null==t?void 0:t.layerId)===e)return t.layerType},toExpression:se,toPreviewExpression:(e,t)=>se(e,t,{mode:"reduced"}),setDimension:({prevState:e,columnId:t})=>({...e,accessor:t}),removeDimension:({prevState:e})=>({...e,accessor:void 0}),getErrorMessages(e){}};class MetricVisualization{setup(e,{expressions:t,formatFactory:a,editorFrame:i}){i.registerVisualization((async()=>{const{metricVisualization:e,getMetricChartRenderer:i}=await Promise.resolve().then(n.bind(null,529));return t.registerRenderer((()=>i(a))),e}))}}var oe=n(1);const ue=({title:e,titleId:t,...n})=>Object(E.jsx)("svg",x()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(E.jsx)("title",{id:t},e):null,Object(E.jsx)("path",{d:"M19.21 21.119a11 11 0 006.595-8.1c.11-.577-.355-1.082-.942-1.082H20.75c-.477 0-.878.342-1.046.788a5.028 5.028 0 11-6.474-6.474c.447-.168.788-.569.788-1.046V1.094c0-.588-.505-1.053-1.082-.943a11 11 0 106.272 20.968h.002z",className:"lensChartIcon__subdued"}),Object(E.jsx)("path",{d:"M22.778 3.176A11 11 0 0017.084.154C16.507.042 16 .507 16 1.095v4.116c0 .475.34.875.784 1.044l.14.055A5.026 5.026 0 0119.7 9.17c.168.445.568.784 1.044.784h4.115c.588 0 1.053-.506.942-1.084a11 11 0 00-3.023-5.694z",className:"lensChartIcon__accent"})),ce=_.i18n.translate("xpack.lens.pie.groupLabel",{defaultMessage:"Proportion"}),de={donut:{icon:ue,label:_.i18n.translate("xpack.lens.pie.donutLabel",{defaultMessage:"Donut"}),groupLabel:ce},pie:{icon:({title:e,titleId:t,...n})=>Object(E.jsx)("svg",x()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(E.jsx)("title",{id:t},e):null,Object(E.jsx)("path",{d:"M17.827 21.189a10.001 10.001 0 005.952-7.148c.124-.578-.343-1.091-.935-1.091H14a1 1 0 01-1-1V3.106c0-.592-.513-1.059-1.092-.935a10 10 0 105.919 19.018z",className:"lensChartIcon__subdued"}),Object(E.jsx)("path",{d:"M22.462 3.538A12.29 12.29 0 0016.094.16C15.512.048 15 .514 15 1.106V10a1 1 0 001 1h8.895c.591 0 1.057-.512.945-1.094a12.288 12.288 0 00-3.378-6.368z",className:"lensChartIcon__accent"})),label:_.i18n.translate("xpack.lens.pie.pielabel",{defaultMessage:"Pie"}),groupLabel:ce},treemap:{icon:({title:e,titleId:t,...n})=>Object(E.jsx)("svg",x()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(E.jsx)("title",{id:t},e):null,Object(E.jsx)("path",{d:"M0 1a1 1 0 011-1h13a1 1 0 011 1v20a1 1 0 01-1 1H1a1 1 0 01-1-1V1z",className:"lensChartIcon__subdued"}),Object(E.jsx)("path",{d:"M17 1a1 1 0 011-1h11a1 1 0 011 1v12a1 1 0 01-1 1H18a1 1 0 01-1-1V1z",className:"lensChartIcon__accent"}),Object(E.jsx)("path",{d:"M29 16H18a1 1 0 00-1 1v4a1 1 0 001 1h11a1 1 0 001-1v-4a1 1 0 00-1-1z",className:"lensChartIcon__subdued"})),label:_.i18n.translate("xpack.lens.pie.treemaplabel",{defaultMessage:"Treemap"}),groupLabel:ce}},pe=2;n(202);const me=Symbol("empty_slice");function ge(e){var t,n,a,i,r,s,l,o,u;const[c]=Object.values(e.data.tables),d={},{chartsThemeService:p,paletteService:m,syncColors:g,onClickValue:f}=e,{shape:b,groups:x,metric:y,numberDisplay:j,categoryDisplay:_,legendDisplay:k,legendPosition:I,nestedLegend:w,percentDecimals:T,legendMaxLines:P,truncateLegend:S,hideLabels:A,palette:L}=e.args,D=p.useChartsTheme(),N=p.useChartsBaseTheme(),z=p.useDarkMode();A||c.columns.forEach((t=>{d[t.id]=e.formatFactory(t.meta.params)}));const B={valueFont:{fontWeight:700}};"hidden"===j&&(B.valueFormatter=()=>"");const R=c.columns.filter((e=>x.includes(e.id))),V=Object(Z.uniq)(c.rows.map((e=>R.map((({id:t})=>e[t])).join(",")))).length,H=R.map(((e,t)=>({groupByRollup:t=>{var n;return null!==(n=t[e.id])&&void 0!==n?n:me},showAccessor:e=>e!==me,nodeLabel:t=>{return A||t===me?"":e.meta.params?null!==(n=d[e.id].convert(t))&&void 0!==n?n:"":String(t);var n},fillLabel:B,shape:{fillColor:e=>{const n=[];let a=e;for(;a.parent&&a.depth>0;)n.unshift({name:String(a.parent.children[a.sortIndex][0]),rankAtDepth:a.sortIndex,totalSeriesAtDepth:a.parent.children.length}),a=a.parent;if("treemap"===b){if(t<R.length-1)return z?"rgba(0,0,0,0)":"rgba(255,255,255,0)";n.length>1&&n.pop()}return m.get(L.name).getCategoricalColor(n,{behindText:"hide"!==_,maxDepth:R.length,totalSeries:V,syncColors:g},L.params)||"rgba(0,0,0,0)"}}}))),G={partitionLayout:"treemap"===b?oe.PartitionLayout.treemap:oe.PartitionLayout.sunburst,fontFamily:null===(t=D.barSeriesStyle)||void 0===t||null===(n=t.displayValue)||void 0===n?void 0:n.fontFamily,outerSizeRatio:1,specialFirstInnermostSector:!0,minFontSize:10,maxFontSize:16,linkLabel:{maxCount:5,fontSize:11,textColor:null===(a=D.axes)||void 0===a||null===(i=a.axisTitle)||void 0===i?void 0:i.fill},sectorLineStroke:null===(r=D.lineSeriesStyle)||void 0===r||null===(s=r.point)||void 0===s?void 0:s.fill,sectorLineWidth:1.5,circlePadding:4};"treemap"===b?(A||"hide"===_)&&(G.fillLabel={textColor:"rgba(0,0,0,0)"}):(G.emptySizeRatio="donut"===b?.3:0,A||"hide"===_?G.linkLabel={maxCount:0,maximumSection:Number.POSITIVE_INFINITY}:"inside"===_&&(G.linkLabel={maxCount:0}));const q=c.columns.find((e=>e.id===y)),W=e.formatFactory({id:"percent",params:{pattern:`0,0.[${"0".repeat(null!=T?T:pe)}]%`}}),[$,Y]=Object(h.useState)(!1);Object(h.useEffect)((()=>{Y(!0)}),[]);const K=c.rows.some((e=>{const t=e[q.id];return"number"==typeof t&&t<0})),U=c.rows.every((e=>!e[q.id]));if(0===c.rows.length||c.rows.every((e=>x.every((t=>void 0===e[t]))))||U)return Object(E.jsx)(C,{reportTitle:e.args.title,reportDescription:e.args.description,className:"lnsPieExpression__container"},Object(E.jsx)(M.c,{icon:ue}));if(K)return Object(E.jsx)(F.EuiText,{className:"lnsChart__empty",textAlign:"center",color:"subdued",size:"xs"},Object(E.jsx)(O.FormattedMessage,{id:"xpack.lens.pie.pieWithNegativeWarningLabel",defaultMessage:"{chartType} charts can't render with negative values.",values:{chartType:de[b].label}}));return Object(E.jsx)(C,{reportTitle:e.args.title,reportDescription:e.args.description,className:"lnsPieExpression__container",isReady:$},Object(E.jsx)(oe.Chart,null,Object(E.jsx)(oe.Settings,{tooltip:{boundary:null!==(l=document.getElementById("app-fixed-viewport"))&&void 0!==l?l:void 0},debugState:null!==(o=window._echDebugStateFlag)&&void 0!==o&&o,showLegend:!A&&("show"===k||"default"===k&&R.length>1&&"treemap"!==b),legendPosition:I||oe.Position.Right,legendMaxDepth:w?void 0:1,onElementClick:null===(u=e.interactive)||void 0===u||u?e=>{const t=function(e,t,n){const a=n.rows.findIndex((n=>e.every(((e,a)=>{const i=t[a];return n[i]===e.groupByRollup}))));return{data:e.map(((e,i)=>({column:n.columns.findIndex((e=>e.id===t[i])),row:a,value:e.groupByRollup,table:n})))}}(e[0][0],x,c);f(t)}:void 0,legendAction:e.interactive?(X=c,Q=f,v.a.memo((({series:[e],label:t})=>{const n=X.columns.reduce(((t,{id:n},a)=>{const i=e.key,r=X.rows.findIndex((e=>e[n]===i));return r>-1&&t.push({table:X,column:a,row:r,value:i}),t}),[]);if(0===n.length)return null;const a={data:n};return Object(E.jsx)(M.e,{label:t,context:a,onFilter:Q})}))):void 0,theme:{...D,background:{...D.background,color:void 0},legend:{labelOptions:{maxLines:S?null!=P?P:1:0}}},baseTheme:N}),Object(E.jsx)(oe.Partition,{id:b,data:c.rows,valueAccessor:e=>function(e,t){const n=e[t.id];return Number.isFinite(n)&&n>=0?n:0}(e,q),percentFormatter:e=>W.convert(e/100),valueGetter:A||"value"===j?void 0:"percent",valueFormatter:e=>A?"":d[q.id].convert(e),layers:H,config:G,topGroove:A||"hide"===_?0:void 0})));var X,Q}const fe=e=>({name:"lens_pie_renderer",displayName:_.i18n.translate("xpack.lens.pie.visualizationName",{defaultMessage:"Pie"}),help:"",validate:()=>{},reuseDomNode:!0,render:(t,n,a)=>{j.a.render(Object(E.jsx)(O.I18nProvider,null,Object(E.jsx)(be,x()({},n,{formatFactory:e.formatFactory,chartsThemeService:e.chartsThemeService,interactive:a.isInteractive(),paletteService:e.paletteService,onClickValue:e=>{a.event({name:"filter",data:e})},renderMode:a.getRenderMode(),syncColors:a.isSyncColorsEnabled()}))),t,(()=>{a.done()})),a.onDestroy((()=>j.a.unmountComponentAtNode(t)))}}),be=v.a.memo(ge);function xe(e,t,n,a={isPreview:!1}){var i,r,s;const l=e.layers[0],o=t[l.layerId],u=l.groups.map((e=>({columnId:e,operation:o.getOperationForColumnId(e)}))).filter((e=>!!e.operation));return l.metric&&u.length?{type:"expression",chain:[{type:"function",function:"lens_pie",arguments:{title:[a.title||""],description:[a.description||""],shape:[e.shape],hideLabels:[a.isPreview],groups:u.map((e=>e.columnId)),metric:[l.metric],numberDisplay:[l.numberDisplay],categoryDisplay:[l.categoryDisplay],legendDisplay:[l.legendDisplay],legendPosition:[l.legendPosition||"right"],percentDecimals:[null!==(i=l.percentDecimals)&&void 0!==i?i:pe],legendMaxLines:[null!==(r=l.legendMaxLines)&&void 0!==r?r:1],truncateLegend:[null===(s=l.truncateLegend)||void 0===s||s],nestedLegend:[!!l.nestedLegend],...e.palette?{palette:[{type:"expression",chain:[{type:"function",function:"theme",arguments:{variable:["palette"],default:[n.get(e.palette.name).toExpression(e.palette.params)]}}]}]}:{}}}]}:null}function he({table:e,state:t,keptLayerIds:n,mainPalette:a,subVisualizationId:i}){if(function({table:e,keptLayerIds:t}){return t.length>1||t.length&&e.layerId!==t[0]||"reorder"===e.changeType||e.columns.some((e=>"interval"===e.operation.scale))}({table:e,state:t,keptLayerIds:n}))return[];const[r,s]=Object(Z.partition)(e.columns,(e=>e.operation.isBucketed));if(s.length>1||r.length>Math.max(3,2))return[];const l=0===s.length||0===r.length,o=s.length>0?s[0].columnId:void 0;if(l&&t&&!i)return[];const u=[];if(r.length<=3&&"treemap"!==i){let n=i||"donut";1===r.length||i||(n="pie");const s={title:_.i18n.translate("xpack.lens.pie.suggestionLabel",{defaultMessage:"As {chartName}",values:{chartName:de[n].label},description:"chartName is already translated"}),score:t&&"treemap"!==t.shape?.6:.4,state:{shape:n,palette:a||(null==t?void 0:t.palette),layers:[null!=t&&t.layers[0]?{...t.layers[0],layerId:e.layerId,groups:r.map((e=>e.columnId)),metric:o,layerType:$.i.DATA}:{layerId:e.layerId,groups:r.map((e=>e.columnId)),metric:o,numberDisplay:"percent",categoryDisplay:"default",legendDisplay:"default",nestedLegend:!1,layerType:$.i.DATA}]},previewIcon:"bullseye",hide:"reduced"===e.changeType||t&&"treemap"!==t.shape};u.push(s),u.push({...s,title:_.i18n.translate("xpack.lens.pie.suggestionLabel",{defaultMessage:"As {chartName}",values:{chartName:de["pie"===n?"donut":"pie"].label},description:"chartName is already translated"}),score:.1,state:{...s.state,shape:"pie"===n?"donut":"pie"},hide:!0})}return r.length<=2&&(!i||"treemap"===i)&&u.push({title:_.i18n.translate("xpack.lens.pie.treemapSuggestionLabel",{defaultMessage:"As Treemap"}),score:"treemap"===(null==t?void 0:t.shape)?.7:.5,state:{shape:"treemap",palette:a||(null==t?void 0:t.palette),layers:[null!=t&&t.layers[0]?{...t.layers[0],layerId:e.layerId,groups:r.map((e=>e.columnId)),metric:o,categoryDisplay:"inside"===t.layers[0].categoryDisplay?"default":t.layers[0].categoryDisplay,layerType:$.i.DATA}:{layerId:e.layerId,groups:r.map((e=>e.columnId)),metric:o,numberDisplay:"percent",categoryDisplay:"default",legendDisplay:"default",nestedLegend:!1,layerType:$.i.DATA}]},previewIcon:"bullseye",hide:"reduced"===e.changeType||!t||t&&"treemap"===t.shape}),[...u].map((e=>({...e,score:e.score+.05*r.length}))).sort(((e,t)=>t.score-e.score)).map((e=>({...e,hide:l||e.hide})))}n(211);const ve=[{value:"hidden",inputDisplay:_.i18n.translate("xpack.lens.pieChart.hiddenNumbersLabel",{defaultMessage:"Hide from chart"})},{value:"percent",inputDisplay:_.i18n.translate("xpack.lens.pieChart.showPercentValuesLabel",{defaultMessage:"Show percent"})},{value:"value",inputDisplay:_.i18n.translate("xpack.lens.pieChart.showFormatterValuesLabel",{defaultMessage:"Show value"})}],ye=[{value:"default",inputDisplay:_.i18n.translate("xpack.lens.pieChart.showCategoriesLabel",{defaultMessage:"Inside or outside"})},{value:"inside",inputDisplay:_.i18n.translate("xpack.lens.pieChart.fitInsideOnlyLabel",{defaultMessage:"Inside only"})},{value:"hide",inputDisplay:_.i18n.translate("xpack.lens.pieChart.categoriesInLegendLabel",{defaultMessage:"Hide labels"})}],je=[{value:"default",inputDisplay:_.i18n.translate("xpack.lens.pieChart.showTreemapCategoriesLabel",{defaultMessage:"Show labels"})},{value:"hide",inputDisplay:_.i18n.translate("xpack.lens.pieChart.categoriesInLegendLabel",{defaultMessage:"Hide labels"})}],_e=[{id:"pieLegendDisplay-default",value:"default",label:_.i18n.translate("xpack.lens.pieChart.legendVisibility.auto",{defaultMessage:"Auto"})},{id:"pieLegendDisplay-show",value:"show",label:_.i18n.translate("xpack.lens.pieChart.legendVisibility.show",{defaultMessage:"Show"})},{id:"pieLegendDisplay-hide",value:"hide",label:_.i18n.translate("xpack.lens.pieChart.legendVisibility.hide",{defaultMessage:"Hide"})}];function Oe(e){var t,n;const{state:a,setState:i}=e,r=a.layers[0];return r?Object(E.jsx)(F.EuiFlexGroup,{gutterSize:"none",justifyContent:"spaceBetween",responsive:!1},Object(E.jsx)(M.j,{title:_.i18n.translate("xpack.lens.pieChart.valuesLabel",{defaultMessage:"Labels"}),type:"labels",groupPosition:"left",buttonDataTestSubj:"lnsLabelsButton"},Object(E.jsx)(F.EuiFormRow,{label:_.i18n.translate("xpack.lens.pieChart.labelPositionLabel",{defaultMessage:"Position"}),fullWidth:!0,display:"columnCompressed"},Object(E.jsx)(F.EuiSuperSelect,{compressed:!0,valueOfSelected:r.categoryDisplay,options:"treemap"===a.shape?je:ye,onChange:e=>{i({...a,layers:[{...r,categoryDisplay:e}]})}})),Object(E.jsx)(F.EuiFormRow,{label:_.i18n.translate("xpack.lens.pieChart.numberLabels",{defaultMessage:"Values"}),fullWidth:!0,display:"columnCompressed"},Object(E.jsx)(F.EuiSuperSelect,{compressed:!0,disabled:"hide"===r.categoryDisplay,valueOfSelected:"hide"===r.categoryDisplay?"hidden":r.numberDisplay,options:ve,onChange:e=>{i({...a,layers:[{...r,numberDisplay:e}]})}})),Object(E.jsx)(F.EuiHorizontalRule,{margin:"s"}),Object(E.jsx)(F.EuiFormRow,{label:_.i18n.translate("xpack.lens.pieChart.percentDecimalsLabel",{defaultMessage:"Maximum decimal places for percent"}),fullWidth:!0,display:"rowCompressed"},Object(E.jsx)(ke,{value:null!==(t=r.percentDecimals)&&void 0!==t?t:pe,setValue:e=>{i({...a,layers:[{...r,percentDecimals:e}]})}}))),Object(E.jsx)(M.f,{legendOptions:_e,mode:r.legendDisplay,onDisplayChange:e=>{i({...a,layers:[{...r,legendDisplay:_e.find((({id:t})=>t===e)).value}]})},position:r.legendPosition,onPositionChange:e=>{i({...a,layers:[{...r,legendPosition:e}]})},renderNestedLegendSwitch:!0,nestedLegend:!!r.nestedLegend,onNestedLegendChange:()=>{i({...a,layers:[{...r,nestedLegend:!r.nestedLegend}]})},shouldTruncate:null===(n=r.truncateLegend)||void 0===n||n,onTruncateLegendChange:()=>{var e;const t=null===(e=r.truncateLegend)||void 0===e||e;i({...a,layers:[{...r,truncateLegend:!t}]})},maxLines:null==r?void 0:r.legendMaxLines,onMaxLinesChange:e=>{i({...a,layers:[{...r,legendMaxLines:e}]})}})):null}const ke=({value:e,setValue:t})=>{const{inputValue:n,handleInputChange:a}=Object(M.q)({value:e,onChange:t},{allowFalsyValue:!0});return Object(E.jsx)(F.EuiRange,{"data-test-subj":"indexPattern-dimension-formatDecimals",value:n,min:0,max:10,showInput:!0,compressed:!0,onChange:e=>{a(Number(e.currentTarget.value))}})};function Ie(e){return Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(M.h,{palettes:e.paletteService,activePalette:e.state.palette,setPalette:t=>{e.setState({...e.state,palette:t})}}))}function Fe(e){return{layerId:e,groups:[],metric:void 0,numberDisplay:"percent",categoryDisplay:"default",legendDisplay:"default",nestedLegend:!1,layerType:$.i.DATA}}const we=e=>e.isBucketed,Te=e=>!e.isBucketed&&"number"===e.dataType,Ee=({paletteService:e})=>({id:"lnsPie",visualizationTypes:[{id:"donut",icon:de.donut.icon,label:de.donut.label,groupLabel:de.donut.groupLabel},{id:"pie",icon:de.pie.icon,label:de.pie.label,groupLabel:de.pie.groupLabel},{id:"treemap",icon:de.treemap.icon,label:de.treemap.label,groupLabel:de.treemap.groupLabel}],getVisualizationTypeId:e=>e.shape,getLayerIds:e=>e.layers.map((e=>e.layerId)),clearLayer:e=>({shape:e.shape,layers:e.layers.map((e=>Fe(e.layerId)))}),getDescription:e=>"treemap"===e.shape?de.treemap:"donut"===e.shape?de.donut:de.pie,switchVisualizationType:(e,t)=>({...t,shape:e}),initialize:(e,t,n)=>t||{shape:"donut",layers:[Fe(e())],palette:n},getMainPalette:e=>e?e.palette:void 0,getSuggestions:he,getConfiguration({state:t,frame:n,layerId:a}){const i=t.layers.find((e=>e.layerId===a));if(!i)return{groups:[]};const r=n.datasourceLayers[i.layerId].getTableSpec().map((({columnId:e})=>e)).filter((e=>e!==i.metric)),s=Array.from(new Set(r.concat(i.groups))).map((e=>({columnId:e})));var l,o;s.length>0&&(s[0]={columnId:s[0].columnId,triggerIcon:"colorBy",palette:e.get((null===(l=t.palette)||void 0===l?void 0:l.name)||"default").getCategoricalColors(10,null===(o=t.palette)||void 0===o?void 0:o.params)});return"treemap"===t.shape?{groups:[{groupId:"groups",groupLabel:_.i18n.translate("xpack.lens.pie.treemapGroupLabel",{defaultMessage:"Group by"}),layerId:a,accessors:s,supportsMoreColumns:s.length<2,filterOperations:we,required:!0,dataTestSubj:"lnsPie_groupByDimensionPanel",enableDimensionEditor:!0},{groupId:"metric",groupLabel:_.i18n.translate("xpack.lens.pie.groupsizeLabel",{defaultMessage:"Size by"}),layerId:a,accessors:i.metric?[{columnId:i.metric}]:[],supportsMoreColumns:!i.metric,filterOperations:Te,required:!0,dataTestSubj:"lnsPie_sizeByDimensionPanel"}]}:{groups:[{groupId:"groups",groupLabel:_.i18n.translate("xpack.lens.pie.sliceGroupLabel",{defaultMessage:"Slice by"}),layerId:a,accessors:s,supportsMoreColumns:s.length<3,filterOperations:we,required:!0,dataTestSubj:"lnsPie_sliceByDimensionPanel",enableDimensionEditor:!0},{groupId:"metric",groupLabel:_.i18n.translate("xpack.lens.pie.groupsizeLabel",{defaultMessage:"Size by"}),layerId:a,accessors:i.metric?[{columnId:i.metric}]:[],supportsMoreColumns:!i.metric,filterOperations:Te,required:!0,dataTestSubj:"lnsPie_sizeByDimensionPanel"}]}},setDimension:({prevState:e,layerId:t,columnId:n,groupId:a})=>({...e,layers:e.layers.map((e=>e.layerId!==t?e:"groups"===a?{...e,groups:[...e.groups,n]}:{...e,metric:n}))}),removeDimension:({prevState:e,layerId:t,columnId:n})=>({...e,layers:e.layers.map((e=>e.layerId!==t?e:e.metric===n?{...e,metric:void 0}:{...e,groups:e.groups.filter((e=>e!==n))}))}),renderDimensionEditor(t,n){Object(y.render)(Object(E.jsx)(O.I18nProvider,null,Object(E.jsx)(Ie,x()({},n,{paletteService:e}))),t)},getSupportedLayers:()=>[{type:$.i.DATA,label:_.i18n.translate("xpack.lens.pie.addLayer",{defaultMessage:"Add visualization layer"})}],getLayerType(e,t){var n;return null==t||null===(n=t.layers.find((({layerId:t})=>t===e)))||void 0===n?void 0:n.layerType},toExpression:(t,n,a)=>function(e,t,n,a={}){return xe(e,t,n,{...a,isPreview:!1})}(t,n,e,a),toPreviewExpression:(t,n)=>function(e,t,n){return xe(e,t,n,{isPreview:!0})}(t,n,e),renderToolbar(e,t){Object(y.render)(Object(E.jsx)(O.I18nProvider,null,Object(E.jsx)(Oe,t)),e)},getWarningMessages(e,t){if(0===(null==e?void 0:e.layers.length)||!t.activeData)return;const n=[];for(const i of e.layers){var a;const{layerId:e,metric:r}=i,s=t.activeData[e]&&t.activeData[e].rows;if(!s||!r)break;const l=null===(a=t.datasourceLayers[e].getOperationForColumnId(r))||void 0===a?void 0:a.label;s.some((e=>Array.isArray(e[r])))&&n.push(l||r)}return n.map((e=>Object(E.jsx)(O.FormattedMessage,{key:e,id:"xpack.lens.pie.arrayValues",defaultMessage:"{label} contains array values. Your visualization may not render as expected.",values:{label:Object(E.jsx)("strong",null,e)}})))},getErrorMessages(e){}});class PieVisualization{setup(e,{expressions:t,formatFactory:a,editorFrame:i,charts:r}){i.registerVisualization((async()=>{const{getPieVisualization:e,getPieRenderer:i}=await Promise.resolve().then(n.bind(null,529)),s=await r.palettes.getPalettes();return t.registerRenderer(i({formatFactory:a,chartsThemeService:r.theme,paletteService:s})),e({paletteService:s})}))}}n(220);var Ce=n(75);function Me(e){return"bar_horizontal"===e||"bar_horizontal_stacked"===e||"bar_horizontal_percentage_stacked"===e}function Pe(e){return e.every((e=>Me(e.seriesType)))}function Se(e){const t=Ce.visualizationTypes.find((t=>t.id===e));if(!t)throw new Error(`Unknown series type ${e}`);return t.icon||"empty"}const Ae=(e,t)=>{var n,a;return e.splitAccessor?null:(null==e||null===(n=e.yConfig)||void 0===n||null===(a=n.find((e=>e.forAccessor===t)))||void 0===a?void 0:a.color)||null},Le=(e,t)=>{const n={};return e.accessors.concat(e.splitAccessor?[e.splitAccessor]:[]).forEach((e=>{const a=t.getOperationForColumnId(e);null!=a&&a.label&&(n[e]=a.label)})),n};var De=n(41),Ne=n(51);function ze(e){return e?oe.Fit[e]:oe.Fit.None}function Be(e){return{type:ze(e)}}function Re(e,t){return e.id===t.id}function Ve(e,t){const n={auto:[],left:[],right:[],bottom:[]};return null==e||e.forEach((e=>{const a=null==t?void 0:t[e.layerId];e.accessors.forEach((t=>{var i,r,s,l;const o=(null===(i=e.yConfig)||void 0===i||null===(r=i.find((e=>e.forAccessor===t)))||void 0===r?void 0:r.axisMode)||"auto";let u=(null==a||null===(s=a.columns.find((e=>e.id===t)))||void 0===s||null===(l=s.meta)||void 0===l?void 0:l.params)||{id:"number"};e.seriesType.includes("percentage")&&"percent"!==u.id&&(u={id:"percent",params:{pattern:"0.[00]%"}}),n[o].push({layer:e.layerId,accessor:t,fieldFormat:u})}))})),n.auto.forEach((e=>{0===n.left.length||t&&n.left.every((t=>Re(t.fieldFormat,e.fieldFormat)))?n.left.push(e):0===n.right.length||t&&n.left.every((t=>Re(t.fieldFormat,e.fieldFormat)))?n.right.push(e):n.right.length>=n.left.length?n.left.push(e):n.right.push(e)})),n}function He(e,t,n,a){const i=Ve(e,n),r=[];return i.left.length>0&&r.push({groupId:"left",position:t?"bottom":"left",formatter:null==a?void 0:a(i.left[0].fieldFormat),series:i.left.map((({fieldFormat:e,...t})=>t))}),i.right.length>0&&r.push({groupId:"right",position:t?"top":"right",formatter:null==a?void 0:a(i.right[0].fieldFormat),series:i.right.map((({fieldFormat:e,...t})=>t))}),r}function Ge(e,t){return{inclusiveZeroError:t&&e&&(void 0!==t.lowerBound&&t.lowerBound>0||(void 0!==t.upperBound&&t.upperBound)<0),boundaryError:t&&void 0!==t.lowerBound&&void 0!==t.upperBound&&t.upperBound<=t.lowerBound}}var qe=n(48);const We=e=>null!=e&&"object"!=typeof e,$e=qe.euiLightVars.euiColorDarkShade;function Ye(e,t,n){const a={};return e.filter((({layerType:e})=>e===$.i.DATA)).forEach((e=>{var t;const n=(null===(t=e.palette)||void 0===t?void 0:t.name)||"default";a[n]||(a[n]=[]),a[n].push(e)})),Object(Z.mapValues)(a,(e=>{const a=e.map(((e,a)=>{var i;if(!e.splitAccessor)return{numberOfSeries:e.accessors.length,splits:[]};const r=e.splitAccessor,s=null===(i=t.tables[e.layerId])||void 0===i?void 0:i.columns.find((({id:e})=>e===r)),l=s&&t.tables[e.layerId]?Object(Z.uniq)(t.tables[e.layerId].rows.map((e=>{let t=e[r];return t=t&&!We(t)?n(s.meta.params).convert(t):String(t),t}))):[];return{numberOfSeries:(l.length||1)*e.accessors.length,splits:l}}));return{totalSeriesCount:a.reduce(((e,t)=>e+t.numberOfSeries),0),getRank(t,n,i){const r=e.findIndex((e=>t.layerId===e.layerId)),s=a[r].splits.indexOf(n);return(0===r?0:a.slice(0,r).reduce(((e,t)=>e+t.numberOfSeries),0))+(t.splitAccessor&&-1!==s?s*t.accessors.length:0)+t.accessors.indexOf(i)}}}))}function Ke(e,t,n,a){var i;const r=Boolean(n.splitAccessor),s=n.palette||{type:"palette",name:"default"},l=null===(i=e[s.name])||void 0===i?void 0:i.totalSeriesCount;return n.accessors.map((i=>{var o;const u=null===(o=n.yConfig)||void 0===o?void 0:o.find((e=>e.forAccessor===i));if(r)return{columnId:i,triggerIcon:"disabled"};if(n.layerType===$.i.REFERENCELINE)return{columnId:i,triggerIcon:"color",color:(null==u?void 0:u.color)||$e};const c=Le(n,t.datasourceLayers[n.layerId]),d=e[s.name].getRank(n,c[i]||i,i),p=(null==u?void 0:u.color)||(null!=l?a.get(s.name).getCategoricalColor([{name:c[i]||i,rankAtDepth:d,totalSeriesAtDepth:l}],{maxDepth:1,totalSeries:l},s.params):void 0);return{columnId:i,triggerIcon:p?"color":"disabled",color:null!=p?p:void 0}}))}const Ue=(e,t,n,a,i)=>{var r,s,l,o;const u=a?{min:null!==(r=null===(s=t.dateRange)||void 0===s?void 0:s.fromDate.getTime())&&void 0!==r?r:NaN,max:null!==(l=null===(o=t.dateRange)||void 0===o?void 0:o.toDate.getTime())&&void 0!==l?l:NaN,minInterval:n}:i?{minInterval:n,min:NaN,max:NaN}:void 0;if(i&&Xe(u)){const n=Object(Z.uniq)(e.flatMap((e=>t.tables[e.layerId].rows.map((t=>t[e.xAccessor].valueOf())))).sort()),[a]=n,i=n[n.length-1],r=Math.min(a,u.min),s=u.max-u.minInterval;return{extendedDomain:{min:r,max:Math.max(s,i),minInterval:u.minInterval},baseDomain:u}}return{baseDomain:u,extendedDomain:u}};function Xe(e){return Boolean(e&&"number"==typeof e.min&&"number"==typeof e.max&&e.minInterval)}const Qe=function({baseDomain:e,extendedDomain:t,histogramMode:n,darkMode:a}){return Xe(e)&&Xe(t)?Object(E.jsx)(Ne.Endzones,{isFullBin:!n,isDarkMode:a,domainStart:e.min,domainEnd:e.max,interval:t.minInterval,domainMin:t.min,domainMax:t.max,hideTooltips:!1}):null},Ze=(e,t,n,a,i)=>v.a.memo((({series:[r]})=>{var s;const l=r,o=e.find((e=>l.seriesKeys.some((t=>e.accessors.includes(t.toString())))));if(!o||!o.splitAccessor)return null;const u=l.seriesKeys[0],c=o.splitAccessor,d=t[o.layerId],p=d.columns.find((({id:e})=>e===o.splitAccessor)),m=a(p&&(null===(s=p.meta)||void 0===s?void 0:s.params)),g=d.rows.findIndex((e=>i[c]?m.convert(e[c])===u:e[c]===u));if(g<0)return null;const f={data:[{row:g,column:d.columns.findIndex((e=>e.id===c)),value:c?d.rows[g][c]:u,table:d}]};return Object(E.jsx)(M.e,{label:!i[c]&&m?m.convert(u):u,context:f,onFilter:n})}));n(229),n(90);const Je=(e,t)=>{const n=e.getTableSpec().map((({columnId:e})=>e)).filter((e=>t.accessors.includes(e)));return Array.from(new Set(n.concat(t.accessors)))},et=(e,t,n,a={})=>{if(!e||!e.layers.length)return null;const i={};return e.layers.forEach((e=>{i[e.layerId]={};t[e.layerId].getTableSpec().forEach((n=>{const a=t[e.layerId].getOperationForColumnId(n.columnId);i[e.layerId][n.columnId]=a}))})),nt(e,i,t,n,a)};function tt(e,t){if(!e)return t;if("ordinal"===e.scale)return oe.ScaleType.Ordinal;if("interval"===e.scale||"ratio"===e.scale)return"date"===e.dataType?oe.ScaleType.Time:oe.ScaleType.Linear;switch(e.dataType){case"boolean":case"string":case"ip":return oe.ScaleType.Ordinal;case"date":return oe.ScaleType.Time;default:return oe.ScaleType.Linear}}const nt=(e,t,n,a,i={})=>{var r,s,l,o,u,c,d,p,m,g,f,b,x,h,v,y,j,_,O,k,I,F,w,T,E,C,M,P,S,A,L,D,N,z,B;const R=e.layers.filter((e=>Boolean(e.accessors.length))).map((e=>{if(!n)return e;const t=Je(n[e.layerId],e);return{...e,accessors:t}}));return R.length?{type:"expression",chain:[{type:"function",function:"lens_xy_chart",arguments:{title:[(null==i?void 0:i.title)||""],description:[(null==i?void 0:i.description)||""],xTitle:[e.xTitle||""],yTitle:[e.yTitle||""],yRightTitle:[e.yRightTitle||""],legend:[{type:"expression",chain:[{type:"function",function:"lens_xy_legendConfig",arguments:{isVisible:[e.legend.isVisible],showSingleSeries:e.legend.showSingleSeries?[e.legend.showSingleSeries]:[],position:[e.legend.position],isInside:e.legend.isInside?[e.legend.isInside]:[],horizontalAlignment:e.legend.horizontalAlignment?[e.legend.horizontalAlignment]:[],verticalAlignment:e.legend.verticalAlignment?[e.legend.verticalAlignment]:[],floatingColumns:e.legend.floatingColumns?[Math.min(5,e.legend.floatingColumns)]:[],maxLines:e.legend.maxLines?[e.legend.maxLines]:[],shouldTruncate:[null===(r=e.legend.shouldTruncate)||void 0===r||r]}}]}],fittingFunction:[e.fittingFunction||"None"],curveType:[e.curveType||"LINEAR"],fillOpacity:[e.fillOpacity||.3],yLeftExtent:[{type:"expression",chain:[{type:"function",function:"lens_xy_axisExtentConfig",arguments:{mode:[(null==e||null===(s=e.yLeftExtent)||void 0===s?void 0:s.mode)||"full"],lowerBound:void 0!==(null==e||null===(l=e.yLeftExtent)||void 0===l?void 0:l.lowerBound)?[null==e||null===(o=e.yLeftExtent)||void 0===o?void 0:o.lowerBound]:[],upperBound:void 0!==(null==e||null===(u=e.yLeftExtent)||void 0===u?void 0:u.upperBound)?[null==e||null===(c=e.yLeftExtent)||void 0===c?void 0:c.upperBound]:[]}}]}],yRightExtent:[{type:"expression",chain:[{type:"function",function:"lens_xy_axisExtentConfig",arguments:{mode:[(null==e||null===(d=e.yRightExtent)||void 0===d?void 0:d.mode)||"full"],lowerBound:void 0!==(null==e||null===(p=e.yRightExtent)||void 0===p?void 0:p.lowerBound)?[null==e||null===(m=e.yRightExtent)||void 0===m?void 0:m.lowerBound]:[],upperBound:void 0!==(null==e||null===(g=e.yRightExtent)||void 0===g?void 0:g.upperBound)?[null==e||null===(f=e.yRightExtent)||void 0===f?void 0:f.upperBound]:[]}}]}],axisTitlesVisibilitySettings:[{type:"expression",chain:[{type:"function",function:"lens_xy_axisTitlesVisibilityConfig",arguments:{x:[null===(b=null==e||null===(x=e.axisTitlesVisibilitySettings)||void 0===x?void 0:x.x)||void 0===b||b],yLeft:[null===(h=null==e||null===(v=e.axisTitlesVisibilitySettings)||void 0===v?void 0:v.yLeft)||void 0===h||h],yRight:[null===(y=null==e||null===(j=e.axisTitlesVisibilitySettings)||void 0===j?void 0:j.yRight)||void 0===y||y]}}]}],tickLabelsVisibilitySettings:[{type:"expression",chain:[{type:"function",function:"lens_xy_tickLabelsConfig",arguments:{x:[null===(_=null==e||null===(O=e.tickLabelsVisibilitySettings)||void 0===O?void 0:O.x)||void 0===_||_],yLeft:[null===(k=null==e||null===(I=e.tickLabelsVisibilitySettings)||void 0===I?void 0:I.yLeft)||void 0===k||k],yRight:[null===(F=null==e||null===(w=e.tickLabelsVisibilitySettings)||void 0===w?void 0:w.yRight)||void 0===F||F]}}]}],gridlinesVisibilitySettings:[{type:"expression",chain:[{type:"function",function:"lens_xy_gridlinesConfig",arguments:{x:[null===(T=null==e||null===(E=e.gridlinesVisibilitySettings)||void 0===E?void 0:E.x)||void 0===T||T],yLeft:[null===(C=null==e||null===(M=e.gridlinesVisibilitySettings)||void 0===M?void 0:M.yLeft)||void 0===C||C],yRight:[null===(P=null==e||null===(S=e.gridlinesVisibilitySettings)||void 0===S?void 0:S.yRight)||void 0===P||P]}}]}],labelsOrientation:[{type:"expression",chain:[{type:"function",function:"lens_xy_labelsOrientationConfig",arguments:{x:[null!==(A=null==e||null===(L=e.labelsOrientation)||void 0===L?void 0:L.x)&&void 0!==A?A:0],yLeft:[null!==(D=null==e||null===(N=e.labelsOrientation)||void 0===N?void 0:N.yLeft)&&void 0!==D?D:0],yRight:[null!==(z=null==e||null===(B=e.labelsOrientation)||void 0===B?void 0:B.yRight)&&void 0!==z?z:0]}}]}],valueLabels:[(null==e?void 0:e.valueLabels)||"hide"],hideEndzones:[(null==e?void 0:e.hideEndzones)||!1],valuesInLegend:[(null==e?void 0:e.valuesInLegend)||!1],layers:R.map((e=>{const i=Le(e,n[e.layerId]),r=n&&n[e.layerId].getOperationForColumnId(e.xAccessor),s=Boolean(r&&r.isBucketed&&r.scale&&"ordinal"!==r.scale);return{type:"expression",chain:[{type:"function",function:"lens_xy_layer",arguments:{layerId:[e.layerId],hide:[Boolean(e.hide)],xAccessor:e.xAccessor?[e.xAccessor]:[],yScaleType:[tt(t[e.layerId][e.accessors[0]],oe.ScaleType.Ordinal)],xScaleType:[tt(t[e.layerId][e.xAccessor],oe.ScaleType.Linear)],isHistogram:[s],splitAccessor:e.splitAccessor?[e.splitAccessor]:[],yConfig:e.yConfig?e.yConfig.map((t=>({type:"expression",chain:[{type:"function",function:"lens_xy_yConfig",arguments:{forAccessor:[t.forAccessor],axisMode:t.axisMode?[t.axisMode]:[],color:e.layerType===$.i.REFERENCELINE?[t.color||$e]:t.color?[t.color]:[],lineStyle:[t.lineStyle||"solid"],lineWidth:[t.lineWidth||1],fill:[t.fill||"none"],icon:Ct(t.icon)?[t.icon]:[],iconPosition:Ct(t.icon)||t.textVisibility?[t.iconPosition||"auto"]:["auto"],textVisibility:[t.textVisibility||!1]}}]}))):[],seriesType:[e.seriesType],layerType:[e.layerType||$.i.DATA],accessors:e.accessors,columnToLabel:[JSON.stringify(i)],...e.palette?{palette:[{type:"expression",chain:[{type:"function",function:"theme",arguments:{variable:["palette"],default:[a.get(e.palette.name).toExpression(e.palette.params)]}}]}]}:{}}}]}}))}}]}:null};var at=n(70);const it=({title:e,titleId:t,...n})=>Object(E.jsx)("svg",x()({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(E.jsx)("title",{id:t},e):null,Object(E.jsx)("path",{d:"M5 1.5a.5.5 0 111 0v7a.5.5 0 01-1 0v-7zM15.39 11.39a1.5 1.5 0 010 2.12l-2.122 2.122a.5.5 0 11-.707-.707l2.121-2.122a.5.5 0 000-.707l-2.121-2.12a.5.5 0 11.707-.708l2.121 2.121zM3.439 9.269a.5.5 0 010 .707l-2.122 2.121a.5.5 0 000 .707l2.122 2.121a.5.5 0 01-.707.708L.61 13.51a1.5 1.5 0 010-2.121l2.122-2.121a.5.5 0 01.707 0zM8 3a.5.5 0 01.5.5v5a.5.5 0 01-1 0v-5A.5.5 0 018 3zM11 5.5a.5.5 0 00-1 0v3a.5.5 0 001 0v-3z"}),Object(E.jsx)("path",{d:"M3.5 12a.5.5 0 000 1h9a.5.5 0 000-1h-9z"})),rt=({title:e,titleId:t,...n})=>Object(E.jsx)("svg",x()({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(E.jsx)("title",{id:t},e):null,Object(E.jsx)("path",{d:"M7.378 3.585a.5.5 0 00.353-.854L5.61.611a1.5 1.5 0 00-2.121 0L1.367 2.73a.5.5 0 00.708.707l2.12-2.12a.5.5 0 01.708 0l2.121 2.12a.5.5 0 00.354.147z"}),Object(E.jsx)("path",{d:"M5.046 3.088v4.129l.005.04v5.658a.5.5 0 01-.992.09l-.01-.09V8.786l-.004-.04V3.087a.5.5 0 01.992-.09l.01.09z"}),Object(E.jsx)("path",{d:"M4.55 15.829a1.5 1.5 0 001.06-.44l2.122-2.121a.5.5 0 10-.707-.707l-2.121 2.121a.5.5 0 01-.708 0l-2.12-2.121a.5.5 0 00-.708.707l2.121 2.121a1.5 1.5 0 001.061.44zM13.5 4a.5.5 0 01.5.5v7a.5.5 0 11-1 0v-7a.5.5 0 01.5-.5zM10.5 6.5a.5.5 0 011 0v5a.5.5 0 11-1 0v-5zM8.5 8a.5.5 0 00-.5.5v3a.5.5 0 101 0v-3a.5.5 0 00-.5-.5z"})),st=({title:e,titleId:t,...n})=>Object(E.jsx)("svg",x()({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(E.jsx)("title",{id:t},e):null,Object(E.jsx)("path",{d:"M8.622 3.585a.5.5 0 01-.353-.854L10.39.611a1.5 1.5 0 012.121 0l2.122 2.12a.5.5 0 11-.707.707l-2.122-2.12a.5.5 0 00-.707 0l-2.121 2.12a.5.5 0 01-.354.147z"}),Object(E.jsx)("path",{d:"M11.95 12.915V8.786l.005-.04V3.087a.5.5 0 00-.992-.09l-.01.09v4.129l-.004.04v5.658a.5.5 0 00.992.09l.01-.09z"}),Object(E.jsx)("path",{d:"M11.45 15.829a1.5 1.5 0 01-1.06-.44l-2.122-2.121a.5.5 0 11.707-.707l2.121 2.121a.5.5 0 00.707 0l2.122-2.121a.5.5 0 01.707.707l-2.121 2.121a1.5 1.5 0 01-1.061.44zM2.5 4a.5.5 0 00-.5.5v7a.5.5 0 101 0v-7a.5.5 0 00-.5-.5zM5.5 6.5a.5.5 0 00-1 0v5a.5.5 0 101 0v-5zM7.5 8a.5.5 0 01.5.5v3a.5.5 0 11-1 0v-3a.5.5 0 01.5-.5z"})),lt=({title:e,titleId:t,...n})=>Object(E.jsx)("svg",x()({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(E.jsx)("title",{id:t},e):null,Object(E.jsx)("path",{d:"M4.99991 7.49999C4.99991 7.22384 5.22376 6.99999 5.49991 6.99999C5.77605 6.99999 5.99991 7.22384 5.99991 7.49999V14.5C5.99991 14.7761 5.77605 15 5.49991 15C5.22376 15 4.99991 14.7761 4.99991 14.5V7.49999Z"}),Object(E.jsx)("path",{d:"M15.3893 2.38929C15.6706 2.67059 15.8287 3.05212 15.8287 3.44995C15.8287 3.84777 15.6706 4.2293 15.3893 4.51061L13.268 6.63193C13.1742 6.7257 13.0471 6.77838 12.9145 6.77838C12.7818 6.77838 12.6547 6.7257 12.5609 6.63193C12.4671 6.53816 12.4145 6.41098 12.4145 6.27838C12.4145 6.14577 12.4671 6.01859 12.5609 5.92482L14.6822 3.8035C14.776 3.70973 14.8287 3.58256 14.8287 3.44995C14.8287 3.31734 14.776 3.19016 14.6822 3.09639L12.5609 0.975075C12.4671 0.881307 12.4145 0.754129 12.4145 0.621522C12.4145 0.488914 12.4671 0.361736 12.5609 0.267968C12.6547 0.1742 12.7819 0.121521 12.9145 0.121521C13.0471 0.121521 13.1742 0.1742 13.268 0.267968L15.3893 2.38929Z"}),Object(E.jsx)("path",{d:"M3.43867 0.26864C3.53243 0.362408 3.58511 0.489585 3.58511 0.622193C3.58511 0.754801 3.53243 0.881978 3.43867 0.975746L1.31735 3.09707C1.22358 3.19083 1.1709 3.31801 1.1709 3.45062C1.1709 3.58323 1.22358 3.71041 1.31735 3.80417L3.43867 5.92549C3.53243 6.01926 3.58511 6.14644 3.58511 6.27905C3.58511 6.41166 3.53243 6.53883 3.43867 6.6326C3.3449 6.72637 3.21772 6.77905 3.08511 6.77905C2.9525 6.77905 2.82533 6.72637 2.73156 6.6326L0.610239 4.51128C0.328934 4.22998 0.170898 3.84844 0.170898 3.45062C0.170898 3.0528 0.328934 2.67126 0.610238 2.38996L2.73156 0.26864C2.82533 0.174871 2.9525 0.122192 3.08511 0.122192C3.21772 0.122192 3.3449 0.174871 3.43867 0.26864Z"}),Object(E.jsx)("path",{d:"M7.99991 6.99999C8.27605 6.99999 8.49991 7.22384 8.49991 7.49999V12.5C8.49991 12.7761 8.27605 13 7.99991 13C7.72377 13 7.49991 12.7761 7.49991 12.5V7.49999C7.49991 7.22384 7.72377 6.99999 7.99991 6.99999Z"}),Object(E.jsx)("path",{d:"M10.9999 7.49999C10.9999 7.22384 10.776 6.99999 10.4999 6.99999C10.2238 6.99999 9.99991 7.22384 9.99991 7.49999V10.5C9.99991 10.7761 10.2238 11 10.4999 11C10.776 11 10.9999 10.7761 10.9999 10.5V7.49999Z"}),Object(E.jsx)("path",{d:"M3.50015 2.99999C3.22401 2.99999 3.00015 3.22384 3.00015 3.49999C3.00015 3.77613 3.22401 3.99999 3.50015 3.99999H12.5002C12.7763 3.99999 13.0002 3.77613 13.0002 3.49999C13.0002 3.22384 12.7763 2.99999 12.5002 2.99999H3.50015Z"})),ot=[{id:"xy_axis_orientation_horizontal",value:0,label:_.i18n.translate("xpack.lens.xyChart.axisOrientation.horizontal",{defaultMessage:"Horizontal"})},{id:"xy_axis_orientation_vertical",value:-90,label:_.i18n.translate("xpack.lens.xyChart.axisOrientation.vertical",{defaultMessage:"Vertical"})},{id:"xy_axis_orientation_angled",value:-45,label:_.i18n.translate("xpack.lens.xyChart.axisOrientation.angled",{defaultMessage:"Angled"})}],ut=()=>{},ct=Object(F.htmlIdGenerator)()(),dt=({layers:e,axis:t,axisTitle:n,updateTitleState:a,toggleTickLabelsVisibility:i,toggleGridlinesVisibility:r,isDisabled:s,areTickLabelsVisible:l,areGridlinesVisible:o,isAxisTitleVisible:u,orientation:c,setOrientation:d,toggleAxisTitleVisibility:p,setEndzoneVisibility:m,endzonesVisible:g,extent:f,setExtent:b,hasBarOrAreaOnAxis:x,hasPercentageAxis:y,dataBounds:j})=>{var O,k;const I=!(null==e||!e.length)&&Pe(e),w=((e,t)=>{switch(e){case"yLeft":return{icon:t?it:rt,groupPosition:"left",popoverTitle:t?_.i18n.translate("xpack.lens.xyChart.bottomAxisLabel",{defaultMessage:"Bottom axis"}):_.i18n.translate("xpack.lens.xyChart.leftAxisLabel",{defaultMessage:"Left axis"}),buttonDataTestSubj:"lnsLeftAxisButton"};case"yRight":return{icon:t?lt:st,groupPosition:"right",popoverTitle:t?_.i18n.translate("xpack.lens.xyChart.topAxisLabel",{defaultMessage:"Top axis"}):_.i18n.translate("xpack.lens.xyChart.rightAxisLabel",{defaultMessage:"Right axis"}),buttonDataTestSubj:"lnsRightAxisButton"};default:return{icon:t?rt:it,groupPosition:"center",popoverTitle:t?_.i18n.translate("xpack.lens.xyChart.leftAxisLabel",{defaultMessage:"Left axis"}):_.i18n.translate("xpack.lens.xyChart.bottomAxisLabel",{defaultMessage:"Bottom axis"}),buttonDataTestSubj:"lnsBottomAxisButton"}}})(t,I),{inputValue:T,handleInputChange:C}=Object(M.q)({value:f,onChange:b||ut}),[P,S]=Object(h.useState)(T),{inclusiveZeroError:A,boundaryError:L}=Ge(x,P);Object(h.useEffect)((()=>{b&&!A&&!L&&P&&P!==T&&C(P)}),[P,A,L,C,T,b]);const{inputValue:D,handleInputChange:N}=Object(M.q)({value:n||"",onChange:a});return Object(E.jsx)(M.j,{title:w.popoverTitle,type:w.icon,groupPosition:w.groupPosition,isDisabled:s,buttonDataTestSubj:w.buttonDataTestSubj},Object(E.jsx)(F.EuiFlexGroup,{gutterSize:"s",justifyContent:"spaceBetween"},Object(E.jsx)(F.EuiFlexItem,{grow:!1},Object(E.jsx)(F.EuiText,{size:"xs"},Object(E.jsx)("h4",null,_.i18n.translate("xpack.lens.xyChart.axisNameLabel",{defaultMessage:"Axis name"})))),Object(E.jsx)(F.EuiFlexItem,{grow:!1},Object(E.jsx)(F.EuiSwitch,{compressed:!0,"data-test-subj":`lnsShowAxisTitleSwitch__${t}`,label:_.i18n.translate("xpack.lens.xyChart.ShowAxisTitleLabel",{defaultMessage:"Show"}),onChange:({target:e})=>p(t,e.checked),checked:u}))),Object(E.jsx)(F.EuiSpacer,{size:"xs"}),Object(E.jsx)(F.EuiFieldText,{"data-test-subj":`lns${t}AxisTitle`,compressed:!0,placeholder:_.i18n.translate("xpack.lens.xyChart.overwriteAxisTitle",{defaultMessage:"Overwrite axis title"}),value:D||"",disabled:!u||!1,onChange:({target:e})=>N(e.value),"aria-label":_.i18n.translate("xpack.lens.xyChart.overwriteAxisTitle",{defaultMessage:"Overwrite axis title"})}),Object(E.jsx)(F.EuiSpacer,{size:"m"}),Object(E.jsx)(F.EuiSwitch,{compressed:!0,"data-test-subj":`lnsshow${t}AxisGridlines`,label:_.i18n.translate("xpack.lens.xyChart.Gridlines",{defaultMessage:"Gridlines"}),onChange:()=>r(t),checked:o}),Object(E.jsx)(F.EuiSpacer,{size:"m"}),Object(E.jsx)(F.EuiSwitch,{compressed:!0,"data-test-subj":`lnsshow${t}AxisTickLabels`,label:_.i18n.translate("xpack.lens.xyChart.tickLabels",{defaultMessage:"Tick labels"}),onChange:()=>i(t),checked:l}),Object(E.jsx)(F.EuiSpacer,{size:"s"}),Object(E.jsx)(F.EuiFormRow,{display:"rowCompressed",fullWidth:!0,label:_.i18n.translate("xpack.lens.xyChart.axisOrientation.label",{defaultMessage:"Orientation"})},Object(E.jsx)(F.EuiButtonGroup,{isFullWidth:!0,legend:_.i18n.translate("xpack.lens.xyChart.axisOrientation.label",{defaultMessage:"Orientation"}),"data-test-subj":"lnsXY_axisOrientation_groups",name:"axisOrientation",isDisabled:!l,buttonSize:"compressed",options:ot,idSelected:ot.find((({value:e})=>e===c)).id,onChange:e=>{const n=ot.find((({id:t})=>t===e)).value;d(t,n)}})),m&&Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiSpacer,{size:"m"}),Object(E.jsx)(F.EuiSwitch,{compressed:!0,"data-test-subj":"lnsshowEndzones",label:_.i18n.translate("xpack.lens.xyChart.showEnzones",{defaultMessage:"Show partial data markers"}),onChange:()=>m(!Boolean(g)),checked:Boolean(g)})),P&&b&&Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiSpacer,{size:"s"}),Object(E.jsx)(F.EuiFormRow,{display:"rowCompressed",fullWidth:!0,label:_.i18n.translate("xpack.lens.xyChart.axisExtent.label",{defaultMessage:"Bounds"}),helpText:x?_.i18n.translate("xpack.lens.xyChart.axisExtent.disabledDataBoundsMessage",{defaultMessage:"Only line charts can be fit to the data bounds"}):void 0},Object(E.jsx)(F.EuiButtonGroup,{isFullWidth:!0,legend:_.i18n.translate("xpack.lens.xyChart.axisExtent.label",{defaultMessage:"Bounds"}),"data-test-subj":"lnsXY_axisBounds_groups",name:"axisBounds",buttonSize:"compressed",options:[{id:`${ct}full`,label:_.i18n.translate("xpack.lens.xyChart.axisExtent.full",{defaultMessage:"Full"}),"data-test-subj":"lnsXY_axisExtent_groups_full"},{id:`${ct}dataBounds`,label:_.i18n.translate("xpack.lens.xyChart.axisExtent.dataBounds",{defaultMessage:"Data bounds"}),"data-test-subj":"lnsXY_axisExtent_groups_DataBounds",isDisabled:x},{id:`${ct}custom`,label:_.i18n.translate("xpack.lens.xyChart.axisExtent.custom",{defaultMessage:"Custom"}),"data-test-subj":"lnsXY_axisExtent_groups_custom",isDisabled:y}],idSelected:`${ct}${x&&"dataBounds"===P.mode||y?"full":P.mode}`,onChange:e=>{const t=e.replace(ct,"");S({...P,mode:t,lowerBound:"custom"===t&&j?Math.min(0,j.min):void 0,upperBound:"custom"===t&&j?j.max:void 0})}})),"custom"===P.mode&&!y&&Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiSpacer,{size:"s"}),Object(E.jsx)(F.EuiFlexGroup,{gutterSize:"s"},Object(E.jsx)(F.EuiFlexItem,null,Object(E.jsx)(F.EuiFormRow,{display:"rowCompressed",fullWidth:!0,label:_.i18n.translate("xpack.lens.xyChart.lowerBoundLabel",{defaultMessage:"Lower bound"}),isInvalid:A||L,helpText:x&&!A?_.i18n.translate("xpack.lens.xyChart.inclusiveZero",{defaultMessage:"Bounds must include zero."}):void 0,error:x&&A?_.i18n.translate("xpack.lens.xyChart.inclusiveZero",{defaultMessage:"Bounds must include zero."}):void 0},Object(E.jsx)(F.EuiFieldNumber,{compressed:!0,value:null!==(O=P.lowerBound)&&void 0!==O?O:"",isInvalid:A||L,"data-test-subj":"lnsXY_axisExtent_lowerBound",onChange:e=>{const t=Number(e.target.value);""===e.target.value||Number.isNaN(Number(t))?S({...P,lowerBound:void 0}):S({...P,lowerBound:t})},onBlur:()=>{void 0===P.lowerBound&&j&&S({...P,lowerBound:Math.min(0,j.min)})}}))),Object(E.jsx)(F.EuiFlexItem,null,Object(E.jsx)(F.EuiFormRow,{display:"rowCompressed",fullWidth:!0,label:_.i18n.translate("xpack.lens.xyChart.upperBoundLabel",{defaultMessage:"Upper bound"}),isInvalid:A||L,error:L?_.i18n.translate("xpack.lens.xyChart.boundaryError",{defaultMessage:"Lower bound has to be larger than upper bound"}):void 0},Object(E.jsx)(F.EuiFieldNumber,{compressed:!0,value:null!==(k=P.upperBound)&&void 0!==k?k:"","data-test-subj":"lnsXY_axisExtent_upperBound",onChange:e=>{const t=Number(e.target.value);""===e.target.value||Number.isNaN(Number(t))?S({...P,upperBound:void 0}):S({...P,upperBound:t})},onBlur:()=>{void 0===P.upperBound&&j&&S({...P,upperBound:j.max})}})))))))},pt=[{id:"value_labels_hide",value:"hide",label:_.i18n.translate("xpack.lens.xyChart.valueLabelsVisibility.auto",{defaultMessage:"Hide"}),"data-test-subj":"lnsXY_valueLabels_hide"},{id:"value_labels_inside",value:"inside",label:_.i18n.translate("xpack.lens.xyChart.valueLabelsVisibility.inside",{defaultMessage:"Show"}),"data-test-subj":"lnsXY_valueLabels_inside"}],mt=({onValueLabelChange:e,onFittingFnChange:t,valueLabels:n,fittingFunction:a,isValueLabelsEnabled:i=!0,isFittingEnabled:r=!0})=>{const s=n||"hide";return Object(E.jsx)(v.a.Fragment,null,i&&Object(E.jsx)(F.EuiFormRow,{display:"columnCompressed",label:Object(E.jsx)("span",null,_.i18n.translate("xpack.lens.shared.chartValueLabelVisibilityLabel",{defaultMessage:"Labels"}))},Object(E.jsx)(F.EuiButtonGroup,{isFullWidth:!0,legend:_.i18n.translate("xpack.lens.shared.chartValueLabelVisibilityLabel",{defaultMessage:"Labels"}),"data-test-subj":"lnsValueLabelsDisplay",name:"valueLabelsDisplay",buttonSize:"compressed",options:pt,idSelected:pt.find((({value:e})=>e===s)).id,onChange:t=>{const n=pt.find((({id:e})=>e===t)).value;e(n)}})),r&&Object(E.jsx)(F.EuiFormRow,{display:"columnCompressed",label:Object(E.jsx)(v.a.Fragment,null,_.i18n.translate("xpack.lens.xyChart.missingValuesLabel",{defaultMessage:"Missing values"})," ",Object(E.jsx)(F.EuiIconTip,{color:"subdued",content:_.i18n.translate("xpack.lens.xyChart.missingValuesLabelHelpText",{defaultMessage:"By default, Lens hides the gaps in the data. To fill the gap, make a selection."}),iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"}))},Object(E.jsx)(F.EuiSuperSelect,{"data-test-subj":"lnsMissingValuesSelect",compressed:!0,options:D.a.map((({id:e,title:t,description:n})=>({value:e,dropdownDisplay:Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)("strong",null,t),Object(E.jsx)(F.EuiText,{size:"xs",color:"subdued"},Object(E.jsx)("p",null,n))),inputDisplay:t}))),valueOfSelected:a||"None",onChange:e=>t(e),itemLayoutAlign:"top",hasDividers:!0})))},gt=({onChange:e,value:t,isCurveTypeEnabled:n=!0})=>n?Object(E.jsx)(F.EuiFormRow,{display:"columnCompressedSwitch",label:_.i18n.translate("xpack.lens.xyChart.curveStyleLabel",{defaultMessage:"Curve lines"})},Object(E.jsx)(F.EuiSwitch,{showLabel:!1,label:"Curved",checked:"CURVE_MONOTONE_X"===t,compressed:!0,onChange:t=>{t.target.checked?e("CURVE_MONOTONE_X"):e("LINEAR")},"data-test-subj":"lnsCurveStyleToggle"})):null,ft=({onChange:e,value:t,isFillOpacityEnabled:n=!0})=>{const{inputValue:a,handleInputChange:i}=Object(M.q)({value:t,onChange:e});return n?Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiFormRow,{display:"columnCompressed",label:_.i18n.translate("xpack.lens.xyChart.fillOpacityLabel",{defaultMessage:"Fill opacity"}),fullWidth:!0},Object(E.jsx)(F.EuiRange,{"data-test-subj":"lnsFillOpacity",value:a,min:.1,max:1,step:.1,showInput:!0,compressed:!0,fullWidth:!0,onChange:e=>{i(Number(e.currentTarget.value))}}))):null};const bt=({state:e,setState:t,datasourceLayers:n})=>{var a;const i=null==e?void 0:e.layers.some((({seriesType:e})=>"area_percentage_stacked"===e)),r=null==e?void 0:e.layers.some((({seriesType:e})=>["area_stacked","area","line"].includes(e))),s=null==e?void 0:e.layers.some((({seriesType:e})=>["bar","bar_horizontal"].includes(e))),l=null==e?void 0:e.layers.some((({seriesType:e})=>["area_stacked","area","area_percentage_stacked"].includes(e))),o=Boolean(function(e=[],t){return!!t&&e.filter((({accessors:e})=>e.length)).some((({layerId:e,xAccessor:n})=>{const a=t[e].getOperationForColumnId(n);return a&&a.isBucketed&&a.scale&&"ordinal"!==a.scale}))}(null==e?void 0:e.layers,n)),u=!r&&s&&!o,c=r,d=r||i,p=function({isAreaPercentage:e,isHistogramSeries:t}){return t?_.i18n.translate("xpack.lens.xyChart.valuesHistogramDisabledHelpText",{defaultMessage:"This setting cannot be changed on histograms."}):e?_.i18n.translate("xpack.lens.xyChart.valuesPercentageDisabledHelpText",{defaultMessage:"This setting cannot be changed on percentage area charts."}):_.i18n.translate("xpack.lens.xyChart.valuesStackedDisabledHelpText",{defaultMessage:"This setting cannot be changed on stacked or percentage bar charts"})}({isAreaPercentage:i,isHistogramSeries:o}),m=!u&&!c&&!d;return Object(E.jsx)(M.k,{tooltipContent:p,condition:m},Object(E.jsx)(M.j,{title:_.i18n.translate("xpack.lens.shared.curveLabel",{defaultMessage:"Visual options"}),type:"visualOptions",groupPosition:"left",buttonDataTestSubj:"lnsVisualOptionsButton",isDisabled:m},Object(E.jsx)(gt,{isCurveTypeEnabled:d,value:null==e?void 0:e.curveType,onChange:n=>{t({...e,curveType:n})}}),Object(E.jsx)(mt,{isValueLabelsEnabled:u,isFittingEnabled:c,valueLabels:null==e?void 0:e.valueLabels,fittingFunction:null==e?void 0:e.fittingFunction,onValueLabelChange:n=>{t({...e,valueLabels:n})},onFittingFnChange:n=>{t({...e,fittingFunction:n})}}),Object(E.jsx)(ft,{isFillOpacityEnabled:l,value:null!==(a=null==e?void 0:e.fillOpacity)&&void 0!==a?a:.3,onChange:n=>{t({...e,fillOpacity:n})}})))};function xt(e,t,n){const a=[...e.layers];return a[n]=t,{...e,layers:a}}const ht=[{id:"xy_legend_auto",value:"auto",label:_.i18n.translate("xpack.lens.xyChart.legendVisibility.auto",{defaultMessage:"Auto"})},{id:"xy_legend_show",value:"show",label:_.i18n.translate("xpack.lens.xyChart.legendVisibility.show",{defaultMessage:"Show"})},{id:"xy_legend_hide",value:"hide",label:_.i18n.translate("xpack.lens.xyChart.legendVisibility.hide",{defaultMessage:"Hide"})}];function vt(e,t,n){var a;return Boolean(null===(a=e.find((e=>e.groupId===t)))||void 0===a?void 0:a.series.some((({layer:e})=>null==n?void 0:n.layers.find((t=>t.layerId===e&&t.seriesType.includes("percentage"))))))}const yt=Object(h.memo)((function(e){var t,n,a,i,r,s,l,o,u,c,d,p,m,g,f,b,x,v,y,j,O,k,I,w,T,C,P,S,A;const{state:L,setState:D,frame:N}=e,z=!(null==L||!L.layers.length)&&Pe(L.layers),B=He(null==L?void 0:L.layers,z,N.activeData),R=function(e,t){const n={};return t.forEach((t=>{let a=Number.MAX_VALUE,i=Number.MIN_VALUE;t.series.forEach((t=>{var n;null==e||null===(n=e[t.layer])||void 0===n||n.rows.forEach((e=>{const n=e[t.accessor];Number.isNaN(n)||(n<a&&(a=n),n>i&&(i=n))}))})),a!==Number.MAX_VALUE&&i!==Number.MIN_VALUE&&(n[t.groupId]={min:Math.round(100*(a+Number.EPSILON))/100,max:Math.round(100*(i+Number.EPSILON))/100})})),n}(N.activeData,B),V={x:null===(t=null==L||null===(n=L.tickLabelsVisibilitySettings)||void 0===n?void 0:n.x)||void 0===t||t,yLeft:null===(a=null==L||null===(i=L.tickLabelsVisibilitySettings)||void 0===i?void 0:i.yLeft)||void 0===a||a,yRight:null===(r=null==L||null===(s=L.tickLabelsVisibilitySettings)||void 0===s?void 0:s.yRight)||void 0===r||r},H=e=>{const t={...V,[e]:!V[e]};D({...L,tickLabelsVisibilitySettings:t})},G={x:null===(l=null==L||null===(o=L.gridlinesVisibilitySettings)||void 0===o?void 0:o.x)||void 0===l||l,yLeft:null===(u=null==L||null===(c=L.gridlinesVisibilitySettings)||void 0===c?void 0:c.yLeft)||void 0===u||u,yRight:null===(d=null==L||null===(p=L.gridlinesVisibilitySettings)||void 0===p?void 0:p.yRight)||void 0===d||d},q=e=>{const t={...G,[e]:!G[e]};D({...L,gridlinesVisibilitySettings:t})},W={x:null!==(m=null==L||null===(g=L.labelsOrientation)||void 0===g?void 0:g.x)&&void 0!==m?m:0,yLeft:null!==(f=null==L||null===(b=L.labelsOrientation)||void 0===b?void 0:b.yLeft)&&void 0!==f?f:0,yRight:null!==(x=null==L||null===(v=L.labelsOrientation)||void 0===v?void 0:v.yRight)&&void 0!==x?x:0},$=(e,t)=>{const n={...W,[e]:t};D({...L,labelsOrientation:n})},Y={x:null===(y=null==L||null===(j=L.axisTitlesVisibilitySettings)||void 0===j?void 0:j.x)||void 0===y||y,yLeft:null===(O=null==L||null===(k=L.axisTitlesVisibilitySettings)||void 0===k?void 0:k.yLeft)||void 0===O||O,yRight:null===(I=null==L||null===(w=L.axisTitlesVisibilitySettings)||void 0===w?void 0:w.yRight)||void 0===I||I},K=(e,t)=>{const n={...Y,[e]:t};D({...L,axisTitlesVisibilitySettings:n})},U=null==L?void 0:L.layers.every((t=>!t.xAccessor||"ordinal"!==tt(e.frame.datasourceLayers[t.layerId].getOperationForColumnId(t.xAccessor),oe.ScaleType.Linear))),X=null!=L&&L.layers.every((t=>t.xAccessor&&"time"===tt(e.frame.datasourceLayers[t.layerId].getOperationForColumnId(t.xAccessor),oe.ScaleType.Linear)))?e=>{D({...L,hideEndzones:!e})}:void 0,Q=null==L||!L.legend.isVisible||null!=L&&L.legend.showSingleSeries?null!=L&&L.legend.isVisible?"show":"hide":"auto",Z=Boolean(null===(T=B.find((e=>"left"===e.groupId)))||void 0===T||null===(C=T.series)||void 0===C?void 0:C.some((e=>{var t;const n=null===(t=L.layers.find((t=>t.layerId===e.layer)))||void 0===t?void 0:t.seriesType;return(null==n?void 0:n.includes("bar"))||(null==n?void 0:n.includes("area"))}))),J=Object(h.useCallback)((e=>{D({...L,yLeftExtent:e})}),[D,L]),ee=Boolean(null===(P=B.find((e=>"left"===e.groupId)))||void 0===P||null===(S=P.series)||void 0===S?void 0:S.some((e=>{var t;const n=null===(t=L.layers.find((t=>t.layerId===e.layer)))||void 0===t?void 0:t.seriesType;return(null==n?void 0:n.includes("bar"))||(null==n?void 0:n.includes("area"))}))),te=Object(h.useCallback)((e=>{D({...L,yRightExtent:e})}),[D,L]);return Object(E.jsx)(F.EuiFlexGroup,{gutterSize:"m",justifyContent:"spaceBetween",responsive:!1},Object(E.jsx)(F.EuiFlexItem,null,Object(E.jsx)(F.EuiFlexGroup,{gutterSize:"none",responsive:!1},Object(E.jsx)(bt,{state:L,setState:D,datasourceLayers:N.datasourceLayers}),Object(E.jsx)(M.f,{legendOptions:ht,mode:Q,location:null!=L&&L.legend.isInside?"inside":"outside",onLocationChange:e=>{D({...L,legend:{...L.legend,isInside:"inside"===e}})},onDisplayChange:e=>{const t=ht.find((({id:t})=>t===e)).value;"auto"===t?D({...L,legend:{...L.legend,isVisible:!0,showSingleSeries:!1}}):"show"===t?D({...L,legend:{...L.legend,isVisible:!0,showSingleSeries:!0}}):"hide"===t&&D({...L,legend:{...L.legend,isVisible:!1,showSingleSeries:!1}})},position:null==L?void 0:L.legend.position,horizontalAlignment:null==L?void 0:L.legend.horizontalAlignment,verticalAlignment:null==L?void 0:L.legend.verticalAlignment,floatingColumns:null==L?void 0:L.legend.floatingColumns,onFloatingColumnsChange:e=>{D({...L,legend:{...L.legend,floatingColumns:e}})},maxLines:null==L?void 0:L.legend.maxLines,onMaxLinesChange:e=>{D({...L,legend:{...L.legend,maxLines:e}})},shouldTruncate:null===(A=null==L?void 0:L.legend.shouldTruncate)||void 0===A||A,onTruncateLegendChange:()=>{var e;const t=null===(e=null==L?void 0:L.legend.shouldTruncate)||void 0===e||e;D({...L,legend:{...L.legend,shouldTruncate:!t}})},onPositionChange:e=>{D({...L,legend:{...L.legend,position:e}})},onAlignmentChange:e=>{const[t,n]=e.split("_"),a=t,i=n;D({...L,legend:{...L.legend,verticalAlignment:a,horizontalAlignment:i}})},renderValueInLegendSwitch:U,valueInLegend:null==L?void 0:L.valuesInLegend,onValueInLegendChange:()=>{D({...L,valuesInLegend:!L.valuesInLegend})}}))),Object(E.jsx)(F.EuiFlexItem,null,Object(E.jsx)(F.EuiFlexGroup,{gutterSize:"none",responsive:!1},Object(E.jsx)(M.k,{tooltipContent:z?_.i18n.translate("xpack.lens.xyChart.bottomAxisDisabledHelpText",{defaultMessage:"This setting only applies when bottom axis is enabled."}):_.i18n.translate("xpack.lens.xyChart.leftAxisDisabledHelpText",{defaultMessage:"This setting only applies when left axis is enabled."}),condition:0===Object.keys(B.find((e=>"left"===e.groupId))||{}).length},Object(E.jsx)(dt,{axis:"yLeft",layers:null==L?void 0:L.layers,axisTitle:null==L?void 0:L.yTitle,updateTitleState:e=>D({...L,yTitle:e}),areTickLabelsVisible:V.yLeft,toggleTickLabelsVisibility:H,areGridlinesVisible:G.yLeft,toggleGridlinesVisibility:q,isDisabled:0===Object.keys(B.find((e=>"left"===e.groupId))||{}).length,orientation:W.yLeft,setOrientation:$,isAxisTitleVisible:Y.yLeft,toggleAxisTitleVisibility:K,extent:(null==L?void 0:L.yLeftExtent)||{mode:"full"},setExtent:J,hasBarOrAreaOnAxis:Z,dataBounds:R.left,hasPercentageAxis:vt(B,"left",L)})),Object(E.jsx)(dt,{axis:"x",layers:null==L?void 0:L.layers,axisTitle:null==L?void 0:L.xTitle,updateTitleState:e=>D({...L,xTitle:e}),areTickLabelsVisible:V.x,toggleTickLabelsVisibility:H,areGridlinesVisible:G.x,toggleGridlinesVisibility:q,orientation:W.x,setOrientation:$,isAxisTitleVisible:Y.x,toggleAxisTitleVisibility:K,endzonesVisible:!(null!=L&&L.hideEndzones),setEndzoneVisibility:X,hasBarOrAreaOnAxis:!1,hasPercentageAxis:!1}),Object(E.jsx)(M.k,{tooltipContent:z?_.i18n.translate("xpack.lens.xyChart.topAxisDisabledHelpText",{defaultMessage:"This setting only applies when top axis is enabled."}):_.i18n.translate("xpack.lens.xyChart.rightAxisDisabledHelpText",{defaultMessage:"This setting only applies when right axis is enabled."}),condition:0===Object.keys(B.find((e=>"right"===e.groupId))||{}).length},Object(E.jsx)(dt,{axis:"yRight",layers:null==L?void 0:L.layers,axisTitle:null==L?void 0:L.yRightTitle,updateTitleState:e=>D({...L,yRightTitle:e}),areTickLabelsVisible:V.yRight,toggleTickLabelsVisibility:H,areGridlinesVisible:G.yRight,toggleGridlinesVisibility:q,isDisabled:0===Object.keys(B.find((e=>"right"===e.groupId))||{}).length,orientation:W.yRight,setOrientation:$,hasPercentageAxis:vt(B,"right",L),isAxisTitleVisible:Y.yRight,toggleAxisTitleVisibility:K,extent:(null==L?void 0:L.yRightExtent)||{mode:"full"},setExtent:te,hasBarOrAreaOnAxis:ee,dataBounds:R.right})))))})),jt=Object(F.htmlIdGenerator)()();function _t(e){var t,n;const{state:a,setState:i,layerId:r,accessor:s}=e,l=a.layers.findIndex((e=>e.layerId===r)),o=a.layers[l],u=Pe(a.layers),c=o.yConfig&&(null===(t=o.yConfig)||void 0===t||null===(n=t.find((e=>e.forAccessor===s)))||void 0===n?void 0:n.axisMode)||"auto";return"breakdown"===e.groupId?Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(M.h,{palettes:e.paletteService,activePalette:o.palette,setPalette:e=>{i(xt(a,{...o,palette:e},l))}})):o.layerType===$.i.REFERENCELINE?Object(E.jsx)(Mt,x()({},e,{isHorizontal:u})):Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(kt,e),Object(E.jsx)(F.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:_.i18n.translate("xpack.lens.xyChart.axisSide.label",{defaultMessage:"Axis side"})},Object(E.jsx)(F.EuiButtonGroup,{isFullWidth:!0,legend:_.i18n.translate("xpack.lens.xyChart.axisSide.label",{defaultMessage:"Axis side"}),"data-test-subj":"lnsXY_axisSide_groups",name:"axisSide",buttonSize:"compressed",options:[{id:`${jt}auto`,label:_.i18n.translate("xpack.lens.xyChart.axisSide.auto",{defaultMessage:"Auto"}),"data-test-subj":"lnsXY_axisSide_groups_auto"},{id:`${jt}left`,label:u?_.i18n.translate("xpack.lens.xyChart.axisSide.bottom",{defaultMessage:"Bottom"}):_.i18n.translate("xpack.lens.xyChart.axisSide.left",{defaultMessage:"Left"}),"data-test-subj":"lnsXY_axisSide_groups_left"},{id:`${jt}right`,label:u?_.i18n.translate("xpack.lens.xyChart.axisSide.top",{defaultMessage:"Top"}):_.i18n.translate("xpack.lens.xyChart.axisSide.right",{defaultMessage:"Right"}),"data-test-subj":"lnsXY_axisSide_groups_right"}],idSelected:`${jt}${c}`,onChange:e=>{const t=e.replace(jt,""),n=[...o.yConfig||[]],r=n.findIndex((e=>e.forAccessor===s));-1!==r?n[r]={...n[r],axisMode:t}:n.push({forAccessor:s,axisMode:t}),i(xt(a,{...o,yConfig:n},l))}})))}const Ot={auto:_.i18n.translate("xpack.lens.configPanel.color.tooltip.auto",{defaultMessage:"Lens automatically picks colors for you unless you specify a custom color."}),custom:_.i18n.translate("xpack.lens.configPanel.color.tooltip.custom",{defaultMessage:"Clear the custom color to return to “Auto” mode."}),disabled:_.i18n.translate("xpack.lens.configPanel.color.tooltip.disabled",{defaultMessage:"Individual series cannot be custom colored when the layer includes a “Break down by.“"})},kt=({state:e,setState:t,layerId:n,accessor:a,frame:i,formatFactory:r,paletteService:s,label:l,disableHelpTooltip:o})=>{const u=e.layers.findIndex((e=>e.layerId===n)),c=e.layers[u],d=Boolean(c.splitAccessor),p=Ae(c,a),m=Object(h.useMemo)((()=>{var t;if(p||!i.activeData)return p;if(c.layerType===$.i.REFERENCELINE)return $e;const n=i.datasourceLayers[c.layerId],l=Je(n,c);return(null===(t=Ke(Ye(e.layers,{tables:i.activeData},r),i,{...c,accessors:l.filter((e=>c.accessors.includes(e)))},s).find((e=>e.columnId===a)))||void 0===t?void 0:t.color)||null}),[p,i,s,e.layers,a,r,c]),[g,f]=Object(h.useState)(m),b=Object(h.useMemo)((()=>Object(Z.debounce)(((n,i)=>{const r=[...c.yConfig||[]],s=r.findIndex((e=>e.forAccessor===a));-1!==s?r[s]=""===n?{...r[s],color:void 0}:{...r[s],color:i.hex}:r.push({forAccessor:a,color:i.hex}),t(xt(e,{...c,yConfig:r},u))}),256)),[e,t,c,a,u]),x=null!=l?l:_.i18n.translate("xpack.lens.xyChart.seriesColor.label",{defaultMessage:"Series color"}),y=Object(E.jsx)(F.EuiColorPicker,{"data-test-subj":"indexPattern-dimension-colorPicker",compressed:!0,isClearable:Boolean(p),onChange:(e,t)=>{f(e),(t.isValid||""===e)&&b(e,t)},color:d?"":g||m,disabled:d,placeholder:_.i18n.translate("xpack.lens.xyChart.seriesColor.auto",{defaultMessage:"Auto"}),"aria-label":x});return Object(E.jsx)(F.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:Object(E.jsx)(M.k,{delay:"long",position:"top",tooltipContent:g&&!d?Ot.custom:Ot.auto,condition:!o},Object(E.jsx)("span",null,x,!o&&Object(E.jsx)(v.a.Fragment,null,"",Object(E.jsx)(F.EuiIcon,{type:"questionInCircle",color:"subdued",size:"s",className:"eui-alignTop"}))))},d?Object(E.jsx)(F.EuiToolTip,{position:"top",content:Ot.disabled,delay:"long",anchorClassName:"eui-displayBlock"},y):y)},It=[{value:"none",label:_.i18n.translate("xpack.lens.xyChart.referenceLine.noIconLabel",{defaultMessage:"None"})},{value:"asterisk",label:_.i18n.translate("xpack.lens.xyChart.referenceLine.asteriskIconLabel",{defaultMessage:"Asterisk"})},{value:"bell",label:_.i18n.translate("xpack.lens.xyChart.referenceLine.bellIconLabel",{defaultMessage:"Bell"})},{value:"bolt",label:_.i18n.translate("xpack.lens.xyChart.referenceLine.boltIconLabel",{defaultMessage:"Bolt"})},{value:"bug",label:_.i18n.translate("xpack.lens.xyChart.referenceLine.bugIconLabel",{defaultMessage:"Bug"})},{value:"editorComment",label:_.i18n.translate("xpack.lens.xyChart.referenceLine.commentIconLabel",{defaultMessage:"Comment"})},{value:"alert",label:_.i18n.translate("xpack.lens.xyChart.referenceLine.alertIconLabel",{defaultMessage:"Alert"})},{value:"flag",label:_.i18n.translate("xpack.lens.xyChart.referenceLine.flagIconLabel",{defaultMessage:"Flag"})},{value:"tag",label:_.i18n.translate("xpack.lens.xyChart.referenceLine.tagIconLabel",{defaultMessage:"Tag"})}],Ft=e=>e.value?Object(E.jsx)("span",null,Object(E.jsx)(F.EuiIcon,{type:e.value}),` ${e.label}`):null,wt=({value:e,onChange:t})=>{const n=It.find((t=>e===t.value))||It[0];return Object(E.jsx)(F.EuiComboBox,{isClearable:!1,options:It,selectedOptions:[n],onChange:e=>{t(e[0].value)},singleSelection:{asPlainText:!0},renderOption:Ft,compressed:!0})};function Tt({isHorizontal:e,axisMode:t}){const n=_.i18n.translate("xpack.lens.xyChart.referenceLineFill.above",{defaultMessage:"Above"}),a=_.i18n.translate("xpack.lens.xyChart.referenceLineFill.below",{defaultMessage:"Below"}),i=_.i18n.translate("xpack.lens.xyChart.referenceLineFill.before",{defaultMessage:"Before"}),r=_.i18n.translate("xpack.lens.xyChart.referenceLineFill.after",{defaultMessage:"After"}),s="bottom"===t||e?r:n,l="bottom"===t||e?i:a;return[{id:`${jt}none`,label:_.i18n.translate("xpack.lens.xyChart.referenceLineFill.none",{defaultMessage:"None"}),"data-test-subj":"lnsXY_referenceLine_fill_none"},{id:`${jt}above`,label:s,"data-test-subj":"lnsXY_referenceLine_fill_above"},{id:`${jt}below`,label:l,"data-test-subj":"lnsXY_referenceLine_fill_below"}]}function Et({isHorizontal:e,axisMode:t}){const n=[{id:`${jt}auto`,label:_.i18n.translate("xpack.lens.xyChart.referenceLineMarker.auto",{defaultMessage:"Auto"}),"data-test-subj":"lnsXY_referenceLine_markerPosition_auto"}],a=_.i18n.translate("xpack.lens.xyChart.markerPosition.above",{defaultMessage:"Top"}),i=_.i18n.translate("xpack.lens.xyChart.markerPosition.below",{defaultMessage:"Bottom"}),r=_.i18n.translate("xpack.lens.xyChart.markerPosition.left",{defaultMessage:"Left"}),s=_.i18n.translate("xpack.lens.xyChart.markerPosition.right",{defaultMessage:"Right"});if("bottom"===t){const t=[{id:`${jt}above`,label:e?s:a,"data-test-subj":"lnsXY_referenceLine_markerPosition_above"},{id:`${jt}below`,label:e?r:i,"data-test-subj":"lnsXY_referenceLine_markerPosition_below"}];return e&&t.reverse(),[...n,...t]}const l=[{id:`${jt}left`,label:e?i:r,"data-test-subj":"lnsXY_referenceLine_markerPosition_left"},{id:`${jt}right`,label:e?a:s,"data-test-subj":"lnsXY_referenceLine_markerPosition_right"}];return e&&l.reverse(),[...n,...l]}function Ct(e){return null!=e&&"none"!==e}const Mt=e=>{var t;const{state:n,setState:a,layerId:i,accessor:r,isHorizontal:s}=e,{inputValue:l,handleInputChange:o}=Object(M.q)({value:n,onChange:a}),u=l.layers.findIndex((e=>e.layerId===i)),c=l.layers[u],d=Object(h.useCallback)((e=>{if(null==e)return;const t=[...c.yConfig||[]],n=t.findIndex((e=>e.forAccessor===r));-1!==n?t[n]={...t[n],...e}:t.push({forAccessor:r,...e}),o(xt(l,{...c,yConfig:t},u))}),[r,u,l,c,o]),p=null===(t=c.yConfig)||void 0===t?void 0:t.find((e=>e.forAccessor===r));return Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiFormRow,{label:_.i18n.translate("xpack.lens.referenceLineMarker.textVisibility",{defaultMessage:"Show display name"}),display:"columnCompressedSwitch"},Object(E.jsx)(F.EuiSwitch,{compressed:!0,label:_.i18n.translate("xpack.lens.referenceLineMarker.textVisibility",{defaultMessage:"Show display name"}),showLabel:!1,"data-test-subj":"lns-referenceLineMaker-text-visibility",checked:Boolean(null==p?void 0:p.textVisibility),onChange:()=>{d({forAccessor:r,textVisibility:!(null!=p&&p.textVisibility)})}})),Object(E.jsx)(F.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:_.i18n.translate("xpack.lens.xyChart.referenceLineMarker.icon",{defaultMessage:"Icon"})},Object(E.jsx)(wt,{value:null==p?void 0:p.icon,onChange:e=>{d({forAccessor:r,icon:e})}})),Object(E.jsx)(F.EuiFormRow,{display:"columnCompressed",fullWidth:!0,isDisabled:!(Ct(null==p?void 0:p.icon)||null!=p&&p.textVisibility),label:_.i18n.translate("xpack.lens.xyChart.referenceLineMarker.position",{defaultMessage:"Decoration position"})},Object(E.jsx)(M.k,{tooltipContent:_.i18n.translate("xpack.lens.referenceLineMarker.positionRequirementTooltip",{defaultMessage:"You must select an icon or show the display name in order to alter its position"}),condition:!(Ct(null==p?void 0:p.icon)||null!=p&&p.textVisibility),position:"top",delay:"regular",display:"block"},Object(E.jsx)(F.EuiButtonGroup,{isFullWidth:!0,legend:_.i18n.translate("xpack.lens.xyChart.referenceLineMarker.position",{defaultMessage:"Decoration position"}),"data-test-subj":"lnsXY_markerPosition_referenceLine",name:"markerPosition",isDisabled:!(Ct(null==p?void 0:p.icon)||null!=p&&p.textVisibility),buttonSize:"compressed",options:Et({isHorizontal:s,axisMode:p.axisMode}),idSelected:`${jt}${(null==p?void 0:p.iconPosition)||"auto"}`,onChange:e=>{const t=e.replace(jt,"");d({forAccessor:r,iconPosition:t})}}))),Object(E.jsx)(kt,x()({},e,{disableHelpTooltip:!0,label:_.i18n.translate("xpack.lens.xyChart.referenceLineColor.label",{defaultMessage:"Color"})})),Object(E.jsx)(F.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:_.i18n.translate("xpack.lens.xyChart.referenceLineStyle.label",{defaultMessage:"Line style"})},Object(E.jsx)(F.EuiButtonGroup,{isFullWidth:!0,legend:_.i18n.translate("xpack.lens.xyChart.referenceLineStyle.label",{defaultMessage:"Line style"}),"data-test-subj":"lnsXY_line_style",name:"lineStyle",buttonSize:"compressed",options:[{id:`${jt}solid`,label:_.i18n.translate("xpack.lens.xyChart.referenceLineStyle.solid",{defaultMessage:"Solid"}),"data-test-subj":"lnsXY_line_style_solid"},{id:`${jt}dashed`,label:_.i18n.translate("xpack.lens.xyChart.referenceLineStyle.dashed",{defaultMessage:"Dashed"}),"data-test-subj":"lnsXY_line_style_dashed"},{id:`${jt}dotted`,label:_.i18n.translate("xpack.lens.xyChart.referenceLineStyle.dotted",{defaultMessage:"Dotted"}),"data-test-subj":"lnsXY_line_style_dotted"}],idSelected:`${jt}${(null==p?void 0:p.lineStyle)||"solid"}`,onChange:e=>{const t=e.replace(jt,"");d({forAccessor:r,lineStyle:t})}})),Object(E.jsx)(F.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:_.i18n.translate("xpack.lens.xyChart.referenceLineThickness.label",{defaultMessage:"Line thickness"})},Object(E.jsx)(St,{value:(null==p?void 0:p.lineWidth)||1,onChange:e=>{d({forAccessor:r,lineWidth:e})}})),Object(E.jsx)(F.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:_.i18n.translate("xpack.lens.xyChart.referenceLineFill.label",{defaultMessage:"Fill"})},Object(E.jsx)(F.EuiButtonGroup,{isFullWidth:!0,legend:_.i18n.translate("xpack.lens.xyChart.referenceLineFill.label",{defaultMessage:"Fill"}),"data-test-subj":"lnsXY_referenceLine_fill",name:"fill",buttonSize:"compressed",options:Tt({isHorizontal:s,axisMode:null==p?void 0:p.axisMode}),idSelected:`${jt}${(null==p?void 0:p.fill)||"none"}`,onChange:e=>{const t=e.replace(jt,"");d({forAccessor:r,fill:t})}})))};function Pt(e,t,n,a){return""===e?t:Math.max(1,Math.min(e,10))}const St=({value:e,onChange:t})=>{const[n,a]=Object(h.useState)(String(e));return Object(E.jsx)(F.EuiRange,{fullWidth:!0,"data-test-subj":"lnsXY_referenceLineThickness",value:n,showInput:!0,min:1,max:10,step:1,compressed:!0,onChange:({currentTarget:{value:e}})=>{a(e);const n=""===e?"":Number(e),i=Pt(Number(e),Number(e));n===i&&t(i)},onBlur:()=>{if(n!==String(e)){const i=Pt(""===n?n:Number(n),e);t(i),a(String(i))}}})},At=20,Lt=(e,t,n,a,i)=>{const r={};if((null==t||!t.x)&&(null==n||!n.x)&&e.bottom){r[i?Nt("bottom"):"bottom"]=e.bottom}if(e.left&&(i||(null==t||!t.yLeft)&&(null==n||!n.yLeft))){r[i?Nt("left"):"left"]=e.left}if(e.right&&(i||!a.right||(null==t||!t.yRight)&&(null==n||!n.yRight))){r[i?Nt("right"):"right"]=e.right}if(e.top){r[i?Nt("top"):"top"]=e.top}return r},Dt=(e,t)=>{const n={},a={};return e.forEach((e=>{var i;null===(i=e.yConfig)||void 0===i||i.forEach((({axisMode:e,icon:i,iconPosition:r,textVisibility:s})=>{if(e&&(Ct(i)||s)){const l=zt(r,e,t);n[l]=Math.max(n[l]||0,At*(s?2:1)),a[l]=(a[l]||0)+(Ct(i)?1:0)}}))})),Object.keys(n).forEach((e=>{a[e]||(n[e]=At)})),n};function Nt(e){switch(e){case oe.Position.Top:return oe.Position.Right;case oe.Position.Bottom:return oe.Position.Left;case oe.Position.Left:return oe.Position.Bottom;case oe.Position.Right:return oe.Position.Top}}function zt(e,t,n){return"auto"===e?"bottom"===t?oe.Position.Top:"left"===t?n.right?oe.Position.Left:oe.Position.Right:n.left?oe.Position.Right:oe.Position.Left:"left"===e?oe.Position.Left:"right"===e?oe.Position.Right:"below"===e?oe.Position.Bottom:oe.Position.Top}function Bt(e,t){if(e)return t?Object(E.jsx)("div",{className:"eui-textTruncate",style:{maxWidth:3*At}},e):Object(E.jsx)("div",{className:"lnsXyDecorationRotatedWrapper",style:{width:At}},Object(E.jsx)("div",{className:"eui-textTruncate lnsXyDecorationRotatedWrapper__label",style:{maxWidth:3*At}},e))}function Rt(e,t,n,a){return Ct(e.icon)?Object(E.jsx)(F.EuiIcon,{type:e.icon}):e.textVisibility?a?Bt(t,!n&&"bottom"===e.axisMode||n&&"bottom"!==e.axisMode):Object(E.jsx)(F.EuiIcon,{type:"empty"}):void 0}const Vt=({layers:e,data:t,formatters:n,paletteService:a,syncColors:i,axesMap:r,isHorizontal:s,paddingMap:l})=>Object(E.jsx)(v.a.Fragment,null,e.flatMap((e=>{if(!e.yConfig)return[];const{columnToLabel:a,yConfig:i,layerId:o}=e,u=a?JSON.parse(a):{},c=t.tables[o],d=c.rows[0],p=i.sort((({forAccessor:e},{forAccessor:t})=>d[e]-d[t])),m=Object(Z.groupBy)(p,"fill");return m.below&&m.below.reverse(),p.flatMap(((e,t)=>{const a="bottom"===e.axisMode?void 0:"right"===e.axisMode?"right":"left",i=n[a||"bottom"],p=qe.euiLightVars.euiColorDarkShade,g=zt(e.iconPosition,e.axisMode,r),f=l[g]===At,b={groupId:a,marker:Rt(e,u[e.forAccessor],s,f),markerBody:Bt(e.textVisibility&&!f?u[e.forAccessor]:void 0,!s&&"bottom"===e.axisMode||s&&"bottom"!==e.axisMode),markerPosition:s?Nt(g):g},h=[],v="dashed"===e.lineStyle?[3*(e.lineWidth||1),e.lineWidth||1]:"dotted"===e.lineStyle?[e.lineWidth||1,e.lineWidth||1]:void 0,y={strokeWidth:e.lineWidth||1,stroke:e.color||p,dash:v};if(h.push(Object(E.jsx)(oe.LineAnnotation,x()({},b,{id:`${o}-${e.forAccessor}-line`,key:`${o}-${e.forAccessor}-line`,dataValues:c.rows.map((()=>({dataValue:d[e.forAccessor],header:u[e.forAccessor],details:(null==i?void 0:i.convert(d[e.forAccessor]))||d[e.forAccessor]}))),domainType:"bottom"===e.axisMode?oe.AnnotationDomainType.XDomain:oe.AnnotationDomainType.YDomain,style:{line:{...y,opacity:1}}}))),e.fill&&"none"!==e.fill){const t="above"===e.fill,n=m[e.fill].findIndex((({forAccessor:t})=>t===e.forAccessor)),a=n<m[e.fill].length-1;h.push(Object(E.jsx)(oe.RectAnnotation,x()({},b,{id:`${o}-${e.forAccessor}-rect`,key:`${o}-${e.forAccessor}-rect`,dataValues:c.rows.map((()=>{const r=a?d[m[e.fill][n+1].forAccessor]:void 0;return"bottom"===e.axisMode?{coordinates:{x0:t?d[e.forAccessor]:r,y0:void 0,x1:t?r:d[e.forAccessor],y1:void 0},header:u[e.forAccessor],details:(null==i?void 0:i.convert(d[e.forAccessor]))||d[e.forAccessor]}:{coordinates:{x0:void 0,y0:t?d[e.forAccessor]:r,x1:void 0,y1:t?r:d[e.forAccessor]},header:u[e.forAccessor],details:(null==i?void 0:i.convert(d[e.forAccessor]))||d[e.forAccessor]}})),style:{...y,fill:e.color||p,opacity:.1}})))}return h}))})));function Ht(e,{isHorizontal:t}){const n=_.i18n.translate("xpack.lens.xyChart.verticalAxisLabel",{defaultMessage:"Vertical axis"}),a=_.i18n.translate("xpack.lens.xyChart.horizontalAxisLabel",{defaultMessage:"Horizontal axis"});if("x"===e)return t?n:a;if("y"===e)return t?a:n;const i=_.i18n.translate("xpack.lens.xyChart.verticalLeftAxisLabel",{defaultMessage:"Vertical left axis"}),r=_.i18n.translate("xpack.lens.xyChart.verticalRightAxisLabel",{defaultMessage:"Vertical right axis"}),s=_.i18n.translate("xpack.lens.xyChart.horizontalLeftAxisLabel",{defaultMessage:"Horizontal top axis"}),l=_.i18n.translate("xpack.lens.xyChart.horizontalRightAxisLabel",{defaultMessage:"Horizontal bottom axis"});return"yLeft"===e?t?l:i:t?s:r}function Gt(e,t,n){return a=>{const i=n[a.layerId];if(!a.xAccessor)return!1;const r=null==i?void 0:i.getOperationForColumnId(a.xAccessor);return Boolean(r&&(!t||r.dataType===t)&&r.scale===e)}}function qt(e,t,n){const a=e.some(Gt("interval","number",t)),{right:i,left:r}=Ve(e,n);return{x:e.some((({xAccessor:e})=>null!=e))&&a,yLeft:r.length>0,yRight:i.length>0}}function Wt(e,t,{activeData:n},a){if(!n)return 100;const{dataLayers:i,untouchedDataLayers:r,accessors:s}=function(e,t,n){switch(e){case"x":{const e=t.filter((({xAccessor:e})=>e));return{dataLayers:e.map((({accessors:e,xAccessor:t,...n})=>({...n,accessors:[t]}))),untouchedDataLayers:e,accessors:e.map((({xAccessor:e})=>e))}}case"yLeft":case"yRight":{const a="yLeft"===e?"left":"right",{[a]:i}=Ve(t,n),r=new Set(i.map((({layer:e})=>e))),s=t.filter((({layerId:e})=>r.has(e)));return{dataLayers:s,untouchedDataLayers:s,accessors:i.map((({accessor:e})=>e))}}}}(t,e,n);if("x"===t&&i.length&&!r.some(a))return 100;const l=function(e,t,n,a=!0,i=!0){const r=3/4;if(e.length&&t.length){if(e.some((({seriesType:e})=>function(e){return"bar_percentage_stacked"===e||"bar_horizontal_percentage_stacked"===e||"area_percentage_stacked"===e}(e))))return r;const{min:s,max:l}=$t(e,t,n,i);if(null!=s&&null!=l&&isFinite(s)&&isFinite(l)){const e=a?Math.min(0,s):s;return Number((e+(l-e)*r).toFixed(2))}}}(i,s,n,"x"!==t,"x"!==t);return null!=l?l:100}function $t(e,t,n,a=!0){const i=new Set(t);let r,s;const[l,o]=Object(Z.partition)(e,(({seriesType:e})=>function(e){return e.includes("stacked")}(e)&&a));for(const{layerId:e,accessors:t}of o){const a=n[e];if(a)for(const e of t)if(i.has(e))for(const t of a.rows){const n=t[e];"number"==typeof n&&(s=null!=s?Math.max(n,s):n,r=null!=r?Math.min(n,r):n)}}const u={};for(const{layerId:e,accessors:t,xAccessor:a}of l){const r=n[e];if(r)for(const e of t)if(i.has(e))for(const t of r.rows){const n=t[e];let i="shared";var c;if(a&&(i=t[a]),"number"==typeof n)u[i]=null!==(c=u[i])&&void 0!==c?c:0,u[i]+=n}}for(const e of Object.values(u))s=Math.max(e,s||0,0),r=Math.min(e,r||0,0);return{min:r,max:s}}function Yt({args:{layers:e},data:t}){var n;const a=Jt(e,t);if(0===a.length)return;const i=t.dateRange&&a.every((e=>"time"===e.xScaleType)),r=t.tables[a[0].layerId].columns.find((e=>e.id===a[0].xAccessor));if(!r)return;if(!i){const e=De.search.aggs.getNumberHistogramIntervalByDatatableColumn(r);return"number"==typeof e?e:void 0}const s=null===(n=De.search.aggs.getDateHistogramMetaDataByDatatableColumn(r))||void 0===n?void 0:n.interval;if(!s)return;const l=De.search.aggs.parseInterval(s);return l?l.as("milliseconds"):void 0}const Kt=e=>null!=e&&"object"!=typeof e,Ut=e=>({name:"lens_xy_chart_renderer",displayName:"XY chart",help:_.i18n.translate("xpack.lens.xyChart.renderer.help",{defaultMessage:"X/Y chart renderer"}),validate:()=>{},reuseDomNode:!0,render:async(t,n,a)=>{a.onDestroy((()=>j.a.unmountComponentAtNode(t)));j.a.render(Object(E.jsx)(O.I18nProvider,null,Object(E.jsx)(Qt,x()({},n,{formatFactory:e.formatFactory,chartsActiveCursorService:e.chartsActiveCursorService,chartsThemeService:e.chartsThemeService,paletteService:e.paletteService,timeZone:e.timeZone,minInterval:Yt(n),interactive:a.isInteractive(),onClickValue:e=>{a.event({name:"filter",data:e})},onSelectRange:e=>{a.event({name:"brush",data:e})},renderMode:a.getRenderMode(),syncColors:a.isSyncColorsEnabled()}))),t,(()=>a.done()))}});const Xt=v.a.memo(Zt);function Qt(e){const[t,n]=Object(h.useState)(!1);return Object(h.useEffect)((()=>{n(!0)}),[n]),Object(E.jsx)(C,{className:"lnsXyExpression__container",isReady:t,reportTitle:e.args.title,reportDescription:e.args.description},Object(E.jsx)(Xt,e))}function Zt({data:e,args:t,formatFactory:n,timeZone:a,chartsThemeService:i,chartsActiveCursorService:r,paletteService:s,minInterval:l,onClickValue:o,onSelectRange:u,interactive:c=!0,syncColors:d}){var p,m,g,f,b,v,y,j,O;const{legend:k,layers:I,fittingFunction:F,gridlinesVisibilitySettings:w,valueLabels:T,hideEndzones:C,yLeftExtent:P,yRightExtent:S,valuesInLegend:A}=t,L=Object(h.useRef)(null),D=i.useChartsTheme(),N=i.useChartsBaseTheme(),z=i.useDarkMode(),B=Jt(I,e),R=B.reduce(((e,t)=>(e[t.layerId]=t,e)),{}),V=Object(Ne.useActiveCursor)(r,L,{datatables:Object.values(e.tables)});if(0===B.length){const e=I.length>0?(H=I[0].seriesType,Ce.visualizationTypes.find((e=>e.id===H)).icon||"empty"):"bar";return Object(E.jsx)(M.c,{icon:e})}var H;const G=I.filter((e=>e.layerType===$.i.REFERENCELINE)),q=e.tables[B[0].layerId].columns.find((({id:e})=>e===B[0].xAccessor)),W=n(q&&(null===(p=q.meta)||void 0===p?void 0:p.params)),Y={},K=e=>q&&Y[q.id]?e:W.convert(e),U=B.length>1||B.some((e=>e.accessors.length>1))||B.some((e=>e.splitAccessor)),X=Pe(B),Q=He(B,X,e.tables,n),Z=t.xTitle||q&&q.name,J=t.axisTitlesVisibilitySettings||{x:!0,yLeft:!0,yRight:!0},ee=t.tickLabelsVisibilitySettings||{x:!0,yLeft:!0,yRight:!0},te=t.labelsOrientation||{x:0,yLeft:0,yRight:0},ne=B.filter((e=>e.seriesType.includes("bar"))),ae=ne.length>1||ne.some((e=>e.accessors.length>1))||ne.some((e=>e.splitAccessor)),ie=e.dateRange&&B.every((e=>"time"===e.xScaleType)),re=B.every((e=>e.isHistogram)),{baseDomain:se,extendedDomain:le}=Ue(B,e,l,Boolean(ie),Boolean(re)),ue={left:Q.find((({groupId:e})=>"left"===e)),right:Q.find((({groupId:e})=>"right"===e))},ce=Dt(G,ue),de=e=>{var n,a;const i="right"===e?null==ee?void 0:ee.yRight:null==ee?void 0:ee.yLeft;return{tickLabel:{visible:i,rotation:"right"===e?(null===(n=t.labelsOrientation)||void 0===n?void 0:n.yRight)||0:(null===(a=t.labelsOrientation)||void 0===a?void 0:a.yLeft)||0,padding:null!=ce[e]?{inner:ce[e]}:void 0},axisTitle:{visible:"right"===e?null==J?void 0:J.yRight:null==J?void 0:J.yLeft,padding:i||null==ce[e]?void 0:{inner:ce[e]}}}},pe=t=>{const n="left"===t.groupId?P:S,a=Boolean(t.series.some((e=>{var t;const n=null===(t=R[e.layer])||void 0===t?void 0:t.seriesType;return(null==n?void 0:n.includes("bar"))||(null==n?void 0:n.includes("area"))}))),i=!a&&"dataBounds"===n.mode;let r=NaN,s=NaN;if("custom"===n.mode){const{inclusiveZeroError:e,boundaryError:t}=Ge(a,n);var l,o;if(!e&&!t)r=null!==(l=n.lowerBound)&&void 0!==l?l:NaN,s=null!==(o=n.upperBound)&&void 0!==o?o:NaN}else{const n=G.some((({yConfig:e})=>null==e?void 0:e.some((({axisMode:e})=>e===t.groupId))));if(!i&&n){const{min:n,max:a}=$t(B,t.series.map((({accessor:e})=>e)),e.tables);null!=n&&null!=a&&(s=Math.max(a,s||0),r=Math.min(n,r||0));for(const{layerId:n,yConfig:a}of G){const i=e.tables[n];for(const{axisMode:e,forAccessor:n}of a||[])if(t.groupId===e)for(const e of i.rows){const t=e[n];s=Math.max(t,s||0,0),r=Math.min(t,r||0,0)}}}}return{fit:i,min:r,max:s}},me=B.every((e=>!e.seriesType.includes("stacked")))&&!re,ge=me&&"hide"!==T&&{displayValue:{fontSize:{min:10,max:12},fill:{textBorder:0},alignment:(fe=X)?{vertical:oe.VerticalAlignment.Middle}:{horizontal:oe.HorizontalAlignment.Center},offsetX:fe?10:0,offsetY:fe?0:-10}};var fe;const be=Ye(t.layers,e,n),xe={vAlign:null!==(m=k.verticalAlignment)&&void 0!==m?m:oe.VerticalAlignment.Top,hAlign:null!==(g=null==k?void 0:k.horizontalAlignment)&&void 0!==g?g:oe.HorizontalAlignment.Right,direction:oe.LayoutDirection.Vertical,floating:!0,floatingColumns:null!==(f=null==k?void 0:k.floatingColumns)&&void 0!==f?f:1};return Object(E.jsx)(oe.Chart,{ref:L},Object(E.jsx)(oe.Settings,{onPointerUpdate:V,debugState:null!==(b=window._echDebugStateFlag)&&void 0!==b&&b,showLegend:k.isVisible&&!k.showSingleSeries?U:k.isVisible,legendPosition:null!=k&&k.isInside?xe:k.position,theme:{...D,barSeriesStyle:{...D.barSeriesStyle,...ge},background:{color:void 0},legend:{labelOptions:{maxLines:k.shouldTruncate?null!==(v=null==k?void 0:k.maxLines)&&void 0!==v?v:1:0}},chartMargins:{...D.chartPaddings,...Lt(ce,ee,J,ue,X)}},baseTheme:N,tooltip:{boundary:null!==(y=document.getElementById("app-fixed-viewport"))&&void 0!==y?y:void 0,headerFormatter:e=>K(e.value)},allowBrushingLastHistogramBin:Boolean(ie),rotation:X?90:0,xDomain:le,onBrushEnd:c?({x:t})=>{var n,a;if(!t)return;const[i,r]=t;if(!q||!re)return;const s=e.tables[B[0].layerId],l=s.columns.findIndex((e=>e.id===B[0].xAccessor)),o=ie?null===(n=s.columns[l])||void 0===n||null===(a=n.meta)||void 0===a?void 0:a.field:void 0;u({range:[i,r],table:s,column:l,timeFieldName:o})}:void 0,onElementClick:c?([[t,a]])=>{var i;const r=a,s=t,l=B.find((e=>r.seriesKeys.some((t=>e.accessors.includes(t.toString())))));if(!l)return;const u=e.tables[l.layerId],c=u.columns.find((e=>e.id===l.xAccessor)),d=l.xAccessor&&Y[l.xAccessor]&&c?n(c.meta.params):W,p=u.rows.findIndex((e=>{if(l.xAccessor)return Y[l.xAccessor]?d.convert(e[l.xAccessor])===s.x:e[l.xAccessor]===s.x})),m=[{row:p,column:u.columns.findIndex((e=>e.id===l.xAccessor)),value:l.xAccessor?u.rows[p][l.xAccessor]:s.x}];if(r.seriesKeys.length>1){const e=r.seriesKeys[0];m.push({row:u.rows.findIndex((t=>l.splitAccessor&&t[l.splitAccessor]===e)),column:u.columns.findIndex((e=>e.id===l.splitAccessor)),value:e})}const g=null===(i=u.columns.find((e=>e.id===l.xAccessor)))||void 0===i?void 0:i.meta,f=null==g?void 0:g.field,b="date"===(null==g?void 0:g.type),x={data:m.map((e=>({row:e.row,column:e.column,value:e.value,table:u}))),timeFieldName:le&&b?f:void 0};o(x)}:void 0,legendAction:c?Ze(B,e.tables,o,n,Y):void 0,showLegendExtra:re&&A}),Object(E.jsx)(oe.Axis,{id:"x",position:X?oe.Position.Left:oe.Position.Bottom,title:Z,gridLine:{visible:null==w?void 0:w.x,strokeWidth:2},hide:B[0].hide||!B[0].xAccessor,tickFormat:e=>K(e),style:{tickLabel:{visible:null==ee?void 0:ee.x,rotation:null==te?void 0:te.x,padding:null!=ce.bottom?{inner:ce.bottom}:void 0},axisTitle:{visible:J.x,padding:null!=ee&&ee.x||null==ce.bottom?void 0:{inner:ce.bottom}}}}),Q.map((n=>{return Object(E.jsx)(oe.Axis,{key:n.groupId,id:n.groupId,groupId:n.groupId,position:n.position,title:(a=n.series,i=n.groupId,("right"===i?t.yRightTitle:t.yTitle)||a.map((t=>{var n;return null===(n=e.tables[t.layer].columns.find((e=>e.id===t.accessor)))||void 0===n?void 0:n.name})).filter((e=>Boolean(e)))[0]),gridLine:{visible:"right"===n.groupId?null==w?void 0:w.yRight:null==w?void 0:w.yLeft},hide:B[0].hide,tickFormat:e=>{var t;return(null===(t=n.formatter)||void 0===t?void 0:t.convert(e))||""},style:de(n.groupId),domain:pe(n)});var a,i})),!C&&Object(E.jsx)(Qe,{baseDomain:se,extendedDomain:le,darkMode:z,histogramMode:B.every((e=>e.isHistogram&&(e.seriesType.includes("stacked")||!e.splitAccessor)&&(e.seriesType.includes("stacked")||!e.seriesType.includes("bar")||!ae)))}),B.flatMap(((i,r)=>i.accessors.map(((l,o)=>{const{splitAccessor:u,seriesType:c,accessors:p,xAccessor:m,layerId:g,columnToLabel:f,yScaleType:b,xScaleType:h,isHistogram:v,palette:y}=i,j=f?JSON.parse(f):{},O=e.tables[g],k={...O,rows:O.rows.map((e=>{const t={...e};for(const e of O.columns){const a=t[e.id];null==a||Kt(a)&&(e.id!==m||"ordinal"!==h)||(t[e.id]=n(e.meta.params).convert(a))}return t}))};O.columns.reduce(((e,{id:t})=>(e[t]||(e[t]=O.rows.some(((e,n)=>e[t]!==k.rows[n][t]))),e)),Y);const I=c.includes("stacked"),w=c.includes("percentage"),C=c.includes("bar"),M=v&&(I||!u)&&(I||!C||!ae),P=k.rows.filter((e=>!(m&&void 0===e[m]||u&&void 0===e[u]&&void 0===e[l])));m||P.forEach((e=>{e.unifiedX=_.i18n.translate("xpack.lens.xyChart.emptyXLabel",{defaultMessage:"(empty)"})}));const S=Q.find((e=>e.series.find((e=>e.accessor===l)))),A={splitSeriesAccessors:u?[u]:[],stackAccessors:I?[m]:[],id:`${u}-${l}`,xAccessor:m||"unifiedX",yAccessors:[l],data:P,xScaleType:m?h:"ordinal",yScaleType:b,color:({yAccessor:e,seriesKeys:t})=>{const n=Ae(i,l);if(null!==n)return n;const a=be[y.name],r=[{name:u?String(t[0]):j[t[0]],totalSeriesAtDepth:a.totalSeriesCount,rankAtDepth:a.getRank(i,String(t[0]),String(e))}];return s.get(y.name).getCategoricalColor(r,{maxDepth:1,behindText:!1,totalSeries:a.totalSeriesCount,syncColors:d},y.params)},groupId:null==S?void 0:S.groupId,enableHistogramMode:M,stackMode:w?oe.StackMode.Percentage:void 0,timeZone:a,areaSeriesStyle:{point:{visible:!m,radius:5},...t.fillOpacity&&{area:{opacity:t.fillOpacity}}},lineSeriesStyle:{point:{visible:!m,radius:5}},name(e){var t,a,i;const r=null===(t=O.columns.find((e=>e.id===u)))||void 0===t||null===(a=t.meta)||void 0===a?void 0:a.params;if(p.length>1){return e.seriesKeys.map(((e,t)=>{var a;return 0===t&&r&&u&&!Y[u]?n(r).convert(e):u&&0===t?e:null!==(a=j[e])&&void 0!==a?a:""})).join(" - ")}return r?u&&Y[u]?e.seriesKeys[0]:n(r).convert(e.seriesKeys[0]):u?e.seriesKeys[0]:null!==(i=j[e.seriesKeys[0]])&&void 0!==i?i:""}},L=`${r}-${o}`,D=t.curveType?oe.CurveType[t.curveType]:void 0;switch(c){case"line":return Object(E.jsx)(oe.LineSeries,x()({key:L},A,{fit:Be(F),curve:D}));case"bar":case"bar_stacked":case"bar_percentage_stacked":case"bar_horizontal":case"bar_horizontal_stacked":case"bar_horizontal_percentage_stacked":const e={displayValueSettings:{valueFormatter:e=>{var t;return(null==S||null===(t=S.formatter)||void 0===t?void 0:t.convert(e))||""},showValueLabel:me&&"hide"!==T,isValueContainedInElement:!1,isAlternatingValueLabel:!1,overflowConstraints:[oe.LabelOverflowConstraint.ChartEdges,oe.LabelOverflowConstraint.BarGeometry]}};return Object(E.jsx)(oe.BarSeries,x()({key:L},A,e));case"area_stacked":case"area_percentage_stacked":return Object(E.jsx)(oe.AreaSeries,x()({key:L},A,{fit:w?"zero":Be(F),curve:D}));case"area":return Object(E.jsx)(oe.AreaSeries,x()({key:L},A,{fit:Be(F),curve:D}));default:return function(e){throw new Error("Unexpected series type: "+e)}(c)}})))),G.length?Object(E.jsx)(Vt,{layers:G,data:e,syncColors:d,paletteService:s,formatters:{left:null===(j=ue.left)||void 0===j?void 0:j.formatter,right:null===(O=ue.right)||void 0===O?void 0:O.formatter,bottom:W},axesMap:{left:Boolean(ue.left),right:Boolean(ue.right)},isHorizontal:X,paddingMap:ce}):null)}function Jt(e,t){return e.filter((({layerId:e,xAccessor:n,accessors:a,splitAccessor:i,layerType:r})=>r===$.i.DATA&&!(!a.length||!t.tables[e]||0===t.tables[e].rows.length||n&&t.tables[e].rows.every((e=>void 0===e[n]))||!n&&i&&t.tables[e].rows.every((e=>void 0===e[i])))))}const en={document:0,date:1,string:2,ip:3,boolean:4,number:5,histogram:6,geo_point:7,geo_shape:8};function tn({table:e,state:t,keptLayerIds:n,subVisualizationId:a,mainPalette:i}){const r=!e.isMultiRow||e.columns.length<=1||e.columns.every((e=>"number"!==e.operation.dataType))||e.columns.some((e=>!en.hasOwnProperty(e.operation.dataType)));if(r&&"unchanged"===e.changeType&&t)return Ce.visualizationTypes.map((e=>{const n=e.id;return{seriesType:n,score:0,state:{...t,preferredSeriesType:n,layers:t.layers.map((e=>({...e,seriesType:n})))},previewIcon:Se(n),title:e.label,hide:!0}}));if(r&&t&&!a)return[];const s=function(e,t,n,a,i){const[r,s]=Object(Z.partition)(e.columns,(e=>e.operation.isBucketed));if(1===r.length||2===r.length){const[r,l]=function(e,t){const n=t&&t.layers.find((({layerId:t})=>t===e.layerId)),a=e.columns.filter((e=>e.operation.isBucketed)),i=an([...a].reverse());if(!n||"initial"===e.changeType)return i;if("reorder"===e.changeType)return a;const r=i.findIndex((({columnId:e})=>e===n.xAccessor)),s=r>-1&&i[r].operation.scale;if(s&&("interval"===s||"interval"!==i[0].operation.scale)){const[e]=i.splice(r,1);i.unshift(e)}const l=i.findIndex((({columnId:e})=>e===n.splitAccessor));if(l>-1){const[e]=i.splice(l,1);i.push(e)}return i}(e,n);return rn({layerId:e.layerId,changeType:e.changeType,xValue:r,yValues:s,splitBy:l,currentState:n,tableLabel:e.label,keptLayerIds:t,requestedSeriesType:a,mainPalette:i})}if(0===r.length){const[r,[l,o]]=Object(Z.partition)(an(s),(e=>"number"===e.operation.dataType&&!e.operation.isBucketed));return rn({layerId:e.layerId,changeType:e.changeType,xValue:l,yValues:r,splitBy:o,currentState:n,tableLabel:e.label,keptLayerIds:t,requestedSeriesType:a,mainPalette:i})}}(e,n,t,a,i);return s&&s instanceof Array?s:s?[s]:[]}function nn(e){switch(e){case"bar_horizontal":return"bar";case"bar_horizontal_stacked":return"bar_stacked";case"bar":default:return"bar_horizontal";case"bar_horizontal_percentage_stacked":return"bar_percentage_stacked";case"bar_percentage_stacked":return"bar_horizontal_percentage_stacked"}}function an(e){return[...e].sort(((e,t)=>en[e.operation.dataType]-en[t.operation.dataType]))}function rn({layerId:e,changeType:t,xValue:n,yValues:a,splitBy:i,currentState:r,tableLabel:s,keptLayerIds:l,requestedSeriesType:o,mainPalette:u}){const c=function(e,t,n){const a=e.map((e=>e.operation.label)).join(_.i18n.translate("xpack.lens.xySuggestions.yAxixConjunctionSign",{defaultMessage:" & ",description:"A character that can be used for conjunction of multiple enumarated items. Make sure to include spaces around it if needed."})),i=(null==t?void 0:t.operation.label)||_.i18n.translate("xpack.lens.xySuggestions.emptyAxisTitle",{defaultMessage:"(empty)"}),r=n||("date"===(null==t?void 0:t.operation.dataType)?_.i18n.translate("xpack.lens.xySuggestions.dateSuggestion",{defaultMessage:"{yTitle} over {xTitle}",description:'Chart description for charts over time, like "Transfered bytes over log.timestamp"',values:{xTitle:i,yTitle:a}}):_.i18n.translate("xpack.lens.xySuggestions.nonDateSuggestion",{defaultMessage:"{yTitle} of {xTitle}",description:'Chart description for a value of some groups, like "Top URLs of top 5 countries"',values:{xTitle:i,yTitle:a}}));return r}(a,n,s),d=o||function(e,t,n){const a="bar_stacked",i=cn(e,t),r=!!i&&i.seriesType||e&&e.preferredSeriesType||a;if(n&&n.operation.scale&&"ordinal"===n.operation.scale)return r.startsWith("bar")?r:a;return r}(r,e,n),p={currentState:r,seriesType:d,layerId:e,title:c,yValues:a,splitBy:i,changeType:t,xValue:n,keptLayerIds:l,mainPalette:i?u:void 0};if(!r&&"unchanged"===t)return Ce.visualizationTypes.map((e=>({...on({...p,seriesType:e.id,hide:"bar_stacked"!==e.id||void 0}),title:e.label}))).sort(((e,t)=>"bar_stacked"===e.state.preferredSeriesType?-1:1));if(!(r&&"unchanged"===t))return on(p);const m=[];if(!d.includes("bar")||n&&"ordinal"!==n.operation.scale){const e=function(e){switch(e){case"area":case"bar":case"bar_stacked":return"line";default:return"bar_stacked"}}(d);m.push(on({...p,seriesType:e,title:e.startsWith("bar")?_.i18n.translate("xpack.lens.xySuggestions.barChartTitle",{defaultMessage:"Bar chart"}):_.i18n.translate("xpack.lens.xySuggestions.lineChartTitle",{defaultMessage:"Line chart"})}))}else m.push(on({...p,title:_.i18n.translate("xpack.lens.xySuggestions.flipTitle",{defaultMessage:"Flip"}),seriesType:nn(d)}));if("line"!==d&&i&&!d.includes("percentage")&&m.push(on({...p,seriesType:sn(d),title:d.endsWith("stacked")?_.i18n.translate("xpack.lens.xySuggestions.unstackedChartTitle",{defaultMessage:"Unstacked"}):_.i18n.translate("xpack.lens.xySuggestions.stackedChartTitle",{defaultMessage:"Stacked"})})),"line"!==d&&d.includes("stacked")&&!d.includes("percentage")){var g;const e={...p};"ordinal"!==(null===(g=e.xValue)||void 0===g?void 0:g.operation.scale)||e.splitBy||(e.splitBy=e.xValue,delete e.xValue),m.push(on({...p,hide:!e.splitBy,seriesType:ln(d),title:_.i18n.translate("xpack.lens.xySuggestions.asPercentageTitle",{defaultMessage:"Percentage"})}))}return m.concat(Ce.visualizationTypes.filter((e=>!m.find((t=>t.state.preferredSeriesType===e.id)))).map((e=>({...on({...p,seriesType:e.id}),hide:!0}))))}function sn(e){switch(e){case"area":return"area_stacked";case"area_stacked":return"area";case"bar":return"bar_stacked";case"bar_stacked":return"bar";default:return e}}function ln(e){switch(e){case"area_stacked":return"area_percentage_stacked";case"bar_stacked":return"bar_percentage_stacked";case"bar_horizontal_stacked":return"bar_horizontal_percentage_stacked";default:return e}}function on({currentState:e,seriesType:t,layerId:n,title:a,yValues:i,splitBy:r,changeType:s,xValue:l,keptLayerIds:o,hide:u,mainPalette:c}){var d,p,m;t.includes("percentage")&&"ordinal"===(null===(d=l)||void 0===d?void 0:d.operation.scale)&&!r&&(r=l,l=void 0);const g=cn(e,n)||{},f=i.map((e=>e.columnId)),b={...g,palette:c||("palette"in g?g.palette:void 0),layerId:n,seriesType:t,xAccessor:null===(p=l)||void 0===p?void 0:p.columnId,splitAccessor:null===(m=r)||void 0===m?void 0:m.columnId,accessors:f,yConfig:"yConfig"in g&&g.yConfig?g.yConfig.filter((({forAccessor:e})=>-1!==f.indexOf(e))):void 0,layerType:$.i.DATA},x=e?e.layers.filter((e=>o.includes(e.layerId))).map((e=>e.layerId===n?b:e)).map((e=>({...e,seriesType:t}))):[],h={legend:e?e.legend:{isVisible:!0,position:oe.Position.Right},valueLabels:(null==e?void 0:e.valueLabels)||"hide",fittingFunction:(null==e?void 0:e.fittingFunction)||"None",curveType:null==e?void 0:e.curveType,fillOpacity:null==e?void 0:e.fillOpacity,xTitle:null==e?void 0:e.xTitle,yTitle:null==e?void 0:e.yTitle,yRightTitle:null==e?void 0:e.yRightTitle,hideEndzones:null==e?void 0:e.hideEndzones,valuesInLegend:null==e?void 0:e.valuesInLegend,yLeftExtent:null==e?void 0:e.yLeftExtent,yRightExtent:null==e?void 0:e.yRightExtent,axisTitlesVisibilitySettings:(null==e?void 0:e.axisTitlesVisibilitySettings)||{x:!0,yLeft:!0,yRight:!0},tickLabelsVisibilitySettings:(null==e?void 0:e.tickLabelsVisibilitySettings)||{x:!0,yLeft:!0,yRight:!0},labelsOrientation:(null==e?void 0:e.labelsOrientation)||{x:0,yLeft:0,yRight:0},gridlinesVisibilitySettings:(null==e?void 0:e.gridlinesVisibilitySettings)||{x:!0,yLeft:!0,yRight:!0},preferredSeriesType:t,layers:Object.keys(g).length?x:[...x,b]};return{title:a,score:un(i,r,s),hide:null!=u?u:!e&&"unchanged"!==s&&"extended"!==s||e&&"reduced"===s||0===i.length||!l&&!r,state:h,previewIcon:Se(t)}}function un(e,t,n){const a="unchanged"===n?.5:1;return((e.length>1?2:1)+(t?1:0))/3*a}function cn(e,t){return e&&e.layers.find((e=>e.layerId===t))}var dn=n(43);const pn=({title:e,titleId:t,...n})=>Object(E.jsx)("svg",x()({viewBox:"0 0 16 12",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(E.jsx)("title",{id:t},e):null,Object(E.jsx)("g",null,Object(E.jsx)("path",{className:"lensChartIcon__subdued",d:"M3.2 4.79997C3.2 4.50542 2.96122 4.26663 2.66667 4.26663H0.533333C0.238784 4.26663 0 4.50542 0 4.79997V6.39997H3.2V4.79997ZM3.2 9.59997H0V13.3333C0 13.6279 0.238784 13.8666 0.533333 13.8666H2.66667C2.96122 13.8666 3.2 13.6279 3.2 13.3333V9.59997ZM8.53333 9.59997H11.7333V13.3333C11.7333 13.6279 11.4946 13.8666 11.2 13.8666H9.06667C8.77211 13.8666 8.53333 13.6279 8.53333 13.3333V9.59997ZM11.7333 6.39997H8.53333V2.66663C8.53333 2.37208 8.77211 2.1333 9.06667 2.1333H11.2C11.4946 2.1333 11.7333 2.37208 11.7333 2.66663V6.39997ZM12.8 9.59997V13.3333C12.8 13.6279 13.0388 13.8666 13.3333 13.8666H15.4667C15.7612 13.8666 16 13.6279 16 13.3333V9.59997H12.8ZM16 6.39997V5.86663C16 5.57208 15.7612 5.3333 15.4667 5.3333H13.3333C13.0388 5.3333 12.8 5.57208 12.8 5.86663V6.39997H16ZM7.46667 11.2C7.46667 10.9054 7.22789 10.6666 6.93333 10.6666H4.8C4.50544 10.6666 4.26667 10.9054 4.26667 11.2V13.3333C4.26667 13.6279 4.50544 13.8666 4.8 13.8666H6.93333C7.22789 13.8666 7.46667 13.6279 7.46667 13.3333V11.2Z"}),Object(E.jsx)("rect",{y:"7.4668",width:"16",height:"1.06667",rx:"0.533334",className:"lensChartIcon__accent"})));function mn(e){const[t,n]=Object(h.useState)(!1),{state:a,layerId:i}=e,r=Pe(a.layers),s=a.layers.findIndex((e=>e.layerId===i)),l=a.layers[s];if(!l)return null;if(l.layerType===$.i.REFERENCELINE)return Object(E.jsx)(M.i,{icon:pn,label:_.i18n.translate("xpack.lens.xyChart.layerReferenceLineLabel",{defaultMessage:"Reference lines"})});const o=Ce.visualizationTypes.find((({id:e})=>e===l.seriesType));return Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiPopover,{panelClassName:"lnsChangeIndexPatternPopover",button:Object(E.jsx)(dn.ToolbarButton,{"data-test-subj":"lns_layer_settings",title:o.fullLabel||o.label,onClick:()=>n(!t),fullWidth:!0,size:"s"},Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiIcon,{type:o.icon}),Object(E.jsx)(F.EuiText,{size:"s",className:"lnsLayerPanelChartSwitch_title"},o.fullLabel||o.label))),isOpen:t,closePopover:()=>n(!1),display:"block",panelPaddingSize:"s",ownFocus:!0},Object(E.jsx)(F.EuiPopoverTitle,null,_.i18n.translate("xpack.lens.layerPanel.layerVisualizationType",{defaultMessage:"Layer visualization type"})),Object(E.jsx)("div",null,Object(E.jsx)(F.EuiSelectable,{singleSelection:"always",options:Ce.visualizationTypes.filter((e=>Me(e.id)===r)).map((e=>({value:e.id,key:e.id,checked:e.id===o.id?"on":void 0,prepend:Object(E.jsx)(F.EuiIcon,{type:e.icon}),label:e.fullLabel||e.label,"data-test-subj":`lnsXY_seriesType-${e.id}`}))),onChange:t=>{const i=t.find((({checked:e})=>"on"===e));if(!i)return;const r=i.value;Object(at.e)("xy_change_layer_display"),e.setState(xt(a,{...l,seriesType:r},s)),n(!1)}},(e=>Object(E.jsx)(v.a.Fragment,null,e))))))}var gn=n(88);const fn=({title:e,titleId:t,...n})=>Object(E.jsx)("svg",x()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(E.jsx)("title",{id:t},e):null,Object(E.jsx)("path",{d:"M24 16l.186-.002.345-.02.266-.03.334-.058.193-.043.25-.067.223-.07.215-.074.209-.079.305-.124c.166-.07.34-.148.524-.234l.285-.135 1.202-.588c.428-.203.728-.326.966-.396.146-.044.27-.067.384-.076L30 14v7a1 1 0 01-1 1H1a1 1 0 01-1-1v-2c1 0 3.5-4 6-4s5 3 6 3 3.23-7.994 5.865-7.997L19.032 10l.541 1.205.272.595.29.612c.517 1.069.955 1.842 1.391 2.391.08.1.16.194.241.28.095.101.189.191.283.272l.143.114c.218.164.446.284.69.368.207.071.426.116.662.14l.14.012.154.008L24 16zm6-12v6l-.186.002-.345.02-.266.03-.331.057-.196.044-.25.067-.304.097-.134.047a9.492 9.492 0 00-.386.15l-.128.053c-.166.07-.34.148-.524.234l-.285.135-1.264.618-.352.159-.187.078-.256.095-.178.054a13.872 13.872 0 01-.38-.687l-.16-.311-.233-.47-.016-.472H24c1 0 3-6 6-6z",className:"lensChartIcon__accent"}),Object(E.jsx)("path",{d:"M30 13c-.507 0-.988.146-1.89.571l-1.209.592C25.621 14.78 24.924 15 24 15c-1.384 0-2.003-.865-3.516-4.206l-.637-1.42-.346-.749-.213-.445C18.572 6.698 18.127 6 18 6c-.466 0-.967.252-1.99.997l-.891.659-.458.325C13.576 8.728 12.907 9 12 9c-1.269 0-1.966-.69-3.492-2.939l-.774-1.146-.272-.387-.26-.358C6.581 3.342 6.213 3 6 3c-.294 0-.885.651-2.017 2.33l-.491.731-.326.475C1.859 8.409 1.175 9 0 9V7c.294 0 .885-.651 2.017-2.33l.491-.731.326-.475C4.141 1.591 4.825 1 6 1c1.269 0 1.966.69 3.492 2.939l.774 1.146.272.387.26.358C11.419 6.658 11.788 7 12 7c.466 0 .967-.252 1.99-.997l.891-.659.458-.325C16.424 4.272 17.093 4 18 4c1.384 0 2.003.865 3.516 4.206l.637 1.42.346.749.213.445C23.428 12.302 23.873 13 24 13c.507 0 .988-.146 1.89-.571l1.209-.592C28.379 11.22 29.076 11 30 11v2z",className:"lensChartIcon__subdued"}),Object(E.jsx)("path",{d:"M6 13v7.889C6 21.503 5.552 22 5 22H1c-.552 0-1-.497-1-1.111V13a1 1 0 011-1h4a1 1 0 011 1zm8-1v9a1 1 0 01-1 1H9a1 1 0 01-1-1v-9a1 1 0 011-1h4a1 1 0 011 1zm8 5v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4a1 1 0 011-1h4a1 1 0 011 1zm8 2v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2a1 1 0 011-1h4a1 1 0 011 1z",className:"lensChartIcon__subdued"}));var bn=n(89),xn=n(81);const hn=gn.a,vn="bar_stacked",yn=e=>!e.isBucketed&&"number"===e.dataType,jn=e=>e.isBucketed;function _n(e){var t;if(!e.layers.length)return null!==(t=Ce.visualizationTypes.find((t=>t.id===e.preferredSeriesType)))&&void 0!==t?t:Ce.visualizationTypes[0];const n=Ce.visualizationTypes.find((t=>t.id===e.layers[0].seriesType)),a=Object(Z.uniq)(e.layers.map((e=>e.seriesType)));return n&&1===a.length?n:"mixed"}const On=({paletteService:e,fieldFormats:t})=>({id:"lnsXY",visualizationTypes:Ce.visualizationTypes,getVisualizationTypeId(e){const t=_n(e);return"mixed"===t?t:t.id},getLayerIds:e=>wn(e).map((e=>e.layerId)),getRemoveOperation(e,t){const n=wn(e,$.i.DATA).map((e=>e.layerId));return n.includes(t)&&1===n.length?"clear":"remove"},removeLayer:(e,t)=>({...e,layers:e.layers.filter((e=>e.layerId!==t))}),appendLayer(e,t,n){const a=Object(Z.uniq)(e.layers.map((e=>e.seriesType)));return{...e,layers:[...e.layers,Fn(1===a.length?a[0]:e.preferredSeriesType,t,n)]}},clearLayer:(e,t)=>({...e,layers:e.layers.map((n=>n.layerId!==t?n:Fn(e.preferredSeriesType,t)))}),getDescription(e){const{icon:t,label:n}=function(e){if(!e)return{icon:hn,label:_.i18n.translate("xpack.lens.xyVisualization.xyLabel",{defaultMessage:"XY"})};const t=_n(e);return"mixed"===t&&Pe(e.layers)?{icon:bn.a,label:_.i18n.translate("xpack.lens.xyVisualization.mixedBarHorizontalLabel",{defaultMessage:"Mixed bar horizontal"})}:"mixed"===t?{icon:fn,label:_.i18n.translate("xpack.lens.xyVisualization.mixedLabel",{defaultMessage:"Mixed XY"})}:{icon:t.icon,label:t.fullLabel||t.label}}(e);return{icon:t||hn,label:n}},switchVisualizationType:(e,t)=>({...t,preferredSeriesType:e,layers:t.layers.map((t=>({...t,seriesType:e})))}),getSuggestions:tn,initialize:(e,t)=>t||{title:"Empty XY chart",legend:{isVisible:!0,position:oe.Position.Right},valueLabels:"hide",preferredSeriesType:vn,layers:[{layerId:e(),accessors:[],position:oe.Position.Top,seriesType:vn,showGridlines:!1,layerType:$.i.DATA}]},getLayerType(e,t){var n;return null==t||null===(n=t.layers.find((({layerId:t})=>t===e)))||void 0===n?void 0:n.layerType},getSupportedLayers(e,t){const n=(null==e?void 0:e.layers.filter((({layerType:e=$.i.DATA})=>e===$.i.DATA)))||[],a=n.filter((({accessors:e,xAccessor:t})=>e.length||t)),i=Gt("interval","number",(null==t?void 0:t.datasourceLayers)||{}),r=function(e,t,n,a){if(!t)return[];const i=qt(t.layers.filter((({layerType:e=$.i.DATA})=>e===$.i.DATA)),n,a);return e.filter((({label:e})=>i[e]))}([{id:"yReferenceLineLeft",label:"yLeft"},{id:"yReferenceLineRight",label:"yRight"},{id:"xReferenceLine",label:"x"}],e,(null==t?void 0:t.datasourceLayers)||{},null==t?void 0:t.activeData);return[{type:$.i.DATA,label:_.i18n.translate("xpack.lens.xyChart.addDataLayerLabel",{defaultMessage:"Add visualization layer"}),icon:fn},{type:$.i.REFERENCELINE,label:_.i18n.translate("xpack.lens.xyChart.addReferenceLineLayerLabel",{defaultMessage:"Add reference layer"}),icon:pn,disabled:!a.length||!n.some(i)&&n.every((({accessors:e})=>!e.length)),tooltipContent:a.length?void 0:_.i18n.translate("xpack.lens.xyChart.addReferenceLineLayerLabelDisabledHelp",{defaultMessage:"Add some data to enable reference layer"}),initialDimensions:e?r.map((({id:a,label:r})=>({groupId:a,columnId:Object(xn.a)(),dataType:"number",label:Ht(r,{isHorizontal:Pe((null==e?void 0:e.layers)||[])}),staticValue:Wt(n,r,{activeData:null==t?void 0:t.activeData},i)}))):void 0}]},getConfiguration({state:n,frame:a,layerId:i}){var r,s;const l=n.layers.find((e=>e.layerId===i));if(!l)return{groups:[],supportStaticValue:!0};const o=a.datasourceLayers[l.layerId],u=Je(o,l);let c=u.map((e=>({columnId:e})));if(a.activeData){const i=Ye(n.layers,{tables:a.activeData},t.deserialize);c=Ke(i,a,{...l,accessors:u.filter((e=>l.accessors.includes(e)))},e)}const d=Pe(n.layers);if(!(!l.layerType||l.layerType===$.i.DATA)){const e=u.reduce(((e,t,n)=>(e[t]=n,e)),{}),{bottom:t,left:i,right:r}=Object(Z.groupBy)([...l.yConfig||[]].sort((({forAccessor:t},{forAccessor:n})=>e[t]-e[n])),(({axisMode:e})=>e)),s=function(e,t,n,a){if(!t)return[];const i=qt(t.layers.filter((({layerType:e=$.i.DATA})=>e===$.i.DATA)),n,a);return e.filter((({label:e,config:t})=>i[e]||(null==t?void 0:t.length))).map((e=>({...e,valid:i[e.label]})))}([{config:i,id:"yReferenceLineLeft",label:"yLeft",dataTestSubj:"lnsXY_yReferenceLineLeftPanel"},{config:r,id:"yReferenceLineRight",label:"yRight",dataTestSubj:"lnsXY_yReferenceLineRightPanel"},{config:t,id:"xReferenceLine",label:"x",dataTestSubj:"lnsXY_xReferenceLinePanel"}],n,a.datasourceLayers,null==a?void 0:a.activeData);return{supportFieldFormat:!1,supportStaticValue:!0,groups:s.map((({config:e=[],id:t,label:n,dataTestSubj:a,valid:i})=>({groupId:t,groupLabel:Ht(n,{isHorizontal:d}),accessors:e.map((({forAccessor:e,color:t})=>{var n;return{columnId:e,color:t||(null===(n=c.find((({columnId:t})=>t===e)))||void 0===n?void 0:n.color),triggerIcon:"color"}})),filterOperations:yn,supportsMoreColumns:!0,required:!1,enableDimensionEditor:!0,dataTestSubj:a,invalid:!i,invalidMessage:"x"===n?_.i18n.translate("xpack.lens.configure.invalidBottomReferenceLineDimension",{defaultMessage:"This reference line is assigned to an axis that no longer exists or is no longer valid. You may move this reference line to another available axis or remove it."}):_.i18n.translate("xpack.lens.configure.invalidReferenceLineDimension",{defaultMessage:"This reference line is assigned to an axis that no longer exists. You may move this reference line to another available axis or remove it."}),requiresPreviousColumnOnDuplicate:!0})))}}const{left:p,right:m}=Ve([l],a.activeData),g=Boolean(l.accessors.length<2||p.length&&p.length<2||m.length&&m.length<2)&&wn(n,$.i.DATA).filter((e=>{if(e.seriesType===l.seriesType&&Boolean(e.xAccessor)===Boolean(l.xAccessor)&&Boolean(e.splitAccessor)===Boolean(l.splitAccessor)){const{left:t,right:n}=Ve([e],a.activeData);return e.accessors.length&&(Boolean(t.length)===Boolean(p.length)||Boolean(n.length)===Boolean(m.length))}return!1})).length<2;return{groups:[{groupId:"x",groupLabel:Ht("x",{isHorizontal:d}),accessors:l.xAccessor?[{columnId:l.xAccessor}]:[],filterOperations:jn,supportsMoreColumns:!l.xAccessor,dataTestSubj:"lnsXY_xDimensionPanel"},{groupId:"y",groupLabel:Ht("y",{isHorizontal:d}),accessors:c,filterOperations:yn,supportsMoreColumns:!0,required:!0,dataTestSubj:"lnsXY_yDimensionPanel",enableDimensionEditor:!0},{groupId:"breakdown",groupLabel:_.i18n.translate("xpack.lens.xyChart.splitSeries",{defaultMessage:"Break down by"}),accessors:l.splitAccessor?[{columnId:l.splitAccessor,triggerIcon:"colorBy",palette:e.get((null===(r=l.palette)||void 0===r?void 0:r.name)||"default").getCategoricalColors(10,null===(s=l.palette)||void 0===s?void 0:s.params)}]:[],filterOperations:jn,supportsMoreColumns:!l.splitAccessor,dataTestSubj:"lnsXY_splitDimensionPanel",required:l.seriesType.includes("percentage")&&g,enableDimensionEditor:!0}]}},getMainPalette:e=>{if(e&&0!==e.layers.length)return e.layers[0].palette},setDimension({prevState:e,layerId:t,columnId:n,groupId:a,previousColumn:i}){const r=e.layers.find((e=>e.layerId===t));if(!r)return e;const s={...r};if("x"===a&&(s.xAccessor=n),"y"===a&&(s.accessors=[...s.accessors.filter((e=>e!==n)),n]),"breakdown"===a&&(s.splitAccessor=n),s.layerType===$.i.REFERENCELINE){var l,o;s.accessors=[...s.accessors.filter((e=>e!==n)),n];const e=null===(l=s.yConfig)||void 0===l?void 0:l.some((({forAccessor:e})=>e===n)),t=!!i&&(null===(o=s.yConfig)||void 0===o?void 0:o.find((({forAccessor:e})=>e===i)));e||(s.yConfig=[...s.yConfig||[],{...t,forAccessor:n,axisMode:"xReferenceLine"===a?"bottom":"yReferenceLineRight"===a?"right":"left"}])}return{...e,layers:e.layers.map((e=>e.layerId===t?s:e))}},removeDimension({prevState:e,layerId:t,columnId:n,frame:a}){const i=e.layers.find((e=>e.layerId===t));if(!i)return e;const r={...i};r.xAccessor===n?delete r.xAccessor:r.splitAccessor===n?(delete r.splitAccessor,delete r.palette):r.accessors.includes(n)&&(r.accessors=r.accessors.filter((e=>e!==n))),r.yConfig&&(r.yConfig=r.yConfig.filter((({forAccessor:e})=>e!==n)));let s=e.layers.map((e=>e.layerId===t?r:e));const l=qt(Object(Z.groupBy)(s,(({layerType:e})=>e))[$.i.DATA],a.datasourceLayers,null==a?void 0:a.activeData);return Object.keys(l).every((e=>!l[e]))&&(s=s.filter((({layerType:e,accessors:t})=>e===$.i.DATA||t.length))),{...e,layers:s}},renderLayerHeader(e,t){Object(y.render)(Object(E.jsx)(O.I18nProvider,null,Object(E.jsx)(mn,t)),e)},renderToolbar(e,t){Object(y.render)(Object(E.jsx)(O.I18nProvider,null,Object(E.jsx)(yt,t)),e)},renderDimensionEditor(n,a){Object(y.render)(Object(E.jsx)(O.I18nProvider,null,Object(E.jsx)(_t,x()({},a,{formatFactory:t.deserialize,paletteService:e}))),n)},toExpression:(t,n,a)=>et(t,n,e,a),toPreviewExpression:(t,n)=>function(e,t,n){return et({...e,layers:e.layers.map((e=>{var t;return e.layerType===$.i.DATA?{...e,hide:!0}:{...e,hide:!0,yConfig:null===(t=e.yConfig)||void 0===t?void 0:t.map((({lineWidth:e,...t})=>({...t,lineWidth:1,icon:void 0,textVisibility:!1})))}})),legend:{...e.legend,isVisible:!1},valueLabels:"hide"},t,n,{})}(t,n,e),getErrorMessages(e,t){const n=({accessors:e})=>null==e||0===e.length,a=({splitAccessor:e,seriesType:t})=>t.includes("percentage")&&null==e,i=[];if(e&&e.layers.length>1){const t=[["Y",n],["Break down",a]],r=e.layers.filter((({accessors:e,xAccessor:t,splitAccessor:n,layerType:a})=>a===$.i.DATA&&(e.length>0||null!=t||null!=n)));for(const[e,n]of t){const t=kn(e,r,n);t.valid||i.push(t.payload)}}if(t&&e){i.push(...function(e,t){const n=[],a=e.layers.some(Gt("interval","date",t)),i=e.layers.some(Gt("interval","number",t)),r=e.layers.some(Gt("ordinal",void 0,t));return e.layers.length>1&&a&&i&&n.push({shortMessage:_.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureXShort",{defaultMessage:"Wrong data type for {axis}.",values:{axis:Ht("x",{isHorizontal:Pe(e.layers)})}}),longMessage:_.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureXLong",{defaultMessage:"Data type mismatch for the {axis}. Cannot mix date and number interval types.",values:{axis:Ht("x",{isHorizontal:Pe(e.layers)})}})}),e.layers.length>1&&(a||i)&&r&&n.push({shortMessage:_.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureXShort",{defaultMessage:"Wrong data type for {axis}.",values:{axis:Ht("x",{isHorizontal:Pe(e.layers)})}}),longMessage:_.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureXOrdinalLong",{defaultMessage:"Data type mismatch for the {axis}, use a different function.",values:{axis:Ht("x",{isHorizontal:Pe(e.layers)})}})}),n}(e,t));for(const n of e.layers){const a=t[n.layerId];if(a)for(const t of n.accessors){const n=a.getOperationForColumnId(t);n&&"number"!==n.dataType&&i.push({shortMessage:_.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureYShort",{defaultMessage:"Wrong data type for {axis}.",values:{axis:Ht("y",{isHorizontal:Pe(e.layers)})}}),longMessage:_.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureYLong",{defaultMessage:"The dimension {label} provided for the {axis} has the wrong data type. Expected number but have {dataType}",values:{label:n.label,dataType:n.dataType,axis:Ht("y",{isHorizontal:Pe(e.layers)})}})})}}}return i.length?i:void 0},getWarningMessages(e,t){if(0===(null==e?void 0:e.layers.length)||!t.activeData)return;const n=e.layers.filter((({accessors:e})=>e.length>0)),a=[];for(const e of n){const{layerId:n,accessors:i}=e,r=t.activeData[n]&&t.activeData[n].rows;if(!r)break;const s=Le(e,t.datasourceLayers[n]);for(const e of i){r.some((t=>Array.isArray(t[e])))&&a.push(s[e])}}return a.map((e=>Object(E.jsx)(O.FormattedMessage,{key:e,id:"xpack.lens.xyVisualization.arrayValues",defaultMessage:"{label} contains array values. Your visualization may not render as expected.",values:{label:Object(E.jsx)("strong",null,e)}})))}});function kn(e,t,n){if(t.every(n)||!t.some(n))return{valid:!0};return{valid:!1,payload:In(e,t.reduce(((e,t,a)=>(n(t)&&e.push(a),e)),[]),Pe(t))}}function In(e,t,n){const a=t.map((e=>e+1)).join(", ");switch(e){case"Break down":return{shortMessage:_.i18n.translate("xpack.lens.xyVisualization.dataFailureSplitShort",{defaultMessage:"Missing {axis}.",values:{axis:"Break down by axis"}}),longMessage:_.i18n.translate("xpack.lens.xyVisualization.dataFailureSplitLong",{defaultMessage:"{layers, plural, one {Layer} other {Layers}} {layersList} {layers, plural, one {requires} other {require}} a field for the {axis}.",values:{layers:t.length,layersList:a,axis:"Break down by axis"}})};case"Y":return{shortMessage:_.i18n.translate("xpack.lens.xyVisualization.dataFailureYShort",{defaultMessage:"Missing {axis}.",values:{axis:Ht("y",{isHorizontal:n})}}),longMessage:_.i18n.translate("xpack.lens.xyVisualization.dataFailureYLong",{defaultMessage:"{layers, plural, one {Layer} other {Layers}} {layersList} {layers, plural, one {requires} other {require}} a field for the {axis}.",values:{layers:t.length,layersList:a,axis:Ht("y",{isHorizontal:n})}})}}return{shortMessage:"",longMessage:""}}function Fn(e,t,n=$.i.DATA){return{layerId:t,seriesType:e,accessors:[],layerType:n}}function wn(e,t){return e.layers.filter((({layerType:e=$.i.DATA})=>!t||e===t))}var Tn=n(74);class xy_visualization_XyVisualization{setup(e,{expressions:t,formatFactory:a,editorFrame:i}){i.registerVisualization((async()=>{const{getXyChartRenderer:i,getXyVisualization:r}=await Promise.resolve().then(n.bind(null,529)),[,{charts:s,fieldFormats:l}]=await e.getStartServices(),o=await s.palettes.getPalettes();return t.registerRenderer(i({formatFactory:a,chartsThemeService:s.theme,chartsActiveCursorService:s.activeCursor,paletteService:o,timeZone:Object(Tn.getTimeZone)(e.uiSettings)})),r({paletteService:o,fieldFormats:l})}))}}const En=({title:e,titleId:t,...n})=>Object(E.jsx)("svg",x()({width:30,height:22,viewBox:"0 0 30 22",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(E.jsx)("title",{id:t},e):null,Object(E.jsx)("path",{className:"lensChartIcon__accent",d:"M16 1a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1V1zM0 17a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1H1a1 1 0 01-1-1v-4zm17-9a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V9a1 1 0 00-1-1h-4zm-1 9a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4zm9-17a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V1a1 1 0 00-1-1h-4z"}),Object(E.jsx)("path",{className:"lensChartIcon__subdued",d:"M0 1a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1H1a1 1 0 01-1-1V1zm0 8a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1H1a1 1 0 01-1-1V9zm9-9a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V1a1 1 0 00-1-1H9zM8 9a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1H9a1 1 0 01-1-1V9zm1 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1v-4a1 1 0 00-1-1H9zm15-7a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1V9zm1 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1v-4a1 1 0 00-1-1h-4z"})),Cn="temperature",Mn=_.i18n.translate("xpack.lens.heatmap.groupLabel",{defaultMessage:"Heatmap"}),Pn="heatmap",Sn={heatmap:{shapeType:Pn,icon:En,label:_.i18n.translate("xpack.lens.heatmap.heatmapLabel",{defaultMessage:"Heatmap"}),groupLabel:Mn}},An="x",Ln="y",Dn="cell",Nn="lens_heatmap",zn="lens_heatmap_legendConfig",Bn="lens_heatmap_grid";n(249);function Rn({colors:e,stops:t,range:n},{min:a,max:i}){if(t.length)return t.slice(0,t.length-1);const r="percent"===n?0:a,s=(("percent"===n?100:i)-r)/e.length;return e.slice(0,e.length-1).map(((e,t)=>r+(t+1)*s))}function Vn(e,t,n,a){const i=(null==t?void 0:t.colors)||Object(M.l)(e,{type:"palette",name:Cn},a).map((({color:e})=>e)),r=[i[0],...i],s=function(e,{min:t,max:n}){const a="percent"===e.range?0:t;return[e.stops.length?e.rangeMin:a,...Rn(e,{min:t,max:n})].map((a=>{let i=a;return"percent"===e.range&&(i=t+(n-t)*a/100),Number.isNaN(i)?1:Number(i.toFixed(2))}))}({gradient:!1,range:M.m.rangeType,rangeMin:M.m.rangeMin,rangeMax:M.m.rangeMax,stops:[],...t,colors:r.slice(1)},a);return{colors:r,ranges:s}}const Hn=({data:e,args:t,timeZone:n,formatFactory:a,chartsThemeService:i,onClickValue:r,onSelectRange:s,paletteService:l})=>{var o,u,c,d,p,m,g,f,b,x,v,y,j,_,O,k,I,F,w,T,C,P,S,A,L,D;const N=i.useChartsTheme(),z=i.useDarkMode(),B=Object.keys(e.tables)[0],R=e.tables[B],V=null===(o=t.palette)||void 0===o?void 0:o.params,H=R.columns.findIndex((e=>e.id===t.xAccessor)),G=R.columns.findIndex((e=>e.id===t.yAccessor)),q=R.columns[H],W=R.columns[G],$=R.columns.find((e=>e.id===t.valueAccessor)),Y=Object(h.useMemo)((()=>Object(M.n)([t.valueAccessor],R)),[t.valueAccessor,R]);if(!q||!$)return null;let K=R.rows.filter((e=>"number"==typeof e[t.valueAccessor]));W||(K=K.map((e=>({...e,unifiedY:""}))));const U=q.meta,X="date"===U.type;let Q={type:oe.ScaleType.Ordinal};if(X&&K.length>1){var Z;const e=null===(Z=De.search.aggs.getDateHistogramMetaDataByDatatableColumn(q))||void 0===Z?void 0:Z.interval,t=e?De.search.aggs.parseEsInterval(e):void 0;t&&(Q={type:oe.ScaleType.Time,interval:"fixed"===t.type?{type:"fixed",unit:t.unit,value:t.value}:{type:"calendar",unit:t.unit,value:t.value}})}const J=a(U.params),ee=a($.meta.params),{colors:te,ranges:ne}=Vn(l,V,0,Y[t.valueAccessor]),ae=ne.map(((e,t,n)=>({start:e,end:t===n.length-1?1/0:n[t+1],color:te[t+1]}))),ie={grid:{stroke:{width:null!==(u=null!==(c=t.gridConfig.strokeWidth)&&void 0!==c?c:null===(d=N.axes)||void 0===d||null===(p=d.gridLine)||void 0===p||null===(m=p.horizontal)||void 0===m?void 0:m.strokeWidth)&&void 0!==u?u:1,color:null!==(g=null!==(f=t.gridConfig.strokeColor)&&void 0!==f?f:null===(b=N.axes)||void 0===b||null===(x=b.gridLine)||void 0===x||null===(v=x.horizontal)||void 0===v?void 0:v.stroke)&&void 0!==g?g:"#D3DAE6"},cellHeight:{max:"fill",min:1}},cell:{maxWidth:"fill",maxHeight:"fill",label:{visible:null!==(y=t.gridConfig.isCellLabelVisible)&&void 0!==y&&y},border:{strokeWidth:0}},yAxisLabel:{visible:!!W&&t.gridConfig.isYAxisLabelVisible,textColor:null!==(j=null===(_=N.axes)||void 0===_||null===(O=_.tickLabel)||void 0===O?void 0:O.fill)&&void 0!==j?j:"#6a717d",padding:null!=W&&W.name?8:0,name:null!==(k=null==W?void 0:W.name)&&void 0!==k?k:"",...W?{formatter:e=>a(W.meta.params).convert(e)}:{}},xAxisLabel:{visible:t.gridConfig.isXAxisLabelVisible,textColor:null!==(I=null===(F=N.axes)||void 0===F||null===(w=F.tickLabel)||void 0===w?void 0:w.fill)&&void 0!==I?I:"#6a717d",formatter:e=>J.convert(e),name:q.name},brushMask:{fill:z?"rgb(30,31,35,80%)":"rgb(247,247,247,50%)"},brushArea:{stroke:z?"rgb(255, 255, 255)":"rgb(105, 112, 125)"},timeZone:n};return K&&K.length?Object(E.jsx)(oe.Chart,null,Object(E.jsx)(oe.Settings,{onElementClick:e=>{const t=e[0][0],{x:n,y:a}=t.datum,i=q.meta.field,s=X?i:"",l={data:[{row:R.rows.findIndex((e=>e[q.id]===n)),column:H,value:n},...W?[{row:R.rows.findIndex((e=>e[W.id]===a)),column:G,value:a}]:[]].map((e=>({row:e.row,column:e.column,value:e.value,table:R}))),timeFieldName:s};r(l)},showLegend:t.legend.isVisible,legendPosition:t.legend.position,debugState:null!==(T=window._echDebugStateFlag)&&void 0!==T&&T,theme:{...N,legend:{labelOptions:{maxLines:t.legend.shouldTruncate?null!==(C=null===(P=t.legend)||void 0===P?void 0:P.maxLines)&&void 0!==C?C:1:0}}},xDomain:{min:null!==(S=null===(A=e.dateRange)||void 0===A?void 0:A.fromDate.getTime())&&void 0!==S?S:NaN,max:null!==(L=null===(D=e.dateRange)||void 0===D?void 0:D.toDate.getTime())&&void 0!==L?L:NaN},onBrushEnd:e=>{const{x:t,y:n}=e,a=q.meta.field,i=X?a:"";if(X){s({range:t,table:R,column:H,timeFieldName:i})}else{const e=[];W&&n.forEach((t=>{e.push({row:R.rows.findIndex((e=>e[W.id]===t)),column:G,value:t})})),t.forEach((t=>{e.push({row:R.rows.findIndex((e=>e[q.id]===t)),column:H,value:t})}));const a={data:e.map((e=>({row:e.row,column:e.column,value:e.value,table:R}))),timeFieldName:i};r(a)}}}),Object(E.jsx)(oe.Heatmap,{id:B,name:$.name,colorScale:{type:"bands",bands:ae},data:K,xAccessor:t.xAccessor,yAccessor:t.yAccessor||"unifiedY",valueAccessor:t.valueAccessor,valueFormatter:e=>ee.convert(e),xScale:Q,ySortPredicate:"dataIndex",config:ie,xSortPredicate:"dataIndex"})):Object(E.jsx)(M.c,{icon:En})},Gn=v.a.memo(Hn);function qn(e){const[t,n]=Object(h.useState)({isReady:!1});return Object(h.useEffect)((()=>{n({isReady:!0})}),[n]),Object(E.jsx)(C,{className:"lnsHeatmapExpression__container",isReady:t.isReady,reportTitle:e.args.title,reportDescription:e.args.description},Object(E.jsx)(Gn,e))}const Wn=e=>({name:"lens_heatmap_renderer",displayName:_.i18n.translate("xpack.lens.heatmap.visualizationName",{defaultMessage:"Heatmap"}),help:"",validate:()=>{},reuseDomNode:!0,render:async(t,n,a)=>{j.a.render(Object(E.jsx)(O.I18nProvider,null,Object(E.jsx)(qn,x()({},n,{onClickValue:e=>{a.event({name:"filter",data:e})},onSelectRange:e=>{a.event({name:"brush",data:e})},timeZone:e.timeZone,formatFactory:e.formatFactory,chartsThemeService:e.chartsThemeService,paletteService:e.paletteService}))),t,(()=>{a.done()})),a.onDestroy((()=>j.a.unmountComponentAtNode(t)))}}),$n=({table:e,state:t,keptLayerIds:n})=>{var a,i,r,s,l,o,u;if((null==t?void 0:t.shape)===Pn&&(t.xAccessor||t.yAccessor||t.valueAccessor)&&"extended"!==e.changeType)return[];if(t&&"unchanged"===e.changeType||n.length>1||n.length&&e.layerId!==n[0])return[];let c=0;const[d,p]=Object(Z.partition)(e.columns,(e=>e.operation.isBucketed));if(d.length>=3)return[];const m=1===d.length&&0===p.length,g=("reduced"===e.changeType||e.changeType,{shape:Pn,layerId:e.layerId,layerType:$.i.DATA,legend:{isVisible:null===(a=null==t||null===(i=t.legend)||void 0===i?void 0:i.isVisible)||void 0===a||a,position:null!==(r=null==t||null===(s=t.legend)||void 0===s?void 0:s.position)&&void 0!==r?r:oe.Position.Right,type:zn},gridConfig:{type:Bn,isCellLabelVisible:!1,isYAxisLabelVisible:!0,isXAxisLabelVisible:!0}}),f=p.find((e=>"number"===e.operation.dataType));f&&(c+=.3,g.valueAccessor=f.columnId);const[b,x]=Object(Z.partition)(d,(e=>"interval"===e.operation.scale));return g.xAccessor=(null===(l=b[0])||void 0===l?void 0:l.columnId)||(null===(o=x[0])||void 0===o?void 0:o.columnId),g.yAccessor=null===(u=d.find((e=>e.columnId!==g.xAccessor)))||void 0===u?void 0:u.columnId,g.xAccessor&&(c+=.3),g.yAccessor&&(c+=.3),[{state:g,title:_.i18n.translate("xpack.lens.heatmap.heatmapLabel",{defaultMessage:"Heatmap"}),hide:!0,previewIcon:"empty",score:Number(c.toFixed(1))}]},Yn=[{id:"heatmap_legend_show",value:"show",label:_.i18n.translate("xpack.lens.heatmapChart.legendVisibility.show",{defaultMessage:"Show"})},{id:"heatmap_legend_hide",value:"hide",label:_.i18n.translate("xpack.lens.heatmapChart.legendVisibility.hide",{defaultMessage:"Hide"})}],Kn=Object(h.memo)((e=>{var t;const{state:n,setState:a}=e,i=n.legend.isVisible?"show":"hide";return Object(E.jsx)(F.EuiFlexGroup,{gutterSize:"m",justifyContent:"spaceBetween"},Object(E.jsx)(F.EuiFlexItem,null,Object(E.jsx)(F.EuiFlexGroup,{gutterSize:"none",responsive:!1},Object(E.jsx)(M.f,{groupPosition:"none",legendOptions:Yn,mode:i,onDisplayChange:e=>{const t=Yn.find((({id:t})=>t===e)).value;"show"===t?a({...n,legend:{...n.legend,isVisible:!0}}):"hide"===t&&a({...n,legend:{...n.legend,isVisible:!1}})},position:null==n?void 0:n.legend.position,onPositionChange:e=>{a({...n,legend:{...n.legend,position:e}})},maxLines:null==n?void 0:n.legend.maxLines,onMaxLinesChange:e=>{a({...n,legend:{...n.legend,maxLines:e}})},shouldTruncate:null===(t=null==n?void 0:n.legend.shouldTruncate)||void 0===t||t,onTruncateLegendChange:()=>{var e;const t=null===(e=n.legend.shouldTruncate)||void 0===e||e;a({...n,legend:{...n.legend,shouldTruncate:!t}})}}))))}));n(258);function Un(e,t,n,a){if(null==t||null==n)return{displayStops:[],activePalette:{}};const i=null!=a?a:{type:"palette",name:Cn,accessor:n},r=Object(M.n)([n],t)[n];return{displayStops:Object(M.l)(e,i,r),currentMinMax:r,activePalette:i}}function Xn(e){var t,n;const{state:a,setState:i,frame:r,accessor:s}=e,[l,o]=Object(h.useState)(!1);if((null==a?void 0:a.valueAccessor)!==s)return null;const u=null===(t=r.activeData)||void 0===t?void 0:t[a.layerId],{displayStops:c,activePalette:d,currentMinMax:p}=Un(e.paletteService,u,s,null!=a&&a.palette&&a.palette.accessor===s?a.palette:void 0);return Object(E.jsx)(F.EuiFormRow,{className:"lnsDynamicColoringRow",display:"columnCompressed",fullWidth:!0,label:_.i18n.translate("xpack.lens.paletteHeatmapGradient.label",{defaultMessage:"Color"})},Object(E.jsx)(F.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1,className:"lnsDynamicColoringClickable"},Object(E.jsx)(F.EuiFlexItem,null,Object(E.jsx)(F.EuiColorPaletteDisplay,{"data-test-subj":"lnsHeatmap_dynamicColoring_palette",palette:Object(M.o)(c,null==d||null===(n=d.params)||void 0===n?void 0:n.colorStops),type:M.d,onClick:()=>{o(!l)}})),Object(E.jsx)(F.EuiFlexItem,{grow:!1},Object(E.jsx)(F.EuiButtonEmpty,{"data-test-subj":"lnsHeatmap_dynamicColoring_trigger","aria-label":_.i18n.translate("xpack.lens.paletteHeatmapGradient.customizeLong",{defaultMessage:"Edit palette"}),iconType:"controlsHorizontal",onClick:()=>{o(!l)},size:"xs",flush:"both"},_.i18n.translate("xpack.lens.paletteHeatmapGradient.customize",{defaultMessage:"Edit"})),Object(E.jsx)(M.g,{siblingRef:e.panelRef,isOpen:l,handleClose:()=>o(!l)},Object(E.jsx)(M.b,{palettes:e.paletteService,activePalette:d,dataBounds:p,showContinuity:!1,setPalette:e=>{e.params&&!e.params.stops&&(e.params.stops=c),e.accessor=s,i({...a,palette:e})}})))))}const Qn=_.i18n.translate("xpack.lens.heatmapVisualization.heatmapGroupLabel",{defaultMessage:"Heatmap"});function Zn(e){const t=_.i18n.translate("xpack.lens.heatmap.verticalAxisLabel",{defaultMessage:"Vertical axis"}),n=_.i18n.translate("xpack.lens.heatmap.horizontalAxisLabel",{defaultMessage:"Horizontal axis"});return"x"===e?n:t}const Jn=e=>e.isBucketed&&"ordinal"===e.scale,ea=e=>Jn(e)||"interval"===e.scale,ta=e=>!Jn(e)&&("ordinal"===e.scale||"ratio"===e.scale)&&(e=>"number"===e.dataType)(e);function na(e){return{...e,colors:((null==e?void 0:e.stops)||[]).map((({color:e})=>e)),stops:"custom"===(null==e?void 0:e.name)?((null==e?void 0:e.stops)||[]).map((({stop:e})=>e)):[],reverse:!1}}const aa=({paletteService:e})=>({id:"lnsHeatmap",visualizationTypes:[{id:"heatmap",icon:En,label:_.i18n.translate("xpack.lens.heatmapVisualization.heatmapLabel",{defaultMessage:"Heatmap"}),groupLabel:Qn,showExperimentalBadge:!0}],getVisualizationTypeId:e=>e.shape,getLayerIds:e=>[e.layerId],clearLayer(e){const t={...e};return delete t.valueAccessor,delete t.xAccessor,delete t.yAccessor,t},switchVisualizationType:(e,t)=>({...t,shape:e}),getDescription:e=>Sn.heatmap,initialize:(e,t,n)=>t||{layerId:e(),layerType:$.i.DATA,title:"Empty Heatmap chart",shape:Pn,legend:{isVisible:!0,position:oe.Position.Right,maxLines:1,shouldTruncate:!0,type:zn},gridConfig:{type:Bn,isCellLabelVisible:!1,isYAxisLabelVisible:!0,isXAxisLabelVisible:!0}},getSuggestions:$n,getConfiguration({state:t,frame:n,layerId:a}){var i,r,s;if(!n.datasourceLayers[a].getTableSpec().map((({columnId:e})=>e)))return{groups:[]};const{displayStops:l,activePalette:o}=Un(e,null===(i=n.activeData)||void 0===i?void 0:i[t.layerId],t.valueAccessor,null!=t&&t.palette&&t.palette.accessor===t.valueAccessor?t.palette:void 0);return{groups:[{layerId:t.layerId,groupId:An,groupLabel:Zn(An),accessors:t.xAccessor?[{columnId:t.xAccessor}]:[],filterOperations:ea,supportsMoreColumns:!t.xAccessor,required:!0,dataTestSubj:"lnsHeatmap_xDimensionPanel"},{layerId:t.layerId,groupId:Ln,groupLabel:Zn(Ln),accessors:t.yAccessor?[{columnId:t.yAccessor}]:[],filterOperations:ea,supportsMoreColumns:!t.yAccessor,required:!1,dataTestSubj:"lnsHeatmap_yDimensionPanel"},{layerId:t.layerId,groupId:Dn,groupLabel:_.i18n.translate("xpack.lens.heatmap.cellValueLabel",{defaultMessage:"Cell value"}),accessors:t.valueAccessor?[l.length&&(n.activeData||"number"!==(null==o||null===(r=o.params)||void 0===r?void 0:r.rangeType))?{columnId:t.valueAccessor,triggerIcon:"colorBy",palette:Object(M.o)(l,null==o||null===(s=o.params)||void 0===s?void 0:s.colorStops)}:{columnId:t.valueAccessor,triggerIcon:"none"}]:[],filterOperations:ta,supportsMoreColumns:!t.valueAccessor,enableDimensionEditor:!0,required:!0,dataTestSubj:"lnsHeatmap_cellPanel"}]}},setDimension({prevState:e,layerId:t,columnId:n,groupId:a,previousColumn:i}){const r={};return a===An&&(r.xAccessor=n),a===Ln&&(r.yAccessor=n),a===Dn&&(r.valueAccessor=n),{...e,...r}},removeDimension({prevState:e,layerId:t,columnId:n}){const a={...e};return e.valueAccessor===n&&delete a.valueAccessor,e.xAccessor===n&&delete a.xAccessor,e.yAccessor===n&&delete a.yAccessor,a},renderDimensionEditor(t,n){Object(y.render)(Object(E.jsx)(O.I18nProvider,null,Object(E.jsx)(Xn,x()({},n,{paletteService:e}))),t)},renderToolbar(e,t){Object(y.render)(Object(E.jsx)(O.I18nProvider,null,Object(E.jsx)(Kn,t)),e)},getSupportedLayers:()=>[{type:$.i.DATA,label:_.i18n.translate("xpack.lens.heatmap.addLayer",{defaultMessage:"Add visualization layer"})}],getLayerType(e,t){if((null==t?void 0:t.layerId)===e)return t.layerType},toExpression(t,n,a){var i,r,s,l,o,u,c;return n[t.layerId].getTableSpec().map((({columnId:e})=>e))&&t.valueAccessor?{type:"expression",chain:[{type:"function",function:Nn,arguments:{title:[null!==(i=null==a?void 0:a.title)&&void 0!==i?i:""],description:[null!==(r=null==a?void 0:a.description)&&void 0!==r?r:""],xAccessor:[null!==(s=t.xAccessor)&&void 0!==s?s:""],yAccessor:[null!==(l=t.yAccessor)&&void 0!==l?l:""],valueAccessor:[null!==(o=t.valueAccessor)&&void 0!==o?o:""],palette:null!==(u=t.palette)&&void 0!==u&&u.params?[e.get(M.a).toExpression(na((null===(c=t.palette)||void 0===c?void 0:c.params)||{}))]:[e.get(Cn).toExpression()],legend:[{type:"expression",chain:[{type:"function",function:zn,arguments:{isVisible:[t.legend.isVisible],position:[t.legend.position]}}]}],gridConfig:[{type:"expression",chain:[{type:"function",function:Bn,arguments:{strokeWidth:t.gridConfig.strokeWidth?[t.gridConfig.strokeWidth]:[],strokeColor:t.gridConfig.strokeColor?[t.gridConfig.strokeColor]:[],cellHeight:t.gridConfig.cellHeight?[t.gridConfig.cellHeight]:[],cellWidth:t.gridConfig.cellWidth?[t.gridConfig.cellWidth]:[],isCellLabelVisible:[t.gridConfig.isCellLabelVisible],isYAxisLabelVisible:[t.gridConfig.isYAxisLabelVisible],yAxisLabelWidth:t.gridConfig.yAxisLabelWidth?[t.gridConfig.yAxisLabelWidth]:[],yAxisLabelColor:t.gridConfig.yAxisLabelColor?[t.gridConfig.yAxisLabelColor]:[],isXAxisLabelVisible:t.gridConfig.isXAxisLabelVisible?[t.gridConfig.isXAxisLabelVisible]:[]}}]}]}}]}:null},toPreviewExpression(t,n){var a,i,r,s,l;return n[t.layerId].getTableSpec().map((({columnId:e})=>e))?{type:"expression",chain:[{type:"function",function:Nn,arguments:{title:[""],description:[""],xAccessor:[null!==(a=t.xAccessor)&&void 0!==a?a:""],yAccessor:[null!==(i=t.yAccessor)&&void 0!==i?i:""],valueAccessor:[null!==(r=t.valueAccessor)&&void 0!==r?r:""],legend:[{type:"expression",chain:[{type:"function",function:zn,arguments:{isVisible:[!1],position:[]}}]}],palette:null!==(s=t.palette)&&void 0!==s&&s.params?[e.get(M.a).toExpression(na((null===(l=t.palette)||void 0===l?void 0:l.params)||{}))]:[e.get(Cn).toExpression()],gridConfig:[{type:"expression",chain:[{type:"function",function:Bn,arguments:{strokeWidth:[1],isCellLabelVisible:[!1],isYAxisLabelVisible:[!1],isXAxisLabelVisible:[!1]}}]}]}}]}:null},getErrorMessages(e){if(!e.yAccessor&&!e.xAccessor&&!e.valueAccessor)return;const t=[];return e.xAccessor||t.push({shortMessage:_.i18n.translate("xpack.lens.heatmapVisualization.missingXAccessorShortMessage",{defaultMessage:"Missing Horizontal axis."}),longMessage:_.i18n.translate("xpack.lens.heatmapVisualization.missingXAccessorLongMessage",{defaultMessage:"Configuration for the horizontal axis is missing."})}),t.length?t:void 0},getWarningMessages(e,t){if(null==e||!e.layerId||!t.activeData||!e.valueAccessor)return;const n=t.activeData[e.layerId]&&t.activeData[e.layerId].rows;if(!n)return;const a=n.some((t=>Array.isArray(t[e.valueAccessor]))),i=t.datasourceLayers[e.layerId].getOperationForColumnId(e.valueAccessor);return a?[Object(E.jsx)(O.FormattedMessage,{id:"xpack.lens.heatmapVisualization.arrayValuesWarningMessage",defaultMessage:"{label} contains array values. Your visualization may not render as expected.",values:{label:Object(E.jsx)("strong",null,null==i?void 0:i.label)}})]:void 0}});class heatmap_visualization_HeatmapVisualization{setup(e,{expressions:t,formatFactory:a,editorFrame:i,charts:r}){i.registerVisualization((async()=>{const i=Object(Tn.getTimeZone)(e.uiSettings),{getHeatmapVisualization:s,getHeatmapRenderer:l}=await Promise.resolve().then(n.bind(null,529)),o=await r.palettes.getPalettes();return t.registerRenderer(l({formatFactory:a,chartsThemeService:r.theme,paletteService:o,timeZone:i})),s({paletteService:o})}))}}var ia=n(45),ra=n(115);const sa=/[^0-9A-Za-z._@\[\]/]/;function la(e){const{namedArgument:t,variable:n,function:a}=Object(Z.groupBy)(e,(e=>Object(Z.isObject)(e)?e.type:"variable"));return{namedArguments:t||[],variables:n||[],functions:a||[]}}function oa(e){return Object(Z.isObject)(e)?"function"!==e.type?e.value:e.name:e}function ua(e,t=[]){const n=(e.operationParams||[]).reduce(((e,{name:t,type:n})=>(e[t]=n,e)),{});return t.reduce(((t,{name:a,value:i})=>(n[a]&&(t[a]=i),!e.filterable||"kql"!==a&&"lucene"!==a||(t[a]=i),e.shiftable&&"shift"===a&&(t[a]=i),t)),{})}function ca(e){return"number"===e?_.i18n.translate("xpack.lens.formula.number",{defaultMessage:"number"}):"string"===e?_.i18n.translate("xpack.lens.formula.string",{defaultMessage:"string"}):""}const da={add:{positionalArguments:[{name:_.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:ca("number")},{name:_.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:ca("number")}],help:_.i18n.translate("xpack.lens.formula.addFunction.markdown",{defaultMessage:"\nAdds up two numbers.\nAlso works with + symbol\n\nExample: Calculate the sum of two fields\n\n`sum(price) + sum(tax)`\n\nExample: Offset count by a static value\n\n`add(count(), 5)`\n    "})},subtract:{positionalArguments:[{name:_.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:ca("number")},{name:_.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:ca("number")}],help:_.i18n.translate("xpack.lens.formula.subtractFunction.markdown",{defaultMessage:"\nSubtracts the first number from the second number.\nAlso works with `-` symbol\n\nExample: Calculate the range of a field\n`subtract(max(bytes), min(bytes))`\n    "})},multiply:{positionalArguments:[{name:_.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:ca("number")},{name:_.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:ca("number")}],help:_.i18n.translate("xpack.lens.formula.multiplyFunction.markdown",{defaultMessage:"\nMultiplies two numbers.\nAlso works with `*` symbol.\n\nExample: Calculate price after current tax rate\n`sum(bytes) * last_value(tax_rate)`\n\nExample: Calculate price after constant tax rate\n`multiply(sum(price), 1.2)`\n    "})},divide:{positionalArguments:[{name:_.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:ca("number")},{name:_.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:ca("number")}],help:_.i18n.translate("xpack.lens.formula.divideFunction.markdown",{defaultMessage:"\nDivides the first number by the second number.\nAlso works with `/` symbol\n\nExample: Calculate profit margin\n`sum(profit) / sum(revenue)`\n\nExample: `divide(sum(bytes), 2)`\n    "})},abs:{positionalArguments:[{name:_.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ca("number")}],help:_.i18n.translate("xpack.lens.formula.absFunction.markdown",{defaultMessage:"\nCalculates absolute value. A negative value is multiplied by -1, a positive value stays the same.\n\nExample: Calculate average distance to sea level `abs(average(altitude))`\n    "})},cbrt:{positionalArguments:[{name:_.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ca("number")}],help:_.i18n.translate("xpack.lens.formula.cbrtFunction.markdown",{defaultMessage:"\nCube root of value.\n\nExample: Calculate side length from volume\n`cbrt(last_value(volume))`\n    "})},ceil:{positionalArguments:[{name:_.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ca("number")}],help:_.i18n.translate("xpack.lens.formula.ceilFunction.markdown",{defaultMessage:"\nCeiling of value, rounds up.\n\nExample: Round up price to the next dollar\n`ceil(sum(price))`\n    "})},clamp:{positionalArguments:[{name:_.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ca("number")},{name:_.i18n.translate("xpack.lens.formula.min",{defaultMessage:"min"}),type:ca("number")},{name:_.i18n.translate("xpack.lens.formula.max",{defaultMessage:"max"}),type:ca("number")}],help:_.i18n.translate("xpack.lens.formula.clampFunction.markdown",{defaultMessage:"\nLimits the value from a minimum to maximum.\n\nExample: Make sure to catch outliers\n```\nclamp(\n  average(bytes),\n  percentile(bytes, percentile=5),\n  percentile(bytes, percentile=95)\n)\n```\n"})},cube:{positionalArguments:[{name:_.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ca("number")}],help:_.i18n.translate("xpack.lens.formula.cubeFunction.markdown",{defaultMessage:"\nCalculates the cube of a number.\n\nExample: Calculate volume from side length\n`cube(last_value(length))`\n    "})},exp:{positionalArguments:[{name:_.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ca("number")}],help:_.i18n.translate("xpack.lens.formula.expFunction.markdown",{defaultMessage:"\nRaises *e* to the nth power.\n\nExample: Calculate the natural exponential function\n\n`exp(last_value(duration))`\n    "})},fix:{positionalArguments:[{name:_.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ca("number")}],help:_.i18n.translate("xpack.lens.formula.fixFunction.markdown",{defaultMessage:"\nFor positive values, takes the floor. For negative values, takes the ceiling.\n\nExample: Rounding towards zero\n`fix(sum(profit))`\n    "})},floor:{positionalArguments:[{name:_.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ca("number")}],help:_.i18n.translate("xpack.lens.formula.floorFunction.markdown",{defaultMessage:"\nRound down to nearest integer value\n\nExample: Round down a price\n`floor(sum(price))`\n    "})},log:{positionalArguments:[{name:_.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ca("number")},{name:_.i18n.translate("xpack.lens.formula.base",{defaultMessage:"base"}),optional:!0,defaultValue:"e",type:ca("number")}],help:_.i18n.translate("xpack.lens.formula.logFunction.markdown",{defaultMessage:"\nLogarithm with optional base. The natural base *e* is used as default.\n\nExample: Calculate number of bits required to store values\n```\nlog(sum(bytes))\nlog(sum(bytes), 2)\n```\n    "})},mod:{positionalArguments:[{name:_.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ca("number")},{name:_.i18n.translate("xpack.lens.formula.base",{defaultMessage:"base"}),type:ca("number")}],help:_.i18n.translate("xpack.lens.formula.modFunction.markdown",{defaultMessage:"\nRemainder after dividing the function by a number\n\nExample: Calculate last three digits of a value\n`mod(sum(price), 1000)`\n    "})},pow:{positionalArguments:[{name:_.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ca("number")},{name:_.i18n.translate("xpack.lens.formula.base",{defaultMessage:"base"}),type:ca("number")}],help:_.i18n.translate("xpack.lens.formula.powFunction.markdown",{defaultMessage:"\nRaises the value to a certain power. The second argument is required\n\nExample: Calculate volume based on side length\n`pow(last_value(length), 3)`\n    "})},round:{positionalArguments:[{name:_.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ca("number")},{name:_.i18n.translate("xpack.lens.formula.decimals",{defaultMessage:"decimals"}),optional:!0,defaultValue:0,type:ca("number")}],help:_.i18n.translate("xpack.lens.formula.roundFunction.markdown",{defaultMessage:"\nRounds to a specific number of decimal places, default of 0\n\nExamples: Round to the cent\n```\nround(sum(bytes))\nround(sum(bytes), 2)\n```\n    "})},sqrt:{positionalArguments:[{name:_.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ca("number")}],help:_.i18n.translate("xpack.lens.formula.sqrtFunction.markdown",{defaultMessage:"\nSquare root of a positive value only\n\nExample: Calculate side length based on area\n`sqrt(last_value(area))`\n    "})},square:{positionalArguments:[{name:_.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ca("number")}],help:_.i18n.translate("xpack.lens.formula.squareFunction.markdown",{defaultMessage:"\nRaise the value to the 2nd power\n\nExample: Calculate area based on side length\n`square(last_value(length))`\n    "})}};function pa(e){return Object(Z.isObject)(e)&&"function"===e.type&&da[e.name]}function ma(e){return"string"==typeof e?[{type:"variable",value:e,text:e,location:{min:0,max:0}}]:null==e||"number"==typeof e||"namedArgument"===e.type?[]:"variable"===e.type?[e]:e.args.flatMap(ma)}function ga(e){return Object.fromEntries(Object.entries(e).filter((([,e])=>!e.hidden)))}var fa=n(16);function ba(e,t){const n=(a=e,function e(t){return Object(Z.isObject)(t)&&"function"===t.type?[t,...t.args.flatMap(e)].filter(Boolean):[]}(a)).filter((e=>!pa(e)&&!t[e.name]));var a;return{names:Array.from(new Set(n.map((({name:e})=>e)))),locations:n.map((({location:e})=>e)).filter((e=>e))}}const xa=(e,t)=>{const n=e.split("\n").join(""),a=n.split(",").filter((e=>/(kql|lucene)/.test(e))),i=Object.keys(t).some((e=>n.includes(e)));if(0===a.length||!i)return;const r=a.flatMap((e=>e.split("count").filter((e=>/(kql|lucene)/.test(e))))),[s,l]=Object(Z.partition)(r,(e=>/kql/.test(e))),o=[];for(const e of s){const t=ha(e,"kql");t&&o.push(t)}for(const e of l){const t=ha(e,"lucene");t&&o.push(t)}return o.length?o:void 0},ha=(e,t)=>{const[,...n]=e.split("="),a=(n||[""]).join(""),i=a.trim();if(i.length&&("'"!==i[0]||!/'\s*([^']+?)\s*'/.test(a))&&"''"!==i)return _.i18n.translate("xpack.lens.indexPattern.formulaOperationQueryError",{defaultMessage:"Single quotes are required for {language}='' at {rawQuery}",values:{language:t,rawQuery:e}})},va=({value:e,name:t,text:n},a)=>{const i=ha(n,t);if(i)return i;try{return void("kql"===t?De.esKuery.toElasticsearchQuery(De.esKuery.fromKueryExpression(e),a):De.esQuery.luceneStringToDsl(e))}catch(e){return e.message}};function ya({messageId:e,values:t,locations:n}){let a;const i=t;switch(e){case"wrongFirstArgument":a=_.i18n.translate("xpack.lens.indexPattern.formulaOperationWrongFirstArgument",{defaultMessage:"The first argument for {operation} should be a {type} name. Found {argument}",values:{operation:i.operation,type:i.type,argument:i.argument}});break;case"shouldNotHaveField":a=_.i18n.translate("xpack.lens.indexPattern.formulaFieldNotRequired",{defaultMessage:"The operation {operation} does not accept any field as argument",values:{operation:i.operation}});break;case"cannotAcceptParameter":a=_.i18n.translate("xpack.lens.indexPattern.formulaParameterNotRequired",{defaultMessage:"The operation {operation} does not accept any parameter",values:{operation:i.operation}});break;case"missingParameter":a=_.i18n.translate("xpack.lens.indexPattern.formulaExpressionNotHandled",{defaultMessage:"The operation {operation} in the Formula is missing the following parameters: {params}",values:{operation:i.operation,params:i.params}});break;case"wrongTypeParameter":a=_.i18n.translate("xpack.lens.indexPattern.formulaExpressionWrongType",{defaultMessage:"The parameters for the operation {operation} in the Formula are of the wrong type: {params}",values:{operation:i.operation,params:i.params}});break;case"duplicateArgument":a=_.i18n.translate("xpack.lens.indexPattern.formulaOperationDuplicateParams",{defaultMessage:"The parameters for the operation {operation} have been declared multiple times: {params}",values:{operation:i.operation,params:i.params}});break;case"missingField":a=_.i18n.translate("xpack.lens.indexPattern.formulaFieldNotFound",{defaultMessage:"{variablesLength, plural, one {Field} other {Fields}} {variablesList} not found",values:{variablesLength:i.variablesLength,variablesList:i.variablesList}});break;case"missingOperation":a=_.i18n.translate("xpack.lens.indexPattern.operationsNotFound",{defaultMessage:"{operationLength, plural, one {Operation} other {Operations}} {operationsList} not found",values:{operationLength:i.operationLength,operationsList:i.operationsList}});break;case"fieldWithNoOperation":a=_.i18n.translate("xpack.lens.indexPattern.fieldNoOperation",{defaultMessage:"The field {field} cannot be used without operation",values:{field:i.field}});break;case"failedParsing":a=_.i18n.translate("xpack.lens.indexPattern.formulaExpressionParseError",{defaultMessage:"The Formula {expression} cannot be parsed",values:{expression:i.expression}});break;case"tooManyArguments":a=_.i18n.translate("xpack.lens.indexPattern.formulaWithTooManyArguments",{defaultMessage:"The operation {operation} has too many arguments",values:{operation:i.operation}});break;case"missingMathArgument":a=_.i18n.translate("xpack.lens.indexPattern.formulaMathMissingArgument",{defaultMessage:"The operation {operation} in the Formula is missing {count} arguments: {params}",values:{operation:i.operation,count:i.count,params:i.params}});break;case"tooManyQueries":a=_.i18n.translate("xpack.lens.indexPattern.formulaOperationDoubleQueryError",{defaultMessage:"Use only one of kql= or lucene=, not both"});break;case"tooManyFirstArguments":a=_.i18n.translate("xpack.lens.indexPattern.formulaOperationTooManyFirstArguments",{defaultMessage:"The operation {operation} in the Formula requires a {supported, plural, one {single} other {supported}} {type}, found: {text}",values:{operation:i.operation,text:i.text,type:i.type,supported:i.supported||1}});break;case"wrongArgument":a=_.i18n.translate("xpack.lens.indexPattern.formulaOperationwrongArgument",{defaultMessage:"The operation {operation} in the Formula does not support {type} parameters, found: {text}",values:{operation:i.operation,text:i.text,type:i.type}});break;case"wrongReturnedType":a=_.i18n.translate("xpack.lens.indexPattern.formulaOperationWrongReturnedType",{defaultMessage:"The return value type of the operation {text} is not supported in Formula.",values:{text:i.text}});break;default:a="no Error found"}return{message:a,locations:n}}function ja(e,t){let n;try{n=Object(ra.parse)(e)}catch(n){const a=xa(e,t);return a?{root:null,error:{message:a[0],locations:[]}}:{root:null,error:ya({messageId:"failedParsing",values:{expression:e},locations:[]})}}return{root:n,error:null}}function _a(e,t,n,a){return[...Oa(e,t,n,a),...Ia(e,t,n,a)]}function Oa(e,t,n,a){const i=[],r=ba(e,a);r.names.length&&i.push(ya({messageId:"missingOperation",values:{operationLength:r.names.length,operationsList:r.names.join(", ")},locations:r.locations}));const s=ma(e).filter((({value:e})=>!n.getFieldByName(e)&&!t.columns[e]));s.length&&i.push(ya({messageId:"missingField",values:{variablesLength:s.length,variablesList:s.map((({value:e})=>e)).join(", ")},locations:s.map((({location:e})=>e))}));const l=function(e,t){const n=[];return Object(Z.isObject)(e)&&"variable"===e.type&&!t.has(e.value)&&n.push(ya({messageId:"fieldWithNoOperation",values:{field:e.value},locations:[e.location]})),n}(e,new Set(s.map((({value:e})=>e))));return[...i,...l]}function ka(e,t,n,a){const i=[],r=function(e,t=[]){return Ta(e,t).filter((({isMissing:e,isRequired:t})=>e&&t))}(t,n);r.length&&i.push(ya({messageId:"missingParameter",values:{operation:e.name,params:r.map((({name:e})=>e)).join(", ")},locations:e.location?[e.location]:[]}));const s=function(e,t=[]){return Ta(e,t).filter((({isCorrectType:e,isMissing:t})=>!e&&!t))}(t,n);s.length&&i.push(ya({messageId:"wrongTypeParameter",values:{operation:e.name,params:s.map((({name:e})=>e)).join(", ")},locations:e.location?[e.location]:[]}));const l=function(e=[]){const t=Object.create(null);for(const{name:n}of e){const e=t[n]||0;t[n]=e+1}const n=Object.keys(t);if(e.length>n.length)return n.filter((e=>t[e]>1));return[]}(n);l.length&&i.push(ya({messageId:"duplicateArgument",values:{operation:e.name,params:l.join(", ")},locations:e.location?[e.location]:[]}));const o=function(e,t){const n=[];return(null!=e?e:[]).forEach((e=>{if("kql"===e.name||"lucene"===e.name){const a=va(e,t);a&&n.push({message:a,locations:[e.location]})}"shift"===e.name&&"invalid"===Object(fa.parseTimeShift)(e.value)&&n.push({message:_.i18n.translate("xpack.lens.indexPattern.invalidTimeShift",{defaultMessage:"Invalid time shift. Enter positive integer amount followed by one of the units s, m, h, d, w, M, y. For example 3h for 3 hours"}),locations:[e.location]})})),n}(n,a);o.length&&i.push(...o);const u=function(e){return e?e.filter((e=>"kql"===e.name||"lucene"===e.name)).length>1:void 0}(n);return u&&i.push(ya({messageId:"tooManyQueries",values:{},locations:e.location?[e.location]:[]})),i}function Ia(e,t,n,a){const i=ma(e).filter((({value:e})=>!n.getFieldByName(e)&&!t.columns[e])),r=new Set(i.map((({value:e})=>e)));return function e(t){if(!Object(Z.isObject)(t)||"function"!==t.type)return[];const i=a[t.name],s=[],{namedArguments:l,functions:o,variables:u}=la(t.args),[c]=(null==t?void 0:t.args)||[];if(i){if("field"===i.input){if(Ea(t)){if(Ma(c,"variable")){const e=Sa(t,u,{isFieldOperation:!0,firstArg:c,returnedType:wa(i,n,c)});e.length&&s.push(...e)}else pa(c)?s.push(ya({messageId:"wrongFirstArgument",values:{operation:t.name,type:_.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"}),argument:"math operation"},locations:t.location?[t.location]:[]})):s.push(ya({messageId:"wrongFirstArgument",values:{operation:t.name,type:_.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"}),argument:oa(c)||_.i18n.translate("xpack.lens.indexPattern.formulaNoFieldForOperation",{defaultMessage:"no field"})},locations:t.location?[t.location]:[]}));const e=Aa(t,o,0,{isFieldOperation:!0,type:_.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"}),firstArgValidation:!1});e.length&&s.push(...e)}else(null!=o&&o.length||null!=u&&u.length)&&s.push(ya({messageId:"shouldNotHaveField",values:{operation:t.name},locations:t.location?[t.location]:[]}));if(!Fa(i)&&l.length)s.push(ya({messageId:"cannotAcceptParameter",values:{operation:t.name},locations:t.location?[t.location]:[]}));else{const e=ka(t,i,l,n);e.length&&s.push(...e)}return s}if("fullReference"===i.input){const e=Boolean(!Ma(c,"function")||pa(c)&&Pa(c,r).length);e&&s.push(ya({messageId:"wrongFirstArgument",values:{operation:t.name,type:_.i18n.translate("xpack.lens.indexPattern.formulaOperationValue",{defaultMessage:"operation"}),argument:oa(c)||_.i18n.translate("xpack.lens.indexPattern.formulaNoOperation",{defaultMessage:"no operation"})},locations:t.location?[t.location]:[]}));const a=Aa(t,o,i.requiredReferences?i.requiredReferences.length:1,{isFieldOperation:!1,firstArgValidation:e,type:_.i18n.translate("xpack.lens.indexPattern.formulaMetricValue",{defaultMessage:"metric"})});if(a.length&&s.push(...a),!Fa(i)&&l.length)s.push(ya({messageId:"cannotAcceptParameter",values:{operation:t.name},locations:t.location?[t.location]:[]}));else{const e=Sa(t,u,{isFieldOperation:!1,firstArg:c,returnedType:void 0});e.length&&s.push(...e);const a=ka(t,i,l,n);a.length&&s.push(...a)}}return s.concat(e(o[0]))}return s.push(...Pa(t,r)),null!=o&&o.length?s.concat(o.flatMap((t=>e(t)))):s}(e)}function Fa(e){return Boolean((e.operationParams||[]).length)||e.filterable}function wa(e,t,n){var a;const i=ma(n);if(1!==i.length)return;const r=t.getFieldByName(oa(i[0]));return r?null===(a=e.getPossibleOperationForField(r))||void 0===a?void 0:a.scale:void 0}function Ta(e,t=[]){var n;const a=ua(e,t),i=[...null!==(n=e.operationParams)&&void 0!==n?n:[]];return e.filterable&&i.push({name:"kql",type:"string",required:!1},{name:"lucene",type:"string",required:!1}),i.map((({name:e,type:t,required:n})=>({name:e,isMissing:!(e in a),isCorrectType:typeof a[e]===t,isRequired:n})))}function Ea(e){return Ca(e.name)}function Ca(e){return!["count"].includes(e)}function Ma(e,t){return Object(Z.isObject)(e)&&e.type===t}function Pa(e,t){const n=function(e){return function e(t){return Object(Z.isObject)(t)&&"function"===t.type&&pa(t)?[t,...t.args.flatMap(e)].filter(Boolean):[]}(e)}(e),a=[];return n.forEach((e=>{const{positionalArguments:n}=da[e.name];if(!e.args.length)return a.push(ya({messageId:"wrongFirstArgument",values:{operation:e.name,type:"operation",argument:"()"},locations:e.location?[e.location]:[]}));e.args.length>n.length&&a.push(ya({messageId:"tooManyArguments",values:{operation:e.name},locations:e.location?[e.location]:[]}));n.some(((n,a)=>{const i=e.args[a];if(null!=i&&"number"!=typeof i)return"variable"===i.type&&!t.has(i.value)}))&&a.push(ya({messageId:"shouldNotHaveField",values:{operation:e.name},locations:e.location?[e.location]:[]}));const i=n.filter((({optional:e})=>!e));if(i.length>1&&e.args.length<i.length){const t=n.filter((({name:t,optional:n},a)=>!n&&null==e.args[a]));a.push(ya({messageId:"missingMathArgument",values:{operation:e.name,count:i.length-e.args.length,params:t.map((({name:e})=>e)).join(", ")},locations:e.location?[e.location]:[]}))}})),a}function Sa(e,t,{isFieldOperation:n,firstArg:a,returnedType:i}){const r=t.filter((e=>Ma(e,"variable")&&!pa(e))),s=[];var l;(n&&(r.length>1||1===r.length&&r[0]!==a)&&s.push(ya({messageId:"tooManyFirstArguments",values:{operation:e.name,type:_.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"}),supported:1,text:r.map((({text:e})=>e)).join(", ")},locations:e.location?[e.location]:[]})),n&&1===r.length&&r[0]===a)&&("ordinal"===i&&s.push(ya({messageId:"wrongReturnedType",values:{text:null!==(l=e.text)&&void 0!==l?l:`${e.name}(${oa(a)})`},locations:e.location?[e.location]:[]})));return!n&&r.length&&s.push(ya({messageId:"wrongArgument",values:{operation:e.name,text:r.map((({text:e})=>e)).join(", "),type:_.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"})},locations:e.location?[e.location]:[]})),s}function Aa(e,t,n=0,{isFieldOperation:a,firstArgValidation:i,type:r}){const s=[],[l,o]=Object(Z.partition)(t,(e=>!pa(e)));return l.length>n&&(a?s.push(ya({messageId:"wrongArgument",values:{operation:e.name,text:l.map((({text:e})=>e)).join(", "),type:_.i18n.translate("xpack.lens.indexPattern.formulaMetricValue",{defaultMessage:"metric"})},locations:e.location?[e.location]:[]})):s.push(ya({messageId:"tooManyFirstArguments",values:{operation:e.name,type:r,supported:n,text:l.map((({text:e})=>e)).join(", ")},locations:e.location?[e.location]:[]}))),a&&(!i&&o.length||o.length>1)&&s.push(ya({messageId:"wrongArgument",values:{operation:e.name,type:r,text:o.map((({text:e})=>e)).join(", ")},locations:e.location?[e.location]:[]})),s}var La=n(111),Da=n.n(La),Na=n(49);function za({indexPattern:e,operationDefinitionMap:t,isFullscreen:n}){const[a,i]=Object(h.useState)(),r=Object(h.useRef)({});Object(h.useEffect)((()=>{a&&r.current[a]&&r.current[a].scrollIntoView()}),[a]);const s=[];s.push({label:_.i18n.translate("xpack.lens.formulaDocumentationHeading",{defaultMessage:"How it works"}),items:[]}),s.push({label:_.i18n.translate("xpack.lens.formulaFrequentlyUsedHeading",{defaultMessage:"Common formulas"}),description:_.i18n.translate("xpack.lens.formulaCommonFormulaDocumentation",{defaultMessage:'The most common formulas are dividing two values to produce a percent. To display accurately, set "value format" to "percent".'}),items:[{label:_.i18n.translate("xpack.lens.formulaDocumentation.filterRatio",{defaultMessage:"Filter ratio"}),description:Object(E.jsx)(dn.Markdown,{markdown:_.i18n.translate("xpack.lens.formulaDocumentation.filterRatioDescription.markdown",{defaultMessage:"### Filter ratio:\n\nUse `kql=''` to filter one set of documents and compare it to other documents within the same grouping.\nFor example, to see how the error rate changes over time:\n\n```\ncount(kql='response.status_code > 400') / count()\n```\n        ",description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"})})},{label:_.i18n.translate("xpack.lens.formulaDocumentation.weekOverWeek",{defaultMessage:"Week over week"}),description:Object(E.jsx)(dn.Markdown,{markdown:_.i18n.translate("xpack.lens.formulaDocumentation.weekOverWeekDescription.markdown",{defaultMessage:"### Week over week:\n\nUse `shift='1w'` to get the value of each grouping from\nthe previous week. Time shift should not be used with the *Top values* function.\n\n```\npercentile(system.network.in.bytes, percentile=99) /\npercentile(system.network.in.bytes, percentile=99, shift='1w')\n```\n        ",description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"})})},{label:_.i18n.translate("xpack.lens.formulaDocumentation.percentOfTotal",{defaultMessage:"Percent of total"}),description:Object(E.jsx)(dn.Markdown,{markdown:_.i18n.translate("xpack.lens.formulaDocumentation.percentOfTotalDescription.markdown",{defaultMessage:"### Percent of total\n\nFormulas can calculate `overall_sum` for all the groupings,\nwhich lets you convert each grouping into a percent of total:\n\n```\nsum(products.base_price) / overall_sum(sum(products.base_price))\n```\n        ",description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"})})}]}),s.push({label:_.i18n.translate("xpack.lens.formulaDocumentation.elasticsearchSection",{defaultMessage:"Elasticsearch"}),description:_.i18n.translate("xpack.lens.formulaDocumentation.elasticsearchSectionDescription",{defaultMessage:"These functions will be executed on the raw documents for each row of the resulting table, aggregating all documents matching the break down dimensions into a single value."}),items:[]});const l=Ja(e);s[2].items.push(...l.filter((e=>{var n;return e in t&&"elasticsearch"===(null===(n=t[e].documentation)||void 0===n?void 0:n.section)})).sort().map((e=>{var n,a;return{label:e,description:Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)("h3",null,e,"(",null===(n=t[e].documentation)||void 0===n?void 0:n.signature,")"),null!==(a=t[e].documentation)&&void 0!==a&&a.description?Object(E.jsx)(dn.Markdown,{markdown:t[e].documentation.description}):null)}}))),s.push({label:_.i18n.translate("xpack.lens.formulaDocumentation.columnCalculationSection",{defaultMessage:"Column calculations"}),description:_.i18n.translate("xpack.lens.formulaDocumentation.columnCalculationSectionDescription",{defaultMessage:"These functions are executed for each row, but are provided with the whole column as context. This is also known as a window function."}),items:[]}),s[3].items.push(...l.filter((e=>{var n;return e in t&&"calculation"===(null===(n=t[e].documentation)||void 0===n?void 0:n.section)})).sort().map((e=>{var n,i;return{label:e,description:Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)("h3",null,e,"(",null===(n=t[e].documentation)||void 0===n?void 0:n.signature,")"),null!==(i=t[e].documentation)&&void 0!==i&&i.description?Object(E.jsx)(dn.Markdown,{markdown:t[e].documentation.description}):null),checked:a===`${e}: ${t[e].displayName}`?"on":void 0}}))),s.push({label:_.i18n.translate("xpack.lens.formulaDocumentation.mathSection",{defaultMessage:"Math"}),description:_.i18n.translate("xpack.lens.formulaDocumentation.mathSectionDescription",{defaultMessage:"These functions will be executed for reach row of the resulting table using single values from the same row calculated using other functions."}),items:[]});const o=Object(h.useMemo)((()=>Ja(e).filter((e=>e in da)).sort().map((e=>{const[t,n]=da[e].help.split("```");return{label:e,description:t.replace(/\n/g,"\n\n"),examples:n?`\`\`\`${n}\`\`\``:""}}))),[e]);s[4].items.push(...o.map((({label:e,description:n,examples:a})=>({label:e,description:Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)("h3",null,Ra(e,t)),Object(E.jsx)(dn.Markdown,{markdown:`${n}${a}`}))}))));const[u,c]=Object(h.useState)(""),d=u.trim().toLocaleLowerCase(),p=s.map((e=>{const t=e.items.filter((e=>!d||e.label.toLocaleLowerCase().includes(d)));return{...e,items:t}})).filter((e=>e.items.length>0||!d||e.label.toLocaleLowerCase().includes(d)));return Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiPopoverTitle,{className:"lnsFormula__docsHeader",paddingSize:"m"},_.i18n.translate("xpack.lens.formulaDocumentation.header",{defaultMessage:"Formula reference"})),Object(E.jsx)(F.EuiFlexGroup,{className:"lnsFormula__docsContent",gutterSize:"none",responsive:!1,alignItems:"stretch"},Object(E.jsx)(F.EuiFlexItem,{className:"lnsFormula__docsSidebar",grow:1},Object(E.jsx)(F.EuiFlexGroup,{className:"lnsFormula__docsSidebarInner",direction:"column",gutterSize:"none",responsive:!1},Object(E.jsx)(F.EuiFlexItem,{className:"lnsFormula__docsSearch",grow:!1},Object(E.jsx)(F.EuiFieldSearch,{value:u,onChange:e=>{c(e.target.value)},placeholder:_.i18n.translate("xpack.lens.formulaSearchPlaceholder",{defaultMessage:"Search functions"})})),Object(E.jsx)(F.EuiFlexItem,{className:"lnsFormula__docsNav"},p.map(((e,t)=>Object(E.jsx)("nav",{className:"lnsFormula__docsNavGroup",key:e.label},Object(E.jsx)(F.EuiTitle,{size:"xxs"},Object(E.jsx)("h6",null,Object(E.jsx)(F.EuiLink,{className:"lnsFormula__docsNavGroupLink",color:"text",onClick:()=>{i(e.label)}},Object(E.jsx)(F.EuiHighlight,{search:u},e.label)))),e.items.length?Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiSpacer,{size:"s"}),Object(E.jsx)(F.EuiListGroup,{gutterSize:"none"},e.items.map((e=>Object(E.jsx)(F.EuiListGroupItem,{key:e.label,label:Object(E.jsx)(F.EuiHighlight,{search:u},e.label),size:"s",onClick:()=>{i(e.label)}}))))):null)))))),Object(E.jsx)(F.EuiFlexItem,{className:"lnsFormula__docsText",grow:2},Object(E.jsx)(F.EuiText,{size:"s"},Object(E.jsx)("section",{className:"lnsFormula__docsTextIntro",ref:e=>{e&&(r.current[s[0].label]=e)}},Object(E.jsx)(dn.Markdown,{markdown:_.i18n.translate("xpack.lens.formulaDocumentation.markdown",{defaultMessage:"## How it works\n\nLens formulas let you do math using a combination of Elasticsearch aggregations and\nmath functions. There are three main types of functions:\n\n* Elasticsearch metrics, like `sum(bytes)`\n* Time series functions use Elasticsearch metrics as input, like `cumulative_sum()`\n* Math functions like `round()`\n\nAn example formula that uses all of these:\n\n```\nround(100 * moving_average(\n  average(cpu.load.pct),\n  window=10,\n  kql='datacenter.name: east*'\n))\n```\n\nElasticsearch functions take a field name, which can be in quotes. `sum(bytes)` is the same\nas `sum('bytes')`.\n\nSome functions take named arguments, like `moving_average(count(), window=5)`.\n\nElasticsearch metrics can be filtered using KQL or Lucene syntax. To add a filter, use the named\nparameter `kql='field: value'` or `lucene=''`. Always use single quotes when writing KQL or Lucene\nqueries. If your search has a single quote in it, use a backslash to escape, like: `kql='Women's''\n\nMath functions can take positional arguments, like pow(count(), 3) is the same as count() * count() * count()\n\nUse the symbols +, -, /, and * to perform basic math.\n                  ",description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"})})),s.slice(1).map(((e,t)=>Object(E.jsx)("section",{className:"lnsFormula__docsTextGroup",key:e.label,ref:t=>{t&&(r.current[e.label]=t)}},Object(E.jsx)("h2",null,e.label),Object(E.jsx)("p",null,e.description),s[t+1].items.map((e=>Object(E.jsx)("article",{className:"lnsFormula__docsTextItem",key:e.label,ref:t=>{t&&(r.current[e.label]=t)}},e.description))))))))))}const Ba=v.a.memo(za);function Ra(e,t,n){if(da[e])return`${e}(${da[e].positionalArguments.map((({name:e,optional:t,type:n})=>`[${e}]${t?"?":""}: ${n}`)).join(", ")})`;if(t[e]){var a;const n=t[e];let i="";return n.filterable&&(i+=Ca(e)||"operationParams"in n?",":"",i+=_.i18n.translate("xpack.lens.formula.kqlExtraArguments",{defaultMessage:"[kql]?: string, [lucene]?: string"})),n.filterable&&n.shiftable&&(i+=", "),n.shiftable&&(i+=_.i18n.translate("xpack.lens.formula.shiftExtraArguments",{defaultMessage:"[shift]?: string"})),`${e}(${null===(a=n.documentation)||void 0===a?void 0:a.signature}${i})`}return""}function Va(e){return e.map((({name:e,type:t,defaultValue:n=5})=>`${e}=${"string"===t?`"${n}"`:n}`)).join(", ")}const Ha=[{label:_.i18n.translate("xpack.lens.indexPattern.timeShift.hour",{defaultMessage:"1 hour ago (1h)"}),value:"1h"},{label:_.i18n.translate("xpack.lens.indexPattern.timeShift.3hours",{defaultMessage:"3 hours ago (3h)"}),value:"3h"},{label:_.i18n.translate("xpack.lens.indexPattern.timeShift.6hours",{defaultMessage:"6 hours ago (6h)"}),value:"6h"},{label:_.i18n.translate("xpack.lens.indexPattern.timeShift.12hours",{defaultMessage:"12 hours ago (12h)"}),value:"12h"},{label:_.i18n.translate("xpack.lens.indexPattern.timeShift.day",{defaultMessage:"1 day ago (1d)"}),value:"1d"},{label:_.i18n.translate("xpack.lens.indexPattern.timeShift.week",{defaultMessage:"1 week ago (1w)"}),value:"1w"},{label:_.i18n.translate("xpack.lens.indexPattern.timeShift.month",{defaultMessage:"1 month ago (1M)"}),value:"1M"},{label:_.i18n.translate("xpack.lens.indexPattern.timeShift.3months",{defaultMessage:"3 months ago (3M)"}),value:"3M"},{label:_.i18n.translate("xpack.lens.indexPattern.timeShift.6months",{defaultMessage:"6 months ago (6M)"}),value:"6M"},{label:_.i18n.translate("xpack.lens.indexPattern.timeShift.year",{defaultMessage:"1 year ago (1y)"}),value:"1y"}],Ga=Ha.reduce(((e,{value:t},n)=>({...e,[t]:n})),{});function qa(e,t,n,a){const i=e.columnOrder.find((t=>"date_histogram"===e.columns[t].operationType));if(!i&&!t.timeFieldName)return{canShift:!1};if(i&&n&&n[a]&&n[a]){const e=n[a].columns.find((e=>e.id===i));if(e){var r;const t=(null===(r=De.search.aggs.getDateHistogramMetaDataByDatatableColumn(e))||void 0===r?void 0:r.interval)||"";return{interval:De.search.aggs.parseInterval(t),expression:t,canShift:!0}}}return{canShift:!0}}function Wa({interval:e,canShift:t}){return{canShift:t,isValueTooSmall:t=>e&&t&&"object"==typeof t&&t.asMilliseconds()<e.asMilliseconds(),isValueNotMultiple:t=>e&&t&&"object"==typeof t&&!Number.isInteger(t.asMilliseconds()/e.asMilliseconds())}}function $a(e,{activeData:t}){if(!e)return;const n=[];return Object.entries(e.layers).forEach((([a,i])=>{const r=e.indexPatterns[i.indexPatternId];if(!r)return;const s=qa(i,r,t,a);if(!s.interval)return;const l=s.expression,o=s.interval.asMilliseconds();let u=[];const c={};Object.entries(i.columns).forEach((([e,t])=>{if(t.isBucketed)return;let n=0;if(t.timeShift){const e=Object(fa.parseTimeShift)(t.timeShift);if("previous"===e||"invalid"===e)return;n=e.asMilliseconds()}u.push(n),c[n]||(c[n]=[]),c[n].push(e)})),u=Object(Z.uniq)(u),u.length<2||u.forEach((e=>{0!==e&&(e<o?c[e].forEach((e=>{n.push(Object(E.jsx)(O.FormattedMessage,{key:`small-${e}`,id:"xpack.lens.indexPattern.timeShiftSmallWarning",defaultMessage:"{label} uses a time shift of {columnTimeShift} which is smaller than the date histogram interval of {interval}. To prevent mismatched data, use a multiple of {interval} as time shift.",values:{label:Object(E.jsx)("strong",null,i.columns[e].label),interval:Object(E.jsx)("strong",null,l),columnTimeShift:Object(E.jsx)("strong",null,i.columns[e].timeShift)}}))})):Number.isInteger(e/o)||c[e].forEach((e=>{n.push(Object(E.jsx)(O.FormattedMessage,{key:`multiple-${e}`,id:"xpack.lens.indexPattern.timeShiftMultipleWarning",defaultMessage:"{label} uses a time shift of {columnTimeShift} which is not a multiple of the date histogram interval of {interval}. To prevent mismatched data, use a multiple of {interval} as time shift.",values:{label:Object(E.jsx)("strong",null,i.columns[e].label),interval:Object(E.jsx)("strong",null,l),columnTimeShift:Object(E.jsx)("strong",null,i.columns[e].timeShift)}}))})))}))})),n}let Ya=function(e){return e.FIELD="field",e.NAMED_ARGUMENT="named_argument",e.FUNCTIONS="functions",e.KQL="kql",e.SHIFTS="shifts",e}({});const Ka="LENS_MATH_MARKER";function Ua(e,t,n){if("number"!=typeof e&&(!e.location||(a=t,i=e.location,a>=i.min&&a<i.max))){var a,i;if("function"===e.type){const[n]=e.args.map((n=>Ua(n,t,e))).filter((e=>e));return n||(e.location?{ast:e}:void 0)}return{ast:e,parent:n}}}function Xa(e,t){const n=e.split(/\n/);let a=t,i=1;for(const e of n){if(e.length>=a)return new Na.monaco.Position(i,a+1);a-=e.length+1,i++}throw new Error("Algorithm failure")}function Qa(e,t){return e.split(/\n/).slice(0,t.lineNumber).reduce(((e,n,a)=>e+(a===t.lineNumber-1?t.column-1:n.length+1)),0)}async function Za({expression:e,zeroIndexedOffset:t,context:n,indexPattern:a,operationDefinitionMap:i,data:r,dateHistogramInterval:s}){const l=e.substr(0,t)+Ka+e.substr(t);try{const e=Ua(Object(ra.parse)(l),t),o=null==e?void 0:e.ast,u=(null==e?void 0:e.parent)&&"number"!=typeof o&&o&&"type"in o&&"namedArgument"===o.type;if(null!=e&&e.parent&&("="===n.triggerCharacter||u))return await async function({ast:e,data:t,indexPattern:n,dateHistogramInterval:a}){if("shift"===e.name)return{list:Ha.filter((({value:e})=>{if(void 0===a)return!0;const t=Object(fa.parseTimeShift)(e);return"string"==typeof t||Number.isInteger(t.asMilliseconds()/a)})).map((({value:e})=>e)),type:Ya.SHIFTS};if("kql"!==e.name&&"lucene"!==e.name)return{list:[],type:Ya.KQL};if(!t.autocomplete.hasQuerySuggestions("kql"===e.name?"kuery":"lucene"))return{list:[],type:Ya.KQL};const i=e.value.split(Ka)[0],r=e.value.indexOf(Ka)+1,s=await t.autocomplete.getQuerySuggestions({language:"kql"===e.name?"kuery":"lucene",query:i,selectionStart:r,selectionEnd:r,indexPatterns:[n],boolFilter:[]});return{list:null!=s?s:[],type:Ya.KQL}}({ast:o,data:r,indexPattern:a,dateHistogramInterval:s});if(null!=e&&e.parent)return function(e,t,n,a,i){const{name:r}=e,s=i[r];if(!s&&!da[r])return{list:[],type:Ya.FIELD};const l=da[r];if(l)return l.positionalArguments[t]?{list:Object(Z.uniq)(Ja(a,i)).map((e=>({type:"math",label:e}))),type:Ya.FUNCTIONS}:{list:[],type:Ya.FIELD};if(t>0||!Ca(s.type)){const{namedArguments:t}=la(e.args),n=[];if(s.filterable){t.find((e=>"kql"===e.name||"lucene"===e.name))||(n.push("kql"),n.push("lucene"))}return s.shiftable&&(t.find((e=>"shift"===e.name))||n.push("shift")),"operationParams"in s&&n.push(...s.operationParams.filter((e=>!t.find((t=>t.name===e.name)))).map((e=>e.name))),{list:n,type:Ya.NAMED_ARGUMENT}}if("field"===s.input&&0===t){const t=Mo(a,i).find((({operationMetaData:e})=>"number"===e.dataType&&!e.isBucketed));if(t){const a=t.operations.filter((e=>e.operationType===s.type)).map((e=>"field"in e?e.field:void 0)).filter((e=>e)),i=e.args[0],r="string"!=typeof i&&i.location;let l;if(r){const e=Xa(n,r.min),t=Xa(n,r.max-Ka.length);l=Na.monaco.Range.fromPositions(e,t)}return{list:a,type:Ya.FIELD,range:l}}return{list:[],type:Ya.FIELD}}if("fullReference"===s.input){const e=Mo(a,i),t=[];return e.forEach((e=>{s.requiredReferences.some((t=>t.validateMetadata(e.operationMetaData)))&&t.push(...e.operations.filter((e=>s.requiredReferences.some((t=>t.input.includes(e.type))))).map((e=>e.operationType)))})),{list:Object(Z.uniq)(t).map((e=>({label:e,type:"operation"}))),type:Ya.FUNCTIONS}}return{list:[],type:Ya.FIELD}}(e.parent,e.parent.args.findIndex((e=>e===o)),l,a,i);if("object"==typeof o&&Boolean("variable"===o.type||"function"===o.type)){return function(e,t,n){return{list:Object(Z.uniq)(Ja(t,n).filter((t=>Object(Z.startsWith)(t,e)))).map((e=>({label:e,type:"operation"}))),type:Ya.FUNCTIONS}}(("function"===o.type?o.name:o.value).split(Ka)[0],a,i)}}catch(e){}return{list:[],type:Ya.FIELD}}function Ja(e,t){const n=Mo(e,t),a=[];return n.forEach((e=>{"number"!==e.operationMetaData.dataType||e.operationMetaData.isBucketed||a.push(...e.operations.filter((e=>"managedReference"!==e.type)).map((e=>e.operationType)))})),[...Object(Z.uniq)(a),...Object.keys(da)]}const ei={title:"Trigger Suggestion Dialog",id:"editor.action.triggerSuggest"};function ti(e,t){const{description:n,examples:a}=function(e,t){var n,a;const i=t[e],r=null!==(n=null===(a=i.documentation)||void 0===a?void 0:a.description)&&void 0!==n?n:"",s=[];if(!/Example/.test(r)){if(!Ca(e))return s.push(`${e}()`),{description:r,examples:s};if("field"===i.input){var l;const t=(null===(l=i.operationParams)||void 0===l?void 0:l.filter((({required:e})=>e)))||[];if(0===t.length&&s.push(`${e}(bytes)`),t.length){const n=Va(t);s.push(`${e}(bytes, ${n})`)}if(i.operationParams&&t.length!==i.operationParams.length){const t=Va(i.operationParams);s.push(`${e}(bytes, ${t})`)}}if("fullReference"===i.input){var o;const t=(null===(o=i.operationParams)||void 0===o?void 0:o.filter((({required:e})=>e)))||[];if(0===t.length&&s.push(`${e}(sum(bytes))`),t.length){const n=Va(t);s.push(`${e}(sum(bytes), ${n})`)}if(i.operationParams&&t.length!==i.operationParams.length){const t=Va(i.operationParams);s.push(`${e}(sum(bytes), ${t})`)}}}return{description:r,examples:s}}(e,t);return{value:`${n}${a.length?`\n\n**${_.i18n.translate("xpack.lens.formulaExampleMarkdown",{defaultMessage:"Examples"})}**\n\n  ${a.map((e=>`\`${e}\``)).join("\n\n")}`:""}`}}function ni(e,t){if(da[e]){return[{label:Ra(e,t),documentation:{value:da[e].help.replace(/\n/g,"\n\n")},parameters:da[e].positionalArguments.map((e=>({label:e.name,documentation:e.optional?_.i18n.translate("xpack.lens.formula.optionalArgument",{defaultMessage:"Optional. Default value is {defaultValue}",values:{defaultValue:e.defaultValue}}):""})))}]}if(t[e]){const n=t[e],a=Ca(e)?{label:"field"===n.input?"field":"fullReference"===n.input?"function":""}:null,i=Ra(e,t),r=ti(e,t);return"operationParams"in n&&n.operationParams?[{label:i,parameters:[...a?[a]:[],...n.operationParams.map((e=>({label:`${e.name}=${e.type}`,documentation:e.required?_.i18n.translate("xpack.lens.formula.requiredArgument",{defaultMessage:"Required"}):""})))],documentation:r}]:[{label:i,parameters:a?[a]:[],documentation:r}]}return[]}function ai(e,t){const n=e.substr(0,t)+Ka+e.substr(t);try{return Ua(Object(ra.parse)(n),t)}catch(e){return}}const ii="lens_math";Na.monaco.languages.register({id:ii});const ri={wordPattern:/[^()'"\s]+/g,brackets:[["(",")"]],autoClosingPairs:[{open:"(",close:")"},{open:"'",close:"'"},{open:'"',close:'"'}],surroundingPairs:[{open:"(",close:")"},{open:"'",close:"'"},{open:'"',close:'"'}]};Na.monaco.languages.setMonarchTokensProvider(ii,{defaultToken:"invalid",tokenPostfix:"",ignoreCase:!0,brackets:[{open:"(",close:")",token:"delimiter.parenthesis"}],escapes:/\\(?:[\\"'])/,tokenizer:{root:[[/\s+/,"whitespace"],[/-?(\d*\.)?\d+([eE][+\-]?\d+)?/,"number"],[/[a-zA-Z0-9][a-zA-Z0-9_\-\.]*/,"keyword"],[/[,=:]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string_dq"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/'/,"string","@string_sq"],[/\+|\-|\*|\//,"keyword.operator"],[/[\(]/,"delimiter"],[/[\)]/,"delimiter"]],string_dq:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_sq:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]]}}),Na.monaco.languages.setLanguageConfiguration(ii,ri);n(300);const si={type:"math",displayName:"Math",hidden:!0,getDefaultLabel:(e,t)=>"Math",input:"managedReference",getDisabledStatus(e){},getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio"}),toExpression:(e,t)=>{const n=e.columns[t];return[{type:"function",function:"mathColumn",arguments:{id:[t],name:[n.label],expression:[li(n.params.tinymathAst)],onError:["null"]}}]},buildColumn:()=>({label:"Math",dataType:"number",operationType:"math",isBucketed:!1,scale:"ratio",params:{tinymathAst:""},references:[]}),isTransferable:(e,t)=>!0,createCopy:e=>({...e})};function li(e){return"number"==typeof e?e:"string"==typeof e?`"${e}"`:"variable"===e.type?e.value:"namedArgument"===e.type?"kql"===e.name||"lucene"===e.name?`${e.name}='${e.value}'`:`${e.name}=${e.value}`:`${e.name}(${e.args.map(li).join(",")})`}const oi={displayName:_.i18n.translate("xpack.lens.indexPattern.records",{defaultMessage:"Records"}),name:_.i18n.translate("xpack.lens.indexPattern.records",{defaultMessage:"Records"}),type:"document",aggregatable:!0,searchable:!0};function ui(e,t){return`${e}X${t}`}function ci(e,t,n,a,i,r){const{root:s,error:l}=ja(e,i);if(l||null==s)return{extracted:[],isValid:!1};if(_a(s,t,a,i).length)return{extracted:[],isValid:!1};const o=function(e,t,n,a,i,r){const s=[];function l(n){if("number"==typeof n||"function"!==n.type)return n;const o=t[n.name];if(!o){const e=n.args.map(l).filter((e=>null!=e));return{...n,args:e}}const{namedArguments:u,variables:c,functions:d}=la(n.args);if("field"===o.input){const[t]=c.filter((e=>Object(Z.isObject)(e))),l=Ea(n)?i.getFieldByName(t.value):oi,d=ua(o,u||[]),p=o.buildColumn({layer:a,indexPattern:i,field:l},d),m=ui(e,s.length);return p.customLabel=!0,p.label=r,s.push({column:p,location:n.location}),m}if("fullReference"===o.input){const[t]=d,c=l(t),p="string"!=typeof c;if(p){const e=c?ma(c):[],t=si.buildColumn({layer:a,indexPattern:i});t.references=e.map((({value:e})=>e)),t.params.tinymathAst=c,s.push({column:t}),t.customLabel=!0,t.label=r}const m=ua(o,u||[]),g=o.buildColumn({layer:a,indexPattern:i,referenceIds:[p?ui(e,s.length-1):c]},m),f=ui(e,s.length);return g.customLabel=!0,g.label=r,s.push({column:g,location:n.location}),f}}const o=l(n);if(void 0===o)return[];const u="string"!=typeof o;if(u){const e=ma(o),t=si.buildColumn({layer:a,indexPattern:i});t.references=e.map((({value:e})=>e)),t.params.tinymathAst=o,t.customLabel=!0,t.label=r,s.push({column:t})}return s}(n,i,s,t,a,_.i18n.translate("xpack.lens.indexPattern.formulaPartLabel",{defaultMessage:"Part of {label}",values:{label:r||e}}));return{extracted:o,isValid:!0}}function di(e,t,n,a,i,r){const{extracted:s,isValid:l}=ci(e,t,n,i,ga(r),a.customLabel?a.label:void 0),o={...t.columns},u={};return Object.keys(o).forEach((e=>{e.startsWith(n)&&delete o[e]})),s.forEach((({column:e,location:t},a)=>{o[ui(n,a)]=e,t&&(u[ui(n,a)]=t)})),o[n]={...a,label:a.customLabel?a.label:null!=e?e:_.i18n.translate("xpack.lens.indexPattern.formulaLabel",{defaultMessage:"Formula"}),params:{...a.params,formula:e,isFormulaBroken:!l},references:l?[ui(n,s.length-1)]:[]},{newLayer:{...t,columns:o,columnOrder:Hi({...t,columns:o})},locations:u}}function pi(e,t,n){const a=null==e?void 0:e[t];return!(!a||0===a.rows.length)&&a.rows.some((e=>null!=e[n]))}const mi=v.a.memo(gi);function gi({layer:e,updateLayer:t,currentColumn:n,columnId:a,indexPattern:i,operationDefinitionMap:r,data:s,toggleFullscreen:l,isFullscreen:o,setIsCloseable:u,dateHistogramInterval:c,hasData:d}){var p;const[m,g]=Object(h.useState)(n.params.formula),[f,b]=Object(h.useState)([]),[y,j]=Object(h.useState)(o),[O,k]=Object(h.useState)(!1),[I,w]=Object(h.useState)(!0),C=v.a.useRef(),P=v.a.useRef(),S=v.a.useRef([]),A=v.a.useRef(),L=Object(h.useMemo)((()=>ga(r)),[r]),D="interval"in c?null===(p=c.interval)||void 0===p?void 0:p.asMilliseconds():void 0,N=Object(h.useRef)(D);if(N.current=D,null==P||!P.current){const e=P.current=document.createElement("div");e.setAttribute("data-test-subj","lnsFormulaWidget"),e.classList.add("lnsFormulaOverflow","monaco-editor"),document.body.appendChild(e)}Object(h.useEffect)((()=>{const e=C,t=S,n=A;return()=>{var a,i,r,s,l;null===(a=e.current)||void 0===a||a.dispose(),null===(i=P.current)||void 0===i||null===(r=i.parentNode)||void 0===r||r.removeChild(P.current),null===(s=n.current)||void 0===s||s.dispose(),null===(l=t.current)||void 0===l||l.forEach((e=>e.dispose()))}}),[]),Da()((()=>{u(!0),m!==n.params.formula&&t((e=>di(m||"",e,a,n,i,r).newLayer))})),Object(M.p)((()=>{if(!C.current)return;if(!m){if(b([]),Na.monaco.editor.setModelMarkers(C.current,"LENS",[]),n.params.formula){const{newLayer:s}=di(m||"",e,a,n,i,r);t(s)}return}let s=[];const{root:l,error:o}=ja(m,L);if(o)s=[o];else if(l){const t=_a(l,e,i,L);t.length&&(s=t)}if(s.length){const r=n.params.isFormulaBroken,l=!n.params.isFormulaBroken&&!d;(r||l)&&n.params.formula!==m&&t(di(m||"",e,a,n,i,L).newLayer);const o=s.flatMap((e=>{if(e.locations.length)return e.locations.map((t=>{const n=Xa(m,t.min),a=Xa(m,t.max);return{message:e.message,startColumn:n.column+1,startLineNumber:n.lineNumber,endColumn:a.column+1,endLineNumber:a.lineNumber,severity:"warning"===e.severity?Na.monaco.MarkerSeverity.Warning:Na.monaco.MarkerSeverity.Error}}));{const t=Xa(m,0),n=Xa(m,m.length-1);return[{message:e.message,startColumn:t.column+1,startLineNumber:t.lineNumber,endColumn:n.column+1,endLineNumber:n.lineNumber,severity:"warning"===e.severity?Na.monaco.MarkerSeverity.Warning:Na.monaco.MarkerSeverity.Error}]}}));Na.monaco.editor.setModelMarkers(C.current,"LENS",o),b(o.map((({severity:e,message:t})=>({severity:e,message:t}))))}else{Na.monaco.editor.setModelMarkers(C.current,"LENS",[]);const{newLayer:r,locations:s}=di(m||"",e,a,n,i,L);t(r);const l=Ji(a,r.columns).flatMap((([e,t])=>{const n=[];if(s[e]){const a=L[t.operationType];if(a.getErrorMessage){const t=a.getErrorMessage(r,e,i,L);if(t){const a=Xa(m,s[e].min),i=Xa(m,s[e].max);n.push({message:t.join(", "),startColumn:a.column+1,startLineNumber:a.lineNumber,endColumn:i.column+1,endLineNumber:i.lineNumber,severity:Na.monaco.MarkerSeverity.Warning})}}if(a.shiftable&&t.timeShift){const a=Xa(m,s[e].min),i=Xa(m,s[e].max);n.push(...function(e,t){const{isValueTooSmall:n,isValueNotMultiple:a}=Wa(e),i=[],r=t.timeShift&&Object(fa.parseTimeShift)(t.timeShift),s=r&&n(r),l=r&&a(r);return s?i.push(_.i18n.translate("xpack.lens.indexPattern.timeShift.tooSmallHelp",{defaultMessage:"Time shift should to be larger than the date histogram interval. Either increase time shift or specify smaller interval in date histogram"})):l&&i.push(_.i18n.translate("xpack.lens.indexPattern.timeShift.noMultipleHelp",{defaultMessage:"Time shift should be a multiple of the date histogram interval. Either adjust time shift or date histogram interval"})),i}(c,t).map((e=>({message:e,startColumn:a.column+1,startLineNumber:a.lineNumber,endColumn:i.column+1,endLineNumber:i.lineNumber,severity:Na.monaco.MarkerSeverity.Warning}))))}}return n})).filter((e=>e));b(l.map((({severity:e,message:t})=>({severity:e,message:t})))),Na.monaco.editor.setModelMarkers(C.current,"LENS",l)}}),{skipFirstRender:!1},256,[m]);const z=f.filter((e=>e.severity===Na.monaco.MarkerSeverity.Error)).length,B=f.filter((e=>e.severity===Na.monaco.MarkerSeverity.Warning)).length,R=Object(h.useCallback)((async(e,t,n)=>{const a=e.getValue();let r={list:[],type:Ya.FIELD};const l=Qa(a,t);if("("===n.triggerCharacter){"()"===a.slice(l-1,l+1)&&(t=t.delta(0,-1));e.getWordAtPosition(t.delta(0,-3))&&(r=await Za({expression:a,zeroIndexedOffset:l,context:n,indexPattern:i,operationDefinitionMap:L,data:s,dateHistogramInterval:N.current}))}else r=await Za({expression:a,zeroIndexedOffset:l,context:n,indexPattern:i,operationDefinitionMap:L,data:s,dateHistogramInterval:N.current});return{suggestions:r.list.map((e=>function(e,t,n,a,i){var r;let s,l,o,u=Na.monaco.languages.CompletionItemKind.Method,c="string"==typeof e?e:"label"in e?e.label:e.text,d="",p="";const m=c;switch(t){case Ya.SHIFTS:p=String(Ga[c]).padStart(4,"0");break;case Ya.FIELD:u=Na.monaco.languages.CompletionItemKind.Value,sa.test(c)&&(s=`'${c.replaceAll("'","\\'")}'`);break;case Ya.FUNCTIONS:if(s=`${c}($0)`,l=Na.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,"string"!=typeof e){if("text"in e)break;c=Ra(e.label,n),da[e.label]?(d="TinyMath",u=Na.monaco.languages.CompletionItemKind.Method):(u=Na.monaco.languages.CompletionItemKind.Constant,d="Elasticsearch",p=`0${c}`,o=ei)}break;case Ya.NAMED_ARGUMENT:u=Na.monaco.languages.CompletionItemKind.Keyword,"kql"!==c&&"lucene"!==c&&"shift"!==c||(o=ei,s=`${c}='$0'`,l=Na.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,p=`zzz${c}`),c=`${c}=`,d="";break;case Ya.KQL:":"===a?s=`${a} ${c}`:o=ei,c.includes("'")&&(s=(s||c).replaceAll("'","\\'"))}return{detail:d,kind:u,label:c,insertText:null!==(r=s)&&void 0!==r?r:c,insertTextRules:l,command:o,additionalTextEdits:[],range:i,sortText:p,filterText:m}}(e,r.type,L,n.triggerCharacter,r.range)))}}),[i,L,s,N]),V=Object(h.useCallback)((async(e,t,n,a)=>{const i=e.getValue(),r=e.getFullModelRange(),s=e.getValueLengthInRange({startLineNumber:t.lineNumber,startColumn:t.column,endLineNumber:r.endLineNumber,endColumn:r.endColumn});return function(e,t,n){const a=e.substr(0,t)+Ka+e.substr(t);try{const e=Ua(Object(ra.parse)(a),t);let i=[],r=0;if(null!=e&&e.parent){const t=e.parent.name;r=e.parent.args.findIndex((t=>t===e.ast)),i=ni(t,n)}else"object"==typeof(null==e?void 0:e.ast)&&"function"===e.ast.type&&(i=ni(e.ast.name,n));if(i.length)return{value:{signatures:i.map((({documentation:e,...t})=>({...t,documentation:{value:e.value.split("\n\n")[0]}}))),activeParameter:r,activeSignature:0},dispose:()=>{}}}catch(e){}return{value:{signatures:[],activeParameter:0,activeSignature:0},dispose:()=>{}}}(e.getValue(),i.length-s,L)}),[L]),H=Object(h.useCallback)((async(e,t,n)=>{const a=e.getValue(),i=e.getFullModelRange(),r=e.getValueLengthInRange({startLineNumber:t.lineNumber,startColumn:t.column,endLineNumber:i.endLineNumber,endColumn:i.endColumn});return function(e,t,n){try{const a=Ua(Object(ra.parse)(e),t);if(!a||"number"==typeof a.ast||!("name"in a.ast))return{contents:[]};const i=ni(a.ast.name,n);if(i.length){const{label:e}=i[0];return{contents:[{value:e}]}}}catch(e){}return{contents:[]}}(e.getValue(),a.length-r,L)}),[L]),G=Object(h.useCallback)(((e,t)=>{if(!(e.isFlush||e.isRedoing||e.isUndoing)&&1===e.changes.length){const n=e.changes[0].text;if("="!==n&&"'"!==n)return;const a=e.changes[0].range;if(a){const e=t.getValue(),i=Qa(e,new Na.monaco.Position(a.startLineNumber,a.startColumn));let r=ai(e,i+1);if(!r&&"'"===n){const t=e;r=ai(t.substring(0,i)+"\\'"+t.substring(i+1),i+2)}const s=/'LENS_MATH_MARKER/;if(!r||"number"==typeof r.ast||"namedArgument"!==r.ast.type||"kql"!==r.ast.name&&"lucene"!==r.ast.name&&"shift"!==r.ast.name||"LENS_MATH_MARKER"!==r.ast.value&&!s.test(r.ast.value))return;let l=null;const o=2;"="===n&&(l={range:{...a,startColumn:a.startColumn+1,endColumn:a.startColumn+1},text:"''"}),"'"===n&&"shift"!==r.ast.name&&(l={range:{...a,startColumn:a.startColumn,endColumn:a.startColumn+1},text:"\\'"}),l&&setTimeout((()=>{t.executeEdits("LENS",[l],[new Na.monaco.Selection(a.startLineNumber,a.startColumn+o,a.startLineNumber,a.startColumn+o)]),t.setPosition({column:a.startColumn+o,lineNumber:a.startLineNumber}),t.trigger("lens","editor.action.triggerSuggest",{})}),0)}}}),[]),q={languageId:ii,value:null!=m?m:"",onChange:g,options:{automaticLayout:!1,fontSize:14,folding:!1,lineNumbers:"off",scrollBeyondLastLine:!1,minimap:{enabled:!1},wordWrap:I?"on":"off",wordBasedSuggestions:!1,autoIndent:"brackets",wrappingIndent:"none",dimension:{width:320,height:200},fixedOverflowWidgets:!0,matchBrackets:"always",lineDecorationsWidth:16}};return Object(h.useEffect)((()=>{const{dispose:e}=Na.monaco.languages.registerCompletionItemProvider(ii,{triggerCharacters:[".","(","="," ",":","'"],provideCompletionItems:R}),{dispose:t}=Na.monaco.languages.registerSignatureHelpProvider(ii,{signatureHelpTriggerCharacters:["(","="],provideSignatureHelp:V}),{dispose:n}=Na.monaco.languages.registerHoverProvider(ii,{provideHover:H});return()=>{e(),t(),n()}}),[R,V,H]),Object(E.jsx)("div",{className:T()({lnsIndexPatternDimensionEditor:!0,"lnsIndexPatternDimensionEditor-isFullscreen":o})},Object(E.jsx)("div",{className:"lnsIndexPatternDimensionEditor__section lnsIndexPatternDimensionEditor__section--shaded"},Object(E.jsx)("div",{className:"lnsFormula"},Object(E.jsx)("div",{className:"lnsFormula__editor"},Object(E.jsx)("div",{className:"lnsFormula__editorHeader"},Object(E.jsx)(F.EuiFlexGroup,{alignItems:"center",gutterSize:"m",responsive:!1},Object(E.jsx)(F.EuiFlexItem,{className:"lnsFormula__editorHeaderGroup"},Object(E.jsx)(F.EuiToolTip,{content:I?_.i18n.translate("xpack.lens.formula.disableWordWrapLabel",{defaultMessage:"Disable word wrap"}):_.i18n.translate("xpack.lens.formulaEnableWordWrapLabel",{defaultMessage:"Enable word wrap"}),position:"top"},Object(E.jsx)(F.EuiButtonIcon,{iconType:I?"wordWrap":"wordWrapDisabled",display:I?void 0:"fill",color:"text","aria-label":I?_.i18n.translate("xpack.lens.formula.disableWordWrapLabel",{defaultMessage:"Disable word wrap"}):_.i18n.translate("xpack.lens.formulaEnableWordWrapLabel",{defaultMessage:"Enable word wrap"}),isSelected:!I,onClick:()=>{var e;null===(e=A.current)||void 0===e||e.updateOptions({wordWrap:I?"off":"on"}),w(!I)}}))),Object(E.jsx)(F.EuiFlexItem,{className:"lnsFormula__editorHeaderGroup",grow:!1},Object(E.jsx)(F.EuiButtonEmpty,{onClick:()=>{l(),j(!o),Object(at.e)("toggle_formula_fullscreen")},iconType:o?"fullScreenExit":"fullScreen",size:"xs",color:"text",flush:"right","data-test-subj":"lnsFormula-fullscreen"},o?_.i18n.translate("xpack.lens.formula.fullScreenExitLabel",{defaultMessage:"Collapse"}):_.i18n.translate("xpack.lens.formula.fullScreenEnterLabel",{defaultMessage:"Expand"}))))),Object(E.jsx)("div",{className:"lnsFormula__editorContent"},Object(E.jsx)(dn.CodeEditor,x()({},q,{options:{...q.options,overflowWidgetsDomNode:P.current},editorDidMount:e=>{A.current=e;const t=e.getModel();t&&(C.current=t),S.current.push(e.onDidFocusEditorWidget((()=>{setTimeout((()=>{u(!1)}))}))),S.current.push(e.onDidBlurEditorWidget((()=>{setTimeout((()=>{u(!0)}))}))),S.current.push(e.onDidChangeModelContent((t=>{G(t,e)})))}})),m?null:Object(E.jsx)("div",{className:"lnsFormula__editorPlaceholder"},Object(E.jsx)(F.EuiText,{color:"subdued",size:"s"},_.i18n.translate("xpack.lens.formulaPlaceholderText",{defaultMessage:"Type a formula by combining functions with math, like:"})),Object(E.jsx)(F.EuiSpacer,{size:"s"}),Object(E.jsx)("pre",null,"count() + 1"))),Object(E.jsx)("div",{className:"lnsFormula__editorFooter"},Object(E.jsx)(F.EuiFlexGroup,{alignItems:"center",gutterSize:"m",responsive:!1},Object(E.jsx)(F.EuiFlexItem,{className:"lnsFormula__editorFooterGroup"},o?Object(E.jsx)(F.EuiToolTip,{content:y?_.i18n.translate("xpack.lens.formula.editorHelpInlineHideToolTip",{defaultMessage:"Hide function reference"}):_.i18n.translate("xpack.lens.formula.editorHelpInlineShowToolTip",{defaultMessage:"Show function reference"}),delay:"long",position:"top"},Object(E.jsx)(F.EuiLink,{"aria-label":_.i18n.translate("xpack.lens.formula.editorHelpInlineHideLabel",{defaultMessage:"Hide function reference"}),className:"lnsFormula__editorHelp lnsFormula__editorHelp--inline",color:"text",onClick:()=>j(!y)},Object(E.jsx)(F.EuiIcon,{type:"documentation"}),Object(E.jsx)(F.EuiIcon,{type:y?"arrowDown":"arrowUp"}))):Object(E.jsx)(M.k,{tooltipContent:_.i18n.translate("xpack.lens.formula.editorHelpOverlayToolTip",{defaultMessage:"Function reference"}),condition:!y,position:"top",delay:"regular"},Object(E.jsx)(F.EuiPopover,{panelClassName:"lnsFormula__docs lnsFormula__docs--overlay",panelPaddingSize:"none",anchorPosition:"leftCenter",isOpen:y,closePopover:()=>j(!1),ownFocus:!1,button:Object(E.jsx)(F.EuiButtonIcon,{className:"lnsFormula__editorHelp lnsFormula__editorHelp--overlay",onClick:()=>{y||Object(at.e)("open_formula_popover"),j(!y)},iconType:"documentation",color:"text","aria-label":_.i18n.translate("xpack.lens.formula.editorHelpInlineShowToolTip",{defaultMessage:"Show function reference"})})},Object(E.jsx)(Ba,{isFullscreen:o,indexPattern:i,operationDefinitionMap:L})))),z||B?Object(E.jsx)(F.EuiFlexItem,{className:"lnsFormula__editorFooterGroup",grow:!1},Object(E.jsx)(F.EuiPopover,{ownFocus:!1,isOpen:O,closePopover:()=>k(!1),button:Object(E.jsx)(F.EuiButtonEmpty,{color:z?"danger":"warning",className:"lnsFormula__editorError",iconType:"alert",size:"xs",flush:"right",onClick:()=>{k(!O)}},z?_.i18n.translate("xpack.lens.formulaErrorCount",{defaultMessage:"{count} {count, plural, one {error} other {errors}}",values:{count:z}}):null,B?_.i18n.translate("xpack.lens.formulaWarningCount",{defaultMessage:"{count} {count, plural, one {warning} other {warnings}}",values:{count:B}}):null)},f.map((({message:e,severity:t},n)=>Object(E.jsx)("div",{key:n,className:"lnsFormula__warningText"},Object(E.jsx)(F.EuiText,{size:"s",color:t===Na.monaco.MarkerSeverity.Warning?"warning":"danger"},e)))))):null))),o&&y?Object(E.jsx)("div",{className:"lnsFormula__docs lnsFormula__docs--inline"},Object(E.jsx)(Ba,{isFullscreen:o,indexPattern:i,operationDefinitionMap:L})):null)))}function fi(e,t){if(!t)return;const{sourceField:n,operationType:a}=e,i=n?t.getFieldByName(n):void 0,r=a&&Fo[a],s=Boolean(n&&r&&!(i&&"field"===(null==r?void 0:r.input)&&void 0!==r.getPossibleOperationForField(i))),l=Boolean(n&&r&&i&&!r.isTransferable(e,t,Fo));return s?l?[_.i18n.translate("xpack.lens.indexPattern.fieldWrongType",{defaultMessage:"Field {invalidField} is of the wrong type",values:{invalidField:n}})]:[_.i18n.translate("xpack.lens.indexPattern.fieldNotFound",{defaultMessage:"Field {invalidField} was not found",values:{invalidField:n}})]:void 0}function bi(e,t){const n=t.getFieldByName(e);return n?n.displayName:_.i18n.translate("xpack.lens.indexPattern.missingFieldLabel",{defaultMessage:"Missing field"})}function xi(e,t,n,a){const i=Number(e);return""!==e&&null!=e&&!Number.isNaN(i)&&Number.isFinite(i)&&(!t||Number.isInteger(i))&&(void 0===n||i<=n)&&(void 0===a||i>=a)}function hi(e,t){return t.operationType===e}function vi(e){return Boolean("params"in e&&e.params&&"format"in e.params)}function yi(e){return"number"===(null==e?void 0:e.dataType)&&vi(e)&&e.params?{format:e.params.format}:void 0}function ji(e,t){let n=null==e?void 0:e.filter;var a;if(t)if("kql"in t)n={query:null!==(a=t.kql)&&void 0!==a?a:"",language:"kuery"};else if("lucene"in t){var i;n={query:null!==(i=t.lucene)&&void 0!==i?i:"",language:"lucene"}}return n}function _i({sourceField:e,operationType:t}){return e&&"count"!==t?sa.test(e)?`'${e.replaceAll("'","\\'")}'`:e:""}function Oi(e,t,n,a){if(hi("static_value",e)&&e.params&&"value"in e.params)return String(e.params.value);if("references"in e){const a=t.columns[e.references[0]];if(a&&"sourceField"in a&&"number"===a.dataType){const t=_i(a);n+=`${e.operationType}(${a.operationType}(${t})`}}else e&&"sourceField"in e&&"number"===e.dataType&&(n+=`${e.operationType}(${_i(e)}`);const i=function(e,t){if(!t)return[];const n=t[e.operationType];if("operationParams"in n&&(a=e,Boolean("params"in a&&a.params)))return(n.operationParams||[]).flatMap((({name:t,required:n})=>{const a=e.params[t];return Object(Z.isObject)(a)?Object.keys(a).map((e=>({name:`${t}-${e}`,value:a[e],required:n}))):{name:t,value:a,required:n}}));var a;return[]}(e,a);return i.length&&(n+=", "+i.map((({name:e,value:t})=>`${e}=${t}`)).join(", ")),e.filter&&("count"!==e.operationType&&(n+=", "),n+=("kuery"===e.filter.language?"kql=":"lucene=")+`'${e.filter.query.replace(/'/g,"\\'")}'`),e.timeShift&&(("count"!==e.operationType||e.filter)&&(n+=", "),n+=`shift='${e.timeShift}'`),n&&(n+=")"),n}const ki=_.i18n.translate("xpack.lens.indexPattern.formulaLabel",{defaultMessage:"Formula"}),Ii={type:"formula",displayName:ki,getDefaultLabel:(e,t)=>{var n;return null!==(n=e.params.formula)&&void 0!==n?n:ki},input:"managedReference",hidden:!0,getDisabledStatus(e){},getErrorMessage(e,t,n,a){const i=e.columns[t];if(!i.params.formula||!a)return;const r=ga(a),{root:s,error:l}=ja(i.params.formula,r);if(l||null==s)return null!=l&&l.message?[l.message]:[];const o=_a(s,e,n,r);if(o.length)return o.map((({message:e})=>e));const u=Ji(t,e.columns).flatMap((([t,a])=>{const i=r[a.operationType];if(null!=i&&i.getErrorMessage){const a=i.getErrorMessage(e,t,n,r);return a?{message:a.join(", ")}:[]}return[]})).filter((e=>e));return u.length?u.map((({message:e})=>e)):void 0},getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio"}),toExpression:(e,t)=>{var n;const a=e.columns[t],i=a.params,r=a.label!==ki,s=null!=i&&i.isFormulaBroken?ki:r?a.label:null!==(n=null==i?void 0:i.formula)&&void 0!==n?n:ki;return[{type:"function",function:a.references.length?"mathColumn":"mapColumn",arguments:{id:[t],name:[s||ki],expression:[a.references.length?`"${a.references[0]}"`:""]}}]},buildColumn({previousColumn:e,layer:t,indexPattern:n},a,i){let r="";e&&(r=Oi(e,t,r,i));let s={};var l;e&&vi(e)&&(s={format:null===(l=e.params)||void 0===l?void 0:l.format});return{label:r||ki,dataType:"number",operationType:"formula",isBucketed:!1,scale:"ratio",params:r?{formula:r,isFormulaBroken:!1,...s}:{...s},references:[]}},isTransferable:()=>!0,createCopy(e,t,n,a,i){var r;const s=e.columns[t],l={...e,columns:{...e.columns,[n]:{...s}}},{newLayer:o}=di(null!==(r=s.params.formula)&&void 0!==r?r:"",l,n,s,a,i);return o},paramEditor:({activeData:e,...t})=>{const n=qa(t.layer,t.indexPattern,e,t.layerId);return Object(E.jsx)(mi,x()({},t,{dateHistogramInterval:n,hasData:pi(e,t.layerId,t.columnId)}))}};function Fi({layer:e,targetId:t,sourceColumn:n,shouldDeleteSource:a,indexPattern:i,sourceColumnId:r}){let s=wi(e,n,r,t,i);return a&&(s=Vi({layer:s,columnId:r,indexPattern:i})),s}function wi(e,t,n,a,i){let r={...e.columns};if("references"in t){if(r[a])return e;const s=Fo[t.operationType];if("createCopy"in s)return s.createCopy(e,n,a,i,Fo);null==t||t.references.forEach(((s,l)=>{const o=Object(xn.a)(),u={...r[s]},c="references"in u?wi(e,u,n,o,i).columns:{[o]:u},d=r[a];let p=[o];d&&"references"in d&&(p=d.references,p[l]=o),r={...r,...c,[a]:{...t,references:p}}}))}else r={...r,[a]:t};return{...e,columns:r,columnOrder:Hi({...e,columns:r})}}function Ti(e){return e.layer.columns[e.columnId]?Mi(e):Ci(e)}function Ei(e,t,n){const a={...e};return t.filterable&&(a.filter=n.filter),t.shiftable&&(a.timeShift=n.timeShift),"disabled"!==t.timeScalingMode&&(a.timeScale=n.timeScale),a}function Ci({op:e,layer:t,columnId:n,field:a,indexPattern:i,visualizationGroups:r,targetGroup:s,shouldResetLabel:l,incompleteParams:o,initialParams:u}){var c,d;const p=Fo[e];if(!p)throw new Error("No suitable operation found for given parameters");if(t.columns[n])throw new Error("Can't insert a column with an ID that is already in use");const m={indexPattern:i,previousColumn:{...o,...u,...t.columns[n]}};if("none"===p.input||"managedReference"===p.input){if(a)throw new Error(`Can't create operation ${e} with the provided field ${a.name}`);p.input;const l=p.getPossibleOperation();return Xi((Boolean(null==l?void 0:l.isBucketed)?Li:Ni)(t,p.buildColumn({...m,layer:t}),n,r,s),i)}if("fullReference"===p.input){if(a)throw new Error("Reference-based operations can't take a field as input when creating");let l={...t};const o=p.requiredReferences.map((t=>{const n=Object.values(Fo).filter((({type:e})=>Ui({validation:t,operationType:e,indexPattern:i})));if(!n.length)throw new Error(`Can't create reference, ${e} has a validation function which doesn't allow any operations`);const a=Object(xn.a)();if(1===n.length){const e=n[0],t="field"===e.input?i.fields.filter(e.getPossibleOperationForField):[];l="none"===e.input?Ci({layer:l,columnId:a,op:e.type,indexPattern:i,visualizationGroups:r,targetGroup:s}):1===t.length?Ci({layer:l,columnId:a,op:e.type,indexPattern:i,field:t[0],visualizationGroups:r,targetGroup:s}):{...l,incompleteColumns:{...l.incompleteColumns,[a]:{operationType:e.type}}}}return a})),u=p.getPossibleOperation(i);if(!u)throw new Error(`Can't create operation ${e} because it's incompatible with the index pattern`);return Xi((Boolean(u.isBucketed)?Li:Ni)(l,p.buildColumn({...m,layer:l,referenceIds:o}),n,r,s),i)}const g=null===(c=(null!==(d=t.incompleteColumns)&&void 0!==d?d:{})[n])||void 0===c?void 0:c.sourceField,f=g?i.getFieldByName(g):void 0;if(!a&&f){const e=p.getPossibleOperationForField(f);if(!e)throw new Error(`Tried to create an invalid operation ${p.type} using previously selected field ${f.name}`);return Xi(Boolean(e.isBucketed)?Li(t,p.buildColumn({...m,layer:t,field:f}),n,r,s):Ni(t,p.buildColumn({...m,layer:t,field:f}),n),i)}var b;if(!a)return{...t,incompleteColumns:{...null!==(b=t.incompleteColumns)&&void 0!==b?b:{},[n]:{operationType:e}}};const x=p.getPossibleOperationForField(a);var h;if(!x)return{...t,incompleteColumns:{...null!==(h=t.incompleteColumns)&&void 0!==h?h:{},[n]:{operationType:e,sourceField:a.name}}};const v=p.buildColumn({...m,layer:t,field:a});return Xi((Boolean(x.isBucketed)?Li:Ni)(t,v,n,r,s),i)}function Mi({layer:e,columnId:t,indexPattern:n,op:a,field:i,visualizationGroups:r,shouldResetLabel:s}){const l=e.columns[t];if(!l)throw new Error("Can't replace column because there is no prior column");const o=a!==l.operationType,u=Fo[a],c=Fo[l.operationType];if(!u)throw new Error("No suitable operation found for given parameters");const d={columns:e.columns,indexPattern:n,previousColumn:l};if(o){let o={...e};if(o=Qi(o,t),"managedReference"===c.input&&u.input!==c.input){o=Pi(c,l,o,n);const u=Ci({layer:o,columnId:t,indexPattern:n,op:a,field:i,visualizationGroups:r});return!s&&l.customLabel&&l.label!==c.getDefaultLabel(l,n,o.columns)&&(u.columns[t].customLabel=!0,u.columns[t].label=l.label),u.incompleteColumns&&u.incompleteColumns[t]?{...e,incompleteColumns:u.incompleteColumns}:u}if("fullReference"===u.input)return function({layer:e,columnId:t,previousColumn:n,op:a,indexPattern:i,visualizationGroups:r}){const s=Fo[a];if("fullReference"!==s.input)throw new Error("Requirements for transitioning are not met");let l=!1,o=!1;const u="references"in n?[...n.references]:[],c=s.requiredReferences.map((t=>{const a=Object(xn.a)();if(u.length){const n=e.columns[u[0]];if(Zi({validation:t,column:n}))return u.shift()}if(!l&&Zi({validation:t,column:n})){l=!0;const t={...e,columns:{...e.columns,[a]:{...n,filter:s.filterable?void 0:n.filter,timeShift:s.shiftable?void 0:n.timeShift}}};return e={...e,columnOrder:Hi(t),columns:Ri(t,a)},a}if(t.input.includes("none")){const n=Io.filter((e=>{if("none"===e.input)return Ui({validation:t,operationType:e.type,indexPattern:i})}));if(1===n.length)return e=Ci({layer:e,columnId:a,op:n[0].type,indexPattern:i,visualizationGroups:r}),a}if(!o&&"sourceField"in n&&t.input.includes("field")){const s=Io.filter((e=>"field"===e.input&&Ui({validation:t,operationType:e.type,indexPattern:i}))).sort(Eo),l=s.filter((e=>{const a=i.getFieldByName(n.sourceField);if(a)return Ui({validation:t,operationType:e.type,field:a,indexPattern:i})}));if(l.length>0)return o=!0,e=Ci({layer:e,columnId:a,op:l[0].type,indexPattern:i,field:i.getFieldByName(n.sourceField),visualizationGroups:r}),a;if(1===s.length)return o=!0,e={...e,incompleteColumns:{...e.incompleteColumns,[a]:{operationType:s[0].type}}},a}if(u.length){const n=e.columns[u[0]];if(n&&"sourceField"in n&&t.input.includes("field")){const s=i.getFieldByName(n.sourceField);if(s){const n=Io.filter((e=>"field"===e.input&&Ui({validation:t,operationType:e.type,field:s,indexPattern:i}))).sort(Eo);if(n.length>0)return e=Ci({layer:e,columnId:a,op:n[0].type,indexPattern:i,field:s,visualizationGroups:r}),a}}}return a}));u.length&&u.forEach((t=>{e=Vi({layer:e,columnId:t,indexPattern:i})}));return e={...e,columns:{...e.columns,[t]:s.buildColumn({indexPattern:i,layer:e,referenceIds:c,previousColumn:n})}},Xi({...e,columnOrder:Hi(e),columns:Ri(e,t)},i)}({layer:o,columnId:t,previousColumn:l,op:a,indexPattern:n,visualizationGroups:r});if("fullReference"===c.input&&1===l.references.length){const r=l.references[0],s=e.columns[r];if(s){const e=Fo[s.operationType];if(e.type===a){o=Vi({layer:o,columnId:r,indexPattern:n});const a=Ei(Ai({...s},l),e,l);return o={...o,columns:{...o.columns,[t]:a}},Xi({...o,columnOrder:Hi(o),columns:Ri(o,t)},n)}if(!i&&"sourceField"in s&&"field"===e.input&&"field"===u.input){const e=n.getFieldByName(s.sourceField);e&&u.getPossibleOperationForField(e)&&(i=e)}}}if("managedReference"===u.input){const e=u.buildColumn({...d,layer:o},"params"in l?l.params:void 0,Fo);"fullReference"===c.input&&l.references.forEach((e=>{o=Vi({layer:o,columnId:e,indexPattern:n})}));const a={...o,columns:{...o.columns,[t]:e}};let i;try{i=e.params.formula?di(e.params.formula,a,t,e,n,Fo).newLayer:a}catch(e){i=a}const r=i.columns[t];return!s&&r.operationType!==l.operationType&&l.customLabel&&(r.customLabel=!0,r.label=l.label),Xi({...o,columnOrder:Hi(i),columns:Ri(i,t)},n)}if("none"===u.input){let e=u.buildColumn({...d,layer:o});e=Ai(e,l),o=Pi(c,l,o,n);const a={...o,columns:{...o.columns,[t]:e}};return Xi({...o,columnOrder:Hi(a),columns:Ri(a,t)},n)}if(!i){var p;let n={operationType:a};if("fullReference"===c.input){const t=l.references[0],a=e.columns[t];if(a){n=Ei(n,Fo[a.operationType],l)}}return{...o,incompleteColumns:{...null!==(p=o.incompleteColumns)&&void 0!==p?p:{},[t]:n}}}var m;if(!u.getPossibleOperationForField(i))return{...o,incompleteColumns:{...null!==(m=o.incompleteColumns)&&void 0!==m?m:{},[t]:{operationType:a}}};o=Pi(c,l,o,n);let g=u.buildColumn({...d,layer:o,field:i});s||(g=Ai(g,l));const f={...o,columns:{...o.columns,[t]:g}};return Xi({...o,columnOrder:Hi(f),columns:Ri(f,t)},n)}if("field"===u.input&&i&&"sourceField"in l&&l.sourceField!==i.name){let n=u.onFieldChange(l,i);s||(n=Ai(n,l));const a=Qi({...e,columns:{...e.columns,[t]:n}},t);return{...a,columnOrder:Hi(a),columns:Ri(a,t)}}throw new Error("nothing changed")}function Pi(e,t,n,a){let i=n;if("managedReference"===e.input){const[e]=Object.entries(n.columns).find((([e,n])=>n===t))||[];null!=e&&(i=Vi({layer:n,columnId:e,indexPattern:a}))}return"fullReference"===e.input&&t.references.forEach((e=>{i=Vi({layer:n,columnId:e,indexPattern:a})})),i}function Si({layer:e,columnId:t,op:n,field:a,indexPattern:i,filterOperations:r,visualizationGroups:s}){const l=e.columns[t];if(!l)return!0;if(l.operationType===n)return!0;try{var o,u,c;const l=Mi({layer:e,columnId:t,op:n,field:a,indexPattern:i,visualizationGroups:s}),d=Fo[n],p=l.columns[t];return Boolean(p)&&!(null!==(o=l.incompleteColumns)&&void 0!==o&&o[t])&&r(p)&&!(null!==(u=d.getErrorMessage)&&void 0!==u&&null!==(c=u.call(d,l,t,i))&&void 0!==c&&c.length)}catch(e){return!1}}function Ai(e,t){const n={...e},a=e.operationType!==t.operationType,i=("sourceField"in e&&e.sourceField)!==("sourceField"in t&&t.sourceField);return!t.customLabel||a&&i||(n.customLabel=!0,n.label=t.label),n}function Li(e,t,n,a,i){const[r,s]=Object(Z.partition)(e.columnOrder,(t=>e.columns[t].isBucketed)),l=e.columnOrder.findIndex((t=>"date_histogram"===e.columns[t].operationType));let o=[];o=l>-1&&"terms"===t.operationType?[...r.slice(0,l),n,...r.slice(l,r.length),...s]:[...r,n,...s],o=Di(a,i,o,n);const u={...Qi(e,n),columns:{...e.columns,[n]:t},columnOrder:o};return{...u,columns:Ri(u,n),columnOrder:Hi(u)}}function Di(e,t,n,a){var i;if(t&&(null===(i=e.find((e=>e.groupId===t)))||void 0===i?void 0:i.hideGrouping)){const i=[...e];i.sort(((e,t)=>void 0===typeof e.nestingOrder?-1:void 0===typeof t.nestingOrder?1:e.nestingOrder-t.nestingOrder));const r={};return n.forEach((e=>{const s=i.findIndex((n=>e===a&&n.groupId===t||n.accessors.some((t=>t.columnId===e))));r[e]=-1!==s?s:n.length})),[...n].sort(((e,t)=>r[e]-r[t]))}return n}function Ni(e,t,n){const a={...Qi(e,n),columns:{...e.columns,[n]:t}};return{...a,columnOrder:Hi(a),columns:Ri(a,n)}}function zi(e){return Io.sort(Eo).filter((t=>{if("field"!==t.input)return;const n=t.getPossibleOperationForField(e);return n&&!n.isBucketed&&"number"===n.dataType}))}function Bi({layer:e,columnId:t,paramName:n,value:a}){const i=e.columns[t];return{...e,columns:{...e.columns,[t]:{...i,params:{..."params"in i?i.params:{},[n]:a}}}}}function Ri(e,t){const n={...e.columns};return Object.keys(n).forEach((a=>{if(a!==t){const i=n[a],r=Fo[i.operationType];n[a]=r.onOtherColumnChanged?r.onOtherColumnChanged({...e,columns:n},a,t):i}})),n}function Vi({layer:e,columnId:t,indexPattern:n}){const a=e.columns[t];if(!a){const n={...e.incompleteColumns||{}};return delete n[t],{...e,columnOrder:e.columnOrder.filter((e=>e!==t)),incompleteColumns:n}}const i="references"in a?a.references:[],r={...e.columns};delete r[t];let s={...e,columns:Ri({...e,columns:r},t)};i.forEach((e=>{s=Vi({layer:s,columnId:e,indexPattern:n})}));const l={...s.incompleteColumns||{}};return delete l[t],Xi({...s,columnOrder:Hi(s),incompleteColumns:l},n)}function Hi(e){const t=Object.entries(e.columns);t.sort((([t],[n])=>{const a=e.columnOrder.indexOf(t),i=e.columnOrder.indexOf(n);return a>-1&&i>-1?a-i:a>-1?-1:1}));const[n,a]=Object(Z.partition)(t,(([,e])=>e.isBucketed));return n.map((([e])=>e)).concat(a.map((([e])=>e)))}function Gi(e){const[t,n]=Object(Z.partition)(e.columnOrder,(t=>e.columns[t]&&!("references"in e.columns[t])));return[...Object(Z.partition)(t,(t=>{var n;return null===(n=e.columns[t])||void 0===n?void 0:n.isBucketed})),n]}function qi(e,t,n){return Fo[e.operationType].isTransferable(e,t,Fo)&&(!("references"in e)||e.references.every((e=>qi(n.columns[e],t,n))))}function Wi(e,t){const n=Object(Z.pickBy)(e.columns,(n=>qi(n,t,e))),a=Object(Z.mapValues)(n,(e=>{const n=Fo[e.operationType];return n.transfer?n.transfer(e,t):e})),i=e.columnOrder.filter((e=>a[e]));return{...e,indexPatternId:t.id,columns:a,columnOrder:i}}function $i(e,t){return Object.values(e.columns).flatMap((e=>"references"in e?e.references:[])).includes(t)}function Yi(e,t){const n=[];return function t(a){const i=e.columns[a];if(i&&"references"in i){const a=i.references.filter((t=>Boolean(e.columns[t])));n.push(...a),a.forEach(t)}}(t),n}function Ki(e){return e.columnOrder.some((t=>{const n=e.columns[t];if(n)return hi("terms",n)&&n.params.size>5}))}function Ui({operationType:e,validation:t,field:n,indexPattern:a}){const i=Fo[e];let r=!0;if(n&&"field"===i.input){const e=i.getPossibleOperationForField(n);r=Boolean(e)&&t.validateMetadata(e)}else if("none"===i.input){const e=i.getPossibleOperation();r=Boolean(e)&&t.validateMetadata(e)}else if("fullReference"===i.input){const e=i.getPossibleOperation(a);r=Boolean(e)&&t.validateMetadata(e)}return t.input.includes(i.input)&&(!t.specificOperations||t.specificOperations.includes(e))&&r}function Xi(e,t){const n={...e.columns};return e.columnOrder.forEach((e=>{const a=n[e];a.customLabel||(n[e]={...a,label:Fo[a.operationType].getDefaultLabel(a,t,n)})})),{...e,columns:n}}function Qi(e,t){var n;const a={...null!==(n=e.incompleteColumns)&&void 0!==n?n:{}};return delete a[t],{...e,incompleteColumns:a}}function Zi({column:e,validation:t}){if(!e)return!1;const n=e.operationType,a=Fo[n];return t.input.includes(a.input)&&function({column:e,validation:t}){return!t.specificOperations||"managedReference"===Fo[e.operationType].input||t.specificOperations.includes(e.operationType)}({column:e,validation:t})&&t.validateMetadata(e)}function Ji(e,t){const n={};Object.entries(t).forEach((([e,t])=>{n[e]="references"in t?[...t.references]:[]}));const a=n[e],i=[];for(;a.length>0;){const e=a.shift();i.push([e,t[e]]),a.push(...n[e])}return i.filter((([,e])=>e))}const er=({value:e,onChange:t})=>{const n=1e3,[a,i]=Object(h.useState)(String(e));Object(M.p)((()=>{if(""===a)return;const e=Number(a);t(Math.min(n,Math.max(e,1)))}),{skipFirstRender:!0},256,[a]);const r=""===a,s=!r&&Number(a)>n,l=!r&&Number(a)<1;return Object(E.jsx)(F.EuiFormRow,{label:_.i18n.translate("xpack.lens.indexPattern.terms.size",{defaultMessage:"Number of values"}),display:"columnCompressed",fullWidth:!0,isInvalid:s||l,error:s?[_.i18n.translate("xpack.lens.indexPattern.terms.sizeLimitMax",{defaultMessage:"Value is higher than the maximum {max}, the maximum value is used instead.",values:{max:n}})]:l?[_.i18n.translate("xpack.lens.indexPattern.terms.sizeLimitMin",{defaultMessage:"Value is lower than the minimum {min}, the minimum value is used instead.",values:{min:1}})]:null},Object(E.jsx)(F.EuiFieldNumber,{min:1,max:n,step:1,value:a,compressed:!0,isInvalid:s||l,onChange:({currentTarget:e})=>i(e.value),"aria-label":_.i18n.translate("xpack.lens.indexPattern.terms.size",{defaultMessage:"Number of values"}),onBlur:()=>{if(""===a)return i(String(e));const t=Number(a);i(String(Math.min(n,Math.max(t,1))))}}))};n(309);var tr=n(72),nr=n.n(tr),ar=(n(123),function(e,t){if("boolean"!=typeof t&&"boolean"===e.type){if([1,"true"].includes(t))return!0;if([0,"false"].includes(t))return!1;throw new Error("".concat(t," is not a valid boolean value for boolean field ").concat(e.name))}return"number"!=typeof t&&"number"===e.type?Number(t):t}),ir=function(e,t){var n=ar(e,t);return{script:{source:rr(e),lang:e.lang,params:{value:n}}}},rr=function(e){return"painless"===e.lang?"boolean compare(Supplier s, def v) {return s.get() == v;}"+"compare(() -> { ".concat(e.script," }, params.value);"):"(".concat(e.script,") == value")},sr={gt:">",gte:">=",lte:"<=",lt:"<"},lr={gt:"boolean gt(Supplier s, def v) {return s.get() > v}",gte:"boolean gte(Supplier s, def v) {return s.get() >= v}",lte:"boolean lte(Supplier s, def v) {return s.get() <= v}",lt:"boolean lt(Supplier s, def v) {return s.get() < v}"},or={gt:"boolean gt(Supplier s, def v) {return s.get().toInstant().isAfter(Instant.parse(v))}",gte:"boolean gte(Supplier s, def v) {return !s.get().toInstant().isBefore(Instant.parse(v))}",lte:"boolean lte(Supplier s, def v) {return !s.get().toInstant().isAfter(Instant.parse(v))}",lt:"boolean lt(Supplier s, def v) {return s.get().toInstant().isBefore(Instant.parse(v))}"},ur=function(e,t){var n=Object(Z.mapValues)(Object(Z.pickBy)(t,(function(e,t){return t in sr})),(function(t){return"number"===e.type&&"string"==typeof t?parseFloat(t):t})),a=Object(Z.map)(n,(function(t,n){return"("+e.script+")"+Object(Z.get)(sr,n)+n})).join(" && ");if("painless"===e.lang){var i="date"===e.type?or:lr,r=Object(Z.reduce)(n,(function(e,t,n){return e.concat(Object(Z.get)(i,n))}),[]).join(" "),s=Object(Z.map)(n,(function(t,n){return"".concat(n,"(() -> { ").concat(e.script," }, params.").concat(n,")")})).join(" && ");a="".concat(r).concat(s)}return{script:{source:a,params:n,lang:e.lang}}};var cr=n(82),dr=n.n(cr),pr=n(92),mr=n.n(pr);function gr(e){return{type:"literal",value:e}}function fr(e){return e.value}var br="@kuery-wildcard@";function xr(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function hr(e){return e.replace(/[+\-=&|><!(){}[\]^"~*?:\\/]/g,"\\$&")}function vr(e){return e.includes(br)?{type:"wildcard",value:e}:_s(e)}function yr(e,t){var n=e.value.split(br).map(xr).join("[\\s\\S]*");return new RegExp("^".concat(n,"$")).test(t)}function jr(e){return e.value.split(br).join("*")}function _r(e){return e.value.split(br).map(hr).join("*")}function Or(e){var t=e.value;return t.startsWith(br)&&t.replace(br,"").length>0}function kr(e,t){if(!t)return[];if("literal"===e.type){var n=fr(e),a=t.fields.find((function(e){return e.name===n}));return a?[a]:[]}return"wildcard"===e.type?t.fields.filter((function(t){return yr(e,t.name)})):void 0}var Ir=n(47),Fr=n.n(Ir);function wr(e){var t=Fr.a.tz.guess();return"Browser"===e?t:e}function Tr(e){return function(e){var t,n=null==e?void 0:e.subType;return!(null==n||null===(t=n.nested)||void 0===t||!t.path)}(e)?e.subType:void 0}function Er(e,t,n){var a=nr()(nr()({},e),{},{value:n?"".concat(n,".").concat(e.value):e.value});if(!t||"wildcard"===a.type&&!n)return a;var i=kr(a,t).reduce((function(e,t){var a=Tr(t),i=null==a?void 0:a.nested.path;return n&&!i?[].concat(dr()(e),["".concat(t.name,' is not a nested field but is in nested group "').concat(n,'" in the KQL expression.')]):i&&!n?[].concat(dr()(e),["".concat(t.name," is a nested field, but is not in a nested group in the KQL expression.")]):i!==n?[].concat(dr()(e),["Nested field ".concat(t.name," is being queried with the incorrect nested path. The correct path is ").concat(null==a?void 0:a.nested.path,".")]):e}),[]);if(i.length>0)throw new Error(i.join("\n"));return a}function Cr(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Object(Z.isUndefined)(e))throw new Error("fieldName is a required argument");if(Object(Z.isUndefined)(t))throw new Error("value is a required argument");return{arguments:["string"==typeof e?_s(e):gr(e),"string"==typeof t?_s(t):gr(t),gr(n)]}}function Mr(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=mr()(e.arguments,3),r=i[0],s=i[1],l=i[2],o="wildcard"===s.type&&s.value===br,u="wildcard"===r.type&&r.value===br;if(o&&u)return{match_all:{}};var c=Er(r,t,null!=a&&a.nested?a.nested.path:void 0),d=Object(Z.isUndefined)(s)?s:ks(s),p=l.value?"phrase":"best_fields";if(null===c.value)return"wildcard"===s.type?{query_string:{query:_r(s)}}:{multi_match:{type:p,query:d,lenient:!0}};var m=t?kr(c,t):[];return m&&0===m.length&&m.push({name:ks(c),scripted:!1,type:""}),!o||null!=m&&m.length&&(null==m?void 0:m.length)!==(null==t?void 0:t.fields.length)?{bool:{should:m.reduce((function(e,t){var i=function(e){var n=Tr(t);return"wildcard"!==c.type||null==n||!n.nested||null!=a&&a.nested?e:{nested:{path:n.nested.path,query:e,score_mode:"none"}}};if(!t.scripted){if(o)return[].concat(dr()(e),[i({exists:{field:t.name}})]);if("wildcard"===s.type)return[].concat(dr()(e),[i({query_string:{fields:[t.name],query:_r(s)}})]);if("date"===t.type){var r=n.dateFormatTZ?{time_zone:wr(n.dateFormatTZ)}:{};return[].concat(dr()(e),[i({range:Q()({},t.name,nr()({gte:d,lte:d},r))})])}var l="phrase"===p?"match_phrase":"match";return[].concat(dr()(e),[i(Q()({},l,Q()({},t.name,d)))])}if(!o)return[].concat(dr()(e),[{script:nr()({},ir(t,d))}])}),[])||[],minimum_should_match:1}}:{match_all:{}}}function Pr(e){return{arguments:e}}function Sr(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=n.filtersInMustClause,r=e.arguments||[],s=i?"must":"filter";return{bool:Q()({},s,r.map((function(e){return ks(e,t,n,a)})))}}function Ar(e){return{arguments:e}}function Lr(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return{bool:{should:(e.arguments||[]).map((function(e){return ks(e,t,n,a)})),minimum_should_match:1}}}function Dr(e){return{arguments:[e]}}function Nr(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=mr()(e.arguments,1)[0];return{bool:{must_not:ks(i,t,n,a)}}}var zr=n(100),Br=n.n(zr);function Rr(e,t){var n=Object(Z.pick)(t,"gt","lt","gte","lte","format"),a="string"==typeof e?_s(e):ns.literal.buildNode(e),i=Object(Z.map)(n,(function(e,t){return ns.namedArg.buildNode(t,e)}));return{arguments:[a].concat(dr()(i))}}function Vr(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=Br()(e.arguments),r=i[0],s=i.slice(1),l=Er(r,t,null!=a&&a.nested?a.nested.path:void 0),o=t?kr(l,t):[],u=function(e){if(e.gt&&e.gte||e.lt&&e.lte)throw new Error("range ends cannot be both inclusive and exclusive");var t=["gte","lte","format"];return e.reduce((function(e,n,a){return"namedArg"===n.type?e[n.name]=n.value:e[t[a]]=n,e}),{})}(s),c=Object(Z.mapValues)(u,(function(e){return ks(e)}));return o&&0===o.length&&o.push({name:ks(l),scripted:!1,type:""}),{bool:{should:o.map((function(e){var t=function(t){var n=Tr(e);return"wildcard"!==l.type||null==n||!n.nested||a.nested?t:{nested:{path:n.nested.path,query:t,score_mode:"none"}}};if(e.scripted)return{script:ur(e,c)};if("date"===e.type){var i=n.dateFormatTZ?{time_zone:wr(n.dateFormatTZ)}:{};return t({range:Q()({},e.name,nr()(nr()({},c),i))})}return t({range:Q()({},e.name,c)})})),minimum_should_match:1}}}function Hr(e){return{arguments:[gr(e)]}}function Gr(e,t){var n,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=mr()(e.arguments,1)[0],r=fr(nr()(nr()({},i),{},{value:null!=a&&a.nested?"".concat(a.nested.path,".").concat(i.value):i.value})),s=null==t||null===(n=t.fields)||void 0===n?void 0:n.find((function(e){return e.name===r}));if(null!=s&&s.scripted)throw new Error("Exists query does not support scripted fields");return{exists:{field:r}}}function qr(e,t){t=J.a.pick(t,"topLeft","bottomRight");var n=ns.literal.buildNode(e),a=J.a.map(t,(function(e,t){var n="".concat(e.lat,", ").concat(e.lon);return ns.namedArg.buildNode(t,n)}));return{arguments:[n].concat(dr()(a))}}function Wr(e,t){var n,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=Br()(e.arguments),r=i[0],s=i.slice(1),l=nr()(nr()({},r),{},{value:null!=a&&a.nested?"".concat(a.nested.path,".").concat(r.value):r.value}),o=ns.literal.toElasticsearchQuery(l),u=(null!==(n=null==t?void 0:t.fields)&&void 0!==n?n:[]).find((function(e){return e.name===o})),c=s.reduce((function(e,t){var n=J.a.snakeCase(t.name);return nr()(nr()({},e),{},Q()({},n,ks(t)))}),{});if(null!=u&&u.scripted)throw new Error("Geo bounding box query does not support scripted fields");return{geo_bounding_box:Q()(Q()({},o,c),"ignore_unmapped",!0)}}function $r(e,t){var n=ns.literal.buildNode(e),a=t.map((function(e){var t="".concat(e.lat,", ").concat(e.lon);return ns.literal.buildNode(t)}));return{arguments:[n].concat(dr()(a))}}function Yr(e,t){var n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=Br()(e.arguments),s=r[0],l=r.slice(1),o=nr()(nr()({},s),{},{value:null!=i&&i.nested?"".concat(i.nested.path,".").concat(s.value):s.value}),u=ns.literal.toElasticsearchQuery(o),c=(null!==(n=null==t?void 0:t.fields)&&void 0!==n?n:[]).find((function(e){return e.name===u})),d={points:l.map((function(e){return ks(e,t,a,i)}))};if(null!=c&&c.scripted)throw new Error("Geo polygon query does not support scripted fields");return{geo_polygon:Q()(Q()({},u,d),"ignore_unmapped",!0)}}function Kr(e,t){return{arguments:["string"==typeof e?_s(e):gr(e),t]}}function Ur(e,t){var n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=mr()(e.arguments,2),s=r[0],l=r[1],o=ks(s),u=null!=i&&null!==(n=i.nested)&&void 0!==n&&n.path?"".concat(i.nested.path,".").concat(o):o;return{nested:{path:u,query:ks(l,t,a,nr()(nr()({},i),{},{nested:{path:u}})),score_mode:"none"}}}var Xr={is:r,and:s,or:l,not:o,range:u,exists:c,geoBoundingBox:d,geoPolygon:p,nested:m};function Qr(e){var t=Xr[e];if(J.a.isUndefined(t))throw new Error('Unknown function "'.concat(e,'"'));for(var n=arguments.length,a=new Array(n>1?n-1:0),i=1;i<n;i++)a[i-1]=arguments[i];return nr()({type:"function",function:e},t.buildNodeParams.apply(t,a))}function Zr(e,t){if(J.a.isUndefined(Xr[e]))throw new Error('Unknown function "'.concat(e,'"'));return{type:"function",function:e,arguments:t}}function Jr(e,t,n,a){return Xr[e.function].toElasticsearchQuery(e,t,n,a)}function es(e,t){return{type:"namedArg",name:e,value:"literal"===J.a.get(t,"type")?t:ns.literal.buildNode(t)}}function ts(e){return ks(e.value)}var ns={function:g,literal:a,namedArg:f,wildcard:i},as=n(318),is=n.n(as),rs=n(320),ss=n.n(rs),ls=n(321),os=n.n(ls),us=n(322),cs=n.n(us),ds=n(323),ps=n.n(ds),ms=n(324),gs=n.n(ms),fs=n(325),bs=n.n(fs);var xs=_.i18n.translate("esQuery.kql.errors.endOfInputText",{defaultMessage:"end of input"}),hs={fieldName:_.i18n.translate("esQuery.kql.errors.fieldNameText",{defaultMessage:"field name"}),value:_.i18n.translate("esQuery.kql.errors.valueText",{defaultMessage:"value"}),literal:_.i18n.translate("esQuery.kql.errors.literalText",{defaultMessage:"literal"}),whitespace:_.i18n.translate("esQuery.kql.errors.whitespaceText",{defaultMessage:"whitespace"})},vs=function(e){function t(e,n){var a;ss()(this,t);var i=e.message;if(e.expected){var r=e.expected.map((function(e){var t,n="other"===(t=e).type?t.description:"literal"===t.type?'"'.concat(t.text,'"'):"end"===t.type?"end of input":t.text||t.description||"";return hs[n]||n})),s=Object(Z.uniq)(r).filter((function(e){return void 0!==e})).sort().join(", ");i=_.i18n.translate("esQuery.kql.errors.syntaxError",{defaultMessage:"Expected {expectedList} but {foundInput} found.",values:{expectedList:s,foundInput:e.found?'"'.concat(e.found,'"'):xs}})}var l,o,u,c=[i,n,Object(Z.repeat)("-",e.location.start.offset)+"^"].join("\n");return l=this,o=t,u=[c],o=ps()(o),a=os()(l,cs()()?Reflect.construct(o,u||[],ps()(l).constructor):o.apply(l,u)),Q()(a,"shortMessage",void 0),a.name="KQLSyntaxError",a.shortMessage=i,a}return gs()(t,e),is()(t)}(bs()(Error)),ys=n(124),js=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ys.parse;if(void 0===e)throw new Error("expression must be a string, got undefined instead");return n(e,nr()(nr()({},t),{},{helpers:{nodeTypes:ns}}))},_s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return js(e,nr()(nr()({},t),{},{startRule:"Literal"}),ys.parse)},Os=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return js(e,t,ys.parse)}catch(t){throw"SyntaxError"===t.name?new vs(t,e):t}},ks=function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;return t&&t.type&&ns[t.type]?ns[t.type].toElasticsearchQuery(t,n,a,i):e(ns.function.buildNode("and",[]),n)},Is=function(){return ks.apply(void 0,arguments)};function Fs(e){return Object(Z.isString)(e)?""===e.trim()?{match_all:{}}:{query_string:{query:e}}:e}n(326);const ws=({value:e,onChange:t,placeholder:n,inputRef:a,onSubmit:i,dataTestSubj:r,compressed:s})=>{const{inputValue:l,handleInputChange:o}=Object(M.q)({value:e,onChange:t});return Object(E.jsx)(F.EuiFieldText,{"data-test-subj":r||"lens-labelInput",value:l,onChange:e=>o(e.target.value),fullWidth:!0,placeholder:n||"",inputRef:e=>{a&&e&&(a.current=e)},onKeyUp:({key:e})=>{F.keys.ENTER===e&&i&&i()},prepend:_.i18n.translate("xpack.lens.labelInput.label",{defaultMessage:"Label"}),compressed:s})},Ts=({label:e,onClick:t})=>Object(E.jsx)(F.EuiButtonEmpty,{"data-test-subj":"lns-newBucket-add",size:"xs",iconType:"plusInCircle",onClick:t},e),Es=({isInvalid:e,invalidMessage:t,onRemoveClick:n,removeTitle:a,children:i,dataTestSubj:r,isNotRemovable:s})=>Object(E.jsx)(F.EuiPanel,{paddingSize:"none","data-test-subj":r,hasShadow:!1,hasBorder:!0},Object(E.jsx)(F.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(E.jsx)(F.EuiFlexItem,{grow:!1}),Object(E.jsx)(F.EuiFlexItem,{grow:!1},Object(E.jsx)(F.EuiIcon,{size:"s",color:e?"danger":"subdued",type:e?"alert":"grab",title:e?t:_.i18n.translate("xpack.lens.customBucketContainer.dragToReorder",{defaultMessage:"Drag to reorder"})})),Object(E.jsx)(F.EuiFlexItem,{grow:!0},i),Object(E.jsx)(F.EuiFlexItem,{grow:!1},Object(E.jsx)(F.EuiButtonIcon,{iconSize:"s",iconType:"cross",color:"danger","data-test-subj":"lns-customBucketContainer-remove",onClick:n,"aria-label":a,title:a,disabled:s})))),Cs=({id:e,idx:t,children:n,...a})=>Object(E.jsx)(F.EuiDraggable,{style:{marginBottom:4},spacing:"none",index:t,draggableId:e,disableInteractiveElementBlocking:!0},(e=>Object(E.jsx)(Es,a,n))),Ms=({items:e,onDragStart:t,onDragEnd:n,droppableId:a,children:i})=>Object(E.jsx)(F.EuiDragDropContext,{onDragEnd:({source:t,destination:a})=>{if(t&&a){const i=Object(F.euiDragDropReorder)(e,t.index,a.index);n(i)}},onDragStart:t},Object(E.jsx)(F.EuiDroppable,{droppableId:a,spacing:"none"},i)),Ps=({value:e,onChange:t,indexPatternTitle:n,isInvalid:a,onSubmit:i,disableAutoFocus:r})=>{const{inputValue:s,handleInputChange:l}=Object(M.q)({value:e,onChange:t});return Object(E.jsx)(De.QueryStringInput,{dataTestSubj:"indexPattern-filters-queryStringInput",size:"s",disableAutoFocus:r,isInvalid:a,bubbleSubmitEvent:!1,indexPatterns:[n],query:s,onChange:e=>{Object(Z.isEqual)(e,s)||l(e)},onSubmit:()=>{s.query&&i()},placeholder:"kuery"===s.language?_.i18n.translate("xpack.lens.indexPattern.filters.queryPlaceholderKql",{defaultMessage:"{example}",values:{example:'method : "GET" or status : "404"'}}):_.i18n.translate("xpack.lens.indexPattern.filters.queryPlaceholderLucene",{defaultMessage:"{example}",values:{example:"method:GET OR status:404"}}),languageSwitcherPopoverAnchorPosition:"rightDown"})},Ss=({filter:e,setFilter:t,indexPattern:n,Button:a,initiallyOpen:i})=>{const[r,s]=Object(h.useState)(!1),l=v.a.useRef();Object(h.useEffect)((()=>{s(i)}),[]);const o=()=>{r&&s(!1)};return Object(E.jsx)(F.EuiPopover,{"data-test-subj":"indexPattern-filters-existingFilterContainer",anchorClassName:"eui-fullWidth",panelClassName:"lnsIndexPatternDimensionEditor__filtersEditor",isOpen:r,ownFocus:!0,closePopover:()=>o(),button:Object(E.jsx)(a,{onClick:()=>{s((e=>!e))}})},Object(E.jsx)(Ps,{isInvalid:!Rs(e.input,n),value:e.input,indexPatternTitle:n.title,onChange:n=>t({...e,input:n}),onSubmit:()=>{l.current&&l.current.focus()}}),Object(E.jsx)(F.EuiSpacer,{size:"s"}),Object(E.jsx)(ws,{value:e.label||"",onChange:n=>t({...e,label:n}),placeholder:(u=e.input.query,""===u?Ns:"object"===u?JSON.stringify(u):String(u)),inputRef:l,onSubmit:()=>o(),dataTestSubj:"indexPattern-filters-label"}));var u},As=Object(F.htmlIdGenerator)(),Ls="filters",Ds=_.i18n.translate("xpack.lens.indexPattern.filters",{defaultMessage:"Filters"}),Ns=_.i18n.translate("xpack.lens.indexPattern.filters.label.placeholder",{defaultMessage:"All records"}),zs={input:{query:"",language:"kuery"},label:""},Bs=(e,t)=>{let n,a=!0;try{"kuery"===e.language?Is(Os(e.query),t):Fs(e.query)}catch(e){a=!1,n=e.message}return{isValid:a,error:n}},Rs=(e,t)=>Bs(e,t).isValid,Vs={type:Ls,displayName:Ds,priority:3,input:"none",isTransferable:()=>!0,getDefaultLabel:()=>Ds,buildColumn({previousColumn:e}){let t={filters:[zs]};return"terms"===(null==e?void 0:e.operationType)&&"sourceField"in e&&(t={filters:[{label:"",input:{query:`${e.sourceField} : *`,language:"kuery"}}]}),{label:Ds,dataType:"string",operationType:Ls,scale:"ordinal",isBucketed:!0,params:t}},getPossibleOperation:()=>({dataType:"string",isBucketed:!0,scale:"ordinal"}),toEsAggsFn:(e,t,n)=>{var a;const i=null===(a=e.params.filters)||void 0===a?void 0:a.filter((e=>Rs(e.input,n)));return Object(ia.buildExpressionFunction)("aggFilters",{id:t,enabled:!0,schema:"segment",filters:((null==i?void 0:i.length)>0?i:[zs]).map(fa.queryFilterToAst)}).toAst()},paramEditor:({layer:e,columnId:t,currentColumn:n,indexPattern:a,updateLayer:i,data:r})=>{const s=n.params.filters;return Object(E.jsx)(F.EuiFormRow,null,Object(E.jsx)(Hs,{filters:s,setFilters:n=>i(Bi({layer:e,columnId:t,paramName:Ls,value:n})),indexPattern:a,defaultQuery:zs}))}},Hs=({filters:e,setFilters:t,indexPattern:n,defaultQuery:a})=>{const[i,r]=Object(h.useState)(!1),[s,l]=Object(h.useState)((()=>e.map((e=>({...e,id:As()}))))),o=e=>{t(e.map((e=>Object(Z.omit)(e,"id")))),l(e)};return Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(Ms,{onDragEnd:o,onDragStart:()=>{},droppableId:"FILTERS_DROPPABLE_AREA",items:s},null==s?void 0:s.map(((e,t)=>{const a=!Rs(e.input,n);return Object(E.jsx)(Cs,{id:e.id,key:e.id,idx:t,isInvalid:a,invalidMessage:_.i18n.translate("xpack.lens.indexPattern.filters.isInvalid",{defaultMessage:"This query is invalid"}),onRemoveClick:()=>{return t=e.id,o(s.filter((e=>e.id!==t)));var t},removeTitle:_.i18n.translate("xpack.lens.indexPattern.filters.removeFilter",{defaultMessage:"Remove a filter"}),isNotRemovable:1===s.length},Object(E.jsx)(Ss,{"data-test-subj":"indexPattern-filters-existingFilterContainer",initiallyOpen:t===s.length-1&&i,indexPattern:n,filter:e,setFilter:e=>{var t,n,a;t=e.id,n=e.input,a=e.label,o(s.map((e=>e.id===t?{...e,input:n,label:a}:e)))},Button:({onClick:t})=>Object(E.jsx)(F.EuiLink,{className:"lnsFiltersOperation__popoverButton","data-test-subj":"indexPattern-filters-existingFilterTrigger",onClick:t,color:a?"danger":"text",title:_.i18n.translate("xpack.lens.indexPattern.filters.clickToEdit",{defaultMessage:"Click to edit"})},e.label||e.input.query||Ns)}))}))),Object(E.jsx)(Ts,{onClick:()=>{o([...s,{...a,id:As()}]),r(!0)},label:_.i18n.translate("xpack.lens.indexPattern.filters.addaFilter",{defaultMessage:"Add a filter"})}))};function Gs(e){return _.i18n.translate("xpack.lens.indexPattern.termsOf",{defaultMessage:"Top values of {name}",values:{name:null!=e?e:_.i18n.translate("xpack.lens.indexPattern.missingFieldLabel",{defaultMessage:"Missing field"})}})}function qs(e,t){const n=e.columns[t];return n&&!n.isBucketed&&"last_value"!==n.operationType&&!("references"in n)&&!$i(e,t)}function Ws(e,t,n){if(Object(Z.uniq)(Object.values(e.columns).filter((e=>Fo[e.operationType].shiftable)).map((e=>e.timeShift||""))).length>1)return{message:_.i18n.translate("xpack.lens.indexPattern.termsWithMultipleShifts",{defaultMessage:"In a single layer, you are unable to combine metrics with different time shifts and dynamic top values. Use the same time shift value for all metrics, or use filters instead of top values."}),fixAction:{label:_.i18n.translate("xpack.lens.indexPattern.termsWithMultipleShiftsFixActionLabel",{defaultMessage:"Use filters"}),newState:async(a,i,r)=>{var s,l,o;const u=e.columns[t],c=u.sourceField,d=(null===(s=i.activeData)||void 0===s||null===(l=s[r].columns.find((({id:e})=>e===t)))||void 0===l?void 0:l.meta.field)===c;let p=Object(Z.uniq)((null===(o=i.activeData)||void 0===o?void 0:o[r].rows.map((e=>e[t])).filter((e=>"string"==typeof e&&"__other__"!==e)))||[]);if(!d||0===p.length){var m;p=(null===(m=(await a.http.post(`/api/lens/index_stats/${n.id}/field`,{body:JSON.stringify({fieldName:c,dslQuery:De.esQuery.buildEsQuery(n,i.query,i.filters,De.esQuery.getEsQueryConfig(a.uiSettings)),fromDate:i.dateRange.fromDate,toDate:i.dateRange.toDate,size:u.params.size})})).topValues)||void 0===m?void 0:m.buckets.map((({key:e})=>String(e))))||[]}return{...e,columns:{...e.columns,[t]:{label:_.i18n.translate("xpack.lens.indexPattern.pinnedTopValuesLabel",{defaultMessage:"Filters of {field}",values:{field:c}}),customLabel:!0,isBucketed:e.columns[t].isBucketed,dataType:"string",operationType:"filters",params:{filters:p.length>0?p.map((e=>({input:{query:`${c}: "${e}"`,language:"kuery"},label:e}))):[{input:{query:"*",language:"kuery"},label:Ns}]}}}}}}}}const $s=new Set(["string","boolean","number","ip"]),Ys={type:"terms",displayName:_.i18n.translate("xpack.lens.indexPattern.terms",{defaultMessage:"Top values"}),priority:3,input:"field",getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:n})=>{if($s.has(n)&&t&&(!e||e.terms))return{dataType:n,isBucketed:!0,scale:"ordinal"}},getErrorMessage:(e,t,n)=>{const a=[...fi(e.columns[t],n)||[],Ws(e,t,n)||""].filter(Boolean);return a.length?a:void 0},isTransferable:(e,t)=>{const n=t.getFieldByName(e.sourceField);return Boolean(n&&$s.has(n.type)&&n.aggregatable&&(!n.aggregationRestrictions||n.aggregationRestrictions.terms)&&(!e.params.otherBucket||!t.hasRestrictions))},buildColumn({layer:e,field:t,indexPattern:n}){const a=Object.entries(e.columns).filter((([t])=>qs(e,t))).map((([e])=>e))[0],i=Object.values(e.columns).filter((e=>e&&e.isBucketed)).length;return{label:Gs(t.displayName),dataType:t.type,operationType:"terms",scale:"ordinal",sourceField:t.name,isBucketed:!0,params:{size:0===i?5:3,orderBy:a?{type:"column",columnId:a}:{type:"alphabetical",fallback:!0},orderDirection:a?"desc":"asc",otherBucket:!n.hasRestrictions,missingBucket:!1}}},toEsAggsFn:(e,t,n,a,i,r)=>Object(ia.buildExpressionFunction)("aggTerms",{id:t,enabled:!0,schema:"segment",field:e.sourceField,orderBy:"alphabetical"===e.params.orderBy.type?"_key":String(r.indexOf(e.params.orderBy.columnId)),order:e.params.orderDirection,size:e.params.size,otherBucket:Boolean(e.params.otherBucket),otherBucketLabel:_.i18n.translate("xpack.lens.indexPattern.terms.otherLabel",{defaultMessage:"Other"}),missingBucket:e.params.otherBucket&&e.params.missingBucket,missingBucketLabel:_.i18n.translate("xpack.lens.indexPattern.terms.missingLabel",{defaultMessage:"(missing value)"})}).toAst(),getDefaultLabel:(e,t)=>{var n;return Gs(null===(n=t.getFieldByName(e.sourceField))||void 0===n?void 0:n.displayName)},onFieldChange:(e,t)=>{const n={...e.params};return"format"in n&&"number"!==t.type&&delete n.format,{...e,dataType:t.type,label:Gs(t.displayName),sourceField:t.name,params:n}},onOtherColumnChanged:(e,t,n)=>{const a=e.columns,i=a[t];if("column"===i.params.orderBy.type||i.params.orderBy.fallback){if(!("column"===i.params.orderBy.type?a[i.params.orderBy.columnId]:void 0)||"column"===i.params.orderBy.type&&!qs(e,i.params.orderBy.columnId)){const t=Object.entries(e.columns).filter((([t])=>qs(e,t))).map((([e])=>e))[0];return{...i,params:{...i.params,orderBy:t?{type:"column",columnId:t}:{type:"alphabetical",fallback:!0},orderDirection:t?"desc":"asc"}}}}return i},paramEditor:function({layer:e,updateLayer:t,currentColumn:n,columnId:a,indexPattern:i}){var r;const s=i.hasRestrictions;function l(e){return"alphabetical"===e.type?e.type:`${e.type}$$$${e.columnId}`}const o=Object.entries(e.columns).filter((([t])=>qs(e,t))).map((([e,t])=>({value:l({type:"column",columnId:e}),text:t.label})));return o.push({value:l({type:"alphabetical"}),text:_.i18n.translate("xpack.lens.indexPattern.terms.orderAlphabetical",{defaultMessage:"Alphabetical"})}),Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(er,{value:n.params.size,onChange:n=>{t(Bi({layer:e,columnId:a,paramName:"size",value:n}))}}),Object(E.jsx)(F.EuiFormRow,{label:Object(E.jsx)(v.a.Fragment,null,_.i18n.translate("xpack.lens.indexPattern.terms.orderBy",{defaultMessage:"Rank by"})," ",Object(E.jsx)(F.EuiIconTip,{color:"subdued",content:_.i18n.translate("xpack.lens.indexPattern.terms.orderByHelp",{defaultMessage:"Specifies the dimension the top values are ranked by."}),iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"})),display:"columnCompressed",fullWidth:!0},Object(E.jsx)(F.EuiSelect,{compressed:!0,"data-test-subj":"indexPattern-terms-orderBy",options:o,value:l(n.params.orderBy),onChange:n=>{const i="alphabetical"===(r=n.target.value)?{type:"alphabetical",fallback:!1}:{type:"column",columnId:r.split("$$$")[1]};var r;const s=Bi({layer:e,columnId:a,paramName:"orderBy",value:i});t(Bi({layer:s,columnId:a,paramName:"orderDirection",value:"alphabetical"===i.type?"asc":"desc"}))},"aria-label":_.i18n.translate("xpack.lens.indexPattern.terms.orderBy",{defaultMessage:"Rank by"})})),Object(E.jsx)(F.EuiFormRow,{label:_.i18n.translate("xpack.lens.indexPattern.terms.orderDirection",{defaultMessage:"Rank direction"}),display:"columnCompressed",fullWidth:!0},Object(E.jsx)(F.EuiSelect,{compressed:!0,"data-test-subj":"indexPattern-terms-orderDirection",options:[{value:"asc",text:_.i18n.translate("xpack.lens.indexPattern.terms.orderAscending",{defaultMessage:"Ascending"})},{value:"desc",text:_.i18n.translate("xpack.lens.indexPattern.terms.orderDescending",{defaultMessage:"Descending"})}],value:n.params.orderDirection,onChange:n=>t(Bi({layer:e,columnId:a,paramName:"orderDirection",value:n.target.value})),"aria-label":_.i18n.translate("xpack.lens.indexPattern.terms.orderBy",{defaultMessage:"Rank by"})})),!s&&Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiSpacer,{size:"s"}),Object(E.jsx)(F.EuiAccordion,{id:"lnsTermsAdvanced",buttonContent:_.i18n.translate("xpack.lens.indexPattern.terms.advancedSettings",{defaultMessage:"Advanced"})},Object(E.jsx)(F.EuiSpacer,{size:"m"}),Object(E.jsx)(F.EuiSwitch,{label:_.i18n.translate("xpack.lens.indexPattern.terms.otherBucketDescription",{defaultMessage:'Group other values as "Other"'}),compressed:!0,"data-test-subj":"indexPattern-terms-other-bucket",checked:Boolean(n.params.otherBucket),onChange:n=>t(Bi({layer:e,columnId:a,paramName:"otherBucket",value:n.target.checked}))}),Object(E.jsx)(F.EuiSpacer,{size:"m"}),Object(E.jsx)(F.EuiSwitch,{label:_.i18n.translate("xpack.lens.indexPattern.terms.missingBucketDescription",{defaultMessage:"Include documents without this field"}),compressed:!0,disabled:!n.params.otherBucket||"string"!==(null===(r=i.getFieldByName(n.sourceField))||void 0===r?void 0:r.type),"data-test-subj":"indexPattern-terms-missing-bucket",checked:Boolean(n.params.missingBucket),onChange:n=>t(Bi({layer:e,columnId:a,paramName:"missingBucket",value:n.target.checked}))}))))}};var Ks=n(335),Us=n(57);const Xs={s:_.i18n.translate("xpack.lens.fieldFormats.suffix.s",{defaultMessage:"/s"}),m:_.i18n.translate("xpack.lens.fieldFormats.suffix.m",{defaultMessage:"/m"}),h:_.i18n.translate("xpack.lens.fieldFormats.suffix.h",{defaultMessage:"/h"}),d:_.i18n.translate("xpack.lens.fieldFormats.suffix.d",{defaultMessage:"/d"})},Qs={s:_.i18n.translate("xpack.lens.fieldFormats.longSuffix.s",{defaultMessage:"per second"}),m:_.i18n.translate("xpack.lens.fieldFormats.longSuffix.m",{defaultMessage:"per minute"}),h:_.i18n.translate("xpack.lens.fieldFormats.longSuffix.h",{defaultMessage:"per hour"}),d:_.i18n.translate("xpack.lens.fieldFormats.longSuffix.d",{defaultMessage:"per day"})},Zs="suffix";function Js(e){var t;return t=class SuffixFormatter extends Us.FieldFormat{constructor(...t){super(...t),Q()(this,"allowsNumericalAggregations",!0),Q()(this,"textConvert",(t=>{const n=this.param("unit"),a=n?Xs[n]:void 0,i=this.param("id"),r=this.param("params"),s=e()({id:i,params:r}).convert(t);return""===s?"":a?`${s}${a}`:s}))}getParamDefaults(){return{unit:void 0,nestedParams:{}}}},Q()(t,"id",Zs),Q()(t,"hidden",!0),Q()(t,"title",_.i18n.translate("xpack.lens.fieldFormats.suffix.title",{defaultMessage:"Suffix"})),Q()(t,"fieldType",Ks.KBN_FIELD_TYPES.NUMBER),t}function el(e,t){return(t||e?" ":"")+(e?Qs[e]:"")+(t&&e?" ":"")+(t?`-${t}`:"")}function tl(e,t,n,a,i){let r=e;if(t||a){const n=el(t,a),i=e.lastIndexOf(n);-1!==i&&(r=e.substring(0,i))}return n||i?`${r}${el(n,i)}`:r}function nl(e,t,n){const a=e.columns,i=a[t];if(!i.timeScale)return i;return Object.values(a).some((e=>"date_histogram"===(null==e?void 0:e.operationType)))||i.customLabel?i:{...i,timeScale:void 0,label:tl(i.label,i.timeScale,void 0,i.timeShift,i.timeShift)}}const al=new Set(["string","boolean","number","number_range","ip","ip_range","date","date_range"]),il="ratio",rl="unique_count";function sl(e,t){return tl(_.i18n.translate("xpack.lens.indexPattern.cardinalityOf",{defaultMessage:"Unique count of {name}",values:{name:e}}),void 0,void 0,void 0,t)}const ll={type:rl,displayName:_.i18n.translate("xpack.lens.indexPattern.cardinality",{defaultMessage:"Unique count"}),input:"field",getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:n})=>{if(al.has(n)&&t&&(!e||e.cardinality))return{dataType:"number",isBucketed:false,scale:il}},getErrorMessage:(e,t,n)=>fi(e.columns[t],n),isTransferable:(e,t)=>{const n=t.getFieldByName(e.sourceField);return Boolean(n&&al.has(n.type)&&n.aggregatable&&(!n.aggregationRestrictions||n.aggregationRestrictions.cardinality))},filterable:!0,shiftable:!0,getDefaultLabel:(e,t)=>sl(bi(e.sourceField,t),e.timeShift),buildColumn:({field:e,previousColumn:t},n)=>({label:sl(e.displayName,null==t?void 0:t.timeShift),dataType:"number",operationType:rl,scale:il,sourceField:e.name,isBucketed:false,filter:ji(t,n),timeShift:(null==n?void 0:n.shift)||(null==t?void 0:t.timeShift),params:yi(t)}),toEsAggsFn:(e,t)=>Object(ia.buildExpressionFunction)("aggCardinality",{id:t,enabled:!0,schema:"metric",field:e.sourceField,timeShift:e.filter?void 0:e.timeShift}).toAst(),onFieldChange:(e,t)=>({...e,label:sl(t.displayName,e.timeShift),sourceField:t.name}),documentation:{section:"elasticsearch",signature:_.i18n.translate("xpack.lens.indexPattern.cardinality.signature",{defaultMessage:"field: string"}),description:_.i18n.translate("xpack.lens.indexPattern.cardinality.documentation.markdown",{defaultMessage:"\nCalculates the number of unique values of a specified field. Works for number, string, date and boolean values.\n\nExample: Calculate the number of different products:\n`unique_count(product.name)`\n\nExample: Calculate the number of different products from the \"clothes\" group:\n`unique_count(product.name, kql='product.group=clothes')`\n      "})}};function ol(e,t,n){return tl(_.i18n.translate("xpack.lens.indexPattern.percentileOf",{defaultMessage:"{percentile, selectordinal, one {#st} two {#nd} few {#rd} other {#th}} percentile of {name}",values:{name:e,percentile:t}}),void 0,void 0,void 0,n)}const ul=["number","histogram"],cl={type:"percentile",displayName:_.i18n.translate("xpack.lens.indexPattern.percentile",{defaultMessage:"Percentile"}),input:"field",operationParams:[{name:"percentile",type:"number",required:!1,defaultValue:95}],filterable:!0,shiftable:!0,getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:n})=>{if(ul.includes(n)&&t&&!e)return{dataType:"number",isBucketed:!1,scale:"ratio"}},isTransferable:(e,t)=>{const n=t.getFieldByName(e.sourceField);return Boolean(n&&ul.includes(n.type)&&n.aggregatable&&!n.aggregationRestrictions)},getDefaultLabel:(e,t,n)=>ol(bi(e.sourceField,t),e.params.percentile,e.timeShift),buildColumn:({field:e,previousColumn:t,indexPattern:n},a)=>{var i;const r=t&&hi("percentile",t)&&t.params.percentile,s=null!==(i=null==a?void 0:a.percentile)&&void 0!==i?i:r||95;return{label:ol(bi(e.name,n),s,null==t?void 0:t.timeShift),dataType:"number",operationType:"percentile",sourceField:e.name,isBucketed:!1,scale:"ratio",filter:ji(t,a),timeShift:(null==a?void 0:a.shift)||(null==t?void 0:t.timeShift),params:{percentile:s,...yi(t)}}},onFieldChange:(e,t)=>({...e,label:ol(t.displayName,e.params.percentile,e.timeShift),sourceField:t.name}),toEsAggsFn:(e,t,n)=>Object(ia.buildExpressionFunction)("aggSinglePercentile",{id:t,enabled:!0,schema:"metric",field:e.sourceField,percentile:e.params.percentile,timeShift:e.filter?void 0:e.timeShift}).toAst(),getErrorMessage:(e,t,n)=>fi(e.columns[t],n),paramEditor:function({layer:e,updateLayer:t,currentColumn:n,columnId:a,indexPattern:i}){const[r,s]=Object(h.useState)(String(n.params.percentile)),l=Number(r),o=xi(r,!0,99,1);Object(M.p)((()=>{var r;o&&t({...e,columns:{...e.columns,[a]:{...n,label:n.customLabel?n.label:ol((null===(r=i.getFieldByName(n.sourceField))||void 0===r?void 0:r.displayName)||n.sourceField,l,n.timeShift),params:{...n.params,percentile:l}}}})}),{skipFirstRender:!0},256,[r]);const u=Object(h.useCallback)((e=>{const t=String(e.target.value);s(t)}),[]);return Object(E.jsx)(F.EuiFormRow,{label:_.i18n.translate("xpack.lens.indexPattern.percentile.percentileValue",{defaultMessage:"Percentile"}),"data-test-subj":"lns-indexPattern-percentile-form",display:"columnCompressed",fullWidth:!0,isInvalid:!o,error:!o&&_.i18n.translate("xpack.lens.indexPattern.percentile.errorMessage",{defaultMessage:"Percentile has to be an integer between 1 and 99"})},Object(E.jsx)(F.EuiFieldNumber,{"data-test-subj":"lns-indexPattern-percentile-input",compressed:!0,value:r,min:1,max:99,step:1,onChange:u}))},documentation:{section:"elasticsearch",signature:_.i18n.translate("xpack.lens.indexPattern.percentile.signature",{defaultMessage:"field: string, [percentile]: number"}),description:_.i18n.translate("xpack.lens.indexPattern.percentile.documentation.markdown",{defaultMessage:"\nReturns the specified percentile of the values of a field. This is the value n percent of the values occuring in documents are smaller.\n\nExample: Get the number of bytes larger than 95 % of values:\n`percentile(bytes, percentile=95)`\n      "})}},dl={min:"aggMin",max:"aggMax",average:"aggAvg",sum:"aggSum",median:"aggMedian"},pl=["number","histogram"];function ml({type:e,displayName:t,description:n,ofName:a,priority:i,optionalTimeScaling:r}){const s=(e,t)=>tl(a(e),void 0,r?null==t?void 0:t.timeScale:void 0,void 0,null==t?void 0:t.timeShift);return{type:e,priority:i,displayName:t,description:n,input:"field",timeScalingMode:r?"optional":void 0,getPossibleOperationForField:({aggregationRestrictions:t,aggregatable:n,type:a})=>{if(pl.includes(a)&&n&&(!t||t[e]))return{dataType:"number",isBucketed:!1,scale:"ratio"}},isTransferable:(t,n)=>{const a=n.getFieldByName(t.sourceField);return Boolean(a&&pl.includes(a.type)&&a.aggregatable&&(!a.aggregationRestrictions||a.aggregationRestrictions[e]))},onOtherColumnChanged:(e,t,n)=>r?nl(e,t):e.columns[t],getDefaultLabel:(e,t,n)=>s(bi(e.sourceField,t),e),buildColumn:({field:t,previousColumn:n},a)=>({label:s(t.displayName,n),dataType:"number",operationType:e,sourceField:t.name,isBucketed:!1,scale:"ratio",timeScale:r?null==n?void 0:n.timeScale:void 0,filter:ji(n,a),timeShift:(null==a?void 0:a.shift)||(null==n?void 0:n.timeShift),params:yi(n)}),onFieldChange:(e,t)=>({...e,label:s(t.displayName,e),sourceField:t.name}),toEsAggsFn:(t,n,a)=>Object(ia.buildExpressionFunction)(dl[e],{id:n,enabled:!0,schema:"metric",field:t.sourceField,timeShift:t.filter?void 0:t.timeShift}).toAst(),getErrorMessage:(e,t,n)=>fi(e.columns[t],n),filterable:!0,documentation:{section:"elasticsearch",signature:_.i18n.translate("xpack.lens.indexPattern.metric.signature",{defaultMessage:"field: string"}),description:_.i18n.translate("xpack.lens.indexPattern.metric.documentation.markdown",{defaultMessage:"\nReturns the {metric} of a field. This function only works for number fields.\n\nExample: Get the {metric} of price:\n`{metric}(price)`\n\nExample: Get the {metric} of price for orders from the UK:\n`{metric}(price, kql='location:UK')`\n      ",values:{metric:e}})},shiftable:!0}}const gl=ml({type:"min",displayName:_.i18n.translate("xpack.lens.indexPattern.min",{defaultMessage:"Minimum"}),ofName:e=>_.i18n.translate("xpack.lens.indexPattern.minOf",{defaultMessage:"Minimum of {name}",values:{name:e}}),description:_.i18n.translate("xpack.lens.indexPattern.min.description",{defaultMessage:"A single-value metrics aggregation that returns the minimum value among the numeric values extracted from the aggregated documents."})}),fl=ml({type:"max",displayName:_.i18n.translate("xpack.lens.indexPattern.max",{defaultMessage:"Maximum"}),ofName:e=>_.i18n.translate("xpack.lens.indexPattern.maxOf",{defaultMessage:"Maximum of {name}",values:{name:e}}),description:_.i18n.translate("xpack.lens.indexPattern.max.description",{defaultMessage:"A single-value metrics aggregation that returns the maximum value among the numeric values extracted from the aggregated documents."})}),bl=ml({type:"average",priority:2,displayName:_.i18n.translate("xpack.lens.indexPattern.avg",{defaultMessage:"Average"}),ofName:e=>_.i18n.translate("xpack.lens.indexPattern.avgOf",{defaultMessage:"Average of {name}",values:{name:e}}),description:_.i18n.translate("xpack.lens.indexPattern.avg.description",{defaultMessage:"A single-value metric aggregation that computes the average of numeric values that are extracted from the aggregated documents"})}),xl=ml({type:"sum",priority:1,displayName:_.i18n.translate("xpack.lens.indexPattern.sum",{defaultMessage:"Sum"}),ofName:e=>_.i18n.translate("xpack.lens.indexPattern.sumOf",{defaultMessage:"Sum of {name}",values:{name:e}}),optionalTimeScaling:!0,description:_.i18n.translate("xpack.lens.indexPattern.sum.description",{defaultMessage:"A single-value metrics aggregation that sums up numeric values that are extracted from the aggregated documents."})}),hl=ml({type:"median",priority:3,displayName:_.i18n.translate("xpack.lens.indexPattern.median",{defaultMessage:"Median"}),ofName:e=>_.i18n.translate("xpack.lens.indexPattern.medianOf",{defaultMessage:"Median of {name}",values:{name:e}}),description:_.i18n.translate("xpack.lens.indexPattern.median.description",{defaultMessage:"A single-value metrics aggregation that computes the median value that are extracted from the aggregated documents."})});n(338);const vl=({children:e,onClick:t})=>Object(E.jsx)(F.EuiText,{size:"xs"},Object(E.jsx)(F.EuiLink,{onClick:t},Object(E.jsx)(F.EuiIcon,{className:"lnsHelpPopover__buttonIcon",size:"s",type:"help"}),e)),yl=({anchorPosition:e,button:t,children:n,closePopover:a,isOpen:i,title:r})=>(Object(h.useEffect)((()=>{i&&Object(at.e)("open_help_popover")}),[i]),Object(E.jsx)(F.EuiPopover,{anchorPosition:e,button:t,className:"lnsHelpPopover",closePopover:a,isOpen:i,ownFocus:!0,panelClassName:"lnsHelpPopover__panel",panelPaddingSize:"none"},r&&Object(E.jsx)(F.EuiPopoverTitle,{paddingSize:"m"},r),Object(E.jsx)(F.EuiText,{className:"lnsHelpPopover__content",size:"s"},n))),{isValidInterval:jl}=De.search.aggs,_l="auto",Ol=new Set(["w","M","q","y"]);function kl(e,t){if(!Object.values(e.columns).some((e=>e.timeShift&&""!==e.timeShift)))return;return e.columnOrder.filter((t=>"date_histogram"===e.columns[t].operationType)).length<2?void 0:_.i18n.translate("xpack.lens.indexPattern.multipleDateHistogramsError",{defaultMessage:'"{dimensionLabel}" is not the only date histogram. When using time shifts, make sure to only use one date histogram.',values:{dimensionLabel:e.columns[t].label}})}const Il={type:"date_histogram",displayName:_.i18n.translate("xpack.lens.indexPattern.dateHistogram",{defaultMessage:"Date histogram"}),input:"field",priority:5,operationParams:[{name:"interval",type:"string",required:!1}],getErrorMessage:(e,t,n)=>[...fi(e.columns[t],n)||[],kl(e,t)||""].filter(Boolean),getHelpMessage:e=>Object(E.jsx)(wl,e),getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:n})=>{if(("date"===n||"date_range"===n)&&t&&(!e||e.date_histogram))return{dataType:"date",isBucketed:!0,scale:"interval"}},getDefaultLabel:(e,t)=>bi(e.sourceField,t),buildColumn({field:e},t){var n;return{label:e.displayName,dataType:"date",operationType:"date_histogram",sourceField:e.name,isBucketed:!0,scale:"interval",params:{interval:null!==(n=null==t?void 0:t.interval)&&void 0!==n?n:_l}}},isTransferable:(e,t)=>{const n=t.getFieldByName(e.sourceField);return Boolean(n&&"date"===n.type&&n.aggregatable&&(!n.aggregationRestrictions||n.aggregationRestrictions.date_histogram))},onFieldChange:(e,t)=>({...e,label:t.displayName,sourceField:t.name}),toEsAggsFn:(e,t,n)=>{var a,i,r;const s=n.getFieldByName(e.sourceField);let l,o=null!==(a=null===(i=e.params)||void 0===i?void 0:i.interval)&&void 0!==a?a:_l;return s&&s.aggregationRestrictions&&s.aggregationRestrictions.date_histogram&&(o=Fl(s.aggregationRestrictions),l=s.aggregationRestrictions.date_histogram.time_zone),Object(ia.buildExpressionFunction)("aggDateHistogram",{id:t,enabled:!0,schema:"segment",field:e.sourceField,time_zone:l,useNormalizedEsInterval:!(null!=s&&null!==(r=s.aggregationRestrictions)&&void 0!==r&&r.date_histogram),interval:o,drop_partials:!1,min_doc_count:0,extended_bounds:Object(fa.extendedBoundsToAst)({})}).toAst()},paramEditor:function({layer:e,columnId:t,currentColumn:n,updateLayer:a,dateRange:i,data:r,indexPattern:s}){const l=n&&s.getFieldByName(n.sourceField),o=l.aggregationRestrictions&&l.aggregationRestrictions.date_histogram,u=function(e){const t=e||"",n=t.match(/[\d]+/)||[],a=t.match(/[\D]+/)||[],i=parseInt(n[0]||"",10);return{value:isNaN(i)?"":i,unit:a[0]||"h"}}(n.params.interval),c=jl(`${""===u.value?"1":u.value}${u.unit}`,Fl(l.aggregationRestrictions));const d=n=>{const i=`${Ol.has(n.unit)?"1":n.value}${n.unit||"d"}`;a(Bi({layer:e,columnId:t,paramName:"interval",value:i}))};return Object(E.jsx)(v.a.Fragment,null,!o&&Object(E.jsx)(F.EuiFormRow,{display:"rowCompressed",hasChildLabel:!1},Object(E.jsx)(F.EuiSwitch,{label:_.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoInterval",{defaultMessage:"Customize time interval"}),checked:n.params.interval!==_l,onChange:function(n){const{fromDate:s,toDate:l}=i,o=n.target.checked?r.search.aggs.calculateAutoTimeExpression({from:s,to:l})||"1h":_l;a(Bi({layer:e,columnId:t,paramName:"interval",value:o}))},compressed:!0})),n.params.interval!==_l&&Object(E.jsx)(F.EuiFormRow,{label:_.i18n.translate("xpack.lens.indexPattern.dateHistogram.minimumInterval",{defaultMessage:"Minimum interval"}),fullWidth:!0,display:"rowCompressed"},o?Object(E.jsx)(O.FormattedMessage,{id:"xpack.lens.indexPattern.dateHistogram.restrictedInterval",defaultMessage:"Interval fixed to {intervalValue} due to aggregation restrictions.",values:{intervalValue:Fl(l.aggregationRestrictions)}}):Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiFlexGroup,{responsive:!1,gutterSize:"s"},Object(E.jsx)(F.EuiFlexItem,null,Object(E.jsx)(F.EuiFieldNumber,{compressed:!0,"data-test-subj":"lensDateHistogramValue",value:"number"==typeof u.value||""===u.value?u.value:parseInt(u.value,10),disabled:Ol.has(u.unit),isInvalid:!c,onChange:e=>{const t={...u,value:e.target.value};d(t)}})),Object(E.jsx)(F.EuiFlexItem,null,Object(E.jsx)(F.EuiSelect,{compressed:!0,"data-test-subj":"lensDateHistogramUnit",value:u.unit,onChange:e=>{const t={...u,unit:e.target.value};d(t)},isInvalid:!c,options:[{value:"ms",text:_.i18n.translate("xpack.lens.indexPattern.dateHistogram.milliseconds",{defaultMessage:"milliseconds"})},{value:"s",text:_.i18n.translate("xpack.lens.indexPattern.dateHistogram.seconds",{defaultMessage:"seconds"})},{value:"m",text:_.i18n.translate("xpack.lens.indexPattern.dateHistogram.minutes",{defaultMessage:"minutes"})},{value:"h",text:_.i18n.translate("xpack.lens.indexPattern.dateHistogram.hours",{defaultMessage:"hours"})},{value:"d",text:_.i18n.translate("xpack.lens.indexPattern.dateHistogram.days",{defaultMessage:"days"})},{value:"w",text:_.i18n.translate("xpack.lens.indexPattern.dateHistogram.week",{defaultMessage:"week"})},{value:"M",text:_.i18n.translate("xpack.lens.indexPattern.dateHistogram.month",{defaultMessage:"month"})},{value:"y",text:_.i18n.translate("xpack.lens.indexPattern.dateHistogram.year",{defaultMessage:"year"})}]}))),!c&&Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiSpacer,{size:"s"}),Object(E.jsx)(F.EuiTextColor,{color:"danger","data-test-subj":"lensDateHistogramError"},_.i18n.translate("xpack.lens.indexPattern.invalidInterval",{defaultMessage:"Invalid interval value"}))))))}};function Fl(e){if(e&&e.date_histogram)return e.date_histogram.calendar_interval||e.date_histogram.fixed_interval}const wl=({data:e})=>{const[t,n]=Object(h.useState)(!1),a=_.i18n.translate("xpack.lens.indexPattern.dateHistogram.moreThanYear",{defaultMessage:"More than a year"}),i=_.i18n.translate("xpack.lens.indexPattern.dateHistogram.upTo",{defaultMessage:"Up to"});return Object(E.jsx)(yl,{anchorPosition:"upCenter",button:Object(E.jsx)(vl,{onClick:()=>{n(!t)}},_.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoHelpText",{defaultMessage:"How it works"})),closePopover:()=>n(!1),isOpen:t,title:_.i18n.translate("xpack.lens.indexPattern.dateHistogram.titleHelp",{defaultMessage:"How auto date histogram works"})},Object(E.jsx)("p",null,_.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoBasicExplanation",{defaultMessage:"The auto date histogram splits a data field into buckets by interval."})),Object(E.jsx)("p",null,Object(E.jsx)(O.FormattedMessage,{id:"xpack.lens.indexPattern.dateHistogram.autoLongerExplanation",defaultMessage:"To choose the interval, Lens divides the specified time range by the {targetBarSetting} setting. Lens calculates the best interval for your data. For example 30m, 1h, and 12. The maximum number of bars is set by the {maxBarSetting} value.",values:{maxBarSetting:Object(E.jsx)(F.EuiCode,null,De.UI_SETTINGS.HISTOGRAM_MAX_BARS),targetBarSetting:Object(E.jsx)(F.EuiCode,null,De.UI_SETTINGS.HISTOGRAM_BAR_TARGET)}})),Object(E.jsx)("p",null,_.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoAdvancedExplanation",{defaultMessage:"The interval follows this logic:"})),Object(E.jsx)(F.EuiBasicTable,{items:De.search.aggs.boundsDescendingRaw.map((({bound:e,boundLabel:t,intervalLabel:n})=>({bound:"number"==typeof e?a:`${i} ${t}`,interval:n}))),columns:[{field:"bound",name:_.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoBoundHeader",{defaultMessage:"Target interval measured"})},{field:"interval",name:_.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoIntervalHeader",{defaultMessage:"Interval used"})}]}))};var Tl=n(91),El=n.n(Tl);const Cl=e=>(t,n,a)=>tl(e(t),void 0,n,void 0,a);function Ml(e,t){if(e===$.i.REFERENCELINE)return[_.i18n.translate("xpack.lens.indexPattern.calculations.layerDataType",{defaultMessage:"{name} is disabled for this type of layer.",values:{name:t}})]}function Pl(e,t){if(!e.columnOrder.filter((t=>e.columns[t].isBucketed)).some((t=>"date_histogram"===e.columns[t].operationType)))return[_.i18n.translate("xpack.lens.indexPattern.calculations.dateHistogramErrorMessage",{defaultMessage:"{name} requires a date histogram to work. Add a date histogram or select a different function.",values:{name:t}})]}const Sl=El()((e=>{const t=new Set;return Object.entries(e.columns).forEach((([n,a])=>{if("references"in a&&"managedReference"===Fo[a.operationType].input){t.add(n);Ji(n,e.columns).map((([e])=>{t.add(e)}))}})),t}));function Al(e,t,n){var a,i;const r=null!==(a=Pl(e,n))&&void 0!==a?a:[],s=null!==(i=function(e,t){const n=e.columns[t],a=[];return n.references.forEach(((i,r)=>{if(e.columns[i]){const s=e.columns[i],l=Fo[n.operationType];if("fullReference"!==l.input)throw new Error("inconsistent state - column is not a reference operation");Zi({validation:l.requiredReferences[r],column:s})||Sl(e).has(t)||a.push(_.i18n.translate("xpack.lens.indexPattern.invalidReferenceConfiguration",{defaultMessage:'Dimension "{dimensionLabel}" is configured incorrectly',values:{dimensionLabel:n.label}}))}else a.push(_.i18n.translate("xpack.lens.indexPattern.missingReferenceError",{defaultMessage:'"{dimensionLabel}" is not fully configured',values:{dimensionLabel:n.label}}))})),a.length?a:void 0}(e,t))&&void 0!==i?i:[];if(r.length||s.length)return[...r,...s]}function Ll(e){return e.fields.some((e=>"date"===e.type))}function Dl(e,t,n,a={}){const i=e.columns[t],r=e.columnOrder.filter((t=>e.columns[t].isBucketed)),s=r.findIndex((t=>"date_histogram"===e.columns[t].operationType));return r.splice(s,1),[{type:"function",function:n,arguments:{by:r,inputColumnId:[i.references[0]],outputColumnId:[t],outputColumnName:[i.label],...a}}]}const Nl=Cl((e=>_.i18n.translate("xpack.lens.indexPattern.CounterRateOf",{defaultMessage:"Counter rate of {name}",values:{name:null!=e?e:_.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}))),zl={type:"counter_rate",priority:1,displayName:_.i18n.translate("xpack.lens.indexPattern.counterRate",{defaultMessage:"Counter rate"}),input:"fullReference",selectionStyle:"field",requiredReferences:[{input:["field","managedReference"],specificOperations:["max"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],getPossibleOperation:e=>{if(Ll(e))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t,n)=>{var a;const i=n[e.references[0]];return Nl(i&&"sourceField"in i?null===(a=t.getFieldByName(i.sourceField))||void 0===a?void 0:a.displayName:void 0,e.timeScale,e.timeShift)},toExpression:(e,t)=>Dl(e,t,"lens_counter_rate"),buildColumn:({referenceIds:e,previousColumn:t,layer:n,indexPattern:a},i)=>{var r;const s=n.columns[e[0]],l=(null==t?void 0:t.timeScale)||"s";return{label:Nl(s&&"sourceField"in s?null===(r=a.getFieldByName(s.sourceField))||void 0===r?void 0:r.displayName:void 0,l,null==t?void 0:t.timeShift),dataType:"number",operationType:"counter_rate",isBucketed:!1,scale:"ratio",references:e,timeScale:l,timeShift:(null==i?void 0:i.shift)||(null==t?void 0:t.timeShift),filter:ji(t,i),params:yi(t)}},isTransferable:(e,t)=>Ll(t),getErrorMessage:(e,t)=>Al(e,t,_.i18n.translate("xpack.lens.indexPattern.counterRate",{defaultMessage:"Counter rate"})),getDisabledStatus(e,t,n){var a;const i=_.i18n.translate("xpack.lens.indexPattern.counterRate",{defaultMessage:"Counter rate"});if(n){const e=Ml(n,i);if(e)return e.join(", ")}return null===(a=Pl(t,i))||void 0===a?void 0:a.join(", ")},timeScalingMode:"mandatory",filterable:!0,documentation:{section:"calculation",signature:_.i18n.translate("xpack.lens.indexPattern.counterRate.signature",{defaultMessage:"metric: number"}),description:_.i18n.translate("xpack.lens.indexPattern.counterRate.documentation.markdown",{defaultMessage:"\nCalculates the rate of an ever increasing counter. This function will only yield helpful results on counter metric fields which contain a measurement of some kind monotonically growing over time.\nIf the value does get smaller, it will interpret this as a counter reset. To get most precise results, `counter_rate` should be calculated on the `max` of a field.\n\nThis calculation will be done separately for separate series defined by filters or top values dimensions.\nIt uses the current interval when used in Formula.\n\nExample: Visualize the rate of bytes received over time by a memcached server:\n`counter_rate(max(memcached.stats.read.bytes))`\n      "})},shiftable:!0},Bl=Cl((e=>_.i18n.translate("xpack.lens.indexPattern.cumulativeSumOf",{defaultMessage:"Cumulative sum of {name}",values:{name:null!=e?e:_.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}))),Rl={type:"cumulative_sum",priority:1,displayName:_.i18n.translate("xpack.lens.indexPattern.cumulativeSum",{defaultMessage:"Cumulative sum"}),input:"fullReference",selectionStyle:"field",requiredReferences:[{input:["field","managedReference"],specificOperations:["count","sum"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],getPossibleOperation:e=>{if(Ll(e))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t,n)=>{var a;const i=n[e.references[0]];return Bl(i&&"sourceField"in i?null===(a=t.getFieldByName(i.sourceField))||void 0===a?void 0:a.displayName:void 0,void 0,e.timeShift)},toExpression:(e,t)=>Dl(e,t,"cumulative_sum"),buildColumn:({referenceIds:e,previousColumn:t,layer:n,indexPattern:a},i)=>{var r;const s=n.columns[e[0]];return{label:Bl(s&&"sourceField"in s?null===(r=a.getFieldByName(s.sourceField))||void 0===r?void 0:r.displayName:void 0,void 0,null==t?void 0:t.timeShift),dataType:"number",operationType:"cumulative_sum",isBucketed:!1,scale:"ratio",timeShift:(null==i?void 0:i.shift)||(null==t?void 0:t.timeShift),filter:ji(t,i),references:e,params:yi(t)}},isTransferable:()=>!0,getErrorMessage:(e,t)=>Al(e,t,_.i18n.translate("xpack.lens.indexPattern.cumulativeSum",{defaultMessage:"Cumulative sum"})),getDisabledStatus(e,t,n){var a;const i=_.i18n.translate("xpack.lens.indexPattern.cumulativeSum",{defaultMessage:"Cumulative sum"});if(n){const e=Ml(n,i);if(e)return e.join(", ")}return null===(a=Pl(t,i))||void 0===a?void 0:a.join(", ")},filterable:!0,documentation:{section:"calculation",signature:_.i18n.translate("xpack.lens.indexPattern.cumulative_sum.signature",{defaultMessage:"metric: number"}),description:_.i18n.translate("xpack.lens.indexPattern.cumulativeSum.documentation.markdown",{defaultMessage:"\nCalculates the cumulative sum of a metric over time, adding all previous values of a series to each value. To use this function, you need to configure a date histogram dimension as well.\n\nThis calculation will be done separately for separate series defined by filters or top values dimensions.\n\nExample: Visualize the received bytes accumulated over time:\n`cumulative_sum(sum(bytes))`\n      "})},shiftable:!0},Vl="differences",Hl=Cl((e=>_.i18n.translate("xpack.lens.indexPattern.derivativeOf",{defaultMessage:"Differences of {name}",values:{name:null!=e?e:_.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}))),Gl={type:Vl,priority:1,displayName:_.i18n.translate("xpack.lens.indexPattern.derivative",{defaultMessage:"Differences"}),input:"fullReference",selectionStyle:"full",requiredReferences:[{input:["field","managedReference"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],getPossibleOperation:e=>{if(Ll(e))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t,n)=>{var a;return Hl(null===(a=n[e.references[0]])||void 0===a?void 0:a.label,e.timeScale,e.timeShift)},toExpression:(e,t)=>Dl(e,t,"derivative"),buildColumn:({referenceIds:e,previousColumn:t,layer:n},a)=>{const i=n.columns[e[0]];return{label:Hl(null==i?void 0:i.label,null==t?void 0:t.timeScale,null==t?void 0:t.timeShift),dataType:"number",operationType:Vl,isBucketed:!1,scale:"ratio",references:e,timeScale:null==t?void 0:t.timeScale,filter:ji(t,a),timeShift:(null==a?void 0:a.shift)||(null==t?void 0:t.timeShift),params:yi(t)}},isTransferable:(e,t)=>Ll(t),onOtherColumnChanged:nl,getErrorMessage:(e,t)=>Al(e,t,_.i18n.translate("xpack.lens.indexPattern.derivative",{defaultMessage:"Differences"})),getDisabledStatus(e,t,n){var a;const i=_.i18n.translate("xpack.lens.indexPattern.derivative",{defaultMessage:"Differences"});if(n){const e=Ml(n,i);if(e)return e.join(", ")}return null===(a=Pl(t,i))||void 0===a?void 0:a.join(", ")},timeScalingMode:"optional",filterable:!0,documentation:{section:"calculation",signature:_.i18n.translate("xpack.lens.indexPattern.differences.signature",{defaultMessage:"metric: number"}),description:_.i18n.translate("xpack.lens.indexPattern.differences.documentation.markdown",{defaultMessage:"\nCalculates the difference to the last value of a metric over time. To use this function, you need to configure a date histogram dimension as well.\nDifferences requires the data to be sequential. If your data is empty when using differences, try increasing the date histogram interval.\n\nThis calculation will be done separately for separate series defined by filters or top values dimensions.\n\nExample: Visualize the change in bytes received over time:\n`differences(sum(bytes))`\n      "})},shiftable:!0},ql=Cl((e=>_.i18n.translate("xpack.lens.indexPattern.movingAverageOf",{defaultMessage:"Moving average of {name}",values:{name:null!=e?e:_.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}))),Wl=5,$l={type:"moving_average",priority:1,displayName:_.i18n.translate("xpack.lens.indexPattern.movingAverage",{defaultMessage:"Moving average"}),input:"fullReference",selectionStyle:"full",requiredReferences:[{input:["field","managedReference"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],operationParams:[{name:"window",type:"number",required:!1,defaultValue:Wl}],getPossibleOperation:e=>{if(Ll(e))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t,n)=>{var a;return ql(null===(a=n[e.references[0]])||void 0===a?void 0:a.label,e.timeScale,e.timeShift)},toExpression:(e,t)=>Dl(e,t,"moving_average",{window:[e.columns[t].params.window]}),buildColumn:({referenceIds:e,previousColumn:t,layer:n},a={window:Wl})=>{const i=n.columns[e[0]],{window:r=Wl}=a;return{label:ql(null==i?void 0:i.label,null==t?void 0:t.timeScale,null==t?void 0:t.timeShift),dataType:"number",operationType:"moving_average",isBucketed:!1,scale:"ratio",references:e,timeShift:(null==a?void 0:a.shift)||(null==t?void 0:t.timeShift),filter:ji(t,a),timeScale:null==t?void 0:t.timeScale,params:{window:r,...yi(t)}}},paramEditor:function({layer:e,updateLayer:t,currentColumn:n,columnId:a}){const[i,r]=Object(h.useState)(String(n.params.window));return Object(M.p)((()=>{if(!xi(i,!0,void 0,1))return;const n=parseInt(i,10);t(Bi({layer:e,columnId:a,paramName:"window",value:n}))}),{skipFirstRender:!0},256,[i]),Object(E.jsx)(F.EuiFormRow,{label:_.i18n.translate("xpack.lens.indexPattern.movingAverage.window",{defaultMessage:"Window size"}),display:"columnCompressed",fullWidth:!0,isInvalid:!xi(i)},Object(E.jsx)(F.EuiFieldNumber,{compressed:!0,value:i,onChange:e=>r(e.target.value),min:1,step:1,isInvalid:!xi(i)}))},isTransferable:(e,t)=>Ll(t),onOtherColumnChanged:nl,getErrorMessage:(e,t)=>Al(e,t,_.i18n.translate("xpack.lens.indexPattern.movingAverage",{defaultMessage:"Moving average"})),getHelpMessage:()=>Object(E.jsx)(Yl,null),getDisabledStatus(e,t,n){var a;const i=_.i18n.translate("xpack.lens.indexPattern.movingAverage",{defaultMessage:"Moving average"});if(n){const e=Ml(n,i);if(e)return e.join(", ")}return null===(a=Pl(t,i))||void 0===a?void 0:a.join(", ")},timeScalingMode:"optional",filterable:!0,documentation:{section:"calculation",signature:_.i18n.translate("xpack.lens.indexPattern.moving_average.signature",{defaultMessage:"metric: number, [window]: number"}),description:_.i18n.translate("xpack.lens.indexPattern.movingAverage.documentation.markdown",{defaultMessage:"\nCalculates the moving average of a metric over time, averaging the last n-th values to calculate the current value. To use this function, you need to configure a date histogram dimension as well.\nThe default window value is {defaultValue}.\n\nThis calculation will be done separately for separate series defined by filters or top values dimensions.\n\nTakes a named parameter `window` which specifies how many last values to include in the average calculation for the current value.\n\nExample: Smooth a line of measurements:\n`moving_average(sum(bytes), window=5)`\n      ",values:{defaultValue:Wl}})},shiftable:!0};const Yl=()=>{const[e,t]=Object(h.useState)(!1);return Object(E.jsx)(yl,{anchorPosition:"upCenter",button:Object(E.jsx)(vl,{onClick:()=>{t(!e)}},_.i18n.translate("xpack.lens.indexPattern.movingAverage.helpText",{defaultMessage:"How it works"})),closePopover:()=>t(!1),isOpen:e,title:_.i18n.translate("xpack.lens.indexPattern.movingAverage.titleHelp",{defaultMessage:"How moving average works"})},Object(E.jsx)("p",null,Object(E.jsx)(O.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.basicExplanation",defaultMessage:"Moving average slides a window across the data and displays the average value. Moving average is supported only by date histograms."})),Object(E.jsx)("p",null,Object(E.jsx)(O.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.longerExplanation",defaultMessage:"To calculate the moving average, Lens uses the mean of the window and applies a skip policy for gaps.  For missing values, the bucket is skipped, and the calculation is performed on the next value."})),Object(E.jsx)("p",null,Object(E.jsx)(O.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.tableExplanation",defaultMessage:"For example, given the data [1, 2, 3, 4, 5, 6, 7, 8, 9, 10], you can calculate a simple moving average with a window size of 5:"})),Object(E.jsx)("ul",null,Object(E.jsx)("li",null,"(1 + 2 + 3 + 4 + 5) / 5 = 3"),Object(E.jsx)("li",null,"(2 + 3 + 4 + 5 + 6) / 5 = 4"),Object(E.jsx)("li",null,"..."),Object(E.jsx)("li",null,"(5 + 6 + 7 + 8 + 9) / 5 = 7")),Object(E.jsx)("p",null,Object(E.jsx)(O.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.windowLimitations",defaultMessage:"The window does not include the current value."})),Object(E.jsx)("p",null,Object(E.jsx)(O.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.windowInitialPartial",defaultMessage:"The window is partial until it reaches the requested number of items.  For example, with a window size of 5:"})),Object(E.jsx)("ul",null,Object(E.jsx)("li",null,"(1 + 2) / 2 = 1.5"),Object(E.jsx)("li",null,"(1 + 2 + 3) / 3 = 2"),Object(E.jsx)("li",null,"(1 + 2 + 3 + 4) / 4 = 2.5"),Object(E.jsx)("li",null,"(1 + 2 + 3 + 4 + 5) / 5 = 3")),Object(E.jsx)("p",null,Object(E.jsx)(O.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.limitations",defaultMessage:"The first moving average value starts at the second item."})))};function Kl({type:e,displayName:t,ofName:n,description:a,metric:i}){return{type:e,priority:1,displayName:t,input:"fullReference",selectionStyle:"hidden",requiredReferences:[{input:["field","managedReference","fullReference"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio"}),getDefaultLabel:(e,t,a)=>{var i;const r=a[e.references[0]];return n(r&&"sourceField"in r?null===(i=t.getFieldByName(r.sourceField))||void 0===i?void 0:i.displayName:void 0)},toExpression:(e,t)=>function(e,t,n,a={}){const i=e.columns[t],r=e.columnOrder.filter((t=>e.columns[t].isBucketed)),s=r.filter((t=>"date_histogram"!==e.columns[t].operationType&&"range"!==e.columns[t].operationType));return[{type:"function",function:n,arguments:{by:s.length===r.length?[]:s,inputColumnId:[i.references[0]],outputColumnId:[t],outputColumnName:[i.label],...a}}]}(e,t,"overall_metric",{metric:[i]}),buildColumn:({referenceIds:e,previousColumn:t,layer:a,indexPattern:r},s)=>{var l;const o=a.columns[e[0]];return{label:n(o&&"sourceField"in o?null===(l=r.getFieldByName(o.sourceField))||void 0===l?void 0:l.displayName:void 0),dataType:"number",operationType:`overall_${i}`,isBucketed:!1,scale:"ratio",references:e,params:yi(t)}},isTransferable:()=>!0,filterable:!1,shiftable:!1,documentation:{section:"calculation",signature:_.i18n.translate("xpack.lens.indexPattern.overall_metric",{defaultMessage:"metric: number"}),description:a}}}const Ul=Kl({type:"overall_sum",displayName:_.i18n.translate("xpack.lens.indexPattern.overallSum",{defaultMessage:"Overall sum"}),ofName:e=>_.i18n.translate("xpack.lens.indexPattern.overallSumOf",{defaultMessage:"Overall sum of {name}",values:{name:null!=e?e:_.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}),metric:"sum",description:_.i18n.translate("xpack.lens.indexPattern.overall_sum.documentation.markdown",{defaultMessage:"\nCalculates the sum of a metric of all data points of a series in the current chart. A series is defined by a dimension using a date histogram or interval function.\nOther dimensions breaking down the data like top values or filter are treated as separate series.\n\nIf no date histograms or interval functions are used in the current chart, `overall_sum` is calculating the sum over all dimensions no matter the used function.\n\nExample: Percentage of total\n`sum(bytes) / overall_sum(sum(bytes))`\n      "})}),Xl=Kl({type:"overall_min",displayName:_.i18n.translate("xpack.lens.indexPattern.overallMin",{defaultMessage:"Overall min"}),ofName:e=>_.i18n.translate("xpack.lens.indexPattern.overallMinOf",{defaultMessage:"Overall min of {name}",values:{name:null!=e?e:_.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}),metric:"min",description:_.i18n.translate("xpack.lens.indexPattern.overall_min.documentation.markdown",{defaultMessage:"\nCalculates the minimum of a metric for all data points of a series in the current chart. A series is defined by a dimension using a date histogram or interval function.\nOther dimensions breaking down the data like top values or filter are treated as separate series.\n\nIf no date histograms or interval functions are used in the current chart, `overall_min` is calculating the minimum over all dimensions no matter the used function\n\nExample: Percentage of range\n`(sum(bytes) - overall_min(sum(bytes)) / (overall_max(sum(bytes)) - overall_min(sum(bytes)))`\n      "})}),Ql=Kl({type:"overall_max",displayName:_.i18n.translate("xpack.lens.indexPattern.overallMax",{defaultMessage:"Overall max"}),ofName:e=>_.i18n.translate("xpack.lens.indexPattern.overallMaxOf",{defaultMessage:"Overall max of {name}",values:{name:null!=e?e:_.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}),metric:"max",description:_.i18n.translate("xpack.lens.indexPattern.overall_max.documentation.markdown",{defaultMessage:"\nCalculates the maximum of a metric for all data points of a series in the current chart. A series is defined by a dimension using a date histogram or interval function.\nOther dimensions breaking down the data like top values or filter are treated as separate series.\n\nIf no date histograms or interval functions are used in the current chart, `overall_max` is calculating the maximum over all dimensions no matter the used function\n\nExample: Percentage of range\n`(sum(bytes) - overall_min(sum(bytes))) / (overall_max(sum(bytes)) - overall_min(sum(bytes)))`\n      "})}),Zl=Kl({type:"overall_average",displayName:_.i18n.translate("xpack.lens.indexPattern.overallMax",{defaultMessage:"Overall max"}),ofName:e=>_.i18n.translate("xpack.lens.indexPattern.overallAverageOf",{defaultMessage:"Overall average of {name}",values:{name:null!=e?e:_.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}),metric:"average",description:_.i18n.translate("xpack.lens.indexPattern.overall_average.documentation.markdown",{defaultMessage:"\nCalculates the average of a metric for all data points of a series in the current chart. A series is defined by a dimension using a date histogram or interval function.\nOther dimensions breaking down the data like top values or filter are treated as separate series.\n\nIf no date histograms or interval functions are used in the current chart, `overall_average` is calculating the average over all dimensions no matter the used function\n\nExample: Divergence from the mean:\n`sum(bytes) - overall_average(sum(bytes))`\n      "})}),Jl=_.i18n.translate("xpack.lens.indexPattern.countOf",{defaultMessage:"Count of records"}),eo={type:"count",priority:2,displayName:_.i18n.translate("xpack.lens.indexPattern.count",{defaultMessage:"Count"}),input:"field",getErrorMessage:(e,t,n)=>fi(e.columns[t],n),onFieldChange:(e,t)=>({...e,label:tl(t.displayName,void 0,e.timeScale,void 0,e.timeShift),sourceField:t.name}),getPossibleOperationForField:e=>{if("document"===e.type)return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:e=>tl(Jl,void 0,e.timeScale,void 0,e.timeShift),buildColumn:({field:e,previousColumn:t},n)=>({label:tl(Jl,void 0,null==t?void 0:t.timeScale,void 0,null==t?void 0:t.timeShift),dataType:"number",operationType:"count",isBucketed:!1,scale:"ratio",sourceField:e.name,timeScale:null==t?void 0:t.timeScale,filter:ji(t,n),timeShift:(null==n?void 0:n.shift)||(null==t?void 0:t.timeShift),params:"number"===(null==t?void 0:t.dataType)&&vi(t)&&t.params?{format:t.params.format}:void 0}),onOtherColumnChanged:(e,t,n)=>nl(e,t),toEsAggsFn:(e,t)=>Object(ia.buildExpressionFunction)("aggCount",{id:t,enabled:!0,schema:"metric",timeShift:e.filter?void 0:e.timeShift}).toAst(),isTransferable:()=>!0,timeScalingMode:"optional",filterable:!0,documentation:{section:"elasticsearch",signature:"",description:_.i18n.translate("xpack.lens.indexPattern.count.documentation.markdown",{defaultMessage:"\nCalculates the number of documents.\n\nExample: Calculate the number of documents:\n`count()`\n\nExample: Calculate the number of documents matching a certain filter:\n`count(kql='price > 500')`\n      "})},shiftable:!0},to=_.i18n.translate("xpack.lens.indexPattern.staticValueLabelDefault",{defaultMessage:"Static value"});function no(e){return function(e){return null==e||""===e}(e)?to:_.i18n.translate("xpack.lens.indexPattern.staticValueLabelWithValue",{defaultMessage:"Static value: {value}",values:{value:e}})}const ao={type:"static_value",displayName:to,getDefaultLabel:e=>no(e.params.value),input:"managedReference",hidden:!0,getDisabledStatus(e){},getErrorMessage(e,t){const n=e.columns[t];return null==n.params.value||xi(n.params.value)?void 0:[_.i18n.translate("xpack.lens.indexPattern.staticValueError",{defaultMessage:"The static value of {value} is not a valid number",values:{value:n.params.value}})]},getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio"}),toExpression:(e,t)=>{var n;const a=e.columns[t],i=a.params,r=a.label!==to,s=xi(i.value)?r?a.label:null!==(n=null==i?void 0:i.value)&&void 0!==n?n:to:to;return[{type:"function",function:xi(i.value)?"mathColumn":"mapColumn",arguments:{id:[t],name:[s||to],expression:[String(xi(i.value)?i.value:100)]}}]},buildColumn({previousColumn:e,layer:t,indexPattern:n},a,i){var r;var s;const l={value:e&&(s=e,Boolean("params"in s&&s.params&&"value"in s.params))&&xi(e.params.value)?e.params.value:void 0,...yi(e),...a};return{label:no(l.value),dataType:"number",operationType:"static_value",isBucketed:!1,scale:"ratio",params:{...l,value:String(null!==(r=l.value)&&void 0!==r?r:100)},references:[]}},isTransferable:e=>!0,createCopy(e,t,n,a,i){const r=e.columns[t];return{...e,columns:{...e.columns,[n]:{...r}}}},paramEditor:function({layer:e,updateLayer:t,currentColumn:n,columnId:a,activeData:i,layerId:r,indexPattern:s}){var l,o,u,c;const d=Object(h.useCallback)((e=>{n.params.value!==e&&t((t=>{const n=t.columns[a];return{...t,columns:{...t.columns,[a]:{...n,label:null!=n&&n.customLabel?n.label:no(e),params:{...n.params,value:e}}}}}))}),[a,t,null==n||null===(l=n.params)||void 0===l?void 0:l.value]),p=1===(null==i||null===(o=i[r])||void 0===o||null===(u=o.rows)||void 0===u?void 0:u.length)&&i[r].rows[0][a],m="static_value"!==(null==n?void 0:n.operationType)&&null!=p?p:String(100),{inputValue:g,handleInputChange:f}=Object(M.q)({value:(null==n||null===(c=n.params)||void 0===c?void 0:c.value)||m,onChange:d},{allowFalsyValue:!0}),b=Object(h.useCallback)((e=>{const t=e.currentTarget.value;f(xi(t)?t:void 0)}),[f]);return Object(E.jsx)("div",{className:"lnsIndexPatternDimensionEditor__section lnsIndexPatternDimensionEditor__section--padded lnsIndexPatternDimensionEditor__section--shaded"},Object(E.jsx)(F.EuiFormLabel,null,_.i18n.translate("xpack.lens.indexPattern.staticValue.label",{defaultMessage:"Reference line value"})),Object(E.jsx)(F.EuiSpacer,{size:"s"}),Object(E.jsx)(F.EuiFieldNumber,{"data-test-subj":"lns-indexPattern-static_value-input",compressed:!0,value:null!=g?g:"",onChange:b}))}};function io(e,t){return tl(_.i18n.translate("xpack.lens.indexPattern.lastValueOf",{defaultMessage:"Last value of {name}",values:{name:e}}),void 0,void 0,void 0,t)}const ro=new Set(["string","boolean","number","ip"]);function so(e,t){if(!t)return;const n=t.getFieldByName(e);return n?"date"!==n.type?_.i18n.translate("xpack.lens.indexPattern.lastValue.invalidTypeSortField",{defaultMessage:"Field {invalidField} is not a date field and cannot be used for sorting",values:{invalidField:e}}):void 0:_.i18n.translate("xpack.lens.indexPattern.lastValue.sortFieldNotFound",{defaultMessage:"Field {invalidField} was not found",values:{invalidField:e}})}function lo(e){return e.timeFieldName&&e.fields.find((t=>t.name===e.timeFieldName&&"date"===t.type))}function oo(e){const t=e.fields.filter((e=>"date"===e.type));return lo(e)&&t.sort((({name:t},{name:n})=>t===e.timeFieldName?-1:n===e.timeFieldName?1:0)),t}const uo={type:"last_value",displayName:_.i18n.translate("xpack.lens.indexPattern.lastValue",{defaultMessage:"Last value"}),getDefaultLabel:(e,t)=>io(bi(e.sourceField,t),e.timeShift),input:"field",onFieldChange:(e,t)=>{const n={...e.params};return"format"in n&&"number"!==t.type&&delete n.format,{...e,dataType:t.type,label:io(t.displayName,e.timeShift),sourceField:t.name,params:n,scale:"string"===t.type?"ordinal":"ratio"}},getPossibleOperationForField:({aggregationRestrictions:e,type:t})=>{if(ro.has(t)&&!e)return{dataType:t,isBucketed:!1,scale:"string"===t?"ordinal":"ratio"}},getDisabledStatus(e){if(!(e&&oo(e).length))return _.i18n.translate("xpack.lens.indexPattern.lastValue.disabled",{defaultMessage:"This function requires the presence of a date field in your index"})},getErrorMessage(e,t,n){const a=e.columns[t];let i=[];const r=fi(a,n),s=so(a.params.sortField,n);return r&&(i=[...r]),s&&(i=[s]),i.length?i:void 0},buildColumn({field:e,previousColumn:t,indexPattern:n},a){var i;const r=lo(n)?n.timeFieldName:null===(i=n.fields.find((e=>"date"===e.type)))||void 0===i?void 0:i.name;if(!r)throw new Error(_.i18n.translate("xpack.lens.functions.lastValue.missingSortField",{defaultMessage:"This index pattern does not contain any date fields"}));return{label:io(e.displayName,null==t?void 0:t.timeShift),dataType:e.type,operationType:"last_value",isBucketed:!1,scale:"string"===e.type?"ordinal":"ratio",sourceField:e.name,filter:ji(t,a),timeShift:(null==a?void 0:a.shift)||(null==t?void 0:t.timeShift),params:{sortField:r,...yi(t)}}},filterable:!0,shiftable:!0,toEsAggsFn:(e,t)=>Object(ia.buildExpressionFunction)("aggTopHit",{id:t,enabled:!0,schema:"metric",field:e.sourceField,aggregate:"concat",size:1,sortOrder:"desc",sortField:e.params.sortField,timeShift:e.filter?void 0:e.timeShift}).toAst(),isTransferable:(e,t)=>{const n=t.getFieldByName(e.sourceField),a=t.getFieldByName(e.params.sortField);return Boolean(n&&n.type===e.dataType&&!n.aggregationRestrictions&&"date"===(null==a?void 0:a.type)&&ro.has(n.type))},paramEditor:({layer:e,updateLayer:t,columnId:n,currentColumn:a,indexPattern:i})=>{var r,s;const l=oo(i),o=!!so(a.params.sortField,i);return Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiFormRow,{label:_.i18n.translate("xpack.lens.indexPattern.lastValue.sortField",{defaultMessage:"Sort by date field"}),display:"columnCompressed",fullWidth:!0,error:_.i18n.translate("xpack.lens.indexPattern.sortField.invalid",{defaultMessage:"Invalid field. Check your index pattern or pick another field."}),isInvalid:o},Object(E.jsx)(F.EuiComboBox,{placeholder:_.i18n.translate("xpack.lens.indexPattern.lastValue.sortFieldPlaceholder",{defaultMessage:"Sort field"}),compressed:!0,isClearable:!1,"data-test-subj":"lns-indexPattern-lastValue-sortField",isInvalid:o,singleSelection:{asPlainText:!0},"aria-label":_.i18n.translate("xpack.lens.indexPattern.lastValue.sortField",{defaultMessage:"Sort by date field"}),options:null==l?void 0:l.map((e=>({value:e.name,label:e.displayName}))),onChange:a=>{0!==a.length&&t(Bi({layer:e,columnId:n,paramName:"sortField",value:a[0].value}))},selectedOptions:null!==(r=a.params)&&void 0!==r&&r.sortField?[{label:(null===(s=i.getFieldByName(a.params.sortField))||void 0===s?void 0:s.displayName)||a.params.sortField,value:a.params.sortField}]:[]})))},documentation:{section:"elasticsearch",signature:_.i18n.translate("xpack.lens.indexPattern.lastValue.signature",{defaultMessage:"field: string"}),description:_.i18n.translate("xpack.lens.indexPattern.lastValue.documentation.markdown",{defaultMessage:"\nReturns the value of a field from the last document, ordered by the default time field of the index pattern.\n\nThis function is usefull the retrieve the latest state of an entity.\n\nExample: Get the current status of server A:\n`last_value(server.status, kql='server.name=\"A\"')`\n      "})}};n(347);const co="auto",po="range",mo="histogram",go=Object(F.htmlIdGenerator)(),fo=({range:e,setRange:t,Button:n,initiallyOpen:a})=>{const[i,r]=Object(h.useState)(!1),[s,l]=Object(h.useState)(e);Object(h.useEffect)((()=>{r(a)}),[]);const o=(n,a=!1)=>{a&&l(e),t(n)},{from:u,to:c,label:d}=s,p=_.i18n.translate("xpack.lens.indexPattern.ranges.lessThanOrEqualAppend",{defaultMessage:"≤"}),m=_.i18n.translate("xpack.lens.indexPattern.ranges.lessThanOrEqualTooltip",{defaultMessage:"Less than or equal to"}),g=_.i18n.translate("xpack.lens.indexPattern.ranges.lessThanPrepend",{defaultMessage:"<"}),f=_.i18n.translate("xpack.lens.indexPattern.ranges.lessThanTooltip",{defaultMessage:"Less than"}),b=()=>{i&&r(!1)};return Object(E.jsx)(F.EuiPopover,{display:"block",ownFocus:!0,isOpen:i,closePopover:b,button:Object(E.jsx)(n,{onClick:()=>{r((e=>!e))}}),"data-test-subj":"indexPattern-ranges-popover"},Object(E.jsx)(F.EuiFormRow,null,Object(E.jsx)(F.EuiFlexGroup,{gutterSize:"s",responsive:!1,alignItems:"center"},Object(E.jsx)(F.EuiFlexItem,null,Object(E.jsx)(F.EuiFieldNumber,{className:"lnsRangesOperation__popoverNumberField",value:xi(u)?Number(u):"",onChange:({target:e})=>{const t={...s,from:""!==e.value?Number(e.value):-1/0};l(t),o(t)},append:Object(E.jsx)(F.EuiToolTip,{content:m},Object(E.jsx)(F.EuiText,{size:"s"},p)),compressed:!0,placeholder:"−∞",isInvalid:!_o(s)})),Object(E.jsx)(F.EuiFlexItem,{grow:!1},Object(E.jsx)(F.EuiIcon,{type:"sortRight",color:"subdued"})),Object(E.jsx)(F.EuiFlexItem,null,Object(E.jsx)(F.EuiFieldNumber,{className:"lnsRangesOperation__popoverNumberField",value:xi(c)?Number(c):"",onChange:({target:e})=>{const t={...s,to:""!==e.value?Number(e.value):1/0};l(t),o(t)},prepend:Object(E.jsx)(F.EuiToolTip,{content:f},Object(E.jsx)(F.EuiText,{size:"s"},g)),compressed:!0,placeholder:"+∞",isInvalid:!_o(s),onKeyDown:({key:e})=>{F.keys.ENTER===e&&b&&b()}})))),Object(E.jsx)(F.EuiFormRow,null,Object(E.jsx)(ws,{value:d||"",onChange:e=>{const t={...s,label:e};l(t),o(t)},placeholder:_.i18n.translate("xpack.lens.indexPattern.ranges.customRangeLabelPlaceholder",{defaultMessage:"Custom label"}),onSubmit:b,compressed:!0,dataTestSubj:"indexPattern-ranges-label"})))},bo=({ranges:e,setRanges:t,onToggleEditor:n,formatter:a})=>{const[i,r]=Object(h.useState)((()=>e.map((e=>({...e,id:go()}))))),[s,l]=Object(h.useState)(!1),o=i.length-1;Object(M.p)((()=>{t(i.map((({id:e,...t})=>({...t}))))}),{skipFirstRender:!0},256,[i]);return Object(E.jsx)(F.EuiFormRow,{label:_.i18n.translate("xpack.lens.indexPattern.ranges.customRanges",{defaultMessage:"Ranges"}),labelAppend:Object(E.jsx)(F.EuiText,{size:"xs"},Object(E.jsx)(F.EuiLink,{color:"danger",onClick:n},Object(E.jsx)(F.EuiIcon,{size:"s",type:"cross",color:"danger"})," ",_.i18n.translate("xpack.lens.indexPattern.ranges.customRangesRemoval",{defaultMessage:"Remove custom ranges"})))},Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(Ms,{onDragEnd:r,onDragStart:()=>{},droppableId:"RANGES_DROPPABLE_AREA",items:i},i.map(((e,t)=>Object(E.jsx)(Cs,{key:e.id,idx:t,id:e.id,isInvalid:!_o(e),invalidMessage:_.i18n.translate("xpack.lens.indexPattern.range.isInvalid",{defaultMessage:"This range is invalid"}),onRemoveClick:()=>{const e=i.filter(((e,n)=>n!==t));r(e)},removeTitle:_.i18n.translate("xpack.lens.indexPattern.ranges.deleteRange",{defaultMessage:"Delete range"}),isNotRemovable:1===i.length},Object(E.jsx)(fo,{range:e,initiallyOpen:t===o&&s,setRange:e=>{const n=[...i];e.id===n[t].id?n[t]=e:n.push(e),r(n)},Button:({onClick:t})=>Object(E.jsx)(F.EuiLink,{color:"text",onClick:t,className:"lnsRangesOperation__popoverButton","data-test-subj":"indexPattern-ranges-popover-trigger"},Object(E.jsx)(F.EuiText,{size:"s",textAlign:"left",color:_o(e)?"default":"danger"},((e,t)=>e.label||t.convert({gte:xi(e.from)?e.from:-1/0,lt:xi(e.to)?e.to:1/0}))(e,a)))}))))),Object(E.jsx)(Ts,{onClick:()=>{r([...i,{id:go(),from:i[i.length-1].to,to:1/0,label:""}]),l(!0)},label:_.i18n.translate("xpack.lens.indexPattern.ranges.addRange",{defaultMessage:"Add range"})})))},xo=()=>{const[e,t]=Object(h.useState)(!1);return Object(E.jsx)(yl,{anchorPosition:"upCenter",button:Object(E.jsx)(vl,{onClick:()=>{t(!e)}},_.i18n.translate("xpack.lens.indexPattern.ranges.granularityHelpText",{defaultMessage:"How it works"})),closePopover:()=>t(!1),isOpen:e,title:_.i18n.translate("xpack.lens.indexPattern.ranges.granularityPopoverTitle",{defaultMessage:"How granularity interval works"})},Object(E.jsx)("p",null,_.i18n.translate("xpack.lens.indexPattern.ranges.granularityPopoverBasicExplanation",{defaultMessage:"Interval granularity divides the field into evenly spaced intervals based on the minimum and maximum values for the field."})),Object(E.jsx)("p",null,Object(E.jsx)(O.FormattedMessage,{id:"xpack.lens.indexPattern.ranges.granularityPopoverExplanation",defaultMessage:'The size of the interval is a "nice" value. When the granularity of the slider changes, the interval stays the same when the “nice” interval is the same. The minimum granularity is 1, and the maximum value is {setting}. To change the maximum granularity, go to Advanced settings.',values:{setting:Object(E.jsx)(F.EuiCode,null,De.UI_SETTINGS.HISTOGRAM_MAX_BARS)}})),Object(E.jsx)("p",null,_.i18n.translate("xpack.lens.indexPattern.ranges.granularityPopoverAdvancedExplanation",{defaultMessage:"Intervals are incremented by 10, 5 or 2. For example, an interval can be 100 or 0.2 ."})))},ho=({maxBars:e,step:t,maxHistogramBars:n,onToggleEditor:a,onMaxBarsChange:i})=>{const[r,s]=Object(h.useState)(String(e));Object(M.p)((()=>{i(Number(r))}),{skipFirstRender:!0},256,[r]);const l=_.i18n.translate("xpack.lens.indexPattern.ranges.granularity",{defaultMessage:"Intervals granularity"}),o=_.i18n.translate("xpack.lens.indexPattern.ranges.decreaseButtonLabel",{defaultMessage:"Decrease granularity"}),u=_.i18n.translate("xpack.lens.indexPattern.ranges.increaseButtonLabel",{defaultMessage:"Increase granularity"});return Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiFormRow,{label:l,"data-test-subj":"indexPattern-ranges-section-label",labelType:"legend",fullWidth:!0,display:"rowCompressed",labelAppend:Object(E.jsx)(xo,null)},Object(E.jsx)(F.EuiFlexGroup,{alignItems:"center",gutterSize:"xs",responsive:!1},Object(E.jsx)(F.EuiFlexItem,{grow:!1},Object(E.jsx)(F.EuiToolTip,{content:o,delay:"long"},Object(E.jsx)(F.EuiButtonIcon,{iconType:"minusInCircle",color:"text","data-test-subj":"lns-indexPattern-range-maxBars-minus",onClick:()=>s(""+Math.max(Number(r)-t,1)),"aria-label":o}))),Object(E.jsx)(F.EuiFlexItem,null,Object(E.jsx)(F.EuiRange,{compressed:!0,fullWidth:!0,"aria-label":l,"data-test-subj":"lns-indexPattern-range-maxBars-field",min:1,max:n,step:t,value:r,onChange:({currentTarget:e})=>s(e.value)})),Object(E.jsx)(F.EuiFlexItem,{grow:!1},Object(E.jsx)(F.EuiToolTip,{content:u,delay:"long"},Object(E.jsx)(F.EuiButtonIcon,{iconType:"plusInCircle",color:"text","data-test-subj":"lns-indexPattern-range-maxBars-plus",onClick:()=>s(""+Math.min(Number(r)+t,n)),"aria-label":u}))))),Object(E.jsx)(F.EuiButtonEmpty,{size:"xs",iconType:"controlsHorizontal",onClick:()=>a()},_.i18n.translate("xpack.lens.indexPattern.ranges.customIntervalsToggle",{defaultMessage:"Create custom ranges"})))},vo=({setParam:e,params:t,maxHistogramBars:n,maxBars:a,granularityStep:i,onChangeMode:r,rangeFormatter:s})=>{const[l,o]=Object(h.useState)(t.type===po);return l?Object(E.jsx)(bo,{ranges:t.ranges,setRanges:t=>{e("ranges",t)},onToggleEditor:()=>{r(mo),o(!1)},formatter:s}):Object(E.jsx)(ho,{maxBars:a,step:i,maxHistogramBars:n,onMaxBarsChange:t=>{e("maxBars",t)},onToggleEditor:()=>{r(po),o(!0)}})};var yo=n(101);const jo=e=>xi(e.from)&&xi(e.to),_o=e=>!jo(e)||(e=>e.from<=e.to)(e);function Oo(e,t){if(t&&e.fieldFormatMap&&e.fieldFormatMap[t.name])return e.fieldFormatMap[t.name]}const ko=[Vs,Ys,Il,gl,fl,bl,ll,xl,hl,cl,uo,eo,{type:"range",displayName:_.i18n.translate("xpack.lens.indexPattern.intervals",{defaultMessage:"Intervals"}),priority:4,input:"field",getErrorMessage:(e,t,n)=>fi(e.columns[t],n),getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:n})=>{if("number"===n&&t&&(!e||e.range))return{dataType:"number",isBucketed:!0,scale:"interval"}},getDefaultLabel:(e,t)=>{var n,a;return null!==(n=null===(a=t.getFieldByName(e.sourceField))||void 0===a?void 0:a.displayName)&&void 0!==n?n:_.i18n.translate("xpack.lens.indexPattern.missingFieldLabel",{defaultMessage:"Missing field"})},buildColumn:({field:e})=>({label:e.displayName,dataType:"number",operationType:"range",sourceField:e.name,isBucketed:!0,scale:"interval",params:{type:mo,ranges:[{from:0,to:1e3,label:""}],maxBars:co,format:void 0,parentFormat:void 0}}),isTransferable:(e,t)=>{const n=t.getFieldByName(e.sourceField);return Boolean(n&&"number"===n.type&&n.aggregatable&&(!n.aggregationRestrictions||n.aggregationRestrictions.range))},onFieldChange:(e,t)=>({...e,label:t.name,sourceField:t.name}),toEsAggsFn:(e,t,n,a,i)=>{const{sourceField:r,params:s}=e;if(s.type===po)return Object(ia.buildExpressionFunction)("aggRange",{id:t,enabled:!0,schema:"segment",field:r,ranges:s.ranges.filter(_o).map((e=>{if(jo(e))return e;const t={label:e.label};return xi(e.from)&&(t.from=Number(e.from)),xi(e.to)&&(t.to=Number(e.to)),t})).map(fa.numericalRangeToAst)}).toAst();const l=(i.get(De.UI_SETTINGS.HISTOGRAM_MAX_BARS)-1)/2;return Object(ia.buildExpressionFunction)("aggHistogram",{id:t,enabled:!0,schema:"segment",field:r,maxBars:s.maxBars===co?l:s.maxBars,interval:"auto",has_extended_bounds:!1,min_doc_count:!1,extended_bounds:Object(fa.extendedBoundsToAst)({})}).toAst()},paramEditor:({layer:e,columnId:t,currentColumn:n,updateLayer:a,indexPattern:i,uiSettings:r,data:s})=>{var l,o;const u=i.getFieldByName(n.sourceField),c=n.params.format,d=c&&yo.a[c.id]&&yo.a[c.id].decimalsToPattern((null===(l=c.params)||void 0===l?void 0:l.decimals)||0),p=s.fieldFormats.deserialize({...n.params.parentFormat||{id:"range"},params:{...null===(o=n.params.parentFormat)||void 0===o?void 0:o.params,...c?{id:c.id,params:{pattern:d}}:Oo(i,u)}}),m=r.get(De.UI_SETTINGS.HISTOGRAM_MAX_BARS),g=(m-1)/6,f=(m-1)/2;return Object(E.jsx)(vo,{setParam:(n,i)=>{a(Bi({layer:e,columnId:t,paramName:n,value:i}))},maxBars:n.params.maxBars===co?f:n.params.maxBars,granularityStep:g,params:n.params,onChangeMode:i=>{const r=i===po?"ordinal":"interval",s=i===po?"string":"number",l=i===po?{id:"range",params:{template:"arrow_right",replaceInfinity:!0}}:void 0;a({...e,columns:{...e.columns,[t]:{...n,scale:r,dataType:s,params:{type:i,ranges:[{from:0,to:1e3,label:""}],maxBars:f,format:n.params.format,parentFormat:l}}}})},maxHistogramBars:r.get(De.UI_SETTINGS.HISTOGRAM_MAX_BARS),rangeFormatter:p})}},Rl,zl,Gl,$l,si,Ii,Ul,Xl,Ql,Zl,ao],Io=ko,Fo=ko.reduce(((e,t)=>({...e,[t.type]:t})),{}),wo={avg:"average",cardinality:"unique_count"};function To(){const e={};return Io.forEach((({type:t,displayName:n})=>{e[t]={type:t,displayName:n}})),e}function Eo(e,t){return(t.priority||Number.NEGATIVE_INFINITY)-(e.priority||Number.NEGATIVE_INFINITY)}function Co(e,t){return Io.filter((n=>{if("field"!==n.input)return!1;const a=n.getPossibleOperationForField(e);return t?a&&t(a):a})).sort(Eo).map((({type:e})=>e))}const Mo=Object(Z.memoize)((function(e,t){const n={},a=(e,t)=>{if(!t)return;const a=JSON.stringify(t);n[a]?n[a].operations.push(e):n[a]={operationMetaData:t,operations:[e]}};return(t?Object.values(t):Io).sort(Eo).forEach((t=>{if("field"===t.input)e.fields.forEach((e=>{a({type:"field",operationType:t.type,field:e.name},t.getPossibleOperationForField(e))}));else if("none"===t.input)a({type:"none",operationType:t.type},t.getPossibleOperation());else if("fullReference"===t.input){const n=t.getPossibleOperation(e);n&&a({type:"fullReference",operationType:t.type},n)}else if("managedReference"===t.input){const e=t.getPossibleOperation();e&&a({type:"managedReference",operationType:t.type},e)}})),Object.values(n)})),Po="lens-settings";function So(e,t,n){return e[t]&&e[t][n]}function Ao(e){const t=Object(Z.keyBy)(e,"name");return e=>t[e]}async function Lo({indexPatternsService:e,patterns:t,notUsedPatterns:n,cache:a}){const i=t.filter((e=>!a[e]));if(0===i.length)return a;Mo.cache.clear&&Mo.cache.clear();let r=(await Promise.allSettled(i.map((t=>e.get(t))))).filter((e=>"fulfilled"===e.status)).map((e=>e.value));for(let t=0;n&&t<(null==n?void 0:n.length)&&!r.length;t++){const a=await e.get(n[t]).catch((e=>{}));a&&(r=[a])}return r.reduce(((e,t)=>{const n=t.fields.filter((e=>!(De.indexPatterns.isNestedField(e)||!e.aggregatable&&!e.scripted))).map((e=>{const n={name:e.name,displayName:e.displayName,type:e.type,aggregatable:e.aggregatable,searchable:e.searchable,meta:t.metaFields.includes(e.name),esTypes:e.esTypes,scripted:e.scripted,runtime:Boolean(e.runtimeField)};return n.scripted?{...n,lang:e.lang,script:e.script}:n})).concat(oi),{typeMeta:a,title:i,timeFieldName:r,fieldFormatMap:s}=t;if(null!=a&&a.aggs){const e=Object.keys(a.aggs);n.forEach(((t,i)=>{const r={};e.forEach((e=>{const n=a.aggs&&a.aggs[e]&&a.aggs[e][t.name];n&&(r[function(e){return e in wo?wo[e]:e}(e)]=n)})),Object.keys(r).length&&(n[i]={...t,aggregationRestrictions:r})}))}const l={id:t.id,title:i,timeFieldName:r,fieldFormatMap:s&&Object.fromEntries(Object.entries(s).map((([e,t])=>[e,"toJSON"in t?t.toJSON():t]))),fields:n,getFieldByName:Ao(n),hasRestrictions:!(null==a||!a.aggs)};return{[l.id]:l,...e}}),{...a})}const Do=(e,t)=>{var n;const a=((e,t)=>{const n=e.get(Po);return n&&n[t]})(e,"indexPatternId");return a&&(null===(n=t.find((e=>e.id===a)))||void 0===n?void 0:n.id)},No=(e,t)=>{((e,t,n)=>{e.set(Po,{[t]:n})})(e,"indexPatternId",t)},zo="indexpattern-datasource-current-indexpattern";function Bo(e){return`indexpattern-datasource-layer-${e}`}async function Ro({persistedState:e,references:t,defaultIndexPatternId:n,storage:a,indexPatternsService:i,initialContext:r,options:s}){var l;const{isFullEditor:o}=null!=s?s:{},u=await(o?async function(e){const t=await e.getIdsWithTitle();return t.sort(((e,t)=>e.title.localeCompare(t.title)))}(i):[]),c=Do(a,u)||n||(null===(l=u[0])||void 0===l?void 0:l.id),d=e&&t?function(e,t){const n={};return Object.entries(e.layers).forEach((([e,a])=>{n[e]={...a,indexPatternId:t.find((({name:t})=>t===Bo(e))).id}})),{currentIndexPatternId:t.find((({name:e})=>e===zo)).id,layers:n}}(e,t):void 0,p=(r?[r.indexPatternId]:Object(Z.uniq)(d?Object.values(d.layers).map((e=>e.indexPatternId)).concat(d.currentIndexPatternId):[c])).filter(Boolean),m=Object(Z.difference)(Object(Z.uniq)(u.map((({id:e})=>e))),p),g=new Set(u.map((({id:e})=>e))),f=await Lo({indexPatternsService:i,cache:{},patterns:p,notUsedPatterns:m}),b=[null==r?void 0:r.indexPatternId,...p,...m].filter((e=>null!=e&&g.has(e)&&f[e]))[0];return b&&No(a,b),{layers:{},...d,currentIndexPatternId:b,indexPatternRefs:u,indexPatterns:f,existingFields:{},isFirstExistenceFetch:!0}}function Vo(e){return e.reduce(((e,t)=>(e[t]=!0,e)),{})}function Ho(e){const t=Object.values(e);return 1===t.length&&0===t[0].columnOrder.length}function Go(e,t,n){const{columnOrder:a}=e;if(0===a.length||!t)return null;const i={...e.columns};Object.keys(i).forEach((e=>{const t=i[e],n=Fo[t.operationType];"references"in t&&n.filterable&&"fullReference"===n.input&&t.filter&&t.references.forEach((e=>{const n=i[e];Fo[t.operationType].filterable&&(i[e]={...n,filter:t.filter})})),"references"in t&&n.shiftable&&"fullReference"===n.input&&t.timeShift&&t.references.forEach((e=>{const n=i[e];Fo[t.operationType].shiftable&&(i[e]={...n,timeShift:t.timeShift})}))}));const r=a.map((e=>[e,i[e]])),[s,l]=Object(Z.partition)(r,(([,e])=>{var t,n;return"fullReference"===(null===(t=Fo[e.operationType])||void 0===t?void 0:t.input)||"managedReference"===(null===(n=Fo[e.operationType])||void 0===n?void 0:n.input)}));if(s.length||l.length){const a=[],o=[];(function(e){const t={};e.forEach((([e,n])=>{t[e]="references"in n?n.references:[]})),e.forEach((([e])=>{t[e]=t[e].filter((e=>!!t[e]))}));const n=[];for(;n.length<e.length;)Object.keys(t).forEach((e=>{0===t[e].length&&(n.push(e),delete t[e],Object.keys(t).forEach((n=>{t[n]=t[n].filter((t=>t!==e))})))}));return n})(s).forEach((n=>{const a=i[n],r=Fo[a.operationType];"fullReference"!==r.input&&"managedReference"!==r.input||o.push(...r.toExpression(e,n,t))}));const u=l.map((([e])=>e));l.forEach((([i,r],s)=>{const l=Fo[r.operationType];if("fullReference"!==l.input&&"managedReference"!==l.input){const i=Boolean(l.filterable&&r.filter);let o=l.toEsAggsFn(r,i?`${s}-metric`:String(s),t,e,n,u);i&&(o=Object(ia.buildExpressionFunction)("aggFilteredMetric",{id:String(s),enabled:!0,schema:"metric",customBucket:Object(ia.buildExpression)([Object(ia.buildExpressionFunction)("aggFilter",{id:`${s}-filter`,enabled:!0,schema:"bucket",filter:r.filter&&Object(fa.queryToAst)(r.filter)})]),customMetric:Object(ia.buildExpression)({type:"expression",chain:[o]}),timeShift:r.timeShift}).toAst()),a.push(Object(ia.buildExpression)({type:"expression",chain:[o]}))}}));const c=l.reduce(((e,[t,n],a)=>({...e,[`col-${a}-${a}`]:{...n,id:t}})),{}),d=r.filter((([,e])=>{var t,n;return hi("range",e)&&(null===(t=e.params)||void 0===t?void 0:t.parentFormat)||vi(e)&&(null===(n=e.params)||void 0===n?void 0:n.format)})).map((([e,t])=>{var n;const a="parentFormat"in t.params?t.params.parentFormat:void 0,i=t.params.format;return{type:"function",function:"lens_format_column",arguments:{format:i?[i.id]:[""],columnId:[e],decimals:"number"==typeof(null==i||null===(n=i.params)||void 0===n?void 0:n.decimals)?[i.params.decimals]:[],parentFormat:a?[JSON.stringify(a)]:[]}}})),p=r.find((([,e])=>"date_histogram"===e.operationType)),m=(p?r.filter((([,e])=>e.timeScale&&Fo[e.operationType].timeScalingMode&&"disabled"!==Fo[e.operationType].timeScalingMode)):[]).flatMap((([e,t])=>[{type:"function",function:"lens_time_scale",arguments:{dateColumnId:[p[0]],inputColumnId:[e],outputColumnId:[e],outputColumnName:[t.label],targetUnit:[t.timeScale]}},{type:"function",function:"lens_format_column",arguments:{format:[""],columnId:[e],parentFormat:[JSON.stringify({id:"suffix",params:{unit:t.timeScale}})]}}]));if(0===l.length)return{type:"expression",chain:[{type:"function",function:"createTable",arguments:{ids:[],names:[],rowCount:[1]}},...o,...d,...m]};const g=Object.values(i).map((e=>hi("date_histogram",e)?e.sourceField:null)).filter((e=>Boolean(e)));return{type:"expression",chain:[Object(ia.buildExpressionFunction)("esaggs",{index:Object(ia.buildExpression)([Object(ia.buildExpressionFunction)("indexPatternLoad",{id:t.id})]),aggs:a,metricsAtAllLevels:!1,partialRows:!1,timeFields:g}).toAst(),{type:"function",function:"lens_rename_columns",arguments:{idMap:[JSON.stringify(c)]}},...o,...d,...m]}}return null}function qo(e){return"histogram"===e||"document"===e?"number":e}function Wo(e){return"sourceField"in e}function $o(e){return"object"==typeof e&&null!==e&&["id","field","indexPatternId"].every((t=>t in e))}function Yo(e,t,n){var a;const i=e.columns[t];if(!i||!n)return;const r=i.operationType&&Fo[i.operationType],s="references"in i&&Boolean(function(e,t,n){var a;return null===(a=t.references)||void 0===a?void 0:a.map((t=>{var a,i;const r=null===(a=e.columns[t])||void 0===a?void 0:a.operationType,s=Fo[r];return null==s||null===(i=s.getErrorMessage)||void 0===i?void 0:i.call(s,e,t,n,Fo)}))}(e,i,n).filter(Boolean).length),l=r&&(null===(a=r.getErrorMessage)||void 0===a?void 0:a.call(r,e,t,n,Fo)),o=!!i.filter&&!Rs(i.filter,n);return l&&l.length>0||s||o}n(102);function Ko({state:e,layerId:t,newLayer:n}){return{...e,layers:{...e.layers,[t]:{...e.layers[t],...n}}}}n(364);var Uo=n(112),Xo=n.n(Uo);function Qo({type:e,...t}){return Object(E.jsx)(dn.FieldIcon,x()({className:"lnsFieldListPanel__fieldIcon",type:qo(e)},t))}const Zo=()=>document.createElement("canvas").getContext("2d"),Jo=Zo(),eu=(e,t)=>{const n=null!=Jo?Jo:Zo();n.font=t;return n.measureText(e).width},tu=v.a.memo((function({label:e,width:t,search:n,font:a}){const i=Object(h.useMemo)((()=>eu(e,a)),[e,a]);if(i<t)return Object(E.jsx)(F.EuiHighlight,{search:n},e);const r=e.indexOf(n),s=Math.round(t*e.length/i),l="…";let o,u=1;n&&-1!==r?0===r?o=(e,t)=>`${e.substr(0,t)}${l}`:s>e.length-r?o=(e,t)=>`${l}${e.substr(e.length-t)}`:(o=(e,t)=>`${l}${e.substr(r,t)}${l}`,u=2):o=(e,t)=>`${e.substr(0,8)}${l}${e.substr(e.length-(t-8))}`;const c=((e,t,n,a,i)=>{let r=i(n,a);for(;eu(r,t)>e;)r=i(n,a-=1);return r})(t,a,e,s,o);return n.length<c.length-u?Object(E.jsx)(F.EuiHighlight,{search:n},c):Object(E.jsx)(F.EuiMark,null,c)})),nu=305,au=90,iu="14px Inter";function ru({currentIndexPattern:e,incompleteOperation:t,selectedOperationType:n,selectedField:a,operationSupportMatrix:i,onChoose:r,onDeleteColumn:s,existingFields:l,fieldIsInvalid:o,markAllFieldsCompatible:u,...c}){var d;const{operationByField:p}=i,m=Object(h.useMemo)((()=>{const a=[...p.keys()].sort(),i=null!=t?t:n;function r(e){return!i||p.get(e).has(i)}const[s,o]=Object(Z.partition)(a,(t=>{var n;return"document"===(null===(n=e.getFieldByName(t))||void 0===n?void 0:n.type)})),c=t=>{var n;return"document"===(null===(n=e.getFieldByName(t))||void 0===n?void 0:n.type)||So(l,e.title,t)};function d(t){return t.filter((t=>{var n;return null===(n=e.getFieldByName(t))||void 0===n?void 0:n.displayName})).map((t=>{var n,a;return{label:null===(n=e.getFieldByName(t))||void 0===n?void 0:n.displayName,value:{type:"field",field:t,dataType:null===(a=e.getFieldByName(t))||void 0===a?void 0:a.type,operationType:i&&r(t)?i:p.get(t).values().next().value},exists:c(t),compatible:u||r(t)}})).sort(((e,t)=>e.compatible&&!t.compatible?-1:!e.compatible&&t.compatible?1:0)).map((({label:e,value:t,compatible:n,exists:a})=>({label:e,value:t,className:T()({"lnFieldSelect__option--incompatible":!n,"lnFieldSelect__option--nonExistant":!a}),"data-test-subj":`lns-fieldOption${n?"":"Incompatible"}-${t.field}`})))}const[m,g]=Object(Z.partition)(o,(t=>{var n;return null===(n=e.getFieldByName(t))||void 0===n?void 0:n.meta})),[f,b]=Object(Z.partition)(g,c),x=(e,t)=>e.length>0&&{label:t,options:d(e)},h=x(f,_.i18n.translate("xpack.lens.indexPattern.availableFieldsLabel",{defaultMessage:"Available fields"})),v=x(b,_.i18n.translate("xpack.lens.indexPattern.emptyFieldsLabel",{defaultMessage:"Empty fields"})),y=x(m,_.i18n.translate("xpack.lens.indexPattern.metaFieldsLabel",{defaultMessage:"Meta fields"}));return[...d(s),h,v,y].filter(Boolean)}),[t,n,e,p,l,u]),g=Object(h.useRef)(null),[f,b]=v.a.useState({width:nu-au,font:iu}),y=(e,t=!1)=>{if(g.current){var n;const e={...f,width:(null===(n=g.current)||void 0===n?void 0:n.clientWidth)-au};t&&(e.font=window.getComputedStyle(g.current).font),b(e)}};return Xo()((()=>{g.current&&y(0,!0),window.addEventListener("resize",y)})),Object(E.jsx)("div",{ref:g},Object(E.jsx)(F.EuiComboBox,x()({fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":"indexPattern-dimension-field",placeholder:_.i18n.translate("xpack.lens.indexPattern.fieldPlaceholder",{defaultMessage:"Field"}),options:m,isInvalid:Boolean(t||o),selectedOptions:n&&a?[{label:o?a:null===(d=e.getFieldByName(a))||void 0===d?void 0:d.displayName,value:{type:"field",field:a}}]:[],singleSelection:{asPlainText:!0},onChange:e=>{if(0===e.length)return void(null==s||s());const t=e[0].value;t.field!==a&&(Object(at.e)("indexpattern_dimension_field_changed"),r(t))},renderOption:(e,t)=>Object(E.jsx)(F.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(E.jsx)(F.EuiFlexItem,{grow:null},Object(E.jsx)(Qo,{type:e.value.dataType,fill:"none"})),Object(E.jsx)(F.EuiFlexItem,null,Object(E.jsx)(tu,x()({},f,{label:e.label,search:t}))))},c)))}function su(e,t,n){const a=e.filter((e=>e!==n)),i=a.indexOf(t);return a.splice(i+1,0,n),a}function lu(e,t){var n;return Wo(e)?(null===(n=t(e.sourceField))||void 0===n?void 0:n.displayName)||e.sourceField:""}function ou({columnId:e,layer:t,setColumns:n,getFieldByName:a}){const i=t.columns[e],r=Object.entries(t.columns).filter((([t,n])=>t!==e&&n.isBucketed)).map((([e,t])=>({value:e,text:t.label,fieldName:lu(t,a),operationType:t.operationType})));if(!i||!i.isBucketed||!r.length)return null;const s=t.columnOrder[t.columnOrder.indexOf(e)-1];if(1===r.length){const[a]=r,i=_.i18n.translate("xpack.lens.indexPattern.useAsTopLevelAgg",{defaultMessage:"Group by this field first"});return Object(E.jsx)(F.EuiFormRow,{label:i,display:"columnCompressedSwitch"},Object(E.jsx)(F.EuiSwitch,{compressed:!0,label:i,showLabel:!1,"data-test-subj":"indexPattern-nesting-switch",name:"nestingSwitch",checked:!s,onChange:()=>{n(s?su(t.columnOrder,e,a.value):su(t.columnOrder,a.value,e))}}))}return Object(E.jsx)(F.EuiFormRow,{label:_.i18n.translate("xpack.lens.indexPattern.groupByDropdown",{defaultMessage:"Group by"}),display:"columnCompressed",fullWidth:!0},Object(E.jsx)(F.EuiSelect,{compressed:!0,"data-test-subj":"indexPattern-nesting-select",options:[{value:"",text:_.i18n.translate("xpack.lens.xyChart.nestUnderRoot",{defaultMessage:"Entire data set"})},...r.map((({value:e,text:t})=>({value:e,text:t})))],value:s,onChange:a=>n(su(t.columnOrder,a.target.value,e))}))}const uu={number:{title:_.i18n.translate("xpack.lens.indexPattern.numberFormatLabel",{defaultMessage:"Number"})},percent:{title:_.i18n.translate("xpack.lens.indexPattern.percentFormatLabel",{defaultMessage:"Percent"})},bytes:{title:_.i18n.translate("xpack.lens.indexPattern.bytesFormatLabel",{defaultMessage:"Bytes (1024)"})}},cu={value:"",label:_.i18n.translate("xpack.lens.indexPattern.defaultFormatLabel",{defaultMessage:"Default"})},du={asPlainText:!0};function pu(e){var t;const{selectedColumn:n,onChange:a}=e,i="params"in n&&n.params&&"format"in n.params?n.params.format:void 0,[r,s]=Object(h.useState)({decimalPlaces:"number"==typeof(null==i||null===(t=i.params)||void 0===t?void 0:t.decimals)?i.params.decimals:2}),l=null!=i&&i.id?uu[i.id]:void 0,o=_.i18n.translate("xpack.lens.indexPattern.columnFormatLabel",{defaultMessage:"Value format"}),u=_.i18n.translate("xpack.lens.indexPattern.decimalPlacesLabel",{defaultMessage:"Decimals"}),c=Object(h.useMemo)((()=>[cu,...Object.entries(uu).map((([e,t])=>{var n;return{value:e,label:null!==(n=t.title)&&void 0!==n?n:e}}))]),[]),d=Object(h.useCallback)((e=>{0!==e.length&&(e[0].value?a({id:e[0].value,params:{decimals:r.decimalPlaces}}):a())}),[a,r.decimalPlaces]),p=Object(h.useMemo)((()=>{var e;return i?[{value:i.id,label:null!==(e=null==l?void 0:l.title)&&void 0!==e?e:i.id}]:[cu]}),[i,null==l?void 0:l.title]);return Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiFormRow,{label:o,display:"columnCompressed",fullWidth:!0},Object(E.jsx)("div",null,Object(E.jsx)(F.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":"indexPattern-dimension-format","aria-label":o,singleSelection:du,options:c,selectedOptions:p,onChange:d}),i?Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiSpacer,{size:"xs"}),Object(E.jsx)(F.EuiRange,{showInput:"inputWithPopover",min:0,max:20,value:r.decimalPlaces,onChange:e=>{s({decimalPlaces:Number(e.currentTarget.value)}),a({id:i.id,params:{decimals:Number(e.currentTarget.value)}})},"data-test-subj":"indexPattern-dimension-formatDecimals",compressed:!0,fullWidth:!0,prepend:u,"aria-label":u})):null)))}const mu=To();function gu(e){var t;const{layer:n,layerId:a,activeData:i,columnId:r,updateLayer:s,currentIndexPattern:l,existingFields:o,validation:u,selectionStyle:c,dateRange:d,labelAppend:p,dimensionGroups:m,isFullscreen:g,toggleFullscreen:f,setIsCloseable:b,...y}=e,j=n.columns[r],O=j&&Fo[j.operationType],k=null==O?void 0:O.paramEditor,I=n.incompleteColumns?n.incompleteColumns[r]:void 0,w=null==I?void 0:I.operationType,T=null!==(t=null==I?void 0:I.sourceField)&&void 0!==t?t:null,C=Object(h.useMemo)((()=>{const e=new Set,t=new Set,n=new Map,a=new Map;return Object.values(Fo).filter((({hidden:e})=>!e)).sort(((e,t)=>e.displayName.localeCompare(t.displayName))).forEach((i=>{if("field"===i.input){const t=l.fields.filter((e=>Ui({operationType:i.type,validation:u,field:e,indexPattern:l})));t.length&&(e.add(i.type),a.set(i.type,new Set(t.map((({name:e})=>e)))),t.forEach((e=>{var t;const a=null!==(t=n.get(e.name))&&void 0!==t?t:new Set;a.add(i.type),n.set(e.name,a)})))}else Ui({operationType:i.type,validation:u,indexPattern:l})&&(e.add(i.type),t.add(i.type))})),{operationTypes:e,operationWithoutField:t,operationByField:n,fieldByOperation:a}}),[l,u]),M=Array.from(C.operationTypes).map((e=>{var t;const n=Fo[e];return{label:mu[e].displayName,value:e,className:"lnsIndexPatternDimensionEditor__operation","data-test-subj":`lns-indexPatternDimension-${e}${!j||j&&Wo(j)&&"field"===n.input&&(null===(t=C.fieldByOperation.get(e))||void 0===t?void 0:t.has(j.sourceField))||j&&!Wo(j)&&"field"!==n.input?"":" incompatible"}`}}));if("hidden"===c)return null;const P=w?[M.find((({value:e})=>e===w))]:j?[M.find((({value:e})=>e===j.operationType))]:[],S=!j&&!Boolean(w),A=Boolean(w)||"field"===c&&!j,L=!l.getFieldByName(null!=T?T:null==j?void 0:j.sourceField),D=Boolean(P.length&&null==P[0]);if(D){const e=w||j.operationType,t={label:mu[e].displayName,value:e,className:"lnsIndexPatternDimensionEditor__operation","data-test-subj":`lns-indexPatternDimension-${e} incompatible`};M.push(t),P[0]=t}return Object(E.jsx)("div",{id:r},Object(E.jsx)("div",null,"field"!==c?Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiFormRow,{"data-test-subj":"indexPattern-subFunction-selection-row",label:_.i18n.translate("xpack.lens.indexPattern.chooseSubFunction",{defaultMessage:"Choose a sub-function"}),fullWidth:!0,isInvalid:S||D},Object(E.jsx)(F.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":"indexPattern-reference-function",placeholder:_.i18n.translate("xpack.lens.indexPattern.referenceFunctionPlaceholder",{defaultMessage:"Sub-function"}),options:M,isInvalid:S||D,selectedOptions:P,singleSelection:{asPlainText:!0},onChange:e=>{0!==e.length?(Object(at.e)("indexpattern_dimension_field_changed"),function(e){if((null==j?void 0:j.operationType)===e)return;const t=C.fieldByOperation.get(e);if(j&&"sourceField"in j&&null!=t&&t.has(j.sourceField))s(Ti({layer:n,columnId:r,op:e,indexPattern:l,field:l.getFieldByName(j.sourceField),visualizationGroups:m}));else{const a=1===(null==t?void 0:t.size)?l.getFieldByName(t.values().next().value):void 0;s(Ti({layer:n,columnId:r,op:e,indexPattern:l,field:a,visualizationGroups:m}))}Object(at.e)(`indexpattern_dimension_operation_${e}`)}(e[0].value)):s(Vi({layer:n,columnId:r,indexPattern:l}))}})),Object(E.jsx)(F.EuiSpacer,{size:"s"})):null,j&&"field"!==O.input?null:Object(E.jsx)(F.EuiFormRow,{"data-test-subj":"indexPattern-reference-field-selection-row",label:_.i18n.translate("xpack.lens.indexPattern.chooseField",{defaultMessage:"Select a field"}),fullWidth:!0,isInvalid:A||L,labelAppend:p},Object(E.jsx)(ru,{fieldIsInvalid:A||L,currentIndexPattern:l,existingFields:o,operationSupportMatrix:C,selectedOperationType:j?j.operationType:w,selectedField:null!=T?T:null==j?void 0:j.sourceField,incompleteOperation:w,markAllFieldsCompatible:"field"===c,onDeleteColumn:()=>{s(Vi({layer:n,columnId:r,indexPattern:l}))},onChoose:e=>{s(Ti({layer:n,columnId:r,indexPattern:l,op:e.operationType,field:l.getFieldByName(e.field),visualizationGroups:m}))}})),j&&!I&&k&&Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(k,x()({updateLayer:s,currentColumn:j,layer:n,layerId:a,activeData:i,columnId:r,indexPattern:l,dateRange:d,operationDefinitionMap:Fo,isFullscreen:g,toggleFullscreen:f,setIsCloseable:b},y)))))}function fu(e,t,n){const a=t.columns[e],i=a.customLabel?a.label:tl(a.label,a.timeScale,n,a.timeShift,a.timeShift);return{...t,columns:{...t.columns,[e]:{...t.columns[e],label:i,timeScale:n}}}}function bu({selectedColumn:e,columnId:t,layer:n,updateLayer:a}){const i=n.columnOrder.some((e=>"date_histogram"===n.columns[e].operationType)),r=Fo[e.operationType];return r.timeScalingMode&&"disabled"!==r.timeScalingMode&&i&&e.timeScale?Object(E.jsx)(F.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:Object(E.jsx)(F.EuiToolTip,{content:_.i18n.translate("xpack.lens.indexPattern.timeScale.tooltip",{defaultMessage:"Normalize values to be always shown as rate per specified time unit, regardless of the underlying date interval."})},Object(E.jsx)("span",null,_.i18n.translate("xpack.lens.indexPattern.timeScale.label",{defaultMessage:"Normalize by unit"})," ",Object(E.jsx)(F.EuiIcon,{type:"questionInCircle",color:"subdued",size:"s",className:"eui-alignTop"})))},Object(E.jsx)(F.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(E.jsx)(F.EuiFlexItem,null,Object(E.jsx)(F.EuiSelect,{compressed:!0,options:Object.entries(Qs).map((([e,t])=>({value:e,text:t}))),"data-test-subj":"indexPattern-time-scaling-unit",value:e.timeScale,onChange:e=>{a(fu(t,n,e.target.value))}})),"optional"===r.timeScalingMode&&Object(E.jsx)(F.EuiFlexItem,{grow:!1},Object(E.jsx)(F.EuiButtonIcon,{"data-test-subj":"indexPattern-time-scaling-remove",color:"danger","aria-label":_.i18n.translate("xpack.lens.timeScale.removeLabel",{defaultMessage:"Remove normalizing by time unit"}),onClick:()=>{a(fu(t,n,void 0))},iconType:"cross"})))):null}const xu=_.i18n.translate("xpack.lens.indexPattern.filterBy.label",{defaultMessage:"Filter by"}),hu={query:"",language:"kuery"};function vu(e,t,n){return{...t,columns:{...t.columns,[e]:{...t.columns[e],filter:n}}}}function yu({selectedColumn:e,columnId:t,layer:n,updateLayer:a,indexPattern:i,isInitiallyOpen:r}){const s=e.filter,[l,o]=Object(h.useState)(null!=s?s:hu),[u,c]=Object(h.useState)(r);Object(h.useEffect)((()=>{const{isValid:e}=Bs(l,i);e&&!Object(Z.isEqual)(s,l)&&a(vu(t,n,l))}),[t,n,l,i,a,s]);const d=Object(h.useCallback)((()=>{c(!1),s&&o(s)}),[s]);if(!Fo[e.operationType].filterable||!s)return null;const{isValid:p}=Bs(s,i),{isValid:m,error:g}=Bs(l,i);return Object(E.jsx)(F.EuiFormRow,{display:"columnCompressed",label:xu,fullWidth:!0,isInvalid:!p},Object(E.jsx)(F.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(E.jsx)(F.EuiFlexItem,null,Object(E.jsx)(F.EuiPopover,{isOpen:u,closePopover:d,anchorClassName:"eui-fullWidth",panelClassName:"lnsIndexPatternDimensionEditor__filtersEditor",button:Object(E.jsx)(F.EuiPanel,{paddingSize:"none",hasShadow:!1,hasBorder:!0},Object(E.jsx)(F.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(E.jsx)(F.EuiFlexItem,{grow:!1}),Object(E.jsx)(F.EuiFlexItem,{grow:!0},Object(E.jsx)(F.EuiLink,{className:"lnsFiltersOperation__popoverButton","data-test-subj":"indexPattern-filters-existingFilterTrigger",onClick:()=>{c(!u)},color:p?"text":"danger",title:_.i18n.translate("xpack.lens.indexPattern.filterBy.clickToEdit",{defaultMessage:"Click to edit"})},s.query||_.i18n.translate("xpack.lens.indexPattern.filterBy.emptyFilterQuery",{defaultMessage:"(empty)"}))),Object(E.jsx)(F.EuiFlexItem,{grow:!1},Object(E.jsx)(F.EuiButtonIcon,{"data-test-subj":"indexPattern-filter-by-remove",color:"danger","aria-label":_.i18n.translate("xpack.lens.filterBy.removeLabel",{defaultMessage:"Remove filter"}),onClick:()=>{a(vu(t,n,void 0))},iconType:"cross"}))))},Object(E.jsx)(F.EuiFormRow,{label:xu,isInvalid:!m,error:g,fullWidth:!0},Object(E.jsx)(Ps,{indexPatternTitle:i.title,"data-test-subj":"indexPattern-filter-by-input",value:l,onChange:o,isInvalid:!m,onSubmit:()=>{}}))))))}function ju(e){const[t,n]=Object(h.useState)(!1),a=e.options.filter((e=>e.showInPopover)),i=e.options.filter((e=>e.inlineElement));return Object(E.jsx)(v.a.Fragment,null,a.length>0&&Object(E.jsx)(F.EuiText,{textAlign:"right"},Object(E.jsx)(F.EuiSpacer,{size:"s"}),Object(E.jsx)(F.EuiPopover,{ownFocus:!0,button:Object(E.jsx)(F.EuiButtonEmpty,{size:"xs",iconType:"arrowDown",iconSide:"right","data-test-subj":"indexPattern-advanced-popover",onClick:()=>{n(!t)}},_.i18n.translate("xpack.lens.indexPattern.advancedSettings",{defaultMessage:"Add advanced options"})),isOpen:t,closePopover:()=>{n(!1)}},a.map((({dataTestSubj:e,onClick:t,title:i},r)=>Object(E.jsx)(v.a.Fragment,{key:e},Object(E.jsx)(F.EuiText,{size:"s"},Object(E.jsx)(F.EuiLink,{"data-test-subj":e,color:"text",onClick:()=>{n(!1),t()}},i)),a.length-1!==r&&Object(E.jsx)(F.EuiSpacer,{size:"s"})))))),i.length>0&&Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiSpacer,{size:"s"}),i.map(((e,t)=>Object(E.jsx)(v.a.Fragment,{key:e.dataTestSubj},e.inlineElement,t!==i.length-1&&Object(E.jsx)(F.EuiSpacer,{size:"s"}))))))}function _u(e,t,n){const a=null==n?void 0:n.trim(),i=t.columns[e],r=i.customLabel?i.label:tl(i.label,i.timeScale,i.timeScale,i.timeShift,a);return{...t,columns:{...t.columns,[e]:{...t.columns[e],label:r,timeShift:a}}}}function Ou({selectedColumn:e,columnId:t,layer:n,updateLayer:a,indexPattern:i,isFocused:r,activeData:s,layerId:l}){const o=Object(h.useRef)(!1),[u,c]=Object(h.useState)(e.timeShift);Object(h.useEffect)((()=>{c(e.timeShift)}),[e.timeShift]);if(!Fo[e.operationType].shiftable||void 0===e.timeShift)return null;const{isValueTooSmall:d,isValueNotMultiple:p,canShift:m}=Wa(qa(n,i,s,l));if(!m)return null;const g=u&&Object(fa.parseTimeShift)(u),f=Boolean("invalid"===g),b=g&&d(g),x=g&&p(g);return Object(E.jsx)("div",{ref:e=>{if(e&&r){const t=e.querySelector('[data-test-subj="comboBoxSearchInput"]');!o.current&&t instanceof HTMLInputElement&&(o.current=!0,t.focus())}}},Object(E.jsx)(F.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:_.i18n.translate("xpack.lens.indexPattern.timeShift.label",{defaultMessage:"Time shift"}),helpText:_.i18n.translate("xpack.lens.indexPattern.timeShift.help",{defaultMessage:"Enter the time shift number and unit"}),error:b&&_.i18n.translate("xpack.lens.indexPattern.timeShift.tooSmallHelp",{defaultMessage:"Time shift should to be larger than the date histogram interval. Either increase time shift or specify smaller interval in date histogram"})||x&&_.i18n.translate("xpack.lens.indexPattern.timeShift.noMultipleHelp",{defaultMessage:"Time shift should be a multiple of the date histogram interval. Either adjust time shift or date histogram interval"}),isInvalid:Boolean(f||b||x)},Object(E.jsx)(F.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(E.jsx)(F.EuiFlexItem,null,Object(E.jsx)(F.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":"indexPattern-dimension-time-shift",placeholder:_.i18n.translate("xpack.lens.indexPattern.timeShiftPlaceholder",{defaultMessage:"Type custom values (e.g. 8w)"}),options:Ha.filter((({value:e})=>{const t=Object(fa.parseTimeShift)(e);return t&&!d(t)&&!p(t)})),selectedOptions:function(){if(!u)return[];const e=Ha.filter((({value:e})=>e===u));return e.length>0?e:[{value:u,label:u}]}(),singleSelection:{asPlainText:!0},isInvalid:f,onCreateOption:e=>{"invalid"!==Object(fa.parseTimeShift)(e)?a(_u(t,n,e)):c(e)},onChange:e=>{if(0===e.length)return a(_u(t,n,"")),void c("");const i=e[0].value;"invalid"!==Object(fa.parseTimeShift)(i)?a(_u(t,n,i)):c(i)}})),Object(E.jsx)(F.EuiFlexItem,{grow:!1},Object(E.jsx)(F.EuiButtonIcon,{"data-test-subj":"indexPattern-time-shift-remove",color:"danger","aria-label":_.i18n.translate("xpack.lens.timeShift.removeLabel",{defaultMessage:"Remove time shift"}),onClick:()=>{a(_u(t,n,void 0))},iconType:"cross"})))))}const ku="formula",Iu="static_value",Fu="quickFunctions",wu=new Set([ku,Iu]);function Tu(e){return!wu.has(e)}const Eu=({value:e,onChange:t})=>{const{inputValue:n,handleInputChange:a,initialValue:i}=Object(M.q)({onChange:t,value:e});return Object(E.jsx)(F.EuiFormRow,{label:_.i18n.translate("xpack.lens.indexPattern.columnLabel",{defaultMessage:"Display name",description:"Display name of a column of data"}),display:"columnCompressed",fullWidth:!0},Object(E.jsx)(F.EuiFieldText,{compressed:!0,"data-test-subj":"indexPattern-label-edit",value:n,onChange:e=>{a(e.target.value)},placeholder:i}))};const Cu=({currentOperationType:e,temporaryStateType:t})=>"none"===t||null!=e&&Tu(e)?null:e===Iu&&"quickFunctions"===t?Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiCallOut,{className:"lnsIndexPatternDimensionEditor__warning",size:"s",title:_.i18n.translate("xpack.lens.indexPattern.staticValueWarning",{defaultMessage:"Static value currently applied"}),iconType:"alert",color:"warning"},Object(E.jsx)("p",null,_.i18n.translate("xpack.lens.indexPattern.staticValueWarningText",{defaultMessage:"To overwrite your static value, select a quick function"})))):Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiCallOut,{className:"lnsIndexPatternDimensionEditor__warning",size:"s",title:_.i18n.translate("xpack.lens.indexPattern.formulaWarning",{defaultMessage:"Formula currently applied"}),iconType:"alert",color:"warning"},"quickFunctions"!==t?Object(E.jsx)("p",null,_.i18n.translate("xpack.lens.indexPattern.formulaWarningStaticValueText",{defaultMessage:"To overwrite your formula, change the value in the input field"})):Object(E.jsx)("p",null,_.i18n.translate("xpack.lens.indexPattern.formulaWarningText",{defaultMessage:"To overwrite your formula, select a quick function"})))),Mu=({tabsEnabled:e,tabsState:t,onClick:n})=>Object(E.jsx)(F.EuiTabs,{size:"s",className:"lnsIndexPatternDimensionEditor__header","data-test-subj":"lens-dimensionTabs"},e.static_value?Object(E.jsx)(F.EuiTab,{isSelected:t.static_value,"data-test-subj":"lens-dimensionTabs-static_value",onClick:()=>n(Iu)},_.i18n.translate("xpack.lens.indexPattern.staticValueLabel",{defaultMessage:"Static value"})):null,Object(E.jsx)(F.EuiTab,{isSelected:t.quickFunctions,"data-test-subj":"lens-dimensionTabs-quickFunctions",onClick:()=>n(Fu)},_.i18n.translate("xpack.lens.indexPattern.quickFunctionsLabel",{defaultMessage:"Quick functions"})),e.formula?Object(E.jsx)(F.EuiTab,{isSelected:t.formula,"data-test-subj":"lens-dimensionTabs-formula",onClick:()=>n(ku)},_.i18n.translate("xpack.lens.indexPattern.formulaLabel",{defaultMessage:"Formula"})):null);const Pu=To();function Su(e){var t,n;const{selectedColumn:a,operationSupportMatrix:i,state:r,columnId:s,setState:l,layerId:o,currentIndexPattern:u,hideGrouping:c,dateRange:d,dimensionGroups:p,toggleFullscreen:m,isFullscreen:g,supportStaticValue:f,supportFieldFormat:b=!0,layerType:y}=e,j={data:e.data,uiSettings:e.uiSettings,savedObjectsClient:e.savedObjectsClient,http:e.http,storage:e.storage},{fieldByOperation:O,operationWithoutField:k}=i,I=a&&Fo[a.operationType],[w,T]=Object(h.useState)("none"),C=Boolean(w===Fu),M=Boolean(w===Iu),P=Object(h.useCallback)((e=>l((t=>Ko({state:t,layerId:o,newLayer:e})))),[o,l]),S=(e,t={})=>{const n="function"==typeof e?e(r.layers[o]):e,a=Boolean(n.columns[s]);l((t=>{const n="function"==typeof e?e(t.layers[o]):e;return Ko({state:t,layerId:o,newLayer:n})}),{isDimensionComplete:a,...t})},A=e=>{l((t=>({...t,isDimensionClosePrevented:!e})))},L=(null!==(t=r.layers[o].incompleteColumns)&&void 0!==t?t:{})[s],{operationType:D,sourceField:N=null,...z}=L||{},B=Boolean(f?I&&Tu(I.type):!I||Tu(I.type)),R=C||B,V=M||"none"===w&&f&&(!a||(null==a?void 0:a.operationType)===Iu),H=(t=e.state.layers[e.layerId])=>{if((null==a?void 0:a.operationType)!==Iu){var n,i,r;Object(at.e)("indexpattern_dimension_operation_static_value");const a=Ti({layer:t,indexPattern:u,columnId:s,op:Iu,visualizationGroups:p});var l,c,d;return null!=(null===(n=e.activeData)||void 0===n||null===(i=n[o])||void 0===i||null===(r=i.rows[0])||void 0===r?void 0:r[s])?Xi(Bi({layer:a,columnId:s,paramName:"value",value:null===(l=e.activeData)||void 0===l||null===(c=l[o])||void 0===c||null===(d=c.rows[0])||void 0===d?void 0:d[s]}),u):a}return t},G=function(e,t,n){return e?Fo[Iu].paramEditor:null!=t&&t.paramEditor?t.paramEditor:n?Fo[Iu].paramEditor:null}(M,I,f&&!R),q=Object(h.useMemo)((()=>Object.values(Fo).filter((({hidden:e})=>!e)).filter((e=>!("selectionStyle"in e)||"hidden"!==e.selectionStyle)).filter((({type:e})=>{var t;return(null===(t=O.get(e))||void 0===t?void 0:t.size)||k.has(e)})).sort(((e,t)=>e.displayName.localeCompare(t.displayName))).map((e=>e.type))),[O,k]),[W,$]=Object(h.useState)(!1),[Y,K]=Object(h.useState)(!1),U=q.map((t=>{const n=Fo[t],i=a&&Wo(a)&&u.getFieldByName(a.sourceField);return{operationType:t,compatibleWithCurrentField:Si({layer:r.layers[o],columnId:s,op:t,indexPattern:u,field:i||void 0,filterOperations:e.filterOperations,visualizationGroups:p}),disabledStatus:n.getDisabledStatus&&n.getDisabledStatus(r.indexPatterns[r.currentIndexPatternId],r.layers[o],y)}})),X=Object(h.useMemo)((()=>{return t=u,!(!(e=a)||!Wo(e)||null===(n=fi(e,t))||void 0===n||!n.length);var e,t,n}),[a,u]),Q=U.map((({operationType:t,compatibleWithCurrentField:n,disabledStatus:i})=>{const l=Boolean(D===t||!D&&a&&a.operationType===t);let c="primary";l?c="text":n||(c="subdued");let d=Pu[t].displayName;return l&&i?d=Object(E.jsx)(F.EuiToolTip,{content:i,display:"block",position:"left"},Object(E.jsx)(F.EuiText,{color:"danger",size:"s"},Object(E.jsx)("strong",null,Pu[t].displayName))):i?d=Object(E.jsx)(F.EuiToolTip,{content:i,display:"block",position:"left"},Object(E.jsx)("span",null,Pu[t].displayName)):l&&(d=Object(E.jsx)("strong",null,Pu[t].displayName)),{id:t,label:d,color:c,isActive:l,size:"s",isDisabled:!!i,className:"lnsIndexPatternDimensionEditor__operation","data-test-subj":`lns-indexPatternDimension-${t}${n?"":" incompatible"}`,"aria-pressed":l,onClick(){if(["none","fullReference","managedReference"].includes(Fo[t].input)){if((null==a?void 0:a.operationType)===t)return void(L&&S(Qi(r.layers[o],s)));const n=Ti({layer:e.state.layers[e.layerId],indexPattern:u,columnId:s,op:t,visualizationGroups:p,targetGroup:e.groupId});return C&&Tu(n.columns[s].operationType)&&T("none"),S(n),void Object(at.e)(`indexpattern_dimension_operation_${t}`)}if(!a||!n){var i;const n=null!==(i=O.get(t))&&void 0!==i?i:new Set;let a;return a=1===n.size?Ti({layer:e.state.layers[e.layerId],indexPattern:u,columnId:s,op:t,field:u.getFieldByName(n.values().next().value),visualizationGroups:p,targetGroup:e.groupId}):Ti({layer:e.state.layers[e.layerId],indexPattern:u,columnId:s,op:t,field:void 0,visualizationGroups:p,targetGroup:e.groupId}),C&&Tu(a.columns[s].operationType)&&T("none"),S(a),void Object(at.e)(`indexpattern_dimension_operation_${t}`)}if(a.operationType===t)return void(L&&S(Qi(r.layers[o],s)));C&&T("none");const l=Mi({layer:e.state.layers[e.layerId],indexPattern:u,columnId:s,op:t,field:Wo(a)?u.getFieldByName(a.sourceField):void 0,visualizationGroups:p});S(l)}}})),Z=("fullReference"!==(null==I?void 0:I.input)&&"managedReference"!==(null==I?void 0:I.input)||D&&"field"===Fo[D].input)&&function(e,t,n,a){return e&&t?"field"===n?_.i18n.translate("xpack.lens.indexPattern.invalidOperationLabel",{defaultMessage:"This field does not work with the selected function."}):_.i18n.translate("xpack.lens.indexPattern.chooseFieldLabel",{defaultMessage:"To use this function, select a field."}):a?_.i18n.translate("xpack.lens.indexPattern.invalidFieldLabel",{defaultMessage:"Invalid field. Check your index pattern or pick another field."}):void 0}(a,Boolean(D),null==I?void 0:I.input,X),J=!X&&!L&&a&&Tu(a.operationType),ee=Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)("div",{className:"lnsIndexPatternDimensionEditor__section lnsIndexPatternDimensionEditor__section--padded lnsIndexPatternDimensionEditor__section--shaded"},Object(E.jsx)(F.EuiFormLabel,null,_.i18n.translate("xpack.lens.indexPattern.functionsLabel",{defaultMessage:"Select a function"})),Object(E.jsx)(F.EuiSpacer,{size:"s"}),Object(E.jsx)(F.EuiListGroup,{className:Q.length>3?"lnsIndexPatternDimensionEditor__columns":"",gutterSize:"none",listItems:Q.length%2==1?[...Q,{label:" "}]:Q,maxWidth:!1})),Object(E.jsx)("div",{className:"lnsIndexPatternDimensionEditor__section lnsIndexPatternDimensionEditor__section--padded lnsIndexPatternDimensionEditor__section--shaded"},!L&&a&&"references"in a&&"fullReference"===(null==I?void 0:I.input)?Object(E.jsx)(v.a.Fragment,null,a.references.map(((t,n)=>{var a;const i=I.requiredReferences[n];return Object(E.jsx)(gu,x()({key:n,layer:r.layers[o],layerId:o,activeData:e.activeData,columnId:t,updateLayer:e=>{P("function"==typeof e?e(r.layers[o]):e)},validation:i,currentIndexPattern:u,existingFields:r.existingFields,selectionStyle:I.selectionStyle,dateRange:d,labelAppend:null==I||null===(a=I.getHelpMessage)||void 0===a?void 0:a.call(I,{data:e.data,uiSettings:e.uiSettings,currentColumn:r.layers[o].columns[s]}),dimensionGroups:p,isFullscreen:g,toggleFullscreen:m,setIsCloseable:A},j))})),Object(E.jsx)(F.EuiSpacer,{size:"s"})):null,!a||"field"===(null==I?void 0:I.input)||D&&"field"===Fo[D].input||C?Object(E.jsx)(F.EuiFormRow,{"data-test-subj":"indexPattern-field-selection-row",label:_.i18n.translate("xpack.lens.indexPattern.chooseField",{defaultMessage:"Select a field"}),fullWidth:!0,isInvalid:Boolean(D||X),error:Z,labelAppend:!Z&&(null==I||null===(n=I.getHelpMessage)||void 0===n?void 0:n.call(I,{data:e.data,uiSettings:e.uiSettings,currentColumn:r.layers[o].columns[s]}))},Object(E.jsx)(ru,{fieldIsInvalid:X,currentIndexPattern:u,existingFields:r.existingFields,operationSupportMatrix:i,selectedOperationType:a?a.operationType:D,selectedField:N||(null==a?void 0:a.sourceField),incompleteOperation:D,onChoose:t=>{C&&T("none"),S(Ti({layer:r.layers[o],columnId:s,indexPattern:u,op:t.operationType,field:u.getFieldByName(t.field),visualizationGroups:p,targetGroup:e.groupId,incompleteParams:z}),{forceRender:C})}})):null,J&&G&&Object(E.jsx)(G,x()({layer:r.layers[o],layerId:o,activeData:e.activeData,updateLayer:S,columnId:s,currentColumn:r.layers[o].columns[s],dateRange:d,indexPattern:u,operationDefinitionMap:Fo,toggleFullscreen:m,isFullscreen:g,setIsCloseable:A},j)),!X&&!L&&a&&Object(E.jsx)(ju,{options:[{title:_.i18n.translate("xpack.lens.indexPattern.timeScale.enableTimeScale",{defaultMessage:"Normalize by unit"}),dataTestSubj:"indexPattern-time-scaling-enable",onClick:()=>{S(fu(s,r.layers[o],"s"))},showInPopover:Boolean(Fo[a.operationType].timeScalingMode&&"disabled"!==Fo[a.operationType].timeScalingMode&&Object.values(r.layers[o].columns).some((e=>"date_histogram"===e.operationType))&&!a.timeScale),inlineElement:Object(E.jsx)(bu,{selectedColumn:a,columnId:s,layer:r.layers[o],updateLayer:S})},{title:_.i18n.translate("xpack.lens.indexPattern.filterBy.label",{defaultMessage:"Filter by"}),dataTestSubj:"indexPattern-filter-by-enable",onClick:()=>{$(!0),S(vu(s,r.layers[o],hu))},showInPopover:Boolean(Fo[a.operationType].filterable&&!a.filter),inlineElement:Fo[a.operationType].filterable&&a.filter?Object(E.jsx)(yu,{indexPattern:u,selectedColumn:a,columnId:s,layer:r.layers[o],updateLayer:S,isInitiallyOpen:W}):null},{title:_.i18n.translate("xpack.lens.indexPattern.timeShift.label",{defaultMessage:"Time shift"}),dataTestSubj:"indexPattern-time-shift-enable",onClick:()=>{K(!0),S(_u(s,r.layers[o],""))},showInPopover:Boolean(Fo[a.operationType].shiftable&&void 0===a.timeShift&&(u.timeFieldName||Object.values(r.layers[o].columns).some((e=>"date_histogram"===e.operationType)))),inlineElement:Fo[a.operationType].shiftable&&void 0!==a.timeShift?Object(E.jsx)(Ou,{indexPattern:u,selectedColumn:a,columnId:s,layer:r.layers[o],updateLayer:S,isFocused:Y,activeData:e.activeData,layerId:o}):null}]}))),te=G?Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(G,x()({layer:r.layers[o],layerId:o,activeData:e.activeData,updateLayer:M?e=>{if(M&&T("none"),"function"==typeof e)return l((t=>{const n=e(H(t.layers[o]));return Ko({state:t,layerId:o,newLayer:n})}),{isDimensionComplete:!0,forceRender:!0})}:S,columnId:s,currentColumn:r.layers[o].columns[s],dateRange:d,indexPattern:u,operationDefinitionMap:Fo,toggleFullscreen:m,isFullscreen:g,setIsCloseable:A},j))):null,ne=R?ee:te,ae=Object(h.useCallback)((e=>{P(Bi({layer:r.layers[o],columnId:s,paramName:"format",value:e}))}),[s,o,r.layers,P]),ie=!g&&i.operationWithoutField.has(ku),re=!g&&(ie||f);return Object(E.jsx)("div",{id:s},re?Object(E.jsx)(Mu,{tabsEnabled:{static_value:f,formula:ie,quickFunctions:!0},tabsState:{static_value:V,quickFunctions:R,formula:"none"===w&&(null==a?void 0:a.operationType)===ku},onClick:t=>{if("quickFunctions"!==t||!a||Tu(a.operationType)){if("static_value"===t)return(null==a?void 0:a.operationType)===ku?T(Iu):(T("none"),void S(H()));if("formula"===t&&(T("none"),(null==a?void 0:a.operationType)!==ku)){const t=Ti({layer:e.state.layers[e.layerId],indexPattern:u,columnId:s,op:ku,visualizationGroups:p});S(t),Object(at.e)("indexpattern_dimension_operation_formula")}}else T(Fu)}}):null,Object(E.jsx)(Cu,{currentOperationType:null==a?void 0:a.operationType,temporaryStateType:w}),ne,!g&&!X&&Object(E.jsx)("div",{className:"lnsIndexPatternDimensionEditor__section lnsIndexPatternDimensionEditor__section--padded  lnsIndexPatternDimensionEditor__section--collapseNext"},!L&&a&&"none"===w&&Object(E.jsx)(Eu,{value:a.label,onChange:e=>{P({columns:{...r.layers[o].columns,[s]:{...a,label:e,customLabel:Fo[a.operationType].getDefaultLabel(a,r.indexPatterns[r.layers[o].indexPatternId],r.layers[o].columns)!==e}}})}}),!g&&!L&&!c&&"none"===w&&Object(E.jsx)(ou,{layer:r.layers[e.layerId],columnId:e.columnId,setColumns:e=>P({columnOrder:e}),getFieldByName:u.getFieldByName}),!b||g||!a||"number"!==a.dataType&&"range"!==a.operationType?null:Object(E.jsx)(pu,{selectedColumn:a,onChange:ae})))}const Au=El()((function(e,t){return e.reduce(((e,{operationMetaData:n,operations:a})=>t(n)?[...e,...a]:e),[]).reduce(((e,t)=>{if("field"===t.type){var n,a;const i=null!==(n=e.operationByField.get(t.field))&&void 0!==n?n:new Set;i.add(t.operationType),e.operationByField.set(t.field,i);const r=null!==(a=e.fieldByOperation.get(t.operationType))&&void 0!==a?a:new Set;r.add(t.field),e.fieldByOperation.set(t.operationType,r)}else e.operationWithoutField.add(t.operationType);return e}),{operationByField:new Map,operationWithoutField:new Set,fieldByOperation:new Map})}));const Lu=function(e){var t;const n=e.layerId,a=e.state.layers[n],i=e.state.indexPatterns[a.indexPatternId],{columnId:r,uniqueLabel:s,invalid:l,invalidMessage:o}=e,u=Object(h.useMemo)((()=>l||Yo(a,r,i)),[a,r,i,l]),c=null!==(t=a.columns[e.columnId])&&void 0!==t?t:null;if(!c)return null;const d=(p=s)?p.replace(/\./g,".​"):"";var p;return u?Object(E.jsx)(F.EuiToolTip,{content:null!=o?o:Object(E.jsx)("p",null,_.i18n.translate("xpack.lens.configure.invalidConfigTooltip",{defaultMessage:"Invalid configuration."}),Object(E.jsx)("br",null),_.i18n.translate("xpack.lens.configure.invalidConfigTooltipClick",{defaultMessage:"Click for more details."})),anchorClassName:"eui-displayBlock"},Object(E.jsx)(F.EuiText,{size:"s",color:"danger",id:r,className:"lnsLayerPanel__triggerText","data-test-subj":"lns-dimensionTrigger"},Object(E.jsx)(F.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(E.jsx)(F.EuiFlexItem,{grow:!1},Object(E.jsx)(F.EuiIcon,{size:"s",type:"alert"})),Object(E.jsx)(F.EuiFlexItem,{grow:!0},c.label)))):Object(E.jsx)(F.EuiText,{size:"s",id:r,className:"lnsLayerPanel__triggerText","data-test-subj":"lns-dimensionTrigger"},Object(E.jsx)(F.EuiFlexItem,{grow:!0},Object(E.jsx)("span",null,Object(E.jsx)("span",{className:"lnsLayerPanel__triggerTextLabel"},d))))},Du=function(e){var t;const n=e.layerId,a=e.state.indexPatterns[null===(t=e.state.layers[n])||void 0===t?void 0:t.indexPatternId];if(!a)return null;const i=(e=>{const t=e.layerId,n=e.state.indexPatterns[e.state.layers[t].indexPatternId],a=Mo(n);return Au(a,e.filterOperations)})(e),r=e.state.layers[n].columns[e.columnId]||null;return Object(E.jsx)(Su,x()({},e,{layerType:e.layerType||$.i.DATA,currentIndexPattern:a,selectedColumn:r,operationSupportMatrix:i}))},Nu=Object(h.memo)(Lu),zu=Object(h.memo)(Du);var Bu=n(97);const Ru=To();function Vu(e,t,n){if(!e)return;const a=Co(e,t);if(!a.length)return;return n&&a.includes(n.operationType)?n.operationType:a[0]}function Hu(e,t){if(!e)return;return Wo(e)&&t.getFieldByName(e.sourceField)||void 0}function Gu(e){const{state:t,columnId:n,layerId:a,dragging:i,groupId:r,filterOperations:s}=e;if(i){if($o(i))return function({state:e,columnId:t,layerId:n,dragging:a,filterOperations:i}){const r=e.layers[n].columns[t],s=e.layers[n].indexPatternId===a.indexPatternId,l=Vu(a.field,i,r);if(s&&l){const e=Ru[l].displayName;if(!r)return{dropTypes:["field_add"],nextLabel:e};if(Wo(r)&&r.sourceField!==a.field.name||!Wo(r))return{dropTypes:["field_replace"],nextLabel:e}}return}({...e,dragging:i});if(Object(Bu.a)(i)&&i.layerId===a&&n!==i.columnId){const l=t.layers[i.layerId].columns[i.columnId],o=t.layers[a].columns[n];return r===i.groupId?function(e){return e?{dropTypes:["reorder"]}:{dropTypes:["duplicate_compatible"]}}(o):function(e,t){return t&&Wo(t)&&Wo(e)&&t.sourceField===e.sourceField}(l,o)?void 0:s(l)?function(e){return{dropTypes:e?["replace_compatible","replace_duplicate_compatible","swap_compatible"]:["move_compatible","duplicate_compatible"]}}(o):function({state:e,columnId:t,layerId:n,dragging:a,filterOperations:i}){const r=e.layers[n].columns[t],s=e.layers[a.layerId].columns[a.columnId],l=e.indexPatterns[e.layers[n].indexPatternId];if(!l)return;const o=Hu(s,l),u=Vu(o,i,r);if(u){const e=!!Vu(Hu(r,l),a.filterOperations,s);return{dropTypes:r?e?["replace_incompatible","replace_duplicate_incompatible","swap_incompatible"]:["replace_incompatible","replace_duplicate_incompatible"]:["move_incompatible","duplicate_incompatible"],nextLabel:Ru[u].displayName}}}({...e,dragging:i})}}}function qu(e){const{droppedItem:t,dropType:n}=e;return Wu[n]({...e,droppedItem:t})}const Wu={field_add:$u,field_replace:$u,reorder:function({columnId:e,setState:t,state:n,layerId:a,droppedItem:i}){return t(Ko({state:n,layerId:a,newLayer:{columnOrder:function(e,t,n){const a=e.filter((e=>e!==n)),i=e.findIndex((e=>e===n)),r=e.findIndex((e=>e===t)),s=a.indexOf(t);return a.splice(i<r?s+1:s,0,n),a}(n.layers[a].columnOrder,e,i.columnId)}})),!0},move_compatible:e=>Yu(e,!0),replace_compatible:e=>Yu(e,!0),duplicate_compatible:Yu,replace_duplicate_compatible:Yu,move_incompatible:e=>Ku(e,!0),replace_incompatible:e=>Ku(e,!0),duplicate_incompatible:Ku,replace_duplicate_incompatible:Ku,swap_compatible:function({columnId:e,setState:t,state:n,layerId:a,droppedItem:i,dimensionGroups:r,groupId:s}){const l=n.layers[a],o=i.columnId,u=e,c={...l.columns[o]},d={...l.columns[u]},p={...l.columns};p[u]=c,p[o]=d;let m=Uu(l.columnOrder,o,u);return m=Di(r,s,m,e),t(Ko({state:n,layerId:a,newLayer:{columnOrder:m,columns:p}})),!0},swap_incompatible:function({columnId:e,setState:t,state:n,layerId:a,droppedItem:i,filterOperations:r,dimensionGroups:s,groupId:l}){const o=n.layers[a],u=n.indexPatterns[o.indexPatternId],c=o.columns[i.columnId],d=o.columns[e],p=Hu(c,u),m=Hu(d,u),g=Vu(p,r,d),f=Vu(m,i.filterOperations,c);if(!g||!f)return!1;const b=Ti({layer:Ti({layer:o,columnId:e,targetGroup:l,indexPattern:u,op:g,field:p,visualizationGroups:s,shouldResetLabel:!0}),columnId:i.columnId,indexPattern:u,op:f,field:m,visualizationGroups:s,targetGroup:i.groupId,shouldResetLabel:!0});return Object(at.e)("drop_onto_dimension"),t(Ko({state:n,layerId:a,newLayer:b})),!0}};function $u(e){const{columnId:t,setState:n,state:a,layerId:i,droppedItem:r,filterOperations:s,groupId:l,dimensionGroups:o}=e,u=a.layers[i],c=a.indexPatterns[u.indexPatternId],d=u.columns[t],p=Vu(r.field,s,d);if(!$o(r)||!p)return!1;const m=Ti({layer:u,columnId:t,indexPattern:c,op:p,field:r.field,visualizationGroups:o,targetGroup:l});Object(at.e)("drop_onto_dimension");const g=Object.values(a.layers).some((({columns:e})=>e.length));return Object(at.e)(g?"drop_non_empty":"drop_empty"),n(Ko({state:a,layerId:i,newLayer:m})),!0}function Yu({columnId:e,setState:t,state:n,layerId:a,droppedItem:i,dimensionGroups:r,groupId:s},l){const o=n.layers[a],u=o.columns[i.columnId],c=n.indexPatterns[o.indexPatternId],d=Fi({layer:o,targetId:e,sourceColumnId:i.columnId,sourceColumn:u,shouldDeleteSource:l,indexPattern:c});return t(Ko({state:n,layerId:a,newLayer:{columnOrder:Di(r,s,Hi(d),e),columns:d.columns}})),!l||{deleted:i.columnId}}function Ku({columnId:e,setState:t,state:n,layerId:a,droppedItem:i,filterOperations:r,dimensionGroups:s,groupId:l},o){const u=n.layers[a],c=n.indexPatterns[u.indexPatternId],d=u.columns[i.columnId],p=u.columns[e]||null,m=Hu(d,c),g=Vu(m,r,p);if(!g)return!1;const f=Ti({layer:o?Vi({layer:u,columnId:i.columnId,indexPattern:c}):u,columnId:e,indexPattern:c,op:g,field:m,visualizationGroups:s,targetGroup:l,shouldResetLabel:!0});return Object(at.e)("drop_onto_dimension"),t(Ko({state:n,layerId:a,newLayer:f})),!o||{deleted:i.columnId}}const Uu=(e,t,n)=>{const a=[...e],i=a.findIndex((e=>e===t)),r=a.findIndex((e=>e===n));return a[i]=n,a[r]=t,a};n(126);var Xu=n(76);function Qu(e){const[t,n]=Object(h.useState)(!1),a=Object(h.useRef)(void 0),i=Object(h.useRef)(void 0);return Object(h.useEffect)((function t(){a.current?i.current=t:(n(!0),a.current=e.load().catch((()=>{})).then((()=>{const e=i.current;a.current=void 0,i.current=void 0,e?e():n(!1)})))}),e.loadDeps),t?Object(E.jsx)(F.EuiProgress,{size:"xs",color:"accent",position:"absolute"}):null}var Zu=n(5);function Ju({indexPatternRefs:e,isMissingCurrent:t,indexPatternId:n,onChangeIndexPattern:a,trigger:i,selectableProps:r}){const[s,l]=Object(h.useState)(!1),o=t?{color:"danger"}:{};return Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiPopover,{panelClassName:"lnsChangeIndexPatternPopover",button:function(){const{label:e,title:t,...n}=i;return Object(E.jsx)(dn.ToolbarButton,x()({title:t,onClick:()=>l(!s),fullWidth:!0},o,n),e)}(),panelProps:{"data-test-subj":"lnsChangeIndexPatternPopover"},isOpen:s,closePopover:()=>l(!1),display:"block",panelPaddingSize:"s",ownFocus:!0},Object(E.jsx)("div",null,Object(E.jsx)(F.EuiPopoverTitle,null,_.i18n.translate("xpack.lens.indexPattern.changeIndexPatternTitle",{defaultMessage:"Index pattern"})),Object(E.jsx)(F.EuiSelectable,x()({},r,{searchable:!0,singleSelection:"always",options:e.map((({title:e,id:t})=>({key:t,label:e,value:t,checked:t===n?"on":void 0}))),onChange:e=>{const t=e.find((({checked:e})=>e));Object(at.e)("indexpattern_changed"),a(t.value),l(!1)},searchProps:{compressed:!0,...r?r.searchProps:void 0}}),((e,t)=>Object(E.jsx)(v.a.Fragment,null,t,e))))))}n(392),n(401);var ec=n(410),tc=n.n(ec);function nc(e){const[t,n]=Object(h.useState)(void 0);return Object(h.useEffect)((()=>{!async function(){var t,a;const i=await e.uiActions.getTriggerCompatibleActions(Zu.VISUALIZE_GEO_FIELD_TRIGGER,{indexPatternId:e.indexPatternId,fieldName:e.fieldName}),r={indexPatternId:e.indexPatternId,fieldName:e.fieldName,trigger:Zu.visualizeGeoFieldTrigger},s=i.length?await(null===(t=(a=i[0]).getHref)||void 0===t?void 0:t.call(a,r)):void 0;n(s)}()}),[]),Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiButton,{onClick:function(t){t.preventDefault(),e.uiActions.getTrigger(Zu.VISUALIZE_GEO_FIELD_TRIGGER).exec({indexPatternId:e.indexPatternId,fieldName:e.fieldName})},href:t,size:"s","data-test-subj":`lensVisualize-GeoField-${e.fieldName}`},Object(E.jsx)(O.FormattedMessage,{id:"xpack.lens.indexPattern.fieldItem.visualizeGeoFieldLinkText",defaultMessage:"Visualize in Maps"})))}function ac(e){return e?e.replace(/\./g,".​"):""}const ic=function(e,t=256){const n=Object(h.memo)(e);return e=>{const[a,i]=Object(h.useState)(e),r=Object(h.useMemo)((()=>Object(Z.debounce)(i,t)),[i]);return Object(h.useEffect)((()=>()=>r.cancel()),[r]),r(e),v.a.createElement(n,a)}}((function(e){const{core:t,field:n,indexPattern:a,highlight:i,exists:r,query:s,dateRange:l,filters:o,hideDetails:u,itemIndex:c,groupIndex:d,dropOntoWorkspace:p,editField:m,removeField:g}=e,[f,b]=Object(h.useState)(!1),v=Object(h.useMemo)((()=>m?e=>{m(e),b(!1)}:void 0),[m,b]),y=Object(h.useMemo)((()=>g?e=>{g(e),b(!1)}:void 0),[g,b]),j=Object(h.useCallback)((e=>{p(e),b(!1)}),[p,b]),[O,k]=Object(h.useState)({isLoading:!1});const I=Object(h.useCallback)((()=>{b(!1)}),[b]),w=Object(h.useMemo)((()=>({field:n,indexPatternId:a.id,id:n.name,humanData:{label:n.displayName,position:c+1}})),[n,a.id,c]),T=Object(h.useMemo)((()=>[0,d,c]),[d,c]),C=Object(E.jsx)(Qo,{type:n.type}),M=Object(E.jsx)(F.EuiIconTip,{anchorClassName:"lnsFieldItem__infoIcon",content:u?_.i18n.translate("xpack.lens.indexPattern.fieldItemTooltip",{defaultMessage:"Drag and drop to visualize."}):r?_.i18n.translate("xpack.lens.indexPattern.fieldStatsButtonLabel",{defaultMessage:"Click for a field preview, or drag and drop to visualize."}):_.i18n.translate("xpack.lens.indexPattern.fieldStatsButtonEmptyLabel",{defaultMessage:"This field doesn’t have any data but you can still drag and drop to visualize."}),type:"iInCircle",color:"subdued",size:"s"});return Object(E.jsx)("li",null,Object(E.jsx)(F.EuiPopover,{ownFocus:!0,className:"lnsFieldItem__popoverAnchor",display:"block","data-test-subj":"lnsFieldListPanelField",container:document.querySelector(".application")||void 0,button:Object(E.jsx)(Xu.c,{draggable:!0,order:T,value:w,dataTestSubj:`lnsFieldListPanelField-${n.name}`,onDragStart:I},Object(E.jsx)(dn.FieldButton,{className:`lnsFieldItem lnsFieldItem--${n.type} lnsFieldItem--${r?"exists":"missing"}`,isActive:f,onClick:function(){b(!f),f||(Object(at.e)("indexpattern_field_info_click"),O.isLoading||"document"===n.type||n.type.includes("range")||"geo_point"===n.type||"geo_shape"===n.type||(k((e=>({...e,isLoading:!0}))),t.http.post(`/api/lens/index_stats/${a.id}/field`,{body:JSON.stringify({dslQuery:De.esQuery.buildEsQuery(a,s,o,De.esQuery.getEsQueryConfig(t.uiSettings)),fromDate:l.fromDate,toDate:l.toDate,fieldName:n.name})}).then((e=>{k((t=>({...t,isLoading:!1,totalDocuments:e.totalDocuments,sampledDocuments:e.sampledDocuments,sampledValues:e.sampledValues,histogram:e.histogram,topValues:e.topValues})))})).catch((()=>{k((e=>({...e,isLoading:!1})))}))))},buttonProps:{"aria-label":_.i18n.translate("xpack.lens.indexPattern.fieldStatsButtonAriaLabel",{defaultMessage:"Preview {fieldName}: {fieldType}",values:{fieldName:n.displayName,fieldType:n.type}})},fieldIcon:C,fieldName:Object(E.jsx)(F.EuiHighlight,{search:ac(i)},ac(n.displayName)),fieldInfoIcon:M})),isOpen:f,closePopover:()=>b(!1),anchorPosition:"rightUp",panelClassName:"lnsFieldItem__fieldPanel",initialFocus:".lnsFieldItem__fieldPanel"},Object(E.jsx)(sc,x()({},O,e,{editField:v,removeField:y,dropOntoWorkspace:j}))))}));function rc({indexPatternId:e,field:t,hasSuggestionForField:n,dropOntoWorkspace:a,editField:i,removeField:r}){const s={indexPatternId:e,id:t.name,field:t,humanData:{label:t.displayName}};return Object(E.jsx)(F.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(E.jsx)(F.EuiFlexItem,null,Object(E.jsx)(F.EuiTitle,{size:"xxs"},Object(E.jsx)("h5",{className:"eui-textBreakWord lnsFieldItem__fieldPanelTitle"},t.displayName))),Object(E.jsx)(lc,{isEnabled:n(s),dropOntoWorkspace:a,field:s}),i&&Object(E.jsx)(F.EuiFlexItem,{grow:!1},Object(E.jsx)(F.EuiToolTip,{content:_.i18n.translate("xpack.lens.indexPattern.editFieldLabel",{defaultMessage:"Edit index pattern field"})},Object(E.jsx)(F.EuiButtonIcon,{onClick:()=>i(t.name),iconType:"pencil","data-test-subj":"lnsFieldListPanelEdit","aria-label":_.i18n.translate("xpack.lens.indexPattern.editFieldLabel",{defaultMessage:"Edit index pattern field"})}))),r&&t.runtime&&Object(E.jsx)(F.EuiFlexItem,{grow:!1},Object(E.jsx)(F.EuiToolTip,{content:_.i18n.translate("xpack.lens.indexPattern.removeFieldLabel",{defaultMessage:"Remove index pattern field"})},Object(E.jsx)(F.EuiButtonIcon,{onClick:()=>r(t.name),iconType:"trash","data-test-subj":"lnsFieldListPanelRemove",color:"danger","aria-label":_.i18n.translate("xpack.lens.indexPattern.removeFieldLabel",{defaultMessage:"Remove index pattern field"})}))))}function sc(e){const{histogram:t,topValues:n,indexPattern:a,field:i,dateRange:r,core:s,sampledValues:l,chartsThemeService:o,fieldFormats:u,dropOntoWorkspace:c,editField:d,removeField:p,hasSuggestionForField:m,hideDetails:g,uiActions:f}=e,b=o.useChartsTheme(),x=o.useChartsBaseTheme();let y=!!e.histogram;const j=n&&n.buckets.reduce(((e,t)=>t.count+e),0),O=l&&j?l-j:0;j&&t&&t.buckets.length&&n&&n.buckets.length&&(y=O/j>.9);const[k,I]=Object(h.useState)(y),w=Object(E.jsx)(rc,{indexPatternId:a.id,field:i,dropOntoWorkspace:c,hasSuggestionForField:m,editField:d,removeField:p});if(g)return w;let T;if(a.fieldFormatMap&&a.fieldFormatMap[i.name]){const e=u.getType(a.fieldFormatMap[i.name].id);T=e?new e(a.fieldFormatMap[i.name].params,s.uiSettings.get.bind(s.uiSettings)):{convert:e=>JSON.stringify(e)}}else T=u.getDefaultInstance(i.type,i.esTypes);const C=tc.a.parse(r.fromDate),M=tc.a.parse(r.toDate);let P=Object(E.jsx)(v.a.Fragment,null);if(e.isLoading)return Object(E.jsx)(F.EuiLoadingSpinner,null);if(i.type.includes("range"))return Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiPopoverTitle,null,w),Object(E.jsx)(F.EuiText,{size:"s"},_.i18n.translate("xpack.lens.indexPattern.fieldStatsLimited",{defaultMessage:"Summary information is not available for range type fields."})));if("geo_point"===i.type||"geo_shape"===i.type)return Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiPopoverTitle,null,w),Object(E.jsx)(F.EuiText,{size:"s"},Object(Tn.getVisualizeGeoFieldMessage)(i.type)),Object(E.jsx)(F.EuiSpacer,{size:"m"}),Object(E.jsx)(nc,{uiActions:f,indexPatternId:a.id,fieldName:i.name}));if(!(e.histogram&&0!==e.histogram.buckets.length||e.topValues&&0!==e.topValues.buckets.length))return Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiPopoverTitle,null,w),Object(E.jsx)(F.EuiText,{size:"s"},_.i18n.translate("xpack.lens.indexPattern.fieldStatsNoData",{defaultMessage:"This field is empty because it doesn’t exist in the 500 sampled documents. Adding this field to the configuration may result in a blank chart."})));function S(t){return Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiPopoverTitle,null,w),P||Object(E.jsx)(v.a.Fragment,null),Object(E.jsx)(F.EuiSpacer,{size:"s"}),t,e.totalDocuments?Object(E.jsx)(F.EuiPopoverFooter,null,Object(E.jsx)(F.EuiText,{color:"subdued",size:"xs"},e.sampledDocuments&&Object(E.jsx)(v.a.Fragment,null,_.i18n.translate("xpack.lens.indexPattern.percentageOfLabel",{defaultMessage:"{percentage}% of",values:{percentage:Math.round(e.sampledDocuments/e.totalDocuments*100)}}))," ",Object(E.jsx)("strong",null,u.getDefaultInstance(De.KBN_FIELD_TYPES.NUMBER,[De.ES_FIELD_TYPES.INTEGER]).convert(e.totalDocuments))," ",_.i18n.translate("xpack.lens.indexPattern.ofDocumentsLabel",{defaultMessage:"documents"}))):Object(E.jsx)(v.a.Fragment,null))}if(t&&t.buckets.length&&n&&n.buckets.length?P=Object(E.jsx)(F.EuiButtonGroup,{className:"lnsFieldItem__buttonGroup",buttonSize:"compressed",isFullWidth:!0,legend:_.i18n.translate("xpack.lens.indexPattern.fieldStatsDisplayToggle",{defaultMessage:"Toggle either the"}),options:[{label:_.i18n.translate("xpack.lens.indexPattern.fieldTopValuesLabel",{defaultMessage:"Top values"}),id:"topValues"},{label:_.i18n.translate("xpack.lens.indexPattern.fieldDistributionLabel",{defaultMessage:"Distribution"}),id:"histogram"}],onChange:e=>{I("histogram"===e)},idSelected:k?"histogram":"topValues"}):"date"===i.type?P=Object(E.jsx)(F.EuiTitle,{size:"xxxs"},Object(E.jsx)("h6",null,_.i18n.translate("xpack.lens.indexPattern.fieldTimeDistributionLabel",{defaultMessage:"Time distribution"}))):n&&n.buckets.length&&(P=Object(E.jsx)(F.EuiTitle,{size:"xxxs"},Object(E.jsx)("h6",null,_.i18n.translate("xpack.lens.indexPattern.fieldTopValuesLabel",{defaultMessage:"Top values"})))),t&&t.buckets.length){const e=_.i18n.translate("xpack.lens.indexPattern.fieldStatsCountLabel",{defaultMessage:"Count"});if("date"===i.type)return S(Object(E.jsx)(oe.Chart,{"data-test-subj":"lnsFieldListPanel-histogram",size:{height:200,width:268}},Object(E.jsx)(oe.Settings,{tooltip:{type:oe.TooltipType.None},theme:b,baseTheme:x,xDomain:C&&M?{min:C.valueOf(),max:M.valueOf(),minInterval:Math.round((M.valueOf()-C.valueOf())/10)}:void 0}),Object(E.jsx)(oe.Axis,{id:"key",position:oe.Position.Bottom,tickFormat:C&&M?Object(oe.niceTimeFormatter)([C.valueOf(),M.valueOf()]):void 0,showOverlappingTicks:!0}),Object(E.jsx)(oe.BarSeries,{data:t.buckets,id:e,xAccessor:"key",yAccessors:["count"],xScaleType:oe.ScaleType.Time,yScaleType:oe.ScaleType.Linear,timeZone:"local"})));if(k||!n||!n.buckets.length)return S(Object(E.jsx)(oe.Chart,{"data-test-subj":"lnsFieldListPanel-histogram",size:{height:200,width:"100%"}},Object(E.jsx)(oe.Settings,{rotation:90,tooltip:{type:oe.TooltipType.None},theme:b,baseTheme:x}),Object(E.jsx)(oe.Axis,{id:"key",position:oe.Position.Left,showOverlappingTicks:!0,tickFormat:e=>T.convert(e)}),Object(E.jsx)(oe.BarSeries,{data:t.buckets,id:e,xAccessor:"key",yAccessors:["count"],xScaleType:oe.ScaleType.Linear,yScaleType:oe.ScaleType.Linear})))}if(e.topValues&&e.topValues.buckets.length){const t=e.topValues.buckets.some((t=>!Number.isInteger(t.count/e.sampledValues)));return S(Object(E.jsx)("div",{"data-test-subj":"lnsFieldListPanel-topValues"},e.topValues.buckets.map((n=>{const a=T.convert(n.key);return Object(E.jsx)("div",{className:"lnsFieldItem__topValue",key:n.key},Object(E.jsx)(F.EuiFlexGroup,{alignItems:"stretch",key:n.key,gutterSize:"xs",responsive:!1},Object(E.jsx)(F.EuiFlexItem,{grow:!0,className:"eui-textTruncate"},""===a?Object(E.jsx)(F.EuiText,{size:"xs",color:"subdued"},Object(E.jsx)("em",null,_.i18n.translate("xpack.lens.indexPattern.fieldPanelEmptyStringValue",{defaultMessage:"Empty string"}))):Object(E.jsx)(F.EuiToolTip,{content:a,delay:"long"},Object(E.jsx)(F.EuiText,{size:"xs",color:"subdued",className:"eui-textTruncate"},a))),Object(E.jsx)(F.EuiFlexItem,{grow:!1},Object(E.jsx)(F.EuiText,{size:"xs",textAlign:"left",color:"accent"},(Math.round(n.count/e.sampledValues*1e3)/10).toFixed(t?1:0),"%"))),Object(E.jsx)(F.EuiProgress,{className:"lnsFieldItem__topValueProgress",value:n.count/e.sampledValues,max:1,size:"s",color:"accent"}))})),O?Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(F.EuiFlexGroup,{alignItems:"stretch",gutterSize:"xs",responsive:!1},Object(E.jsx)(F.EuiFlexItem,{grow:!0,className:"eui-textTruncate"},Object(E.jsx)(F.EuiText,{size:"xs",className:"eui-textTruncate",color:"subdued"},_.i18n.translate("xpack.lens.indexPattern.otherDocsLabel",{defaultMessage:"Other"}))),Object(E.jsx)(F.EuiFlexItem,{grow:!1,className:"eui-textTruncate"},Object(E.jsx)(F.EuiText,{size:"xs",color:"subdued"},(Math.round(O/e.sampledValues*1e3)/10).toFixed(t?1:0),"%"))),Object(E.jsx)(F.EuiProgress,{className:"lnsFieldItem__topValueProgress",value:O/e.sampledValues,max:1,size:"s",color:"subdued"})):Object(E.jsx)(v.a.Fragment,null)))}return Object(E.jsx)(v.a.Fragment,null)}const lc=({field:e,dropOntoWorkspace:t,isEnabled:n})=>{const a=n?_.i18n.translate("xpack.lens.indexPattern.moveToWorkspace",{defaultMessage:"Add {field} to workspace",values:{field:e.field.name}}):_.i18n.translate("xpack.lens.indexPattern.moveToWorkspaceDisabled",{defaultMessage:"This field can't be added to the workspace automatically. You can still use it directly in the configuration panel."});return Object(E.jsx)(F.EuiFlexItem,{grow:!1},Object(E.jsx)(F.EuiToolTip,{content:a},Object(E.jsx)(F.EuiButtonIcon,{"aria-label":a,isDisabled:!n,iconType:"plusInCircle",onClick:()=>{t(e)}})))},oc=_.i18n.translate("xpack.lens.indexPatterns.noDataLabel",{defaultMessage:"There are no fields."}),uc=({existFieldsInIndex:e,defaultNoFieldsMessage:t=oc,isAffectedByFieldFilter:n=!1,isAffectedByTimerange:a=!1,isAffectedByGlobalFilter:i=!1})=>e?Object(E.jsx)(F.EuiCallOut,{size:"s",color:"warning",title:n?_.i18n.translate("xpack.lens.indexPatterns.noFilteredFieldsLabel",{defaultMessage:"No fields match the selected filters."}):t},(a||n||i)&&Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)("strong",null,_.i18n.translate("xpack.lens.indexPatterns.noFields.tryText",{defaultMessage:"Try:"})),Object(E.jsx)("ul",null,a&&Object(E.jsx)("li",null,_.i18n.translate("xpack.lens.indexPatterns.noFields.extendTimeBullet",{defaultMessage:"Extending the time range"})),n&&Object(E.jsx)("li",null,_.i18n.translate("xpack.lens.indexPatterns.noFields.fieldTypeFilterBullet",{defaultMessage:"Using different field filters"})),i&&Object(E.jsx)("li",null,_.i18n.translate("xpack.lens.indexPatterns.noFields.globalFiltersBullet",{defaultMessage:"Changing the global filters"}))))):Object(E.jsx)(F.EuiCallOut,{size:"s",color:"warning",title:_.i18n.translate("xpack.lens.indexPatterns.noFieldsLabel",{defaultMessage:"No fields exist in this index pattern."})}),cc=Object(h.memo)((function({initialIsOpen:e,onToggle:t,id:n,label:a,helpTooltip:i,hasLoaded:r,fieldsCount:s,isFiltered:l,paginatedFields:o,fieldProps:u,renderCallout:c,exists:d,hideDetails:p,showExistenceFetchError:m,showExistenceFetchTimeout:g,groupIndex:f,dropOntoWorkspace:b,hasSuggestionForField:v,editField:y,removeField:j,uiActions:O}){const k=Object(h.useCallback)(((e,t)=>Object(E.jsx)(ic,x()({},u,{key:e.name,field:e,exists:d(e),hideDetails:p,itemIndex:t,groupIndex:f,dropOntoWorkspace:b,hasSuggestionForField:v,editField:y,removeField:j,uiActions:O}))),[u,d,p,b,v,f,y,j,O]),I=Object(h.useMemo)((()=>{const e=T()({lnsInnerIndexPatternDataPanel__titleTooltip:!!i});return Object(E.jsx)(F.EuiText,{size:"xs"},Object(E.jsx)("strong",{className:e},a),!!i&&Object(E.jsx)(F.EuiIconTip,{"aria-label":i,type:"questionInCircle",color:"subdued",size:"s",position:"right",content:i,iconProps:{className:"eui-alignTop"}}))}),[a,i]),w=Object(h.useMemo)((()=>m?Object(E.jsx)(F.EuiIconTip,{"aria-label":_.i18n.translate("xpack.lens.indexPattern.existenceErrorAriaLabel",{defaultMessage:"Existence fetch failed"}),type:"alert",color:"warning",content:_.i18n.translate("xpack.lens.indexPattern.existenceErrorLabel",{defaultMessage:"Field information can't be loaded"})}):g?Object(E.jsx)(F.EuiIconTip,{"aria-label":_.i18n.translate("xpack.lens.indexPattern.existenceTimeoutAriaLabel",{defaultMessage:"Existence fetch timed out"}),type:"clock",color:"warning",content:_.i18n.translate("xpack.lens.indexPattern.existenceTimeoutLabel",{defaultMessage:"Field information took too long"})}):r?Object(E.jsx)(F.EuiNotificationBadge,{size:"m",color:l?"accent":"subdued"},s):Object(E.jsx)(F.EuiLoadingSpinner,{size:"m"})),[m,g,r,l,s]);return Object(E.jsx)(F.EuiAccordion,{initialIsOpen:e,onToggle:t,"data-test-subj":n,id:n,buttonContent:I,extraAction:w},Object(E.jsx)(F.EuiSpacer,{size:"s"}),r&&(s?Object(E.jsx)("ul",{className:"lnsInnerIndexPatternDataPanel__fieldItems"},o&&o.map(k)):c))}));function dc(e,t){return Object.entries(e).filter((([e])=>t[e])).reduce(((e,[,{fields:t}])=>e+t.length),0)}const pc=v.a.memo((function({exists:e,fieldGroups:t,existenceFetchFailed:n,existenceFetchTimeout:a,fieldProps:i,hasSyncedExistingFields:r,filter:s,currentIndexPatternId:l,existFieldsInIndex:o,dropOntoWorkspace:u,hasSuggestionForField:c,editField:d,removeField:p,uiActions:m}){const[g,f]=Object(h.useState)(50),[b,v]=Object(h.useState)(void 0),[y,j]=Object(h.useState)((()=>Object.fromEntries(Object.entries(t).filter((([,{showInAccordion:e}])=>e)).map((([e,{isInitiallyOpen:t}])=>[e,t])))));Object(h.useEffect)((()=>{b&&(b.scrollTop=0,f(50))}),[s.nameFilter,s.typeFilter,l,b]);const _=Object(h.useCallback)((()=>{if(b){b.scrollTop+b.clientHeight>.9*b.scrollHeight&&f(Math.max(50,Math.min(g+25,dc(t,y))))}}),[b,g,f,t,y]),O=Object(h.useMemo)((()=>{let e=g;return Object.fromEntries(Object.entries(t).filter((([,{showInAccordion:e}])=>e)).map((([t,n])=>{if(!y[t]||e<=0)return[t,[]];const a=n.fields.slice(0,e);return e-=a.length,[t,a]})))}),[g,t,y]);return Object(E.jsx)("div",{className:"lnsIndexPatternFieldList",ref:e=>{e&&!e.dataset.dynamicScroll&&(e.dataset.dynamicScroll="true",v(e))},onScroll:Object(Z.throttle)(_,100)},Object(E.jsx)("div",{className:"lnsIndexPatternFieldList__accordionContainer"},Object(E.jsx)("ul",null,Object.entries(t).filter((([,{showInAccordion:e}])=>!e)).flatMap((([,{fields:t}])=>t.map(((t,n)=>Object(E.jsx)(ic,x()({},i,{exists:e(t),field:t,editField:d,removeField:p,hideDetails:!0,key:t.name,itemIndex:n,groupIndex:0,dropOntoWorkspace:u,hasSuggestionForField:c,uiActions:m}))))))),Object(E.jsx)(F.EuiSpacer,{size:"s"}),Object.entries(t).filter((([,{showInAccordion:e}])=>e)).map((([s,l],b)=>Object(E.jsx)(h.Fragment,{key:s},Object(E.jsx)(cc,{dropOntoWorkspace:u,hasSuggestionForField:c,initialIsOpen:Boolean(y[s]),key:s,id:`lnsIndexPattern${s}`,label:l.title,helpTooltip:l.helpText,exists:e,editField:d,removeField:p,hideDetails:l.hideDetails,hasLoaded:!!r,fieldsCount:l.fields.length,isFiltered:l.fieldCount!==l.fields.length,paginatedFields:O[s],fieldProps:i,groupIndex:b+1,onToggle:e=>{j((t=>({...t,[s]:e})));const n=dc(t,{...y,[s]:e});f(Math.max(50,Math.min(1.5*g,n)))},showExistenceFetchError:n,showExistenceFetchTimeout:a,renderCallout:Object(E.jsx)(uc,{isAffectedByGlobalFilter:l.isAffectedByGlobalFilter,isAffectedByTimerange:l.isAffectedByTimeFilter,isAffectedByFieldFilter:l.fieldCount!==l.fields.length,existFieldsInIndex:!!o,defaultNoFieldsMessage:l.defaultNoFieldsMessage}),uiActions:m}),Object(E.jsx)(F.EuiSpacer,{size:"m"}))))))}));function mc(e,t){return e.displayName.localeCompare(t.displayName,void 0,{sensitivity:"base"})}const gc=new Set(["string","number","boolean","date","ip","number_range","date_range","ip_range","histogram","document","geo_point","geo_shape"]),fc={document:_.i18n.translate("xpack.lens.datatypes.record",{defaultMessage:"record"}),string:_.i18n.translate("xpack.lens.datatypes.string",{defaultMessage:"string"}),number:_.i18n.translate("xpack.lens.datatypes.number",{defaultMessage:"number"}),boolean:_.i18n.translate("xpack.lens.datatypes.boolean",{defaultMessage:"boolean"}),date:_.i18n.translate("xpack.lens.datatypes.date",{defaultMessage:"date"}),ip:_.i18n.translate("xpack.lens.datatypes.ipAddress",{defaultMessage:"IP"}),histogram:_.i18n.translate("xpack.lens.datatypes.histogram",{defaultMessage:"histogram"}),geo_point:_.i18n.translate("xpack.lens.datatypes.geoPoint",{defaultMessage:"geo_point"}),geo_shape:_.i18n.translate("xpack.lens.datatypes.geoShape",{defaultMessage:"geo_shape"})};function bc({setState:e,state:t,dragDropContext:n,core:a,data:i,fieldFormats:r,query:s,filters:l,dateRange:o,changeIndexPattern:u,charts:c,indexPatternFieldEditor:d,showNoDataPopover:p,dropOntoWorkspace:m,hasSuggestionForField:g,uiActions:f}){const{indexPatternRefs:b,indexPatterns:x,currentIndexPatternId:y}=t,j=Object(h.useCallback)((n=>u(n,t,e)),[t,e,u]),k=Object(h.useCallback)((t=>{e((e=>({...e,indexPatterns:{...e.indexPatterns,[t.id]:t}})))}),[e]),I=Object(Z.uniq)(Object.values(t.layers).map((e=>e.indexPatternId)).concat(y)).filter((e=>!!x[e])).sort(((e,t)=>e.localeCompare(t))).map((e=>({id:e,title:x[e].title,timeFieldName:x[e].timeFieldName,fields:x[e].fields,hasRestrictions:x[e].hasRestrictions}))),w=function(e,t,n,a){try{return De.esQuery.buildEsQuery(e,t,n,a)}catch(e){return{bool:{must_not:{match_all:{}}}}}}(x[y],s,l,De.esQuery.getEsQueryConfig(a.uiSettings));return Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)(Qu,{load:()=>{var n;return async function({indexPatterns:e,dateRange:t,fetchJson:n,setState:a,isFirstExistenceFetch:i,currentIndexPatternTitle:r,dslQuery:s,showNoDataPopover:l}){const o=e.map((e=>{if(e.hasRestrictions)return{indexPatternTitle:e.title,existingFieldNames:e.fields.map((e=>e.name))};const a={dslQuery:s,fromDate:t.fromDate,toDate:t.toDate};return e.timeFieldName&&(a.timeFieldName=e.timeFieldName),n(`${$.b}/existing_fields/${e.id}`,{body:JSON.stringify(a)})}));try{const e=await Promise.all(o);if(i){const t=e.find((e=>e.indexPatternTitle===r));t&&0===t.existingFieldNames.length&&l()}a((t=>({...t,isFirstExistenceFetch:!1,existenceFetchFailed:!1,existenceFetchTimeout:!1,existingFields:e.reduce(((e,t)=>(e[t.indexPatternTitle]=Vo(t.existingFieldNames),e)),{...t.existingFields})})))}catch(t){a((n=>{var a,i;return{...n,existenceFetchFailed:408!==(null===(a=t.res)||void 0===a?void 0:a.status),existenceFetchTimeout:408===(null===(i=t.res)||void 0===i?void 0:i.status),existingFields:e.reduce(((e,t)=>(e[t.title]=Vo(t.fields.map((e=>e.name))),e)),{...n.existingFields})}}))}}({dateRange:o,setState:e,isFirstExistenceFetch:t.isFirstExistenceFetch,currentIndexPatternTitle:(null===(n=x[y])||void 0===n?void 0:n.title)||"",showNoDataPopover:p,indexPatterns:I,fetchJson:a.http.post,dslQuery:w})},loadDeps:[s,l,o.fromDate,o.toDate,I.map((e=>`${e.title}:${e.timeFieldName}`)).join(","),t.indexPatterns]}),0===Object.keys(x).length&&0===b.length?Object(E.jsx)(F.EuiFlexGroup,{gutterSize:"m",className:"lnsInnerIndexPatternDataPanel",direction:"column",responsive:!1},Object(E.jsx)(F.EuiFlexItem,{grow:null},Object(E.jsx)(F.EuiCallOut,{"data-test-subj":"indexPattern-no-indexpatterns",title:_.i18n.translate("xpack.lens.indexPattern.noPatternsLabel",{defaultMessage:"No index patterns"}),color:"warning",iconType:"alert"},Object(E.jsx)("p",null,Object(E.jsx)(O.FormattedMessage,{id:"xpack.lens.indexPattern.noPatternsDescription",defaultMessage:"Please create an index pattern or switch to another data source"}))))):Object(E.jsx)(jc,{currentIndexPatternId:y,indexPatternRefs:b,indexPatterns:x,query:s,dateRange:o,filters:l,dragDropContext:n,core:a,data:i,fieldFormats:r,charts:c,indexPatternFieldEditor:d,onChangeIndexPattern:j,onUpdateIndexPattern:k,existingFields:t.existingFields,existenceFetchFailed:t.existenceFetchFailed,existenceFetchTimeout:t.existenceFetchTimeout,dropOntoWorkspace:m,hasSuggestionForField:g,uiActions:f}))}const xc={specialFields:[],availableFields:[],emptyFields:[],metaFields:[]},hc=_.i18n.translate("xpack.lens.indexPatterns.fieldFiltersLabel",{defaultMessage:"Filter by type"}),vc=Object(F.htmlIdGenerator)("datapanel")(),yc=function({currentIndexPatternId:e,indexPatternRefs:t,indexPatterns:n,existenceFetchFailed:a,existenceFetchTimeout:i,query:r,dateRange:s,filters:l,dragDropContext:o,onChangeIndexPattern:u,onUpdateIndexPattern:c,core:d,data:p,fieldFormats:m,indexPatternFieldEditor:g,existingFields:f,charts:b,dropOntoWorkspace:x,hasSuggestionForField:v,uiActions:y}){var j;const[O,k]=Object(h.useState)({nameFilter:"",typeFilter:[],isTypeFilterOpen:!1,isAvailableAccordionOpen:!0,isEmptyAccordionOpen:!1,isMetaAccordionOpen:!1}),I=n[e],w=y.getTrigger(Zu.VISUALIZE_GEO_FIELD_TRIGGER)?I.fields:I.fields.filter((({type:e})=>"geo_point"!==e&&"geo_shape"!==e)),T=()=>k((e=>({...e,nameFilter:"",typeFilter:[]}))),C=f[I.title],M=Object(Z.uniq)(w.map((({type:e})=>e))).filter((e=>e in fc)),P=a||i||I.hasRestrictions,S=g.userPermissions.editIndexPattern(),A=Object(h.useMemo)((()=>{const e=w.filter((e=>gc.has(e.type))).sort(mc),t={...xc,...Object(Z.groupBy)(e,(e=>"document"===e.type?"specialFields":e.meta?"metaFields":(e=>{const t=I.getFieldByName(e.name);return t&&So(f,I.title,t.name)})(e)?"availableFields":"emptyFields"))},n={SpecialFields:{fields:t.specialFields,fieldCount:1,isAffectedByGlobalFilter:!1,isAffectedByTimeFilter:!1,isInitiallyOpen:!1,showInAccordion:!1,title:"",hideDetails:!0},AvailableFields:{fields:t.availableFields,fieldCount:t.availableFields.length,isInitiallyOpen:!0,showInAccordion:!0,title:P?_.i18n.translate("xpack.lens.indexPattern.allFieldsLabel",{defaultMessage:"All fields"}):_.i18n.translate("xpack.lens.indexPattern.availableFieldsLabel",{defaultMessage:"Available fields"}),helpText:_.i18n.translate("xpack.lens.indexPattern.allFieldsLabelHelp",{defaultMessage:"Available fields have data in the first 500 documents that match your filters. To view all fields, expand Empty fields. Some field types cannot be visualized in Lens, including full text and geographic fields."}),isAffectedByGlobalFilter:!!l.length,isAffectedByTimeFilter:!0,hideDetails:P&&!i,defaultNoFieldsMessage:_.i18n.translate("xpack.lens.indexPatterns.noAvailableDataLabel",{defaultMessage:"There are no available fields that contain data."})},EmptyFields:{fields:t.emptyFields,fieldCount:t.emptyFields.length,isAffectedByGlobalFilter:!1,isAffectedByTimeFilter:!1,isInitiallyOpen:!1,showInAccordion:!0,hideDetails:!1,title:_.i18n.translate("xpack.lens.indexPattern.emptyFieldsLabel",{defaultMessage:"Empty fields"}),defaultNoFieldsMessage:_.i18n.translate("xpack.lens.indexPatterns.noEmptyDataLabel",{defaultMessage:"There are no empty fields."}),helpText:_.i18n.translate("xpack.lens.indexPattern.emptyFieldsLabelHelp",{defaultMessage:"Empty fields did not contain any values in the first 500 documents based on your filters."})},MetaFields:{fields:t.metaFields,fieldCount:t.metaFields.length,isAffectedByGlobalFilter:!1,isAffectedByTimeFilter:!1,isInitiallyOpen:!1,showInAccordion:!0,hideDetails:!1,title:_.i18n.translate("xpack.lens.indexPattern.metaFieldsLabel",{defaultMessage:"Meta fields"}),defaultNoFieldsMessage:_.i18n.translate("xpack.lens.indexPatterns.noMetaDataLabel",{defaultMessage:"There are no meta fields."})}};return P&&delete n.EmptyFields,n}),[w,P,l.length,i,I,f]),L=Object(h.useMemo)((()=>Object.fromEntries(Object.entries(A).map((([e,t])=>{return[e,{...t,fields:(n=t.fields,n.filter((e=>!(O.nameFilter.length&&!e.name.toLowerCase().includes(O.nameFilter.toLowerCase())&&!e.displayName.toLowerCase().includes(O.nameFilter.toLowerCase()))&&(!(O.typeFilter.length>0)||O.typeFilter.includes(e.type)))))}];var n})))),[A,O.nameFilter,O.typeFilter]),D=Object(h.useCallback)((e=>"document"===e.type||So(f,I.title,e.name)),[f,I.title]),{nameFilter:N,typeFilter:z}=O,B=Object(h.useMemo)((()=>({nameFilter:N,typeFilter:z})),[N,z]),R=Object(h.useRef)();Object(h.useEffect)((()=>()=>{R.current&&R.current()}),[]);const V=Object(h.useCallback)((async()=>{const e=await Lo({indexPatternsService:p.indexPatterns,cache:{},patterns:[I.id]});c(e[I.id]),p.search.session.start()}),[p,I,c]),H=Object(h.useMemo)((()=>S?async(e,t="edit")=>{Object(at.e)(`open_field_editor_${t}`);const n=await p.indexPatterns.get(I.id);R.current=g.openEditor({ctx:{indexPattern:n},fieldName:e,onSave:async()=>{Object(at.e)(`save_field_${t}`),await V()}})}:void 0),[p,g,I,S,V]),G=Object(h.useMemo)((()=>S?async e=>{Object(at.e)("open_field_delete_modal");const t=await p.indexPatterns.get(I.id);R.current=g.openDeleteModal({ctx:{indexPattern:t},fieldName:e,onDelete:async()=>{Object(at.e)("delete_field"),await V()}})}:void 0),[I.id,p.indexPatterns,S,g,V]),q=Object(h.useMemo)((()=>S&&H?()=>H(void 0,"add"):void 0),[H,S]),W=Object(h.useMemo)((()=>({core:d,data:p,fieldFormats:m,indexPattern:I,highlight:O.nameFilter.toLowerCase(),dateRange:s,query:r,filters:l,chartsThemeService:b.theme})),[d,p,m,I,s,r,l,O.nameFilter,b.theme]),[$,Y]=Object(h.useState)(!1);return Object(E.jsx)(Xu.a,o,Object(E.jsx)(F.EuiFlexGroup,{gutterSize:"none",className:"lnsInnerIndexPatternDataPanel",direction:"column",responsive:!1},Object(E.jsx)(F.EuiFlexItem,{grow:!1},Object(E.jsx)(F.EuiFlexGroup,{gutterSize:"s",alignItems:"center",className:"lnsInnerIndexPatternDataPanel__header",responsive:!1},Object(E.jsx)(F.EuiFlexItem,{grow:!0,className:"lnsInnerIndexPatternDataPanel__switcher"},Object(E.jsx)(Ju,{"data-test-subj":"indexPattern-switcher",trigger:{label:I.title,title:I.title,"data-test-subj":"indexPattern-switch-link",fontWeight:"bold"},indexPatternId:e,indexPatternRefs:t,onChangeIndexPattern:e=>{u(e),T()}})),q&&Object(E.jsx)(F.EuiFlexItem,{grow:!1},Object(E.jsx)(F.EuiPopover,{panelPaddingSize:"s",isOpen:$,closePopover:()=>{Y(!1)},ownFocus:!0,"data-test-subj":"lnsIndexPatternActions-popover",button:Object(E.jsx)(F.EuiButtonIcon,{color:"text",iconType:"boxesHorizontal","data-test-subj":"lnsIndexPatternActions","aria-label":_.i18n.translate("xpack.lens.indexPatterns.actionsPopoverLabel",{defaultMessage:"Index pattern settings"}),onClick:()=>{Y(!$)}})},Object(E.jsx)(F.EuiContextMenuPanel,{size:"s",items:[Object(E.jsx)(F.EuiContextMenuItem,{key:"add",icon:"indexOpen","data-test-subj":"indexPattern-add-field",onClick:()=>{Y(!1),q()}},_.i18n.translate("xpack.lens.indexPatterns.addFieldButton",{defaultMessage:"Add field to index pattern"})),Object(E.jsx)(F.EuiContextMenuItem,{key:"manage",icon:"indexSettings",onClick:()=>{Y(!1),d.application.navigateToApp("management",{path:`/kibana/indexPatterns/patterns/${I.id}`})}},_.i18n.translate("xpack.lens.indexPatterns.manageFieldButton",{defaultMessage:"Manage index pattern fields"}))]}))))),Object(E.jsx)(F.EuiFlexItem,{grow:!1},Object(E.jsx)(F.EuiFormControlLayout,{icon:"search",fullWidth:!0,clear:{title:_.i18n.translate("xpack.lens.indexPatterns.clearFiltersLabel",{defaultMessage:"Clear name and type filters"}),"aria-label":_.i18n.translate("xpack.lens.indexPatterns.clearFiltersLabel",{defaultMessage:"Clear name and type filters"}),onClick:()=>{Object(at.e)("indexpattern_filters_cleared"),T()}}},Object(E.jsx)("input",{className:"euiFieldText euiFieldText--fullWidth lnsInnerIndexPatternDataPanel__textField","data-test-subj":"lnsIndexPatternFieldSearch",placeholder:_.i18n.translate("xpack.lens.indexPatterns.filterByNameLabel",{defaultMessage:"Search field names",description:"Search the list of fields in the index pattern for the provided text"}),value:O.nameFilter,onChange:e=>{k({...O,nameFilter:e.target.value})},"aria-label":_.i18n.translate("xpack.lens.indexPatterns.filterByNameLabel",{defaultMessage:"Search field names",description:"Search the list of fields in the index pattern for the provided text"}),"aria-describedby":vc})),Object(E.jsx)(F.EuiSpacer,{size:"xs"}),Object(E.jsx)(F.EuiFilterGroup,null,Object(E.jsx)(F.EuiPopover,{id:"dataPanelTypeFilter",panelClassName:"euiFilterGroup__popoverPanel",panelPaddingSize:"none",anchorPosition:"rightUp",display:"block",isOpen:O.isTypeFilterOpen,closePopover:()=>k((()=>({...O,isTypeFilterOpen:!1}))),button:Object(E.jsx)(F.EuiFilterButton,{iconType:"arrowDown",isSelected:O.isTypeFilterOpen,numFilters:O.typeFilter.length,hasActiveFilters:!!O.typeFilter.length,numActiveFilters:O.typeFilter.length,"data-test-subj":"lnsIndexPatternFiltersToggle",onClick:()=>{k((e=>({...e,isTypeFilterOpen:!O.isTypeFilterOpen})))}},hc)},Object(E.jsx)(F.EuiContextMenuPanel,{watchedItemProps:["icon","disabled"],"data-test-subj":"lnsIndexPatternTypeFilterOptions",items:M.map((e=>Object(E.jsx)(F.EuiContextMenuItem,{className:"lnsInnerIndexPatternDataPanel__filterType",key:e,icon:O.typeFilter.includes(e)?"check":"empty","data-test-subj":`typeFilter-${e}`,onClick:()=>{Object(at.e)("indexpattern_type_filter_toggled"),k((t=>({...t,typeFilter:O.typeFilter.includes(e)?O.typeFilter.filter((t=>t!==e)):[...O.typeFilter,e]})))}},Object(E.jsx)("span",{className:"lnsInnerIndexPatternDataPanel__filterTypeInner"},Object(E.jsx)(Qo,{type:e})," ",fc[e]))))})))),Object(E.jsx)(F.EuiScreenReaderOnly,null,Object(E.jsx)("div",{"aria-live":"polite",id:vc},_.i18n.translate("xpack.lens.indexPatterns.fieldSearchLiveRegion",{defaultMessage:"{availableFields} available {availableFields, plural, one {field} other {fields}}. {emptyFields} empty {emptyFields, plural, one {field} other {fields}}. {metaFields} meta {metaFields, plural, one {field} other {fields}}.",values:{availableFields:L.AvailableFields.fields.length,emptyFields:(null===(j=L.EmptyFields)||void 0===j?void 0:j.fields.length)||0,metaFields:L.MetaFields.fields.length}}))),Object(E.jsx)(F.EuiFlexItem,null,Object(E.jsx)(pc,{exists:D,fieldProps:W,fieldGroups:L,hasSyncedExistingFields:!!C,filter:B,currentIndexPatternId:e,existenceFetchFailed:a,existenceFetchTimeout:i,existFieldsInIndex:!!w.length,dropOntoWorkspace:x,hasSuggestionForField:v,editField:H,removeField:G,uiActions:y}))))},jc=Object(h.memo)(yc);function _c({state:e,updatedLayer:t,layerId:n,label:a,changeType:i}){const r=t?{...e,layers:{...e.layers,[n]:t}}:e,s=Object(Z.mapValues)(r.layers,(e=>({...e,columns:Object(Z.pick)(e.columns,e.columnOrder)}))),l=s[n].columnOrder,o=s[n].columns,u=Object.values(o).some((e=>e.isBucketed));return{state:{...r,layers:s},table:{columns:l.filter((e=>!$i(s[n],e))).map((e=>({columnId:e,operation:Nc(o[e])}))),isMultiRow:u,layerId:n,changeType:i,label:a},keptLayerIds:Object.keys(e.layers)}}function Oc(e,t,n,a){let i=Object.keys(e.layers).filter((n=>e.layers[n].indexPatternId===t));if(a&&(i=i.filter(a)),0===i.length){const a=Object(xn.a)();return Fc(e,a,t,n).concat(Fc({...e,layers:{}},a,t,n))}{const a=Object(Z.minBy)(i,(t=>e.layers[t].columnOrder.length));return 0===e.layers[a].columnOrder.length?Fc(e,a,t,n):function(e,t,n){const a=e.layers[t],i=e.indexPatterns[a.indexPatternId],r=Co(n),s=Ic(n),l=Object.values(a.columns).some((e=>Wo(e)&&e.sourceField===n.name)),o=[];if(s&&!l)if("date_histogram"===s&&a.columnOrder.some((e=>"date_histogram"===a.columns[e].operationType))){const r=a.columnOrder.find((e=>"date_histogram"===a.columns[e].operationType));o.push(_c({state:e,updatedLayer:Mi({layer:a,indexPattern:i,field:n,op:s,columnId:r,visualizationGroups:[]}),layerId:t,changeType:"initial"}))}else o.push(_c({state:e,updatedLayer:Ci({layer:a,indexPattern:i,field:n,op:s,columnId:Object(xn.a)(),visualizationGroups:[]}),layerId:t,changeType:"extended"}));if(!s&&r.length>0&&!l){const[r]=zi(n);if(r){const s=Ci({layer:a,indexPattern:i,field:n,columnId:Object(xn.a)(),op:r.type,visualizationGroups:[]});s&&o.push(_c({state:e,layerId:t,updatedLayer:s,changeType:"extended"}));const[,l,u]=Gi(a);if(1===l.length&&0===u.length){const s=Mi({layer:a,indexPattern:i,field:n,columnId:l[0],op:r.type,visualizationGroups:[]});s&&o.push(_c({state:e,layerId:t,updatedLayer:s,changeType:"extended"}))}}}if(!l){const a=Tc(i,t,e,n);a&&o.push(a)}return o}(e,a,n)}}function kc(e,t,n){const a=Object.keys(e.layers).filter((n=>e.layers[n].indexPatternId===t)),i=e.indexPatterns[t].getFieldByName(n);if(0!==a.length||!i)return[];const r=Object(xn.a)();return Fc(e,r,t,i).concat(Fc({...e,layers:{}},r,t,i))}function Ic(e){if("number"!==e.type)return Co(e).find((e=>"date_histogram"===e||"terms"===e))}function Fc(e,t,n,a){const i=e.indexPatterns[n];let r;const s=Ic(a);s?r=function(e,t,n){return Ci({op:n,layer:Ci({op:"count",layer:{indexPatternId:e.id,columns:{},columnOrder:[]},columnId:Object(xn.a)(),field:oi,indexPattern:e,visualizationGroups:[]}),columnId:Object(xn.a)(),field:t,indexPattern:e,visualizationGroups:[]})}(i,a,s):i.timeFieldName&&Co(a).length>0&&(r=function(e,t){const n=e.getFieldByName(e.timeFieldName),[a]=zi(t);if(!a)return;return Ci({op:"date_histogram",layer:Ci({op:a.type,layer:{indexPatternId:e.id,columns:{},columnOrder:[]},columnId:Object(xn.a)(),field:t,indexPattern:e,visualizationGroups:[]}),columnId:Object(xn.a)(),field:n,indexPattern:e,visualizationGroups:[]})}(i,a));const l=r?[_c({state:e,updatedLayer:r,layerId:t,changeType:"initial"})]:[],o=Tc(i,t,e,a);return o?l.concat(o):l}function wc(e,t=(()=>!0)){const n=Object.entries(e.layers||{}).filter((([e])=>t(e)));return n.length>1?n.map((([t,a],i)=>{const r=n.some((([e,n])=>e!==t&&n.indexPatternId===a.indexPatternId))?_.i18n.translate("xpack.lens.indexPatternSuggestion.removeLayerPositionLabel",{defaultMessage:"Show only layer {layerNumber}",values:{layerNumber:i+1}}):_.i18n.translate("xpack.lens.indexPatternSuggestion.removeLayerLabel",{defaultMessage:"Show only {indexPatternTitle}",values:{indexPatternTitle:e.indexPatterns[a.indexPatternId].title}});return _c({state:{...e,layers:{[t]:a}},layerId:t,changeType:"layers",label:r})})).concat([_c({state:e,layerId:n[0][0],changeType:"unchanged"})]):Object(Z.flatten)(n.filter((([e,t])=>t.columnOrder.length&&t.indexPatternId)).map((([t,n])=>{const a=e.indexPatterns[n.indexPatternId],[i,r,s]=Gi(n),l=n.columnOrder.find((e=>n.columns[e].isBucketed&&"date"===n.columns[e].dataType)),o=(null==a?void 0:a.timeFieldName)&&a.getFieldByName(a.timeFieldName),u=1===i.length&&i.some((e=>"number"===n.columns[e].dataType)),c=[];return c.push(_c({state:e,layerId:t,changeType:"unchanged"})),!s.length&&r.length&&0===i.length?(o&&i.length<1&&!Ki(n)&&c.push(Cc(e,t,o)),a&&c.push(...function(e,t,n){const a=n.layers[t],i=[],r=a.columnOrder.filter((e=>!$i(a,e)));return r.forEach((r=>{const s=a.columns[r];if(!Wo(s))return;const l=e.getFieldByName(s.sourceField);if(!l)return;const o=zi(l).filter((({type:e})=>e!==s.operationType));if(o.length){const s=Mi({layer:a,indexPattern:e,field:l,columnId:r,op:o[0].type,visualizationGroups:[]});s&&i.push(_c({state:n,layerId:t,updatedLayer:s,changeType:"initial"}))}})),i}(a,t,e))):(c.push(...function(e,t){const n=e.layers[t],[a,i]=Object(Z.partition)(n.columnOrder,(e=>n.columns[e].isBucketed)),r=i.filter((e=>!$i(n,e)));return Object(Z.flatten)(a.map(((e,t)=>{const s=a.slice(0,t+1),l={...n,columnOrder:[...s,...i],noBuckets:!1};return a.length<=1?[]:r.length>1?[{...n,columnOrder:[...s,r[0],...Yi(n,r[0])],noBuckets:!1}]:l}))).concat(a.length>0||r.length>1?r.map((e=>({...n,columnOrder:[e,...Yi(n,e)],noBuckets:!0}))):[]).map((({noBuckets:n,...a})=>_c({state:e,layerId:t,updatedLayer:a,changeType:"reduced",label:n?Mc(a,1===i.length):void 0})))}(e,t)),!l&&o&&i.length<2&&!u&&!Ki(n)&&c.push(Cc(e,t,o)),2===i.length&&c.push(function(e,t){var n,a;const i=e.layers[t],[r,s,...l]=i.columnOrder,o={...i,columnOrder:[s,r,...l]},u=e.indexPatterns[e.currentIndexPatternId],c=i.columns[r],d=Wo(c)&&(null===(n=u.getFieldByName(c.sourceField))||void 0===n?void 0:n.displayName)||"",p=i.columns[s],m=Wo(p)&&(null===(a=u.getFieldByName(p.sourceField))||void 0===a?void 0:a.displayName)||"";return _c({state:e,layerId:t,updatedLayer:o,label:Ec([m,d]),changeType:"reorder"})}(e,t))),c})))}function Tc(e,t,n,a){const[i]=zi(a);if(i)return _c({layerId:t,state:n,changeType:"initial",updatedLayer:Ci({layer:{indexPatternId:e.id,columns:{},columnOrder:[]},columnId:Object(xn.a)(),op:i.type,field:"count"===i.type?oi:a,indexPattern:e,visualizationGroups:[]})})}function Ec([e,t]){return _.i18n.translate("xpack.lens.indexpattern.suggestions.nestingChangeLabel",{defaultMessage:"{innerOperation} for each {outerOperation}",values:{innerOperation:t,outerOperation:e}})}function Cc(e,t,n){const a=e.layers[t];return _c({state:e,layerId:t,updatedLayer:Ci({layer:a,indexPattern:e.indexPatterns[a.indexPatternId],field:n,op:"date_histogram",columnId:Object(xn.a)(),visualizationGroups:[]}),label:_.i18n.translate("xpack.lens.indexpattern.suggestions.overTimeLabel",{defaultMessage:"Over time"}),changeType:"extended"})}function Mc(e,t){const{operationType:n,label:a}=e.columns[e.columnOrder[0]];return _.i18n.translate("xpack.lens.indexpattern.suggestions.overallLabel",{defaultMessage:"{operation} overall",values:{operation:t?Fo[n].displayName:a},description:"Title of a suggested chart containing only a single numerical metric calculated over all available data"})}function Pc({state:e,layerId:t,onChangeIndexPattern:n}){const a=e.layers[t],i=e.indexPatterns[a.indexPatternId],r=_.i18n.translate("xpack.lens.layerPanel.missingIndexPattern",{defaultMessage:"Index pattern not found"});return Object(E.jsx)(O.I18nProvider,null,Object(E.jsx)(Ju,{"data-test-subj":"indexPattern-switcher",trigger:{label:(null==i?void 0:i.title)||r,title:(null==i?void 0:i.title)||r,"data-test-subj":"lns_layerIndexPatternLabel",size:"s",fontWeight:"normal"},indexPatternId:a.indexPatternId,indexPatternRefs:e.indexPatternRefs,isMissingCurrent:!i,onChangeIndexPattern:n}))}const Sc=({title:e,titleId:t,...n})=>Object(E.jsx)("svg",{width:"176",height:"176",viewBox:"0 0 176 176",xmlns:"http://www.w3.org/2000/svg"},Object(E.jsx)("path",{d:"M88 152c35.346 0 64-28.654 64-64 0-13.35-4.087-25.745-11.079-36.002L51.998 140.92C62.255 147.913 74.65 152 88 152zm-58.277-.083l-5.64-5.64 15.93-15.929C30.047 119.064 24 104.238 24 88c0-35.346 28.654-64 64-64 16.238 0 31.064 6.047 42.348 16.013l15.929-15.93 5.64 5.64L29.723 151.917z",fill:"#F9B110"}),Object(E.jsx)("path",{d:"M87.992 151.961h-2.248a76.025 76.025 0 01-.679-.027v-36.978h-7.102l5.87-5.869h1.232v-1.233L90.92 102v7.087h28.52a121.923 121.923 0 001.806-21.048 122.722 122.722 0 00-.951-15.414l10.102-10.102H146.7a67.977 67.977 0 012.211 5.869h-23.228a132.499 132.499 0 011.432 19.647 132.001 132.001 0 01-1.65 21.048h22.963a64.832 64.832 0 01-2.366 5.838h-21.687c-2.957 13.793-8.126 25.36-14.758 33.315a63.132 63.132 0 01-4.943 1.567 63.66 63.66 0 01-7.399 1.526c9.248-5.54 16.955-19.087 20.982-36.377H90.919v36.979c-.22.01-.442.018-.663.026h-2.264zm35.642-93.956l-10.387 10.387 10.387-10.386zM90.919 90.721l-5.854 5.853 5.854-5.854zm0-11.28l-5.854 5.854V68.392h-28.77a122.988 122.988 0 00.25 40.695h4.728l-8.941 8.941a111.251 111.251 0 01-.707-3.072H29.94l-.22-.509c-.755-1.75-1.523-3.529-2.162-5.36H50.52a132.014 132.014 0 01-1.65-21.017 134.648 134.648 0 011.432-19.647H27.09a67.9 67.9 0 012.21-5.869h21.967c2.88-14.4 8.173-26.497 15.039-34.732a64.165 64.165 0 0112.454-3.114c-9.527 5.683-17.42 19.834-21.344 37.815h27.68V24.117c.966-.078 1.93-.078 2.912-.078.492 0 .98.02 1.467.039.483.02.963.039 1.444.039v38.375h16.949l-5.9 5.9h-11.05v11.049zm25.363-25.363l4.804-4.804c-2.947-8.592-6.862-15.903-11.486-21.483a64.417 64.417 0 00-12.454-3.114c7.985 4.762 14.822 15.473 19.136 29.401zM54.881 126.76l4.74-4.74-4.74 4.74zm11.802-11.803l5.87-5.869-5.87 5.869zm-4.036 15.316l-4.551 4.551c2.385 5.173 5.168 9.702 8.271 13.429a63.532 63.532 0 0012.27 3.068c-6.257-3.801-11.806-11.256-15.99-21.048z",fill:"#FEC514"}),Object(E.jsx)("path",{d:"M115.909 138.807c.444-.825.878-1.669 1.299-2.534a1.56 1.56 0 011.223.823c.156.498-.732 1.868-1.401 2.055a1.381 1.381 0 01-1.121-.344zm-5.488-2.505c-.226.416-.455.826-.687 1.23a5.47 5.47 0 01-1.048.171 1.03 1.03 0 01-.826-.342 1.284 1.284 0 010-1.043c.172-.249.701-.514.919-.421.439.311.975.454 1.51.405h.132zm3.41-7.241l-.084.207c-.191.429-.39.896-.578 1.352a.959.959 0 01-.293-.295.958.958 0 01-.143-.39.764.764 0 01.623-.872c.156-.038.319-.039.475-.002zm-28.766 20.867v2.004c-.352-.013-.705-.044-1.057-.074-.464-.04-.928-.08-1.392-.081l-.02-.002c.377-.244.81-.388 1.259-.419a1.83 1.83 0 01.902.125.99.99 0 01-.124-.296 1.715 1.715 0 01.432-1.257zm0-4.223v3.069a1.278 1.278 0 01-.12-.578v-.654a2.033 2.033 0 01-2.149.28 8.458 8.458 0 01-1.697-1.463 1.323 1.323 0 01.39-2.179 2.57 2.57 0 01-1.075-.779 2.03 2.03 0 01-.234.67c-.128.235-.31.437-.529.591-.273.225-.6.376-.95.436.078.027.15.064.219.109a1.402 1.402 0 01.155 1.884 1.438 1.438 0 01-.94.79 1.424 1.424 0 01-1.208-.23 1.415 1.415 0 01-.639-1.79 2.202 2.202 0 011.557-.825l-.249-.109a2.45 2.45 0 01-1.183-1.464c-.327-.327-.576-.685-.483-.856.183-.217.42-.383.685-.482.67-1.075 1.293-1.23 2.647-.576.431.189.79.511 1.028.918a2.477 2.477 0 011.043-1.728 14.152 14.152 0 011.946-.483c-.032-.669.373-1.058 1.198-1.058h.094a.682.682 0 01.494-.11v1.56a.449.449 0 01-.541-.002c-.348.373-.329.766-.307 1.21.005.112.011.227.011.346a2.085 2.085 0 01-1.043 2.024c.717.367 1.355.87 1.88 1.479zm0-3.296v.909a1.091 1.091 0 01-.136-.259.718.718 0 01.136-.65zm0-7.629v2.477a1.282 1.282 0 01-.875.557 1.276 1.276 0 01-1.005-.282 1.247 1.247 0 01-.545-1.759 2.208 2.208 0 012.289-.856l.136-.137zM65.94 147.731c.142.176.284.349.427.521a67.88 67.88 0 01-.447-.163v-.22c0-.037.011-.096.02-.138zm-5.292-7.889c.449.801.908 1.582 1.378 2.341a1.427 1.427 0 01-.325-.105 1.154 1.154 0 01-.81-.42.86.86 0 010-.296 1.87 1.87 0 01-.243-1.52zm-1.22-2.279c.247.485.5.963.755 1.435a.851.851 0 01-.413.569.85.85 0 01-.746.051 5.625 5.625 0 00-.7-.171 2.195 2.195 0 01-1.309 2.335 2.055 2.055 0 01-2.382-1.074v-.234a1.551 1.551 0 01-.778-.155 1.871 1.871 0 01-.716 1.323 62.51 62.51 0 01-1.112-.75l4.416-4.417a1.727 1.727 0 011.18.294 1.786 1.786 0 001.804.794zm-1.184-2.421c.125.269.251.535.379.8a1.056 1.056 0 01-.379-.8zm-13.376-9.65l-.904.904a.94.94 0 01.255-.54.76.76 0 01.65-.364zm2.423-2.423l-.1.099a.38.38 0 00-.077-.099h.177zm-16.669-8.113h4.681a.946.946 0 01-.005.127c-.23.447-.597.517-.97.588a5.091 5.091 0 00-.244.05l-.436.109h.109a2.026 2.026 0 011.557 1.464h.187a1.076 1.076 0 011.276.794 1.119 1.119 0 01-.685 1.354.981.981 0 01-1.152-.56 2.466 2.466 0 01-1.946.934 1.738 1.738 0 01-.723-.324 62.044 62.044 0 01-.78-1.42 3.119 3.119 0 01.009-.701 1.56 1.56 0 01.56-1.152 1.992 1.992 0 01-1.438-1.263zm48.905 35.918c.048.187.048.383.001.57a15.906 15.906 0 01-.217-.029l-.656-.105c-.292-.175-.584-.377-.876-.578l-.107-.074-.185-.127c.129-.249.323-.459.56-.607a1.017 1.017 0 010-.763 1.424 1.424 0 011.044-.716 1.082 1.082 0 011.122.95 1.09 1.09 0 01-.064.529 1.23 1.23 0 01-.653.561c.031.127.042.258.03.389zm-17.312-4.437c.01.053.014.108.012.162a63.978 63.978 0 01-6.015-3.039c.159-.192.366-.339.601-.423a3.55 3.55 0 011.059-.576c.421-.141.763.021 1.118.188.275.13.557.263.89.263a2.281 2.281 0 011.76.841c.309.4.468.895.45 1.401a4.07 4.07 0 010 .747c.055.141.097.287.125.436zm29.171 5.475a64.518 64.518 0 003.223-.249 1.388 1.388 0 00-1.133-.618 5.86 5.86 0 00-1.277.016c.228-.447.294-.959.187-1.448a1.852 1.852 0 00-1.463-1.355v3.659c.154 0 .309-.002.463-.005zm25.699-6.887c.331-.17.661-.342.989-.517l.139-.079c.074-.174.121-.358.14-.545a1.67 1.67 0 00-.576-1.479 4.637 4.637 0 01-.44-.319h-.001c-.337-.265-.656-.516-1.007-.428a1.035 1.035 0 00-.747.544c-.041.066-.09.127-.141.19-.143.177-.299.369-.31.713a2.223 2.223 0 00.747 1.806c.229.17.496.282.778.327l.228-.113.201-.1zm-72.85-92.93a1.65 1.65 0 00-1.558-2.896 1.697 1.697 0 00-.654 2.304 1.76 1.76 0 002.211.592zM38.77 55.8a2.07 2.07 0 00.98-2.522 1.977 1.977 0 00-2.428-1.12 2.008 2.008 0 00-1.417 2.303 2.6 2.6 0 002.865 1.34zm4.24-2.034c.115-.084.245-.144.383-.176a1.557 1.557 0 011.915.716 1.23 1.23 0 01-.7 1.556 1.774 1.774 0 01-1.993-.965 1.06 1.06 0 01.395-1.13zm-5.813 4.39a1.09 1.09 0 01.747-.13c.883.073.878.723.873 1.377v.149c1.82.14 2.226.42 2.226 1.323a2.322 2.322 0 01-1.106 1.635h-1.292a2.429 2.429 0 01-.7-2.008 13.872 13.872 0 00-.46-.39c-.275-.23-.539-.449-.77-.7a.825.825 0 010-.67 1.09 1.09 0 01.482-.586zm-6.4 13.32a.903.903 0 01.31-.311.951.951 0 011.292.685.638.638 0 010 .265c.087-.11.186-.21.296-.296a.606.606 0 01.856.171c.438.015.864.15 1.23.39a1.246 1.246 0 01.374 1.556 1.853 1.853 0 01-1.868.654 1.853 1.853 0 01-.748-1.37 1.168 1.168 0 01-.498-.607.778.778 0 01-.84.109 1.12 1.12 0 01-.53-.825.904.904 0 01.127-.42zm9.3 11.502c.233 0 .529-.265.575-.498.047-.234-.155-.608-.435-.623a.544.544 0 00-.577.39.81.81 0 00.436.73zm-.05 14.544c.186-.389.824-.436 1.65-.124a.795.795 0 01.576 1.105c-.28.483-1.168.919-1.557.732a1.774 1.774 0 01-.67-1.713zm2.163 8.672c.42-.281.903.015 1.043.529.11.374.14.732-.327.919a1.057 1.057 0 01-1.166-.312 1.073 1.073 0 01-.204-.373 3.21 3.21 0 01.654-.763zm31.225 18.686a1.095 1.095 0 01-.494.073.751.751 0 01-.434-.522.765.765 0 01.154-.661c.218-.187.888-.576 1.183-.358.296.218.156.965 0 1.183a1.093 1.093 0 01-.409.285zm.705 8.106a1.695 1.695 0 00-.514-2.024.948.948 0 00-1.338.343 1.462 1.462 0 00.218 1.915 1.18 1.18 0 001.634-.234zm.39-1.93a1.425 1.425 0 001.147.149 1.417 1.417 0 00.876-.756 1.714 1.714 0 00-.296-2.18 2.056 2.056 0 00-2.241.638 1.419 1.419 0 00.513 2.149zm-34.748-25.407c-.094.031-.327.062-.42-.125a.31.31 0 01.077-.42c.09-.045.164.015.245.082a.93.93 0 00.098.074c.124.077.093.358 0 .389zm.794-3.425c-.748-.561-1.261-.436-1.869.42-.607.856-.529 1.557 0 1.868a2.453 2.453 0 002.335-.342 1.387 1.387 0 00-.466-1.946zm26.805 26.793a2 2 0 01-.028 1.229c-.312.561-1.417.576-2.382-.062a1.353 1.353 0 01-.28-1.557 1.871 1.871 0 011.992-.623c.334.256.578.61.698 1.013zm4.33-2.196a1.56 1.56 0 00-.856-.171c.14-.257.183-.555.125-.841a1.886 1.886 0 00-2.024-1.183c-.592.14-1.043 1.214-.856 2.024a1.381 1.381 0 001.074 1.074 1.56 1.56 0 00.856 1.557c.654.389 1.355.109 1.868-.732a1.165 1.165 0 00-.186-1.728zm2.602 8.123c-.066.169-.134.346-.235.346-.203.031-.732.031-.794-.233-.062-.265.327-.592.451-.592.234.059.456.159.654.296-.026.052-.05.117-.076.183zM37.789 94.876c.156-.607.498-1.121 1.23-.934.733.198.657.846.58 1.502l-.004.039c-.27.135-.572.19-.872.156.031.31-.047 1.074-.374 1.183-.326.109-.871-.436-.965-.685a1.058 1.058 0 01.218-.934.56.56 0 01.327-.125c-.054-.062-.1-.13-.14-.202zm.47-5.461a.902.902 0 00.171 1.354 1.106 1.106 0 001.557-.124 1.043 1.043 0 00-.327-1.464.935.935 0 00-1.4.234zm45.032 41.572a.693.693 0 01.252-.258.628.628 0 01.607.264c.041.124-.026.281-.108.472a3.526 3.526 0 00-.125.322c-.106-.06-.219-.111-.322-.158-.216-.097-.394-.177-.394-.293a.698.698 0 01.09-.349zm.377-5.24a.704.704 0 00-.847-.192.704.704 0 00-.243.192c-.327.405-.311 1.199.125 1.339.435.14 1.23.327 1.556-.14.29-.414-.204-.853-.493-1.11l-.064-.058a.704.704 0 01-.034-.031zm9.512 1.51c.607-.202 1.666.218 1.448 1.074a2.55 2.55 0 01-3.083 1.51 2.92 2.92 0 01-.623-.467v-2.802a1.265 1.265 0 011.34.311c.148.115.234.214.3.29.15.17.198.224.618.084zm.218 5.075c-.218-.887-1.168-1.556-1.853-1.385a1.735 1.735 0 00-.623.389v2.273c.423.231.911.313 1.386.233a1.266 1.266 0 001.084-.992c.037-.17.04-.346.006-.518zm-1.775 2.6c.483.125.607.67.327 1.137-.265.404-.514.591-.965.404v-1.541c.21-.039.427-.039.638 0zm-11.645.841a1.559 1.559 0 001.915 0c-.202-1.043-.53-1.557-1.074-1.401-.545.155-.903.716-.84 1.401zm-2.989-2.491a2.33 2.33 0 01.343-1.09 2.006 2.006 0 012.475-.607 1.434 1.434 0 011.417-.95 1.798 1.798 0 011.385 1.37 1.417 1.417 0 01-1.09 1.542.947.947 0 01-.716-.281 2.64 2.64 0 01-.358.857 1.82 1.82 0 01-1.759 1.043v.109a2.008 2.008 0 010 2.101.378.378 0 01.171.094 1.066 1.066 0 01.49.713 1.072 1.072 0 01-.194.844 1.137 1.137 0 01-1.463.404.963.963 0 01-.374-1.214 2.446 2.446 0 01-2.008-.716.844.844 0 01-.078-.125.606.606 0 01-.498.234 1.058 1.058 0 01-.794-.529c-.078-.234.156-1.059.342-1.137.187-.078.514.125.763.358a2.649 2.649 0 01.996-1.557 1.552 1.552 0 011.215-.373 1.822 1.822 0 01-.267-1.047c-.028.248-.425.595-.605.595a.727.727 0 01-.623-.358c-.046-.202.25-.56.42-.607.172-.047.81.078.81.327zm3.503-15.615a.343.343 0 00-.14-.404c-.094 0-.327 0-.374.14a.652.652 0 00-.008.29c.004.033.008.061.008.083a.311.311 0 00.514-.109zm2.11 5.675a1.57 1.57 0 01-1.176-.241c-.716-.374-1.12-1.37-.763-1.9a2.105 2.105 0 012.522-.7 1.569 1.569 0 01-.582 2.841zm22.332 14.688a.82.82 0 00.593-.312.816.816 0 00.154-.653c0-.887-.405-1.432-.825-1.432a1.787 1.787 0 00-1.246 1.354c0 .467.794 1.043 1.324 1.043zm2.257-5.262c.234.919-.124 1.868-.763 2.009-.467.14-1.416-.592-1.557-1.153-.14-.56.483-1.307 1.246-1.463a.786.786 0 01.682.048.788.788 0 01.392.559zm.576-5.635c.134-.208-.076-.645-.263-1.034a9.273 9.273 0 01-.142-.305c0-.082-.128-.124-.295-.178a2.951 2.951 0 01-.281-.102c-.063.15-.176.308-.292.47-.256.357-.524.733-.299 1.086a.963.963 0 001.572.063zm-6.679.965c.032.218.016.809-.249.809-.264.047-.576-.358-.576-.482a2.01 2.01 0 01.312-.639c.062.037.137.059.21.081.145.044.283.086.303.231zm-4.763 11.489c.035.209.109.41.218.592a.947.947 0 00-.53.264c-.22.272-.325.618-.296.965.11.623.576.794 1.744.717a5.12 5.12 0 00.327-.888c.332.146.7.195 1.059.14a2.426 2.426 0 001.556-2.537 1.552 1.552 0 00-.513-.81 2.41 2.41 0 00.186-1.261 1.372 1.372 0 001.697.81 1.717 1.717 0 001.436-1.507 1.713 1.713 0 00-.081-.735 1.807 1.807 0 00-1.993-1.401c-.809.14-1.37 1.292-1.214 2.366a1.401 1.401 0 00-.607-.778 2.99 2.99 0 00-3.114.731 1.964 1.964 0 00.311 2.242 1.838 1.838 0 00-.186 1.09zm-.623-6.414c-.203.389-.452.607-.903.389a1.06 1.06 0 01-.579-1.111c.023-.148.077-.289.159-.414.33-.049.665-.049.996 0a.708.708 0 01.463.481.718.718 0 01-.136.655zm2.942.483a2.199 2.199 0 001.339-2.367 1.602 1.602 0 00-2.962-.028 1.605 1.605 0 00-.011 1.227c.249.872 1.027 1.37 1.634 1.168zm1.03-7.534a.744.744 0 01-.267.263c-.202.047-.545-.264-.592-.436-.046-.171.094-.809.343-.809.249 0 .623.436.623.623a.745.745 0 01-.106.359zm-21.61 14.197c0 .638 1.245 1.245 1.68.918.437-.327 0-1.759-.606-1.806a1.077 1.077 0 00-1.075.888zm-41.707-35.246c-.153.45-.455.835-.856 1.09a.983.983 0 01-.841-.234 1.794 1.794 0 01-1.464-.202 1.557 1.557 0 01-.186-1.822c.12-.376.162-.774.124-1.167a2.348 2.348 0 010-.327h-.109a2.043 2.043 0 01-.87-2.218c.07-.275.197-.533.372-.756.178-.24.421-.424.7-.53a1.338 1.338 0 011.168-1.867c.191-.029.385-.029.576 0 .507.177.722.483.928.777.281.401.546.78 1.516.78a.935.935 0 01.53.731c.342-.373 1.152-.638 1.556 0a2.553 2.553 0 01-.996 3.269 2.575 2.575 0 01-1.806 0 1.787 1.787 0 01-1.448 0l-.186-.155a.67.67 0 010 .171c.082.157.154.318.218.483a1.169 1.169 0 011.058.591c.163.447.169.936.016 1.386zm-2.74 2.382a1.748 1.748 0 00-1.977.06 1.742 1.742 0 00-.468.516 1.401 1.401 0 00-.155 1.043h3.69c.046-.623-.359-.981-1.09-1.619zm5.65-.218c.179.195.307.43.374.685.08.379.122.765.125 1.152h-2.942a1.448 1.448 0 01-.312-.981 1.556 1.556 0 01.748-1.105.952.952 0 01.825-.934 1.01 1.01 0 011.183.731c.03.149.03.303 0 .452zm29.206 25.749a2.209 2.209 0 002.413 1.277 1.595 1.595 0 10-1.198-2.958c.123-.109.224-.241.296-.389a.873.873 0 00-.405-1.277 1.152 1.152 0 00-1.463.405 1.12 1.12 0 00.466 1.432.93.93 0 00.576 0 1.323 1.323 0 00-.685 1.51zm7.771 8.671c-.383.198-.808.418-1.014.296a.976.976 0 01-.382-.806.978.978 0 01.429-.782c.323-.229.687.016 1.043.254.175.118.349.235.513.291-.043.098-.075.2-.104.291-.053.169-.095.301-.176.301-.096.044-.2.098-.308.154v.001zm29.141-.887c-.171-.405.218-.903 1.012-1.308a.793.793 0 011.168.39 1.56 1.56 0 01-.452 1.556 1.769 1.769 0 01-1.728-.638zm-22.48 7.146c-.98-.592-1.868-.576-2.258 0a1.932 1.932 0 00.436 2.039 1.988 1.988 0 002.087-.763.877.877 0 00.147-.696.885.885 0 00-.412-.58zm-12.75-7.566c.133.054.266.095.382.13.184.056.327.099.365.166.017.03-.025.139-.086.302-.163.429-.465 1.227-.194 1.893a2.384 2.384 0 003.118.885c.354-.181.658-.448.883-.776a1.963 1.963 0 00-.172-2.164c-.286-.286-.75-.45-1.13-.584-.323-.113-.586-.206-.629-.335-.031-.094.045-.269.143-.494.192-.444.468-1.081.169-1.67a1.555 1.555 0 00-1.247-.869c.15.013.302.012.453-.003a1 1 0 00.812-.909.996.996 0 00-.065-.429 1.37 1.37 0 00-1.557-1.028 1.356 1.356 0 00-.98 1.557 1.229 1.229 0 001.151.841c-.27.001-.539.048-.793.14a2.951 2.951 0 00-1.308 2.444.959.959 0 00-.779-.218c-.38.15-.698.424-.903.778a24.62 24.62 0 001.09 1.557c.237.037.479.037.716 0a.824.824 0 00.592-1.09.125.125 0 01-.031-.124zm-2.058-3.606a1.82 1.82 0 01-1.056.757 2.143 2.143 0 01-.591.062 65.347 65.347 0 01-3.379-6.772 1.744 1.744 0 011.557 1.355c.1.446.1.908 0 1.354a2.224 2.224 0 012.74-.498 2.1 2.1 0 01.872 2.133.73.73 0 01.14.342 1.82 1.82 0 01-.283 1.267zm25.659 7.513a1.135 1.135 0 00-.436-.918 1.292 1.292 0 001.276-1.199c0-.682-.381-1.081-.606-1.316-.11-.114-.182-.19-.156-.241l.014-.027c.113-.222.594-1.159-.014-1.529a1.558 1.558 0 00-1.043-.25 1.716 1.716 0 00-.857-1.307 1.273 1.273 0 00-.871-.249v3.923c.196.214.216.417.236.627.032.322.065.661.744 1.085.194.117.404.206.623.265-.278.067-.518.24-.67.483a1.098 1.098 0 00-.215.823 1.098 1.098 0 00.433.733h.187c-.16.307-.204.66-.124.997a.58.58 0 00.14.218 1.32 1.32 0 00-.576 1.432 1.108 1.108 0 001.36.57c.17-.059.323-.158.446-.29a1.463 1.463 0 00.233-1.23h.203a1.37 1.37 0 001.183-1.479 1.82 1.82 0 00-1.51-1.121zm-21.375 1.744a2.711 2.711 0 011.557-1.339 1.571 1.571 0 011.219.229 1.564 1.564 0 01.665 1.048 1.929 1.929 0 01-.654 2.039 1.284 1.284 0 01-.094.327c-.047.066-.1.129-.156.187a34.636 34.636 0 01-2.537-2.491zm39.807-.887a.573.573 0 000 .7.79.79 0 00.825.156c.218-.125.141-.561 0-.763a.608.608 0 00-.825-.093zm14.121-10.309a.99.99 0 01.404.516c.203.545-.373 1.293-1.261 1.744a4.745 4.745 0 01-.08.425c-.046.213-.091.421-.091.618-.552.444-1.17.398-1.759.353-.175-.013-.347-.026-.514-.026a.717.717 0 01-.389-1.261 20.077 20.077 0 011.697-1.152c.202-1.043.467-1.37 1.354-1.37a.994.994 0 01.639.153zm-5.558-1.57s-.327.389-.28.514c.046.125.389.576.653.529.265-.046.312-.622.249-.716a1.055 1.055 0 00-.622-.327zm-25.084 18.02c0-.097.029-.191.082-.272.186-.312.731-.14.794-.031a.873.873 0 01.217.451l-1.011.125a.5.5 0 01-.081-.273zm28.244-19.374c.374-.498-.592-1.557-1.277-1.557-.685 0-1.276.887-1.058 1.386.218.498 1.977.669 2.335.171zm-14.163.217c.122-.254.339-.449.603-.544a1.556 1.556 0 011.604.856c.124.389-.483 1.246-.981 1.37a1.202 1.202 0 01-1.277-.872 1.074 1.074 0 01.051-.81zm-10.434 12.159a1.806 1.806 0 00-2.367.639 2.116 2.116 0 00-.296 1.074 1.674 1.674 0 00-1.005.805 1.664 1.664 0 00-.131 1.281 2.102 2.102 0 002.366 1.557 2.225 2.225 0 001.557-1.9 1.29 1.29 0 00.358-.358 2.46 2.46 0 00-.483-3.098zm-1.448 6.663c-.25-.28-.405-.622-.25-.825a2.573 2.573 0 011.806-.28c-.499.396-1.018.765-1.556 1.105zm2.475-8.936a.964.964 0 00-.607.432.946.946 0 00-.11.736.899.899 0 00.738.792.905.905 0 00.384-.014 1.087 1.087 0 00.903-1.229 1.035 1.035 0 00-.504-.633 1.058 1.058 0 00-.804-.084zm1.885 4.474c.233-.382.582-.678.995-.846a2.119 2.119 0 011.588-1.65c.19-.04.386-.04.576 0a36.783 36.783 0 01-3.456 3.767c-.039-.445.065-.89.297-1.271zm1.275-6.669c-.404-.529-.84-1.043-1.556-.591-.717.451-.468 1.012-.125 1.557a1.204 1.204 0 001.681-.966zm-1.276 3.441c-.031-.218.233-.95.623-.856a.882.882 0 01.591.762.842.842 0 01-.576.592.789.789 0 01-.638-.498zM48.469 56.236c.124.078.093.39 0 .39a.358.358 0 01-.514-.11.311.311 0 01.171-.42c.093-.047.17.011.254.076.028.022.057.045.089.064zm-5.154 5.511c-.34.133-.617.389-.778.716h3.27a2.382 2.382 0 00-2.492-.716zm5.574.467c-.42.125-.7-.311-.7-.467a.794.794 0 01.342-.607c.062-.062.467.031.514.233.006.028.015.06.026.098.067.237.181.635-.182.743zm-14.89 57.962c.329-.39.793-.641 1.299-.703a1.933 1.933 0 011.557 1.915 3.114 3.114 0 01-.965 1.728c.28.244.494.554.622.903.12.557.03 1.138-.249 1.635a60.352 60.352 0 01-2.74-4.079 2.025 2.025 0 01.476-1.399zm-6.5-19.898c-.016-.218.015-.81.295-.81.327-.062.607.405.607.561a.748.748 0 01-.436.56c-.202.062-.451-.093-.466-.311zM39.5 126.759a1.12 1.12 0 00.56 2.148 1.337 1.337 0 00.701-1.556 1.045 1.045 0 00-1.261-.592zm-9.496-65.806c.294.122.576.274.84.452a1.417 1.417 0 01.608 1.105h-2.117l.15-.354c.168-.401.339-.807.519-1.203zm1.728-1.277c.623.265 1.059-.077 1.37-.7l-.066-.126c-.24-.465-.49-.947-1.133-.761a1.169 1.169 0 00-.576.84.872.872 0 00.405.747zm8.593 62.907a1.703 1.703 0 01-.218-.592 1.838 1.838 0 01.187-1.09 1.963 1.963 0 01-.311-2.242 2.995 2.995 0 013.114-.731c.29.177.505.454.607.778-.156-1.074.404-2.226 1.214-2.366a1.804 1.804 0 011.993 1.401 1.71 1.71 0 01-.666 1.971 1.718 1.718 0 01-.689.271 1.372 1.372 0 01-1.697-.81c.052.43-.012.865-.186 1.261.252.209.431.493.513.81a2.428 2.428 0 01-1.556 2.537 1.913 1.913 0 01-1.06-.14 5.15 5.15 0 01-.326.888c-1.168.077-1.635-.094-1.744-.717-.03-.347.077-.693.296-.965a.947.947 0 01.53-.264zM32.784 83.58a1.698 1.698 0 00-.514-2.024.951.951 0 00-1.339.343 1.464 1.464 0 00.218 1.914 1.183 1.183 0 001.635-.233zm.947-1.733a1.418 1.418 0 01-.558-.198 1.416 1.416 0 01-.514-2.148 2.055 2.055 0 012.242-.638 1.712 1.712 0 01.296 2.18 1.418 1.418 0 01-1.466.804zm-3.376-4.432a1.556 1.556 0 00-.856-.171c.139-.257.183-.555.125-.841A1.884 1.884 0 0027.6 75.22c-.592.14-1.043 1.214-.856 2.024a1.386 1.386 0 001.074 1.074 1.556 1.556 0 00.856 1.557c.654.389 1.355.109 1.868-.732a1.168 1.168 0 00-.187-1.728zm.537 10.57c.022-.385.14-.76.343-1.09a2.008 2.008 0 012.475-.606 1.432 1.432 0 011.417-.95 1.79 1.79 0 011.385 1.37 1.416 1.416 0 01-1.09 1.541.949.949 0 01-.716-.28 2.644 2.644 0 01-.358.856 1.821 1.821 0 01-1.759 1.043v.11a2.008 2.008 0 010 2.101.373.373 0 01.171.093 1.072 1.072 0 01.296 1.557 1.137 1.137 0 01-1.463.405.965.965 0 01-.374-1.214 2.444 2.444 0 01-2.008-.717.871.871 0 01-.078-.124.607.607 0 01-.498.234 1.06 1.06 0 01-.794-.53c-.078-.233.156-1.058.342-1.136.187-.078.514.124.763.358a2.646 2.646 0 01.997-1.557 1.554 1.554 0 011.214-.374 1.82 1.82 0 01-.266-1.046c-.03.248-.426.595-.606.595a.732.732 0 01-.623-.358c-.046-.203.25-.56.42-.607.172-.047.81.078.81.327zm9.178-14.29a1.57 1.57 0 001.759-2.6 2.102 2.102 0 00-2.522.7c-.358.53.047 1.526.763 1.9z",fill:"#EA9600"}));n(411);const Ac={id:"lnsGeoFieldWorkspace",humanData:{label:_.i18n.translate("xpack.lens.geoFieldWorkspace.dropZoneLabel",{defaultMessage:"drop zone to open in maps"})}},Lc=[1,0,0,0];function Dc(e){return Object(E.jsx)(F.EuiPageContentBody,{className:"lnsWorkspacePanelWrapper__pageContentBody"},Object(E.jsx)(F.EuiText,{className:"lnsWorkspacePanel__emptyContent",textAlign:"center",size:"s"},Object(E.jsx)("h2",null,Object(E.jsx)("strong",null,Object(Tn.getVisualizeGeoFieldMessage)(e.fieldType))),Object(E.jsx)(Sc,{"aria-hidden":!0,className:"lnsWorkspacePanel__dropIllustration"}),Object(E.jsx)(Xu.c,{className:"lnsVisualizeGeoFieldWorkspacePanel__dragDrop",dataTestSubj:"lnsGeoFieldWorkspace",draggable:!1,dropTypes:["field_add"],order:Lc,value:Ac,onDrop:function(){e.uiActions.getTrigger(Zu.VISUALIZE_GEO_FIELD_TRIGGER).exec({indexPatternId:e.indexPatternId,fieldName:e.fieldName})}},Object(E.jsx)("p",null,Object(E.jsx)("strong",null,Object(E.jsx)(O.FormattedMessage,{id:"xpack.lens.geoFieldWorkspace.dropMessage",defaultMessage:"Drop field here to open in Maps"}))))))}function Nc(e,t){const{dataType:n,label:a,isBucketed:i,scale:r}=e;return{dataType:qo(n),isBucketed:i,scale:r,label:t||a}}function zc({core:e,storage:t,data:n,fieldFormats:a,charts:i,indexPatternFieldEditor:r,uiActions:s}){const l=e.uiSettings,o=t=>e.notifications.toasts.addError(t,{title:_.i18n.translate("xpack.lens.indexPattern.indexPatternLoadError",{defaultMessage:"Error loading index pattern"})}),u=n.indexPatterns,c=(e,n,a)=>{!async function({id:e,state:t,setState:n,onError:a,storage:i,indexPatternsService:r}){const s=await Lo({indexPatternsService:r,cache:t.indexPatterns,patterns:[e]});if(null==s[e])return a(Error("Missing indexpatterns"));try{n((n=>({...n,layers:Ho(t.layers)?Object(Z.mapValues)(t.layers,(t=>Wi(t,s[e]))):t.layers,indexPatterns:{...n.indexPatterns,[e]:s[e]},currentIndexPatternId:e}))),No(i,e)}catch(e){a(e)}}({id:e,state:n,setState:a,onError:o,storage:t,indexPatternsService:u})},d={id:"indexpattern",initialize:async(n,a,i,r)=>Ro({persistedState:n,references:a,defaultIndexPatternId:e.uiSettings.get("defaultIndex"),storage:t,indexPatternsService:u,initialContext:i,options:r}),getPersistableState:e=>function({currentIndexPatternId:e,layers:t}){const n=[];n.push({type:"index-pattern",id:e,name:zo});const a={};return Object.entries(t).forEach((([e,{indexPatternId:t,...i}])=>{n.push({type:"index-pattern",id:t,name:Bo(e)}),a[e]=i})),{savedObjectReferences:n,state:{layers:a}}}(e),insertLayer:(e,t)=>({...e,layers:{...e.layers,[t]:Bc(e.currentIndexPatternId)}}),removeLayer(e,t){const n={...e.layers};return delete n[t],{...e,layers:n}},clearLayer:(e,t)=>({...e,layers:{...e.layers,[t]:Bc(e.currentIndexPatternId)}}),getLayers:e=>Object.keys(e.layers),removeColumn({prevState:e,layerId:t,columnId:n}){var a;const i=e.indexPatterns[null===(a=e.layers[t])||void 0===a?void 0:a.indexPatternId];return Ko({state:e,layerId:t,newLayer:Vi({layer:e.layers[t],columnId:n,indexPattern:i})})},initializeDimension(e,t,{columnId:n,groupId:a,label:i,dataType:r,staticValue:s}){var l;const o=e.indexPatterns[null===(l=e.layers[t])||void 0===l?void 0:l.indexPatternId];return null==s?e:Ko({state:e,layerId:t,newLayer:Ci({layer:e.layers[t],op:"static_value",columnId:n,field:void 0,indexPattern:o,visualizationGroups:[],initialParams:{params:{value:s}},targetGroup:a})})},toExpression:(e,t)=>function(e,t,n){return e.layers[t]?Go(e.layers[t],e.indexPatterns[e.layers[t].indexPatternId],n):null}(e,t,l),renderDataPanel(t,l){Object(y.render)(Object(E.jsx)(O.I18nProvider,null,Object(E.jsx)(bc,x()({changeIndexPattern:c,data:n,fieldFormats:a,charts:i,indexPatternFieldEditor:r},l,{core:e,uiActions:s}))),t)},uniqueLabels(e){const t=e.layers,n={},a={};return Object.values(t).forEach((e=>{e.columns&&Object.entries(e.columns).forEach((([e,t])=>{n[e]=(e=>{let t=e;for(;a[t]>=0;){const n=++a[t];t=_.i18n.translate("xpack.lens.indexPattern.uniqueLabel",{defaultMessage:"{label} [{num}]",values:{label:e,num:n}})}return a[t]=0,t})(t.label)}))})),n},isValidColumn:(e,t,n)=>{const a=e.layers[t];return!Yo(a,n,e.indexPatterns[a.indexPatternId])},renderDimensionTrigger:(i,r)=>{const s=d.uniqueLabels(r.state);Object(y.render)(Object(E.jsx)(O.I18nProvider,null,Object(E.jsx)(dn.KibanaContextProvider,{services:{appName:"lens",storage:t,uiSettings:l,data:n,fieldFormats:a,savedObjects:e.savedObjects,docLinks:e.docLinks}},Object(E.jsx)(Nu,x()({uniqueLabel:s[r.columnId]},r)))),i)},renderDimensionEditor:(i,r)=>{const s=d.uniqueLabels(r.state);Object(y.render)(Object(E.jsx)(O.I18nProvider,null,Object(E.jsx)(dn.KibanaContextProvider,{services:{appName:"lens",storage:t,uiSettings:l,data:n,fieldFormats:a,savedObjects:e.savedObjects,docLinks:e.docLinks,http:e.http}},Object(E.jsx)(zu,x()({uiSettings:l,storage:t,savedObjectsClient:e.savedObjects.client,http:e.http,data:n,uniqueLabel:s[r.columnId]},r)))),i)},renderLayerPanel:(e,n)=>{Object(y.render)(Object(E.jsx)(Pc,x()({onChangeIndexPattern:e=>{!async function({indexPatternId:e,layerId:t,state:n,setState:a,onError:i,replaceIfPossible:r,storage:s,indexPatternsService:l}){const o=await Lo({indexPatternsService:l,cache:n.indexPatterns,patterns:[e]});if(null==o[e])return i(Error("Missing indexpatterns"));try{a((n=>({...n,layers:{...n.layers,[t]:Wi(n.layers[t],o[e])},indexPatterns:{...n.indexPatterns,[e]:o[e]},currentIndexPatternId:r?e:n.currentIndexPatternId}))),No(s,e)}catch(e){i(e)}}({indexPatternId:e,setState:n.setState,state:n.state,layerId:n.layerId,onError:o,replaceIfPossible:!0,storage:t,indexPatternsService:u})}},n)),e)},canCloseDimensionEditor:e=>!e.isDimensionClosePrevented,getDropProps:Gu,onDrop:qu,getCustomWorkspaceRenderer:(e,t)=>{if(void 0===t.field||void 0===t.indexPatternId)return;const n=t,a=n.field.esTypes&&n.field.esTypes.find((e=>["geo_point","geo_shape"].includes(e)));return a?()=>Object(E.jsx)(Dc,{uiActions:s,fieldType:a,indexPatternId:n.indexPatternId,fieldName:n.field.name}):void 0},updateStateOnCloseDimension:({state:e,layerId:t})=>{const n=e.layers[t];if(Object.values(n.incompleteColumns||{}).length)return Ko({state:e,layerId:t,newLayer:{...n,incompleteColumns:void 0}})},getPublicAPI({state:e,layerId:t}){const n=d.uniqueLabels(e);return{datasourceId:"indexpattern",getTableSpec:()=>e.layers[t].columnOrder.filter((n=>!$i(e.layers[t],n))).map((e=>({columnId:e}))),getOperationForColumnId:a=>{const i=e.layers[t];return i&&i.columns[a]&&!$i(i,a)?Nc(i.columns[a],n[a]):null}}},getDatasourceSuggestionsForField:(e,t,n)=>$o(t)?Oc(e,t.indexPatternId,t.field,n):[],getDatasourceSuggestionsFromCurrentState:wc,getDatasourceSuggestionsForVisualizeField:kc,getErrorMessages(t){if(!t)return;const n=Object.entries(t.layers).filter((([e,n])=>!!t.indexPatterns[n.indexPatternId])).map((([n,a])=>{var i;return(null!==(i=function(e,t,n,a,i){const r=Object.entries(e.columns),s=r.filter((([t,n])=>!$i(e,t)&&"managedReference"===Fo[n.operationType].input)).flatMap((([t])=>Ji(t,e.columns).map((([e])=>e)))),l=r.flatMap((([n,a])=>{if(s.includes(n))return;const i=Fo[a.operationType];return i.getErrorMessage?i.getErrorMessage(e,n,t,Fo):void 0})).map((e=>"object"!=typeof e?e:{...e,fixAction:e.fixAction?{...e.fixAction,newState:async t=>({...n,layers:{...n.layers,[a]:await e.fixAction.newState(i,t,a)}})}:void 0})).filter((e=>null!=e));return l.length?l:void 0}(a,t.indexPatterns[a.indexPatternId],t,n,e))&&void 0!==i?i:[]).map((e=>({shortMessage:"",longMessage:"string"==typeof e?e:e.message,fixAction:"object"==typeof e?e.fixAction:void 0})))}));var a;if(n.length<=1)return null!==(a=n[0])&&void 0!==a&&a.length?n[0]:void 0;const i=n.flatMap(((e,t)=>e.map((e=>{const{shortMessage:n,longMessage:a}=e;return{shortMessage:n?_.i18n.translate("xpack.lens.indexPattern.layerErrorWrapper",{defaultMessage:"Layer {position} error: {wrappedMessage}",values:{position:t+1,wrappedMessage:n}}):"",longMessage:a?_.i18n.translate("xpack.lens.indexPattern.layerErrorWrapper",{defaultMessage:"Layer {position} error: {wrappedMessage}",values:{position:t+1,wrappedMessage:a}}):""}}))));return i.length?i:void 0},getWarningMessages:$a,checkIntegrity:e=>Object.values(e.layers||{}).map((({indexPatternId:e})=>e)).filter((t=>!e.indexPatterns[t])),isTimeBased:e=>{const{layers:t}=e;return Boolean(t)&&Object.values(t).some((e=>e.columnOrder.filter((t=>e.columns[t].isBucketed)).some((t=>"date_histogram"===e.columns[t].operationType))))}};return d}function Bc(e){return{indexPatternId:e,columns:{},columnOrder:[]}}var Rc=n(17);class indexpattern_datasource_IndexPatternDatasource{setup(e,{fieldFormats:t,expressions:a,editorFrame:i,charts:r}){i.registerDatasource((async()=>{const{getIndexPatternDatasource:a,getSuffixFormatter:i,suffixFormatterId:s}=await Promise.resolve().then(n.bind(null,529));if(!t.has(s)){const n=Object(Rc.createStartServicesGetter)(e.getStartServices),a=i((()=>n().plugins.fieldFormats.deserialize));t.register([a])}const[l,{indexPatternFieldEditor:o,uiActions:u,data:c,fieldFormats:d}]=await e.getStartServices();return a({core:l,fieldFormats:d,storage:new Rc.Storage(localStorage),data:c,charts:r,indexPatternFieldEditor:o,uiActions:u})}))}}var Vc=n(96);async function Hc(e){const t=await Promise.all(e.map((e=>"function"==typeof e?e():e))),n={};return t.forEach((e=>{n[e.id]=e})),n}class service_EditorFrameService{constructor(){Q()(this,"datasources",[]),Q()(this,"visualizations",[]),Q()(this,"documentToExpression",(async e=>{const[t,a]=await Promise.all([Hc(this.datasources),Hc(this.visualizations)]),{persistedStateToExpression:i}=await Promise.resolve().then(n.bind(null,529));return await i(t,a,e)}))}setup(){return{registerDatasource:e=>{this.datasources.push(e)},registerVisualization:e=>{this.visualizations.push(e)}}}start(e,t){return{createInstance:async()=>{const[a,i]=await Promise.all([Hc(this.datasources),Hc(this.visualizations)]),{EditorFrame:r}=await Promise.resolve().then(n.bind(null,529));return{EditorFrameContainer:({showNoDataPopover:n,lensInspector:s})=>Object(E.jsx)("div",{className:"lnsApp__frame"},Object(E.jsx)(r,{"data-test-subj":"lnsEditorFrame",core:e,plugins:t,lensInspector:s,showNoDataPopover:n,datasourceMap:a,visualizationMap:i,ExpressionRenderer:t.expressions.ReactExpressionRenderer})),datasourceMap:a,visualizationMap:i}}}}}var Gc=n(95),qc=n(53),Wc=n(518),$c=n.n(Wc),Yc=n(55),Kc=n(54),Uc=n(9),Xc=n(86),Qc=n(108);function Zc({errors:e,canEdit:t}){const n=e&&e.length>1,a=t&&(null==e?void 0:e.some((({type:e})=>"fixable"===e)));return Object(E.jsx)("div",{className:"lnsEmbeddedError"},Object(E.jsx)(F.EuiEmptyPrompt,{iconType:"alert",iconColor:"danger","data-test-subj":"embeddable-lens-failure",body:Object(E.jsx)(v.a.Fragment,null,e?Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)("p",null,e[0].longMessage),n&&!a?Object(E.jsx)("p",null,Object(E.jsx)(O.FormattedMessage,{id:"xpack.lens.embeddable.moreErrors",defaultMessage:"Edit in Lens editor to see more errors"})):null,a?Object(E.jsx)("p",null,Object(E.jsx)(O.FormattedMessage,{id:"xpack.lens.embeddable.fixErrors",defaultMessage:"Edit in Lens editor to fix the error"})):null):Object(E.jsx)("p",null,Object(E.jsx)(O.FormattedMessage,{id:"xpack.lens.embeddable.failure",defaultMessage:"Visualization couldn't be displayed"})))}))}function Jc({ExpressionRenderer:e,expression:t,searchContext:n,variables:a,handleEvent:i,interactive:r,searchSessionId:s,onData$:l,renderMode:o,syncColors:u,hasCompatibleActions:c,style:d,className:p,errors:m,canEdit:g,onRuntimeError:f,executionContext:b,lensInspector:x}){return Object(E.jsx)(O.I18nProvider,null,m||null===t||""===t?Object(E.jsx)(Zc,{errors:m,canEdit:g}):Object(E.jsx)("div",{className:T()("lnsExpressionRenderer",p),style:d},Object(E.jsx)(e,{className:"lnsExpressionRenderer__component",padding:"s",variables:a,expression:t,interactive:r,searchContext:n,searchSessionId:s,onData$:l,inspectorAdapters:x.adapters,renderMode:o,syncColors:u,executionContext:b,renderError:(e,t)=>(f(),Object(E.jsx)("div",{"data-test-subj":"expression-renderer-error"},Object(E.jsx)(F.EuiFlexGroup,{direction:"column",alignItems:"center",justifyContent:"center"},Object(E.jsx)(F.EuiFlexItem,null,Object(E.jsx)(F.EuiIcon,{type:"alert",color:"danger"})),Object(E.jsx)(F.EuiFlexItem,null,(Object(Qc.d)(t)||[e]).map((e=>Object(E.jsx)(F.EuiText,{size:"s"},e))))))),onEvent:i,hasCompatibleActions:c})))}const ed=e=>{const t=Object(ia.createDefaultInspectorAdapters)();let n;return{adapters:t,inspect:a=>(n=e.open(t,a),n.onClose.then((()=>{n&&(n=void 0)})),n),close:()=>{var e;return null===(e=n)||void 0===e?void 0:e.close()}}};class embeddable_Embeddable extends Uc.Embeddable{logError(e){var t;null===(t=this.deps.usageCollection)||void 0===t||t.reportUiCounter($.f,Yc.METRIC_TYPE.COUNT,"runtime"===e?"embeddable_runtime_error":"embeddable_validation_error")}constructor(e,t,n){super(t,{editApp:"lens"},n),Q()(this,"type",$.c),Q()(this,"deferEmbeddableLoad",!0),Q()(this,"expressionRenderer",void 0),Q()(this,"savedVis",void 0),Q()(this,"expression",void 0),Q()(this,"domNode",void 0),Q()(this,"subscription",void 0),Q()(this,"isInitialized",!1),Q()(this,"errors",void 0),Q()(this,"inputReloadSubscriptions",void 0),Q()(this,"isDestroyed",void 0),Q()(this,"lensInspector",void 0),Q()(this,"externalSearchContext",{}),Q()(this,"updateActiveData",(()=>{this.input.onLoad&&this.input.onLoad(!1)})),Q()(this,"hasCompatibleActions",(async e=>{if(Object(Bu.e)(e)){const{getTriggerCompatibleActions:t}=this.deps;if(!t)return!1;return(await t(Kc.VIS_EVENT_TO_TRIGGER[e.name],{data:e.data,embeddable:this})).length>0}return!1})),Q()(this,"handleEvent",(e=>{this.deps.getTrigger&&!this.input.disableTriggers&&(Object(Bu.b)(e)&&(this.deps.getTrigger(Kc.VIS_EVENT_TO_TRIGGER[e.name]).exec({data:e.data,embeddable:this}),this.input.onBrushEnd&&this.input.onBrushEnd(e.data)),Object(Bu.d)(e)&&(this.deps.getTrigger(Kc.VIS_EVENT_TO_TRIGGER[e.name]).exec({data:e.data,embeddable:this}),this.input.onFilter&&this.input.onFilter(e.data)),Object(Bu.e)(e)&&(this.deps.getTrigger(Kc.VIS_EVENT_TO_TRIGGER[e.name]).exec({data:e.data,embeddable:this},!0),this.input.onTableRowClick&&this.input.onTableRowClick(e.data)))})),Q()(this,"inputIsRefType",(e=>this.deps.attributeService.inputIsRefType(e))),Q()(this,"getInputAsRefType",(async()=>this.deps.attributeService.getInputAsRefType(this.getExplicitInput(),{showSaveModal:!0,saveModalTitle:this.getTitle()}))),Q()(this,"getInputAsValueType",(async()=>this.deps.attributeService.getInputAsValueType(this.getExplicitInput()))),this.deps=e,this.lensInspector=ed(e.inspector),this.expressionRenderer=e.expressionRenderer,this.initializeSavedVis(t).then((()=>this.onContainerStateChanged(t))),this.subscription=this.getUpdated$().subscribe((()=>this.onContainerStateChanged(this.input)));const a=this.getInput$();this.inputReloadSubscriptions=[],this.inputReloadSubscriptions.push(a.pipe(Object(qc.map)((e=>{var t;return null===(t=e.enhancements)||void 0===t?void 0:t.dynamicActions})),Object(qc.distinctUntilChanged)(((e,t)=>$c()(e,t))),Object(qc.skip)(1)).subscribe((e=>{this.reload()}))),this.inputReloadSubscriptions.push(a.pipe(Object(qc.map)((e=>e.viewMode)),Object(qc.distinctUntilChanged)(),Object(qc.skip)(1)).subscribe((e=>{var t;null!==(t=this.getInput().enhancements)&&void 0!==t&&t.dynamicActions&&this.reload()}))),this.inputReloadSubscriptions.push(a.pipe(Object(qc.distinctUntilChanged)(((e,t)=>$c()(["attributes"in e&&e.attributes,"savedObjectId"in e&&e.savedObjectId],["attributes"in t&&t.attributes,"savedObjectId"in t&&t.savedObjectId]))),Object(qc.skip)(1)).subscribe((async e=>{await this.initializeSavedVis(e),this.reload()}))),this.inputReloadSubscriptions.push(this.getUpdated$().pipe(Object(qc.map)((()=>this.getInput()))).pipe(Object(qc.distinctUntilChanged)(((e,t)=>$c()([e.filters,e.query,e.timeRange,e.searchSessionId],[t.filters,t.query,t.timeRange,t.searchSessionId]))),Object(qc.skip)(1)).subscribe((async e=>{this.onContainerStateChanged(e)})))}supportedTriggers(){if(!this.savedVis)return[];switch(this.savedVis.visualizationType){case"lnsXY":return[Kc.VIS_EVENT_TO_TRIGGER.filter,Kc.VIS_EVENT_TO_TRIGGER.brush];case"lnsDatatable":return[Kc.VIS_EVENT_TO_TRIGGER.filter,Kc.VIS_EVENT_TO_TRIGGER.tableRowContextMenuClick];case"lnsPie":return[Kc.VIS_EVENT_TO_TRIGGER.filter];default:return[]}}getInspectorAdapters(){return this.lensInspector.adapters}maybeAddConflictError(e,t){const n=[...e||[]];return"conflict"===(null==t?void 0:t.outcome)&&this.deps.spaces&&n.push({shortMessage:_.i18n.translate("xpack.lens.embeddable.legacyURLConflict.shortMessage",{defaultMessage:"You've encountered a URL conflict"}),longMessage:Object(E.jsx)(this.deps.spaces.ui.components.getEmbeddableLegacyUrlConflict,{targetType:$.c,sourceId:t.sourceId})}),null!=n&&n.length?n:void 0}async initializeSavedVis(e){const t=await this.deps.attributeService.unwrapAttributes(e).catch((e=>(this.onFatalError(e),!1)));if(!t||this.isDestroyed)return;const{metaInfo:n,attributes:a}=t;this.savedVis={...a,type:this.type,savedObjectId:null==e?void 0:e.savedObjectId};const{ast:i,errors:r}=await this.deps.documentToExpression(this.savedVis);this.errors=this.maybeAddConflictError(r,null==n?void 0:n.sharingSavedObjectProps),this.expression=i?Object(Gc.toExpression)(i):null,this.errors&&this.logError("validation"),await this.initializeOutput(),this.isInitialized=!0}onContainerStateChanged(e){this.handleContainerStateChanged(e)&&this.reload()}handleContainerStateChanged(e){let t=!1;const n=e.filters?e.filters.filter((e=>!e.meta.disabled)):void 0;return Object(Z.isEqual)(e.timeRange,this.externalSearchContext.timeRange)&&Object(Z.isEqual)(e.query,this.externalSearchContext.query)&&Object(Z.isEqual)(n,this.externalSearchContext.filters)&&this.externalSearchContext.searchSessionId===e.searchSessionId||(this.externalSearchContext={timeRange:e.timeRange,query:e.query,filters:n,searchSessionId:e.searchSessionId},t=!0),t}render(e){var t;if(this.domNode=e,!this.savedVis||!this.isInitialized||this.isDestroyed)return;this.input.onLoad&&this.input.onLoad(!0);const n={type:"lens",name:null!==(t=this.savedVis.visualizationType)&&void 0!==t?t:"",id:this.id,description:this.savedVis.title||this.input.title||"",url:this.output.editUrl,parent:this.input.executionContext},a=this.getInput();Object(y.render)(Object(E.jsx)(Jc,{ExpressionRenderer:this.expressionRenderer,expression:this.expression||null,errors:this.errors,lensInspector:this.lensInspector,searchContext:this.getMergedSearchContext(),variables:a.palette?{theme:{palette:a.palette}}:{},searchSessionId:this.externalSearchContext.searchSessionId,handleEvent:this.handleEvent,onData$:this.updateActiveData,interactive:!a.disableTriggers,renderMode:a.renderMode,syncColors:a.syncColors,hasCompatibleActions:this.hasCompatibleActions,className:a.className,style:a.style,executionContext:n,canEdit:this.getIsEditable()&&"edit"===a.viewMode,onRuntimeError:()=>{this.logError("runtime")}}),e)}getMergedSearchContext(){var e;if(!this.savedVis)throw new Error("savedVis is required for getMergedSearchContext");const t={timeRange:this.externalSearchContext.timeRange};return this.externalSearchContext.query?t.query=[this.externalSearchContext.query,this.savedVis.state.query]:t.query=[this.savedVis.state.query],null!==(e=this.externalSearchContext.filters)&&void 0!==e&&e.length?t.filters=[...this.externalSearchContext.filters,...this.savedVis.state.filters]:t.filters=[...this.savedVis.state.filters],t.filters=Object(Xc.c)(t.filters,this.savedVis.references),t}async reload(){this.savedVis&&this.isInitialized&&!this.isDestroyed&&(this.handleContainerStateChanged(this.input),this.domNode&&this.render(this.domNode))}async initializeOutput(){var e;if(!this.savedVis)return;const t=(await Promise.allSettled(Object(Z.uniqBy)(this.savedVis.references.filter((({type:e})=>"index-pattern"===e)),"id").map((({id:e})=>this.deps.indexPatternService.get(e))))).filter((e=>"fulfilled"===e.status)).map((({value:e})=>e)),n=this.getInput(),a=n.hidePanelTitles?"":null!==(e=n.title)&&void 0!==e?e:this.savedVis.title,i=n.savedObjectId;this.updateOutput({...this.getOutput(),defaultTitle:this.savedVis.title,editable:this.getIsEditable(),title:a,editPath:Object($.g)(i),editUrl:this.deps.basePath.prepend(`/app/lens${Object($.g)(i)}`),indexPatterns:t}),this.setInitializationFinished()}getIsEditable(){return this.deps.capabilities.canSaveVisualizations||!this.inputIsRefType(this.getInput())&&this.deps.capabilities.canSaveDashboards}getDescription(){return this.savedVis&&this.savedVis.description}destroy(){super.destroy(),this.isDestroyed=!0,this.inputReloadSubscriptions.length>0&&this.inputReloadSubscriptions.forEach((e=>{e.unsubscribe()})),this.domNode&&Object(y.unmountComponentAtNode)(this.domNode),this.subscription&&this.subscription.unsubscribe()}}var td=n(58),nd=n(127),ad=(n(519),n(59)),id=n(71);const rd=({setHeaderActionMenu:e,initialInput:t,indicateNoData:n,lensInspector:a,setIsSaveModalVisible:i,getIsByValueMode:r,runSave:s,onAppLeave:l,redirectToOrigin:o,datasourceMap:u,title:c})=>{var d;const{data:p,fieldFormats:m,navigation:g,uiSettings:f,application:b,attributeService:x,dashboardFeatureFlag:y}=Object(dn.useKibana)().services,j=Object(id.E)(),O=v.a.useCallback((e=>j(Object(id.v)(e))),[j]),[k,I]=Object(h.useState)([]),[F,w]=Object(h.useState)([]),{isSaveable:T,isLinkedToOriginatingApp:C,query:M,activeData:P,savedQuery:S,activeDatasourceId:A,datasourceStates:L}=Object(id.F)((e=>e.lens)),D=Object.values(L).every((({isLoading:e})=>!1===e));Object(h.useEffect)((()=>{if(!(u&&A&&!L[A].isLoading?u[A]:void 0))return;const e=Object(Tn.getIndexPatternsIds)({activeDatasources:Object.keys(L).reduce(((e,t)=>({...e,[t]:u[t]})),{}),datasourceStates:L});(k.length+F.length!==e.length||e.some((e=>![...k.map((e=>e.id)),...F].find((t=>t===e)))))&&Object(Tn.getIndexPatternsObjects)(e,p.indexPatterns).then((({indexPatterns:e,rejectedIds:t})=>{I(e),w(t)}))}),[L,A,F,u,k,p.indexPatterns]);const{TopNavMenu:N}=g.ui,{from:z,to:B}=p.query.timefilter.timefilter.getTime(),R=Boolean(T&&b.capabilities.visualize.save),V=Boolean(T&&(null===(d=b.capabilities.dashboard)||void 0===d?void 0:d.showWriteControls)),H=_.i18n.translate("xpack.lens.app.unsavedFilename",{defaultMessage:"unsaved"}),G=Object(h.useMemo)((()=>function(e){const{actions:t,showCancel:n,allowByValue:a,enableExportToCSV:i,showSaveAndReturn:r,savingToLibraryPermitted:s,savingToDashboardPermitted:l,tooltips:o}=e,u=[],c=s||a&&l&&!e.isByValueMode&&!e.showSaveAndReturn,d=e.isByValueMode?_.i18n.translate("xpack.lens.app.addToLibrary",{defaultMessage:"Save to library"}):e.showSaveAndReturn?_.i18n.translate("xpack.lens.app.saveAs",{defaultMessage:"Save as"}):_.i18n.translate("xpack.lens.app.save",{defaultMessage:"Save"});return u.push({label:_.i18n.translate("xpack.lens.app.inspect",{defaultMessage:"Inspect"}),run:t.inspect,testId:"lnsApp_inspectButton",description:_.i18n.translate("xpack.lens.app.inspectAriaLabel",{defaultMessage:"inspect"}),disableButton:!1}),u.push({label:_.i18n.translate("xpack.lens.app.downloadCSV",{defaultMessage:"Download as CSV"}),run:t.exportToCSV,testId:"lnsApp_downloadCSVButton",description:_.i18n.translate("xpack.lens.app.downloadButtonAriaLabel",{defaultMessage:"Download the data as CSV file"}),disableButton:!i,tooltip:o.showExportWarning}),n&&u.push({label:_.i18n.translate("xpack.lens.app.cancel",{defaultMessage:"Cancel"}),run:t.cancel,testId:"lnsApp_cancelButton",description:_.i18n.translate("xpack.lens.app.cancelButtonAriaLabel",{defaultMessage:"Return to the last app without saving changes"})}),u.push({label:d,iconType:r?void 0:"save",emphasize:!r,run:t.showSaveModal,testId:"lnsApp_saveButton",description:_.i18n.translate("xpack.lens.app.saveButtonAriaLabel",{defaultMessage:"Save the current lens visualization"}),disableButton:!c}),r&&u.push({label:_.i18n.translate("xpack.lens.app.saveAndReturn",{defaultMessage:"Save and return"}),emphasize:!0,iconType:"checkInCircleFilled",run:t.saveAndReturn,testId:"lnsApp_saveAndReturnButton",disableButton:!l,description:_.i18n.translate("xpack.lens.app.saveAndReturnButtonAriaLabel",{defaultMessage:"Save the current lens visualization and return to the last app"})}),u}({showSaveAndReturn:Boolean(C&&(y.allowByValueEmbeddables||Boolean(t))),enableExportToCSV:Boolean(T&&P&&Object.keys(P).length),isByValueMode:r(),allowByValue:y.allowByValueEmbeddables,showCancel:Boolean(C),savingToLibraryPermitted:R,savingToDashboardPermitted:V,tooltips:{showExportWarning:()=>{if(P){if(Object.values(P).some((e=>Object(fa.tableHasFormulas)(e.columns,e.rows))))return _.i18n.translate("xpack.lens.app.downloadButtonFormulasWarning",{defaultMessage:"Your CSV contains characters that spreadsheet applications might interpret as formulas."})}}},actions:{inspect:()=>a.inspect({title:c}),exportToCSV:()=>{if(!P)return;const e=Object.values(P),t=e.reduce(((t,n,a)=>{if(n){const i=e.length>1?`-${a+1}`:"";t[`${c||H}${i}.csv`]={content:De.exporters.datatableToCSV(n,{csvSeparator:f.get("csv:separator",","),quoteValues:f.get("csv:quoteValues",!0),formatFactory:m.deserialize,escapeFormulaValues:!1}),type:De.exporters.CSV_MIME_TYPE}}return t}),{});t&&Object(ad.downloadMultipleAs)(t)},saveAndReturn:()=>{var e;V&&(l((e=>e.default())),s({newTitle:c||"",newCopyOnSave:!1,isTitleDuplicateConfirmed:!1,returnToOrigin:!0},{saveToLibrary:null!==(e=t&&x.inputIsRefType(t))&&void 0!==e&&e}))},showSaveModal:()=>{(V||R)&&i(!0)},cancel:()=>{o&&o()}}})),[P,x,y.allowByValueEmbeddables,m.deserialize,r,t,C,T,c,l,o,s,V,R,i,f,H,a]),q=Object(h.useCallback)((e=>{const{dateRange:t,query:n}=e,a=p.query.timefilter.timefilter.getTime();t.from!==a.from||t.to!==a.to?(p.query.timefilter.timefilter.setTime(t),Object(at.e)("app_date_change")):(O({searchSessionId:p.search.session.start(),resolvedDateRange:Object(Tn.getResolvedDateRange)(p.query.timefilter.timefilter)}),Object(at.e)("app_query_change")),n&&(Object(Z.isEqual)(n,M)||O({query:n}))}),[p.query.timefilter.timefilter,p.search.session,O,M]),W=Object(h.useCallback)((e=>{O({savedQuery:e})}),[O]),$=Object(h.useCallback)((e=>{const t=e.attributes.filters||[],n=p.query.filterManager.getGlobalFilters();p.query.filterManager.setFilters([...n,...t]),O({query:e.attributes.query,savedQuery:{...e}})}),[p.query.filterManager,O]),Y=Object(h.useCallback)((()=>{p.query.filterManager.setFilters(p.query.filterManager.getGlobalFilters()),O({filters:p.query.filterManager.getGlobalFilters(),query:p.query.queryString.getDefaultQuery(),savedQuery:void 0})}),[p.query.filterManager,p.query.queryString,O]);return Object(E.jsx)(N,{setMenuMountPoint:e,config:G,showSaveQuery:Boolean(b.capabilities.visualize.saveQuery),savedQuery:S,onQuerySubmit:q,onSaved:W,onSavedQueryUpdated:$,onClearSavedQuery:Y,indexPatterns:k,query:M,dateRangeFrom:z,dateRangeTo:B,indicateNoData:n,showSearchBar:!0,showDatePicker:k.some((e=>e.isTimeBased()))||Boolean(D&&A&&u[A].isTimeBased(L[A].state)),showQueryBar:!0,showFilterBar:!0,"data-test-subj":"lnsApp_topNav",screenTitle:"lens",appName:"lens"})};var sd=n(110);function ld({history:e,onAppLeave:t,redirectTo:n,editorFrame:a,initialInput:i,incomingState:r,redirectToOrigin:s,setHeaderActionMenu:l,datasourceMap:o,visualizationMap:u}){const c=Object(dn.useKibana)().services,{data:d,chrome:p,uiSettings:m,inspector:g,application:f,notifications:b,savedObjectsTagging:x,getOriginatingAppName:y,spaces:j,http:O,dashboardFeatureFlag:k}=c,I=Object(id.E)(),F=Object(h.useCallback)((e=>I(Object(id.v)(e))),[I]),{persistedDoc:w,sharingSavedObjectProps:T,isLinkedToOriginatingApp:C,searchSessionId:M,isLoading:P,isSaveable:S}=Object(id.F)((e=>e.lens)),A=Object(id.F)((e=>Object(id.r)(e,o,u))),[L,D]=Object(h.useState)(!1),[N,z]=Object(h.useState)(!1),[B,R]=Object(h.useState)(void 0);Object(h.useEffect)((()=>{A&&R(A)}),[A]);const V=Object(h.useCallback)((()=>{D(!0)}),[D]);Object(h.useEffect)((()=>{L&&D(!1)}),[D,L,M]);const H=Object(h.useCallback)((()=>Boolean(k.allowByValueEmbeddables&&C&&!(null!=i&&i.savedObjectId))),[k.allowByValueEmbeddables,C,i]);Object(h.useEffect)((()=>{const t=Object(Rc.createKbnUrlStateStorage)({history:e,useHash:m.get("state:storeInSessionStorage"),...Object(Rc.withNotifyOnErrors)(b.toasts)}),{stop:n}=Object(De.syncQueryStateWithUrl)(d.query,t);return()=>{n()}}),[d.search.session,b.toasts,m,d.query,e]),Object(h.useEffect)((()=>{t((e=>{var t;return f.capabilities.visualize.save&&!Object(Z.isEqual)(null==w?void 0:w.state,null===(t=Object(sd.getLastKnownDocWithoutPinnedFilters)(B))||void 0===t?void 0:t.state)&&(S||w)?e.confirm(_.i18n.translate("xpack.lens.app.unsavedWorkMessage",{defaultMessage:"Leave Lens with unsaved work?"}),_.i18n.translate("xpack.lens.app.unsavedWorkTitle",{defaultMessage:"Unsaved changes"})):e.default()}))}),[t,B,S,w,f.capabilities.visualize.save]);const G=Object(h.useCallback)((()=>{if(j&&"conflict"===(null==T?void 0:T.outcome)&&null!=w&&w.savedObjectId){const t=w.savedObjectId,n=null==T?void 0:T.aliasTargetId,a=O.basePath.prepend(`${Object($.g)(n)}${e.location.search}`);return j.ui.components.getLegacyUrlConflict({objectNoun:_.i18n.translate("xpack.lens.appName",{defaultMessage:"Lens visualization"}),currentObjectId:t,otherObjectId:n,otherObjectPath:a})}return null}),[w,T,j,O,e]);Object(h.useEffect)((()=>{const e=H(),t=[];C&&y()&&s&&t.push({onClick:()=>{s()},text:y()}),e||t.push({href:f.getUrlForApp("visualize"),onClick:e=>{f.navigateToApp("visualize",{path:"/"}),e.preventDefault()},text:_.i18n.translate("xpack.lens.breadcrumbsTitle",{defaultMessage:"Visualize Library"})});let n=_.i18n.translate("xpack.lens.breadcrumbsCreate",{defaultMessage:"Create"});w&&(n=e?_.i18n.translate("xpack.lens.breadcrumbsByValue",{defaultMessage:"Edit visualization"}):w.title),t.push({text:n}),p.setBreadcrumbs(t)}),[k.allowByValueEmbeddables,y,s,H,f,p,C,w]);const q=Object(h.useCallback)(((e,a)=>Object(sd.runSaveLensVisualization)({lastKnownDoc:B,getIsByValueMode:H,savedObjectsTagging:x,initialInput:i,redirectToOrigin:s,persistedDoc:w,onAppLeave:t,redirectTo:n,originatingApp:null==r?void 0:r.originatingApp,...c},e,a).then((e=>{e&&(F(e),z(!1))}),(()=>{}))),[null==r?void 0:r.originatingApp,B,w,H,x,i,s,t,n,c,F,z]);return Object(E.jsx)(v.a.Fragment,null,Object(E.jsx)("div",{className:"lnsApp","data-test-subj":"lnsApp"},Object(E.jsx)(rd,{initialInput:i,redirectToOrigin:s,getIsByValueMode:H,onAppLeave:t,runSave:q,setIsSaveModalVisible:z,setHeaderActionMenu:l,indicateNoData:L,datasourceMap:o,title:null==w?void 0:w.title,lensInspector:g}),G(),(!P||w)&&Object(E.jsx)(od,{editorFrame:a,showNoDataPopover:V,lensInspector:g})),N&&Object(E.jsx)(sd.SaveModalContainer,{lensServices:c,originatingApp:C?null==r?void 0:r.originatingApp:void 0,isSaveable:S,runSave:q,onClose:()=>{z(!1)},getAppNameFromId:()=>y(),lastKnownDoc:B,onAppLeave:t,persistedDoc:w,initialInput:i,redirectTo:n,redirectToOrigin:s,returnToOriginSwitchLabel:H()&&i?_.i18n.translate("xpack.lens.app.updatePanel",{defaultMessage:"Update panel on {originatingAppName}",values:{originatingAppName:y()}}):void 0}))}const od=v.a.memo((function({editorFrame:e,showNoDataPopover:t,lensInspector:n}){const{EditorFrameContainer:a}=e;return Object(E.jsx)(a,{showNoDataPopover:t,lensInspector:n})}));var ud=n(105);async function cd(e,t,n){const{data:a,inspector:i,navigation:r,embeddable:s,savedObjectsTagging:l,usageCollection:o,fieldFormats:u,spaces:c}=t,d=new Rc.Storage(localStorage),p=null==s?void 0:s.getStateTransfer(),m=null==p?void 0:p.getIncomingEditorState($.a);return{data:a,storage:d,inspector:ed(i),navigation:r,fieldFormats:u,stateTransfer:p,usageCollection:o,savedObjectsTagging:l,attributeService:n,http:e.http,chrome:e.chrome,overlays:e.overlays,uiSettings:e.uiSettings,application:e.application,notifications:e.notifications,savedObjectsClient:e.savedObjects.client,presentationUtil:t.presentationUtil,dashboard:t.dashboard,getOriginatingAppName:()=>null!=m&&m.originatingApp?null==p?void 0:p.getAppNameFromId(m.originatingApp):void 0,dashboardFeatureFlag:t.dashboard.dashboardFeatureFlagConfig,spaces:c}}async function dd(e,t,n){const{createEditorFrame:a,attributeService:i,getPresentationUtilContext:r}=n,[s,l]=await e.getStartServices(),o=await a(),u=t.history.location.state,c=await cd(s,l,i),{stateTransfer:d,data:p,storage:m}=c,g=null==d?void 0:d.getIncomingEditorState($.a);var f,b;f=s.chrome,b=s.docLinks,f.setHelpExtension({appName:"Lens",links:[{linkType:"documentation",href:b.links.visualize.lensPanels},{linkType:"github",title:"[Lens]",labels:["Feature:Lens"]}]}),s.chrome.docTitle.change(_.i18n.translate("xpack.lens.pageTitle",{defaultMessage:"Lens"})),Object(at.b)(new at.a({http:e.http,storage:m}));const j=e=>{if(null==g||!g.originatingApp)throw new Error("redirectToOrigin called without an originating app");if(d&&null!=e&&e.input){const{input:t,isCopied:n}=e;d.navigateToWithEmbeddablePackage(null==g?void 0:g.originatingApp,{path:null==g?void 0:g.originatingPath,state:{embeddableId:n?void 0:g.embeddableId,type:$.e,input:t,searchSessionId:p.search.session.getSessionId()}})}else s.application.navigateToApp(null==g?void 0:g.originatingApp,{path:null==g?void 0:g.originatingPath})},k=u&&u.type===Zu.ACTION_VISUALIZE_LENS_FIELD?u.payload:void 0;null!=g&&g.searchSessionId&&p.search.session.continue(g.searchSessionId);const{datasourceMap:I,visualizationMap:F}=o,w={lensServices:c,datasourceMap:I,visualizationMap:F,embeddableEditorIncomingState:g,initialContext:k},T=Object(ud.a)(w),C=Object(id.c)(w,{lens:T}),M=v.a.memo((e=>{const n=Object(h.useCallback)((t=>{var n,a;n=e.history,(a=t)?n.push({pathname:`/edit/${a}`,search:n.location.search}):n.push({pathname:"/",search:n.location.search})}),[e.history]);Object(at.e)("loaded");const a=(i=e.id,e.editByValue?null==g?void 0:g.valueInput:i?{savedObjectId:i}:void 0);var i;return k||p.query.filterManager.setAppFilters([]),C.dispatch(Object(ud.d)(T)),C.dispatch(Object(id.b)({redirectCallback:n,initialInput:a,history:e.history})),Object(E.jsx)(nd.Provider,{store:C},Object(E.jsx)(ld,{incomingState:g,editorFrame:o,initialInput:a,redirectTo:n,redirectToOrigin:j,onAppLeave:t.onAppLeave,setHeaderActionMenu:t.setHeaderActionMenu,history:e.history,datasourceMap:I,visualizationMap:F}))})),P=e=>Object(E.jsx)(M,{id:e.match.params.id,history:e.history,editByValue:e.editByValue});const S=t.history.listen((()=>{window.dispatchEvent(new HashChangeEvent("hashchange"))}));t.element.classList.add("lnsAppWrapper");const A=r();return Object(y.render)(Object(E.jsx)(O.I18nProvider,null,Object(E.jsx)(dn.KibanaContextProvider,{services:c},Object(E.jsx)(A,null,Object(E.jsx)(td.HashRouter,null,Object(E.jsx)(td.Switch,null,Object(E.jsx)(td.Route,{exact:!0,path:"/edit/:id",component:P}),Object(E.jsx)(td.Route,{exact:!0,path:`/${$.d}`,render:e=>Object(E.jsx)(P,x()({},e,{editByValue:!0}))}),Object(E.jsx)(td.Route,{exact:!0,path:"/",component:P}),Object(E.jsx)(td.Route,{path:"/",component:function(){return Object(at.e)("loaded_404"),Object(E.jsx)(O.FormattedMessage,{id:"xpack.lens.app404",defaultMessage:"404 Not Found"})}})))))),t.element),()=>{p.search.session.clear(),Object(y.unmountComponentAtNode)(t.element),c.inspector.close(),S(),C.dispatch(Object(id.d)())}}var pd=n(50),md=n(3);function gd(e,t){const n=new Xc.a(e.savedObjects.client);return t.embeddable.getAttributeService(md.DOC_TYPE,{saveMethod:async(e,t)=>({id:(await n.save({...e,savedObjectId:t,type:md.DOC_TYPE})).savedObjectId}),unwrapMethod:async e=>{const{saved_object:t,outcome:a,alias_target_id:i}=await n.load(e),{attributes:r,references:s,id:l}=t;return{attributes:{...{...r,references:s}},metaInfo:{sharingSavedObjectProps:{aliasTargetId:i,outcome:a,sourceId:l}}}},checkForDuplicateTitle:t=>{const n=e.savedObjects.client,a=e.overlays;return Object(pd.checkForDuplicateTitle)({title:t.newTitle,copyOnSave:!1,lastSavedTitle:"",getEsType:()=>md.DOC_TYPE,getDisplayName:()=>md.DOC_TYPE},t.isTitleDuplicateConfirmed,t.onTitleDuplicate,{savedObjectsClient:n,overlays:a})}})}}])]);